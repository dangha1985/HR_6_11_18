ZPFRules={ruleObj:{},conditionObj:{},actionObj:{},params:{},url:"/fieldRules.zp",rulesArray:[],formFields:[],ruleGroupTemplate:'<div class="panel-group dvaddruleacc" id="dvAddruleparent">$RULECONSTRUCT$</div>',errorTemplate:'<div class="dverrormsg DN" errorid="errorDiv"></div>',ruleHeaderTemplate:'<div class="panel clearfix" name="singleRuleDiv"><a name="deleteIcon" class="IC-delete gry FR lnkcls" onclick="ZPFRules.deleteRule({}, {forPost:true}, {obj:this})"></a><div name="ruleToggleDiv" class="GryBG panel-heading PT5 PL10 PB3" data-parent="#dvAddruleparent" data-target="#dvRule$COUNT$" onclick="ZPFRules.collapseElement(this)"><h6 class="ZPbold S16">'+ZPI18N.getString("zp.rule")+' $COUNT$</h6></div><div id="dvRule$COUNT$" $RULEID$ class="panel panel-collapse collapse col-md-12"><div class="dvCriteria clearfix dvfrmaddrule MT35"><div class="clearfix PB5"></div>$RULEDIV$</div><div class="dverrormsg DN" errorid="errorDiv"></div></div></div>',ruleIfDivTemplate:'<div class="form-group spnpostxt" id="$RULEID$"><label>'+ZPI18N.getString("zp.if")+'</label><select class="selectBox" id="ruleOperator"><option value="0" $SELECTED0$>'+ZPI18N.getString("zp.all")+'</option><option value="1" $SELECTED1$>'+ZPI18N.getString("zp.any")+"</option></select><label>"+ZPI18N.getString("zp.followingconditionsmet")+"</label></div>",selectTemplate:'<select class="selectBox" keyname="$KEYNAME$" onchange="$METHOD$" $MULTIPLE$>$OPTIONS$</select>',ruleConditionTemplate:'<div class="form-group $CLASS$" id="$ID$" name="$NAME$" key="$KEY$">$CONDITION$</div>',addRemoveTemplate:'<div class="form-group col-md-1" name="addRemoveDiv"><div class="dvlist-action MT8"><a class="IC-plus-big S12 MR15 gry" onclick="ZPFRules.addDeleteCondition(this, true)"></a><a class="IC-mins gry S12" onclick="ZPFRules.addDeleteCondition(this, false)"></a></div></div>',optionsTemplate:'<div class="tabvertical tabselect DN" id="conditionDropdownSelection"><div class="rhttablst"><div class="dvPopsearch"><input class="form-control" onkeyup="ZPFRules.searchOptions(this)" type="search" placeholder="'+ZPI18N.getString("zp.search")+'..."></div><ul class="list-group ulRecipient" role="tablist" id="listBody">$LIST$</ul></div></div>',liTemplate:'<li name="list-group-item" class="$CLASS$" onclick="ZPFRules.conditionSelectRecord(this)"><span data-toggle="tab" role="tab" name="mOpt" id="$LISTID$">$LISTVALUE$</span></li>',formActionUsedFields:{},leaveTypes:[],setEmptyFcs:[]},ZPFRules.OPERATOR={SHOW:0,HIDE:1,ALL:0,ANY:1},ZPFRules.ruleCreation=function(obj){var eles=$(obj).parents("#rule").find("[id*=dvRule]"),hasError=!1,isUpdate=!0,rulesArray=[];$(obj).parents("#rule").find("[errorid]").html(),$(obj).parents("#rule").find("[errorid]").hide(),eles.length>0&&$.each(eles,function(index,rule){isUpdate=!0;var ruleObject={},checkRuleObject={},conditionActionArray=[];ruleObject.ruleId=$(rule).attr("ruleid"),ruleObject.operator=$(rule).find("#ruleOperator").val(),void 0!=ruleObject.ruleId&&""!=ruleObject.ruleId&&(checkRuleObject=ZPFRules.findObject(ZPForm.FIELD_RULE_DETAILS[$(obj).parents("#rule").find("#bodyTag").attr("formid")],"ruleId",ruleObject.ruleId),""!=checkRuleObject&&void 0!=checkRuleObject&&checkRuleObject.operator==ruleObject.operator&&(isUpdate=!1)),$.each($(rule).find("[key=conditionFields]"),function(ind,condition){var checkConditionActionObject={},conditionActionObject={},attrId=$(condition).attr("id").toString();if(null!=attrId.match(/[\d]+$/)&&(conditionActionObject.conditionId=attrId.match(/[\d]+$/).toString(),checkConditionActionObject=ZPFRules.findObject(checkRuleObject.conditionArray,"conditionId",conditionActionObject.conditionId)),conditionActionObject.fcid=$(condition).find("[keyname]").val(),isUpdate||checkConditionActionObject.fcid==conditionActionObject.fcid||(isUpdate=!0),0==conditionActionObject.fcid.trim().length)$(condition).find("[errorid=errorDiv]").html("Please select a field for condition"),$(condition).find("[errorid=errorDiv]").show(),hasError=!0;else{var fieldValueObject=$(condition).next("[key=condition]").next("[key=fieldValue]");conditionActionObject.operator=$(condition).next("[key=condition]").find("[keyname=operator]").val(),conditionActionObject.value=$(fieldValueObject).find("#fieldValue").val();var fieldDtls=ZPForm.Field.getFieldComponent(conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"));if((fieldDtls.fieldType==ZPForm.Field.LOOKUP||fieldDtls.fieldType==ZPForm.Field.PICKLIST)&&$(fieldValueObject).find("#optionsIcon").length>0&&$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var valArr=$(fieldValueObject).find("#conditionDropdownSelection #listBody li.sel").length>1?conditionActionObject.value.split(","):[conditionActionObject.value],value="";for(val in valArr)value+=ZPFRules.findOptions(valArr[val],conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"),!0)+",";value=value.substring(0,value.length-1),conditionActionObject.value=value}else if(fieldDtls.fieldType==ZPForm.Field.DATE_TIME&&!ZPFRules.checkEmptyValue(conditionActionObject.value)){var val=conditionActionObject.value;Calendar.is12HrFormat()&&(conditionActionObject.value=Calendar.convertHourFormat(val))}if($.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.TRUE,ZPNewView.OPERATORS.FALSE,ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])<0&&(void 0==conditionActionObject.value||"null"==conditionActionObject.value||0==conditionActionObject.value.trim().length))$(fieldValueObject).find("[errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),$(fieldValueObject).find("[errorid=errorDiv]").show(),hasError=!0;else{if(void 0!=checkConditionActionObject.operator){var checkValue=checkConditionActionObject.value;fieldDtls.fieldType==ZPForm.Field.DATE&&(checkValue=Calendar.parseDate(checkValue,"%Y-%m-%d"),checkValue=Calendar.formatDate(checkValue)),isUpdate||checkValue==conditionActionObject.value&&checkConditionActionObject.operator==conditionActionObject.operator||(isUpdate=!0)}else isUpdate||(isUpdate=!0);conditionActionArray.push(conditionActionObject)}}}),isUpdate||checkRuleObject.conditionArray.length==conditionActionArray.length||(isUpdate=!0),ruleObject.conditionArray=conditionActionArray;var showHideArray=[],actionArray=[];if($.each($(rule).find("[key=action]"),function(index1,action){var conditionActionObject={},checkConditionActionObject={};showHideArray=$(action).next("#actionFields").find("select").val(),null!=showHideArray&&0!=showHideArray.length&&(conditionActionObject.operator=$(action).find("label").attr("saveValue"),void 0!=ruleObject.ruleId&&(checkConditionActionObject=ZPFRules.findObject(checkRuleObject.actionArray,"operator",conditionActionObject.operator),void 0==checkConditionActionObject.operator?isUpdate=!0:isUpdate||ZPFRules.containsAllElements(checkConditionActionObject.fieldArray,showHideArray)||(isUpdate=!0)),conditionActionObject.fieldArray=showHideArray,actionArray.push(conditionActionObject))}),0==actionArray.length){hasError=!0;var errorAt=$(rule).find("#actionFields").parent().children("[errorid=errorDiv]");$(errorAt).html(ZPI18N.getString("zp.showhidefield")),$(errorAt).show()}isUpdate||checkRuleObject.actionArray.length==actionArray.length||(isUpdate=!0),ruleObject.actionArray=actionArray,isUpdate&&rulesArray.push(ruleObject)}),!hasError&&rulesArray.length>0&&(ZPFRules.params={rulesArray:JSON.stringify(rulesArray),formId:$(obj).parents("#rule").find("#bodyTag").attr("formid"),method:"addUpdate"},ZPeople.Request.send(ZPFRules.url,ZPFRules.params,ZPFRules.saveRule))},ZPFRules.saveRule=function(data,params){if(data.hasOwnProperty("msg")){var msg=data.msg.trim();if("success"==msg){var formRuleArray=ZPForm.FIELD_RULE_DETAILS[params.formId],ruleArray=JSON.parse(params.rulesArray),isUpdate=!1;for(index in ruleArray){var ruleObject=ruleArray[index],ruleDiv="",ruleIndex=0,responseRuleObj="",fieldElms=[],actionElms=[];if(responseRuleObj=data.ruleArray[index],ruleObject.hasOwnProperty("ruleId")){var indexObj=ZPFRules.findObject(formRuleArray,"ruleId",ruleObject.ruleId,"index");ruleIndex=indexObj.index,ruleDiv=Layout.Page.container.find("#dvRule"+(parseInt(ruleIndex)+1)),isUpdate=!0}else ruleIndex=formRuleArray.length,ruleDiv=Layout.Page.container.find("#dvRule"+(parseInt(ruleIndex)+1)),$(ruleDiv).attr("ruleid",responseRuleObj.ruleId);$.each(responseRuleObj.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),responseRuleObj.fieldElms=fieldElms,$.each(responseRuleObj.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),responseRuleObj.actionElms=actionElms,formRuleArray[ruleIndex]=responseRuleObj,ZPForm.FIELD_RULE_DETAILS[params.formId]=formRuleArray;var i=($(ruleDiv).find("[name=conditionDiv]"),0);$.each(data.ruleArray[index].conditionArray,function(index,condition){var conditionId=condition.conditionId;null!=$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id").match(/[\d]+$/)?($(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i++ +")").attr("id").replace(/[\d]+$/,conditionId)),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i++ +")").attr("id").replace(/[\d]+$/,conditionId)),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i++ +")").attr("id").replace(/[\d]+$/,conditionId))):($(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i++ +")").attr("id")+conditionId),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i++ +")").attr("id")+conditionId),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i++ +")").attr("id")+conditionId))}),Layout.Page.container.find("[errorid]").hide(),Layout.Page.container.find("[errorid]").html("")}isUpdate?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.updatedmsg")])):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.addedmsg")])),ZPForm.FIELD_RULE_DETAILS[params.formId].formComponent=[]}else"failure"==msg||""==msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")):ZPeople.confirm(null,"",msg,"",!0,!0)}else data.hasOwnProperty("failure")&&ZPeople.confirm(null,"",data.failue,"",!0,!0)},ZPFRules.constructRulesJson=function(data,params){if(data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR){if(ZPFRules.rulesArray=[],void 0!=data.ruleArray&&(ZPFRules.rulesArray=data.ruleArray,delete data.ruleArray,$.each(ZPFRules.rulesArray,function(index,val){var fieldElms=[],actionElms=[];$.each(val.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),val.fieldElms=fieldElms,$.each(val.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),val.actionElms=actionElms})),data.hasOwnProperty("leaveTypes")&&data.leaveTypes.length>0){var leaveTypesData=data.leaveTypes,options=[],option={};$.each(leaveTypesData,function(i,types){option={},option.Id=types.id,option.DISPVALUE=types.name,options.push(option)}),ZPFRules.leaveTypes=options}ZPForm.FIELD_RULE_DETAILS[params.formId]=ZPFRules.rulesArray,ZPForm.FIELD_RULE_DETAILS[params.formId].formComponent=[],ZPForm.CURRFORM_PARAM.formId=data.formId,window.location.href.split("#")[1]&&window.location.href.split("#")[1].indexOf("admin/formslayout")>=0&&!ZPForm.isPreviewForm&&!ZPForm.isRoleBasedPreview&&ZPFRules.rulesConstruction(params.formId)}else data.hasOwnProperty("failue")&&ZPeople.confirm(null,"",data.failue.trim(),"",!0,!0)},ZPFRules.evaluateRulesForAllFields=function(isQuickAdd){if(ZPFRules.LAYOUT=ZPForm.PRINT?ZPForm.PRINTPAGE_DATA:ZPForm.LAYOUT,0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].length){$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){rule.isExecuted=!1});var formFields=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails;$.each(formFields,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){void 0!=field&&ZPFRules.evaluateRules(field,isQuickAdd)})})}),$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){!rule.isExecuted&&rule.hasNotes&&ZPFRules.evaluateSingleRule(rule,isQuickAdd)})}},ZPFRules.evaluateRules=function(field,isQuickAdd){var fcId=field.formComponentId,type=field.fieldType,obj=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcId);void 0==ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcId]&&(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcId]=[]),0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].length&&($.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){1==isQuickAdd?-1!=$.inArray(fcId,rule.actionElms)&&(rule.isExecuted||ZPFRules.evaluateSingleRule(rule,isQuickAdd),$.each(rule.conditionArray,function(j,condition){var condObj=ZPFRules.LAYOUT.find("[id=zp_field_outer_"+condition.fcid+"]");condObj.length>0&&($(condObj).attr("isconditionfield",!0),void 0==ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid]&&(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid]=[]),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid].push(rule))})):-1!=$.inArray(fcId,rule.fieldElms)?(rule.isExecuted||ZPFRules.evaluateSingleRule(rule,type),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcId].push(rule),$(obj).length>0&&$(obj).attr("isconditionfield",!0)):-1!=$.inArray(fcId,rule.actionElms)&&(type==ZPForm.Field.PLAIN_TEXT?void 0==rule.hasNotes&&(rule.hasNotes=!0):rule.hasNotes=!1)}),$(obj).length>0&&(obj=$(obj).find("[id^=zp_field_]").length>0?$(obj).find("[id^=zp_field_]"):obj,void 0!=$(obj).attr("displaytype")?$(obj).attr("displaytype")==ZPForm.Field.RADIO_DISPLYTYPE?($(obj).find("input").unbind("click",ZPFRules.makeExecutefalse),$(obj).find("input").unbind("click",ZPFRules.evaluateRulesForField),$(obj).find("input").click(function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)})):$(obj).attr("displaytype")==ZPForm.Field.SELECT_DISPLYTYPE&&($(obj).find("select").unbind("change",ZPFRules.makeExecutefalse),$(obj).find("select").unbind("change",ZPFRules.evaluateRulesForField),$(obj).find("select").change(function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)})):($(obj).unbind("change",ZPFRules.makeExecutefalse),$(obj).unbind("change",ZPFRules.evaluateRulesForField),$(obj).change(function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)}))))},ZPFRules.evaluateSingleRule=function(rule,isQuickAdd){var str=0,noOfConditions=0;$.each(rule.conditionArray,function(j,condition){var result="",field=ZPForm.Field.getFieldComponent(condition.fcid,ZPForm.CURRFORM_PARAM.formId);if(void 0!=field){var type=field.fieldType;result=type==ZPForm.Field.DATE?ZPFRules.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):type==ZPForm.Field.DATE_TIME?ZPFRules.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):ZPFRules.evaluateCondition(condition,condition.fcid,field,isQuickAdd),condition.result=result,str+=result,noOfConditions++}});var result=!1;str>0&&(result=rule.operator==ZPFRules.OPERATOR.ALL?str==noOfConditions:str>0),rule.result=result;var executeRulesFor=[];for(i=0;i<rule.actionArray.length;i++){var actionObj=rule.actionArray[i].fieldArray;if(actionObj.length>0)for(j=0;j<actionObj.length;j++){var field=ZPForm.Field.getFieldComponent(actionObj[j],ZPForm.CURRFORM_PARAM.formId);(void 0!=field&&field.fieldType!=ZPForm.Field.SCRIPT||!ZPForm.isAddMode())&&(ZPFRules.evaluateAction(rule.actionArray[i].operator,actionObj[j],rule.result),executeRulesFor.push(actionObj[j]))}if(i+1==rule.actionArray.length){var fcsArray=executeRulesFor.slice();for(ZPFRules.makeExecutefalse(fcsArray);executeRulesFor.length>0;)ZPFRules.evaluateRulesForField(executeRulesFor.pop(),!0);rule.isExecuted=!0}}},ZPFRules.getFieldType=function(fcid){return ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid).attr("fieldtype")},ZPFRules.evaluateCondition=function(condition,fcid,field,isQuickAdd){var fcType=field.fieldType,operator=parseInt(condition.operator),inputObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid),value="";if(1!=isQuickAdd||void 0!=inputObject&&0!=inputObject.length)if(value=ZPFRules.getInputValue(inputObject,fcType),fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY||ZPFRules.checkEmptyValue(value,fcType)){var dispType=field.hasOwnProperty("displayType")?field.displayType:0;"Select"!=value&&"-Select-"!=value||!($.inArray(fcType,[ZPForm.Field.PICKLIST,ZPForm.Field.LOOKUP])>-1&&$.inArray(parseInt(dispType),[ZPForm.Field.SELECT_DISPLYTYPE,ZPForm.Field.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[ZPForm.Field.COUNTRY,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER])>-1)||(value="")}else{for(value=Number(value).toString();value.length>1&&0==value.indexOf("0");)value=value.substring(1);var decPointIndex=value.indexOf(".");if(decPointIndex>=0){for(var decStr=value.substring(decPointIndex+1,value.length);decStr.length>0&&"0"==decStr.substring(decStr.length-1,decStr.length);)decStr=decStr.substring(0,decStr.length-1);value=""==decStr.trim()?value.substring(0,decPointIndex):value.replace(value.substring(decPointIndex+1,value.length),decStr)}}else value=fcType==ZPForm.Field.CHECK_BOX?"false":"";var conditionResult=!1;condition.value;if(null!=value&&"null"!=value&&""!=value&&(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST))if($.inArray(operator,[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1&&(0==$(inputObject).find("input,select").length||!$(inputObject).find("input,select").is(":visible")||fcType==ZPForm.Field.PICKLIST))if(fcType==ZPForm.Field.LOOKUP){var fieldData=ZPForm.Field.getFieldValueData(fcid);value=void 0!=fieldData?fieldData.componentValue_ID:ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId,!0)}else value=ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId,!0);else $.inArray(operator,[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])<0&&$(inputObject).find("input,select").length>0&&$(inputObject).find("input,select").is(":visible")&&fcType==ZPForm.Field.LOOKUP&&(value=ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId).trim());switch(operator){case ZPNewView.OPERATORS.EQUAL:conditionResult=ZPFRules.checkEqual(value,condition.value,fcType);break;case ZPNewView.OPERATORS.NOT_EQUAL:conditionResult=!ZPFRules.checkEqual(value,condition.value,fcType);break;case ZPNewView.OPERATORS.EMPTY:conditionResult=ZPFRules.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;case ZPNewView.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRules.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;default:if(operator==ZPNewView.OPERATORS.NOT_CONTAINS)conditionResult=!ZPFRules.checkIfContains(value,condition.value,fcType);else if(null!=value&&"null"!=value)switch(operator){case ZPNewView.OPERATORS.CONTAINS:conditionResult=ZPFRules.checkIfContains(value,condition.value,fcType);break;case ZPNewView.OPERATORS.STARTS_WITH:conditionResult=0==value.indexOf(condition.value);break;case ZPNewView.OPERATORS.ENDS_WITH:var startWith=value.length-condition.value.length;conditionResult=condition.value==value.substring(startWith,value.length);break;case ZPNewView.OPERATORS.LESS_THAN:conditionResult=ZPFRules.checkLessThan(value,condition.value);break;case ZPNewView.OPERATORS.GREATER_THAN:conditionResult=ZPFRules.checkGreaterThan(value,condition.value);break;case ZPNewView.OPERATORS.LESS_EQUAL:conditionResult=ZPFRules.checkLessThan(value,condition.value)||ZPFRules.checkEqual(value,condition.value);break;case ZPNewView.OPERATORS.GREATER_EQUAL:conditionResult=ZPFRules.checkGreaterThan(value,condition.value)||ZPFRules.checkEqual(value,condition.value);break;case ZPNewView.OPERATORS.TRUE:conditionResult=1==value||"true"==value.trim();break;case ZPNewView.OPERATORS.FALSE:conditionResult=0==value||"false"==value.toString().trim()}}return conditionResult},ZPFRules.getInputValue=function(inputObject,fcType){if($(inputObject).hasClass("DN")||$(inputObject).parent("div").hasClass("DN"))return"";var inputDiv=$(inputObject).find("[id*=zp_field_]:visible");if($(inputObject).parents("#zp_form_body").siblings("div").length>0&&(0==$(inputObject).find("#zp_fieldedit_comp").length||$(inputObject).find("#zp_fieldedit_comp").not(".DN").length>0)&&(inputDiv=$(inputObject).find("[id*=zp_field_]")),!($(inputDiv).length>0)){if(void 0!=$(inputObject).attr("displaytype")&&$(inputObject).attr("displaytype")==ZPForm.Field.RADIO_DISPLYTYPE){if($(inputObject).find("input[type=radio]:visible").length>0)return $(inputObject).find("input[type=radio]:checked").val();var val=$(inputObject).find("span:first").text();return"-"==val.trim()&&(val=""),val}if($(inputObject).find("span:visible").length>0){var val=$(inputObject).find("span:visible").text();return"-"==val.trim()&&(val=""),val}return $(inputObject).text()}return $(inputObject).find("select").length>0?$(inputObject).find("select option:selected").val():$(inputObject).find("input").length>0?fcType==ZPForm.Field.CHECK_BOX?$(inputObject).find("input").is(":checked")+"":$(inputObject).find("input").length>1?$(inputObject).find("input[name]").val():$(inputObject).find("input").val():$(inputObject).find("textarea").length>0?$(inputObject).find("textarea").val():void 0},ZPFRules.checkEmptyValue=function(value,fcType,dispType){return $.inArray(fcType,[ZPForm.Field.PICKLIST,ZPForm.Field.LOOKUP])>-1&&$.inArray(parseInt(dispType),[ZPForm.Field.SELECT_DISPLYTYPE,ZPForm.Field.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[ZPForm.Field.COUNTRY,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER])>-1?"Select"==value||""==value||"-Select-"==value:null==value||""==value||"null"==value||"-"==value},ZPFRules.checkEqual=function(value1,value2,fcType){if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST){var valArr=value2.split(",");return valArr.indexOf(value1+"")>-1}if(fcType==ZPForm.Field.URL){if(value1.indexOf("://")>-1&&value2.indexOf("://")<0)return value1.split("://")[1].trim()==value2.trim();if(value2.indexOf("://")>-1&&value1.indexOf("://")<0)return value2.split("://")[1].trim()==value1.trim()}return value1==value2},ZPFRules.checkLessThan=function(value1,value2){return Number(value1)<Number(value2)},ZPFRules.checkGreaterThan=function(value1,value2){return Number(value1)>Number(value2)},ZPFRules.checkOptionsEmpty=function(value1,value2){return"-Select-"==value},ZPFRules.checkIfContains=function(value1,value2,fcType){return value1.indexOf(value2)>-1},ZPFRules.evaluateAction=function(operator,field,result){var actionFieldObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+field),relatedFieldsObject=ZPFRules.LAYOUT.find("[id*=zp_form_relfield_"+field+"]"),parentSectionDiv=null,hideSection=null,isFieldShow=null,secDtls=ZPFRules.findSec(field);if(operator==ZPFRules.OPERATOR.SHOW&&result||operator==ZPFRules.OPERATOR.HIDE&&!result?(isFieldShow=!0,actionFieldObject.length>0&&($(relatedFieldsObject).removeClass("DN"),$(relatedFieldsObject).attr("isActionHidden",!1))):actionFieldObject.length>0&&($(relatedFieldsObject).addClass("DN"),$(relatedFieldsObject).attr("isActionHidden",!0)),$(actionFieldObject).parent("div").length>0||!secDtls.isTabular){if(parentSectionDiv=$(actionFieldObject).parents("[id^=zp_section_fields_]"),ZPForm.PRINT&&(parentSectionDiv=parentSectionDiv.parents("[id^=zp_section_fields_]")),1==isFieldShow)if(void 0==$(actionFieldObject).attr("fieldtype")?$(actionFieldObject).removeClass("DN"):($(actionFieldObject).parent("div").removeClass("DN"),secDtls.isTabular&&ZPFRules.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").removeClass("DN"),$(this).attr("isActionHidden",!1)})),$(actionFieldObject).attr("isActionHidden",!1),$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length>0)1==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length&&(hideSection=!1);else{var notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DN").length>notPlainTextFieldsLength&&(hideSection=!1)}else if(void 0==$(actionFieldObject).attr("fieldtype")?$(actionFieldObject).addClass("DN"):($(actionFieldObject).parent("div").addClass("DN"),secDtls.isTabular&&ZPFRules.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").addClass("DN"),$(this).attr("isActionHidden",!0)})),$(actionFieldObject).attr("isActionHidden",!0),ZPFRules.setEmptyFcs.push(field),0==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length){var notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DN").length==notPlainTextFieldsLength&&(hideSection=!0)}}else if(secDtls.isTabular){var sectionDiv=ZPFRules.LAYOUT.find("#zp_section_fields_"+secDtls.sectionId),resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",field,"index");0!=resultObj.length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",field,"index")),parentSectionDiv=sectionDiv;var index=resultObj.index+1,headerObject=$(sectionDiv).find("thead th:nth-child("+index+")");if(1==isFieldShow){sectionDiv.find("tbody tr").each(function(){$(this).find("td:nth-child("+index+")").removeClass("DN"),$(this).find("td:nth-child("+index+")").attr("isActionHidden",!1)});var tdLen=ZPForm.isViewMode()?1:2;$(headerObject).removeClass("DN"),sectionDiv.find("tr th").not(".DN").length==tdLen&&(hideSection=!1),$(actionFieldObject).attr("isActionHidden",!1)}else{0==sectionDiv.find('tbody tr td:contains("No rows found.")').length&&sectionDiv.find("tbody tr").each(function(){$(this).find("td:nth-child("+index+")").addClass("DN"),$(this).find("td:nth-child("+index+")").attr("isActionHidden",!0)});var tdLen=ZPForm.isViewMode()?0:1;$(headerObject).addClass("DN"),sectionDiv.find("th").not(".DN").length==tdLen&&(hideSection=!0),ZPFRules.setEmptyFcs.push(field),$(actionFieldObject).attr("isActionHidden",!0)}}if($(parentSectionDiv).length>0){var isMultiPageLayout=$(parentSectionDiv).parents("#zp_form_body").siblings().length>0?!0:!1,secId=$(parentSectionDiv).attr("id").split("_").pop();$(parentSectionDiv).is(":visible")||0!=hideSection?1==hideSection&&($(parentSectionDiv).is(":visible")||$(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").is(":visible")||ZPForm.PRINT)&&(isMultiPageLayout&&$(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").hide(),$(parentSectionDiv).addClass("DN"),ZPForm.PRINT||ZPeople.isZPNewUI()?$(parentSectionDiv).prev("h3").addClass("DN"):$(parentSectionDiv).prev("h6").addClass("DN")):isMultiPageLayout?$(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").show():($(parentSectionDiv).removeClass("DN"),ZPForm.PRINT||ZPeople.isZPNewUI()?$(parentSectionDiv).prev("h3").removeClass("DN"):$(parentSectionDiv).prev("h6").removeClass("DN"))}else{var secId=ZPFRules.findSecId(ZPForm.CURRFORM_PARAM.formId,field),secObj=$(actionFieldObject).prevAll("#"+secId);0==secObj.length&&(secObj=$(actionFieldObject).parents("[isallowed]").prevAll("#"+secId)),1==isFieldShow?1==secObj.nextAll("[isallowed]").not(".DN").length&&secObj.removeClass("DN"):0==secObj.nextAll("[isallowed]").not(".DN").length&&secObj.addClass("DN")}},ZPFRules.evaluateRulesForField=function(obj,isFcid){var fcid=obj;if(isFcid||(void 0==obj?obj=ZPFRules.LAYOUT.find("[id^=zp_field_outer_]:active"):obj instanceof Date?obj=$(Calendar.currentObj).parents("[id*=zp_field_outer_]"):$(obj).is(":radio")&&(obj=$(obj).parents("[displaytype]")),fcid=$(obj).attr("id").split("_").pop(),ZPFRules.makeExecutefalse([fcid])),isFcid||$(obj).find("#zp_formedit_cancel").click(function(event){ZPFRules.evaluateRulesForField($(this).parents("[id*=zp_field_outer_]"))}),void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]&&ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)){var rulesArray=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcid];rulesArray.length>0&&$.each(rulesArray,function(i,rule){ZPFRules.evaluateSingleRule(rule)})}},ZPFRules.evaluateDateConditions=function(condition,fcid,field,isQuickAdd){var fcType=field.fieldType,conditionDate=condition.value,inputObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid),value="";(1!=isQuickAdd||void 0!=inputObject)&&(value=ZPFRules.getInputValue(inputObject,fcType)),fcType==ZPForm.Field.DATE?(conditionDate=Calendar.parseDate(conditionDate,uidateFormat),ZPFRules.checkEmptyValue(value)||(value=Calendar.parseDate(value,uidateFormat))):(conditionDate=Calendar.parseDate(conditionDate,uidateFormat,!0,!0),ZPFRules.checkEmptyValue(value)||(value=Calendar.convertHourFormat(value),value=Calendar.parseDate(value,uidateFormat,!0,!0)));var conditionResult=!1;switch(condition.operator){case ZPNewView.OPERATORS.EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate));break;case ZPNewView.OPERATORS.NOT_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=!Calendar.equalsTo(value,conditionDate));break;case ZPNewView.OPERATORS.EMPTY:conditionResult=ZPFRules.checkEmptyValue(value);break;case ZPNewView.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRules.checkEmptyValue(value);break;case ZPNewView.OPERATORS.LESS_THAN:ZPFRules.checkEmptyValue(value)||(conditionResult=ZPFRules.checkDateLessThan(value,conditionDate));break;case ZPNewView.OPERATORS.GREATER_THAN:ZPFRules.checkEmptyValue(value)||(conditionResult=ZPFRules.checkDateGreaterThan(value,conditionDate));break;case ZPNewView.OPERATORS.LESS_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRules.checkDateLessThan(value,conditionDate));break;case ZPNewView.OPERATORS.GREATER_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRules.checkDateGreaterThan(value,conditionDate))}return conditionResult},ZPFRules.checkDateLessThan=function(date1,date2,isTime){if(date1.getFullYear()<date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()<date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()<date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()<date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()<date2.getMinutes())return!0}}}return!1},ZPFRules.checkDateGreaterThan=function(date1,date2,isTime){if(date1.getFullYear()>date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()>date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()>date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()>date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()>date2.getMinutes())return!0}}}return!1},ZPFRules.findOptions=function(value,formComponentID,formId,isId){var formFields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,fieldOption=null;return $.each(formFields,function(){return fieldOption=ZPFRules.findOptionValue(this.column1,formComponentID,value,isId,formId),null==fieldOption&&(fieldOption=ZPFRules.findOptionValue(this.column2,formComponentID,value,isId,formId)),null!=fieldOption?!1:void 0}),fieldOption},ZPFRules.getAllOptions=function(field){var isConfigure=Layout.Page.container.find("#rule:visible").length>0;return field.fieldType===ZPForm.Field.LOOKUP&&ZPeople.isZPNewUI()&&isConfigure?(field.AllOptions||$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:field.formComponentId,fcType:ZPForm.Field.LOOKUP,isFromRule:!0},success:function(data){field.AllOptions=data.lookupDetailsList}}),field.AllOptions):field.isPrimaryLookup?field.hasOwnProperty("AddOptions")?field.AddOptions:field.EditOptions:field.hasOwnProperty("OptionsWithId")?field.OptionsWithId:field.Options},ZPFRules.findOptionValue=function(col,fcID,value,isId,formId){var optionVal=null;return $.each(col,function(){return void 0!=this&&this.formComponentId==fcID&&(options=ZPFRules.getAllOptions(this),0==Object.keys(options).length&&"P_ApplyLeave"==ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formName&&"Leavetype"==this.labelName&&(options=ZPFRules.leaveTypes),optionVal=ZPFRules.findSelectedOptionValue(isId,value,options),null!=optionVal)?!1:void 0}),optionVal},ZPFRules.findSelectedOptionValue=function(isId,value,options){var optionVal=null;return $.each(options,function(){var valVariable=void 0!=this.DISPVALUE?"DISPVALUE":"Value",optionValue=isId?ZPeople.decodeTxt(this[valVariable]).trim():this.Id;return optionValue==value.trim()?(optionVal=isId?this.Id:this[valVariable],!1):void 0}),optionVal},ZPFRules.addRule=function(formId){var formCompData=ZPForm.FORM_COMPONENT_DATA[formId];if(void 0==formCompData||ZPForm.isRoleBasedPreview||formCompData.lastprev)ZPFRules.getFormComponents({},{},{forPost:!0,formId:formId}),ZPForm.isRoleBasedPreview=!1;else{var fc=formCompData.message.formComponentDetails;if(1==fc.length&&0==fc[0].column1.length&&0==fc[0].column2.length){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right"),emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else void 0!=ZPForm.FIELD_RULE_DETAILS[formId]&&(ZPFRules.formActionUsedFields[formId]=[],ZPFRules.rulesConstruction(formId))}},ZPFRules.rulesConstruction=function(formId){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right");$(ruleDiv).find("[buttonname=done]").html(ZPI18N.getString("zp.save")),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").html(ZPI18N.getString("zp.close")),$(ruleDiv).find("[buttonname=done]").unbind(),$(ruleDiv).find("[buttonname=done]").click(function(){ZPFRules.ruleCreation(this)}),0==$(ruleDiv).find("#addRule").length&&$('<a class="btn btn-default btnaddrule" id="addRule" onclick="ZPFRules.addNewRule(this)">'+ZPI18N.getString("zp.addrule")+"</a>").insertAfter($(ruleDiv).find("[buttonaction]").first()),$(ruleDiv).find("#bodyTag").attr("formId",formId);var ruleHtml="";if(ZPForm.FIELD_RULE_DETAILS[formId].length>0?$.each(ZPForm.FIELD_RULE_DETAILS[formId],function(index,rule){ruleHtml+=ZPFRules.singleRuleAdd(parseInt(index)+1,formId,rule)}):ruleHtml=ZPFRules.singleRuleAdd(1,formId,{}),""==ruleHtml){var emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else{var ruleGrp=ZPFRules.ruleGroupTemplate;ruleGrp=ruleGrp.replace(/\$RULECONSTRUCT\$/g,ruleHtml),$(ruleDiv).find("#bodyTag").html(ruleGrp),$(ruleDiv).find("[makeEmpty=true]").val(""),$(ruleDiv).find("#dvRule1").addClass("fade in"),$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("select").select2()}},ZPFRules.singleRuleAdd=function(count,formId,rule){var mainDiv=ZPFRules.ruleHeaderTemplate;mainDiv=mainDiv.replace(/\$COUNT\$/g,count);var ruleId=void 0!=rule&&rule.hasOwnProperty("ruleId")?"ruleid="+rule.ruleId:"";mainDiv=mainDiv.replace(/\$RULEID\$/g,ruleId);var ruleDiv='<div class="clearfix">';ruleDiv+=ZPFRules.ruleIfDivTemplate,ruleDiv=ruleDiv.replace(/\$RULEID\$/g,ruleId),rule.operator==ZPFRules.OPERATOR.ANY?(ruleDiv=ruleDiv.replace(/\$SELECTED1\$/g,"selected"),ruleDiv=ruleDiv.replace(/\$SELECTED0\$/g,"")):(ruleDiv=ruleDiv.replace(/\$SELECTED0\$/g,"selected"),ruleDiv=ruleDiv.replace(/\$SELECTED1\$/g,""));var fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,others={fields:fields};others.uniqueFields=ZPForm.FORM_COMPONENT_DATA[formId].message.UniqueFieldDetails;var fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionArray=rule.hasOwnProperty("conditionArray")?rule.conditionArray:[{fcid:fcId}];if($.each(conditionArray,function(index,condition){others.fieldDtl=ZPForm.Field.getFieldComponent(condition.fcid,formId),void 0==others.fieldDtl&&(others.fieldDtl={}),others.fieldArray=[condition.fcid],others.id=[condition.conditionId],others.formId=formId;var tempDiv="";return tempDiv=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","conditionFields",others),""==tempDiv?(ruleDiv="",!1):(ruleDiv+=tempDiv,others.condition=condition.operator,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3","condition",others),others.fieldValue=condition.value,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-4","fieldValue",others),void(ruleDiv+=ZPFRules.addRemoveTemplate))}),""==ruleDiv)return ruleDiv;ruleDiv+='<div class="clearfix col-md-12"><label class="control-label PL10 PT15 MB10">'+ZPI18N.getString("zp.performactions")+"</label></div>";var actionArray=rule.hasOwnProperty("actionArray")?rule.actionArray:[],showArray=[],hideArray=[];$.each(actionArray,function(index,action){action.operator==ZPFRules.OPERATOR.SHOW?showArray=action.fieldArray:hideArray=action.fieldArray}),others.multiple=!0,delete others.id;var actionArr=[{fieldArray:showArray,value:ZPI18N.getString("zp.show"),saveValue:"0"},{fieldArray:hideArray,value:ZPI18N.getString("zp.hide"),saveValue:"1"}];for(a in actionArr)others.fieldArray=actionArr[a].fieldArray,others.value=actionArr[a].value,others.saveValue=actionArr[a].saveValue,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","action",others),ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-7","actionFields",others);return ruleDiv+='<div class="dverrormsg DN form-group col-md-7 ML15" errorid="errorDiv"></div>',ruleDiv+="</div>",mainDiv=mainDiv.replace(/\$RULEDIV\$/g,ruleDiv)},ZPFRules.createRuleConditionFromTemplate=function(classname,divtype,others){var ruleDiv=ZPFRules.ruleConditionTemplate;ruleDiv=ruleDiv.replace(/\$CLASS\$/g,classname),ruleDiv=ruleDiv.replace(/\$ID\$/g,divtype+(others.hasOwnProperty("id")?others.id:"")),ruleDiv=ruleDiv.replace(/\$KEY\$/g,divtype);var selDiv="";if(divtype.indexOf("Fields")>0){if(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionFields"==divtype?"conditionDiv":"actionDiv"),selDiv=ZPFRules.addFieldsForSelect(others.fields,"conditionFields"==divtype,others,"actionFields"==divtype),""==selDiv)return"";"actionFields"==divtype&&(selDiv+=ZPFRules.errorTemplate)}else"condition"==divtype?(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv"),selDiv=ZPFRules.addConditionsForField(others.fieldDtl.fieldType,others.condition)):"fieldValue"==divtype?(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv"),selDiv=ZPFRules.changeFieldForValue(others.condition,others.fieldDtl,void 0!=others.fieldValue?others.fieldValue:"",others.formId)):"action"==divtype&&(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"actionDiv"),selDiv='<label saveValue="'+others.saveValue+'" class="form-control spnshwgry">'+others.value+"</label>");return ruleDiv=ruleDiv.replace(/\$CONDITION\$/g,selDiv)},ZPFRules.addFieldsForSelect=function(fields,isRestrict,others,isUniqFielsRes){var selectDiv=ZPFRules.selectTemplate;selectDiv=selectDiv.replace(/\$METHOD\$/g,others.hasOwnProperty("multiple")?"ZPFRules.updateActionArray(event, this)":"ZPFRules.changeConditions(this)"),selectDiv=selectDiv.replace(/\$KEYNAME\$/g,"fcid"),selectDiv=selectDiv.replace(/\$MULTIPLE\$/g,others.hasOwnProperty("multiple")?"multiple":"");var options="",actionArray=ZPFRules.formActionUsedFields[others.formId];(void 0==actionArray||0==actionArray.length)&&(actionArray=ZPFRules.getAllActions(ZPForm.FIELD_RULE_DETAILS[others.formId]),ZPFRules.formActionUsedFields[others.formId]=actionArray);var formTableName=ZPForm.FORM_COMPONENT_DATA[others.formId].formDetails.tableName,noOptions=!0;return $.each(fields,function(index1,section){options+="<optgroup label="+section.sectionName+" secid="+section.sectionId+">",$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(!(void 0==field||isUniqFielsRes&&ZPUtil.checkIsExistInArray(others.uniqueFields,field.labelName)||isRestrict&&section.isTabular||!ZPFRules.isFieldAllowed(isRestrict,field,others.fieldArray,formTableName,actionArray))){noOptions=!1;var selected=$.inArray(field.formComponentId,others.fieldArray)>-1?"selected":"";options+='<option value="'+field.formComponentId+'" '+selected+">"+field.displayName+"</option>"}})}),options+="</optgroup>"}),noOptions&&(isRestrict||!isRestrict&&0==actionArray.length)?"":selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ZPFRules.addConditionsForField=function(fctype,id){var selectDiv=ZPFRules.selectTemplate;selectDiv=selectDiv.replace(/\$METHOD\$/g,"ZPFRules.changeInput(this)"),selectDiv=selectDiv.replace(/\$KEYNAME\$/g,"operator");var selected=id==ZPNewView.OPERATORS.EQUAL?"selected":"",options='<option value="'+ZPNewView.OPERATORS.EQUAL+'" '+selected+">"+ZPI18N.getString("zp.is")+"</option>";return selected=id==ZPNewView.OPERATORS.NOT_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.isnot")+"</option>",selected=id==ZPNewView.OPERATORS.EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isempty")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isnotempty")+"</option>",$.inArray(parseInt(fctype),[ZPForm.Field.DATE,ZPForm.Field.DATE_TIME,ZPForm.Field.NUMBER,ZPForm.Field.CURRENCY,ZPForm.Field.DECIMAL])>-1&&(selected=id==ZPNewView.OPERATORS.GREATER_THAN?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.GREATER_THAN+'" '+selected+">"+ZPI18N.getString("zp.greaterthan")+"</option>",selected=id==ZPNewView.OPERATORS.LESS_THAN?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.LESS_THAN+'" '+selected+">"+ZPI18N.getString("zp.lesserthan")+"</option>",selected=id==ZPNewView.OPERATORS.GREATER_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.GREATER_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.greaterorequalto")+"</option>",selected=id==ZPNewView.OPERATORS.LESS_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.LESS_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.lesserorequalto")+"</option>"),$.inArray(parseInt(fctype),[ZPForm.Field.DATE,ZPForm.Field.DATE_TIME,ZPForm.Field.CHECK_BOX])<0?(selected=id==ZPNewView.OPERATORS.CONTAINS?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.CONTAINS+'" '+selected+">"+ZPI18N.getString("zp.contains")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_CONTAINS?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_CONTAINS+'" '+selected+">"+ZPI18N.getString("zp.notcontains")+"</option>",selected=id==ZPNewView.OPERATORS.STARTS_WITH?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.STARTS_WITH+'" '+selected+">"+ZPI18N.getString("zp.startswith")+"</option>",selected=id==ZPNewView.OPERATORS.ENDS_WITH?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.ENDS_WITH+'" '+selected+">"+ZPI18N.getString("zp.endswith")+"</option>"):fctype==ZPForm.Field.CHECK_BOX&&(selected=id==ZPNewView.OPERATORS.TRUE?"selected":"",options='<option value="'+ZPNewView.OPERATORS.TRUE+'" '+selected+">"+ZPI18N.getString("zp.true")+"</option>",selected=id==ZPNewView.OPERATORS.FALSE?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.FALSE+'" '+selected+">"+ZPI18N.getString("zp.false")+"</option>"),selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ZPFRules.changeFieldForValue=function(condition,fieldDtl,value,formId){var selDiv="",disabledClass="",fcType=parseInt(fieldDtl.fieldType),emptyAttr="";if($.inArray(parseInt(condition),[ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])>-1&&(value="",disabledClass="disabled",emptyAttr=" makeEmpty=true"),$.inArray(fcType,[ZPForm.Field.LOOKUP,ZPForm.Field.PICKLIST])>-1){selDiv='<span class="input-group-addon dvSetpopup $DN$" id="optionsIcon" onclick="ZPFRules.openOptionsPopup(this)" data-placement="bottom" data-toggle="popover" aria-expanded="false"><i class="IC-addlist S15"></i></span>',selDiv+=ZPFRules.optionsTemplate;var options=ZPFRules.getAllOptions(fieldDtl);0==Object.keys(options).length&&"P_ApplyLeave"==ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formName&&"Leavetype"==fieldDtl.labelName&&(options=ZPFRules.leaveTypes);var valArr=value.split(",");if(selDiv=selDiv.replace(/\$LIST\$/g,ZPFRules.constructOptions(options,valArr)),void 0==condition&&(condition=ZPNewView.OPERATORS.EQUAL),$.inArray(parseInt(condition),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){if(selDiv=selDiv.replace(/\$DN\$/g,""),disabledClass="disabled",""!=value.trim()){value="";for(val in valArr){var v=ZPFRules.findSelectedOptionValue(!1,valArr[val],options);null!=v&&(""!=value.trim()&&(value+=","),value+=v)}}}else selDiv=selDiv.replace(/\$DN\$/g,"DN")}else fcType==ZPForm.Field.CHECK_BOX&&(disabledClass="disabled");var dateHtml="";fcType==ZPForm.Field.DATE&&(dateHtml='onclick="Calendar.setUpCalendar(event,this)" caltype="popup"'),fcType==ZPForm.Field.DATE_TIME&&(dateHtml='onclick="Calendar.setUpCalendar(event,this,1)" caltype="popup"',Calendar.is12HrFormat()&&(value=Calendar.convertTo12Hours(value)));var inputDiv='<div class="input-group" keyname="value"><input id="fieldValue"'+emptyAttr+' class="form-control" type="text" value="'+ZPeople.escapeHtml(value)+'" '+disabledClass+" "+dateHtml+">";return inputDiv+=selDiv,inputDiv+="</div>",inputDiv+=ZPFRules.errorTemplate},ZPFRules.constructOptions=function(options,valArr,searchStr){var optionsDiv="";void 0!=searchStr&&searchStr.indexOf("+")>-1&&(searchStr=searchStr.replace(/\+/i,"\\+"));var searchRe=void 0!=searchStr?new RegExp(searchStr,"i"):"";return $.each(options,function(ind,option){var value=void 0!=option.DISPVALUE?option.DISPVALUE:option.Value,id=option.Id+"";value.search(searchRe)>-1&&(optionsDiv+=ZPFRules.liTemplate,optionsDiv=optionsDiv.replace(/\$LISTID\$/g,id),optionsDiv=optionsDiv.replace(/\$LISTVALUE\$/g,value),optionsDiv=optionsDiv.replace(/\$CLASS\$/g,$.inArray(id,valArr)>-1?"sel":""))}),optionsDiv},ZPFRules.selectJson=function(condition,fieldDtl,value,formId){var fcType=fieldDtl.fieldType,selectJson={disableClass:!1,showIcon:!1};return $.inArray(parseInt(condition),[ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])>-1?selectJson.disableClass=!0:$.inArray(fcType,[ZPForm.Field.LOOKUP,ZPForm.Field.PICKLIST])>-1?$.inArray(parseInt(condition),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1&&(selectJson.showIcon=!0,selectJson.disableClass=!0):fcType==ZPForm.Field.CHECK_BOX&&(selectJson.disableClass=!0),selectJson},ZPFRules.changeConditions=function(obj){var formId=$(obj).parents("#bodyTag").attr("formId"),fieldDtls=ZPForm.Field.getFieldComponent($(obj).val(),formId),a=ZPFRules.addConditionsForField(fieldDtls.fieldType,$(obj).val());$(obj).parents("[id*=conditionFields]").next("[id*=condition]").html(a),$(obj).parents("[id*=conditionFields]").next("[id*=condition]").find("select").select2();var b=selDiv=ZPFRules.changeFieldForValue(ZPNewView.OPERATORS.EQUAL,fieldDtls,"",formId);$(obj).parents("[id*=conditionFields]").next("[id*=condition]").next("[id*=fieldValue]").html(b)},ZPFRules.changeInput=function(obj){var formId=$(obj).parents("#bodyTag").attr("formId"),fcId=$(obj).parents("[id*=condition]").prev("[id*=conditionFields]").find("select").val(),fieldDtls=ZPForm.Field.getFieldComponent(fcId,formId),inputObj=$(obj).parents("[id*=condition]").next("[id*=fieldValue]").find("input#fieldValue"),selJson=ZPFRules.selectJson(parseInt($(obj).val()),fieldDtls,"",formId);if($(inputObj).prop("disabled",selJson.disableClass),selJson.showIcon){if(!$(inputObj).siblings("#optionsIcon").is(":visible")){var val="",length=$(inputObj).siblings("#conditionDropdownSelection").find("#listBody li.sel").length;$.each($(inputObj).siblings("#conditionDropdownSelection").find("#listBody li.sel"),function(ind,option){val+=$(option).find("span").text(),length>ind+1&&(val+=",")}),$(inputObj).val(val)}$(inputObj).siblings("#optionsIcon").removeClass("DN")}else $(inputObj).siblings("#optionsIcon").addClass("DN"),$(inputObj).val("")},ZPFRules.getFormComponents=function(data,params,others){if(others.hasOwnProperty("forPost")){var params={formId:others.formId,mode:"getFormComponents"};ZPForm.CURRFORM_PARAM.formId=others.formId,ZPeople.Request.send(ZPForm.URL,params,ZPFRules.getFormComponents,others),delete others.forPost}else ZPForm.FORM_COMPONENT_DATA[others.formId]=data,ZPForm.populateFields(data.message),ZPForm.CURRFORM_PARAM.tableName=void 0!==data.formDetails&&data.formDetails.hasOwnProperty("tableName")?data.formDetails.tableName:"","P_EmployeeLeave"===ZPForm.CURRFORM_PARAM.tableName&&(ZPForm.CURRFORM_PARAM.fieldFormat=["Employee_ID","Leavetype","From","To","TeamEmailID","Reasonforleave"]),ZPForm.formatFields(ZPForm.FORM_COMPONENT_DATA[others.formId].message),data.hasOwnProperty("ruleArray")&&(ZPFRules.constructRulesJson(data,params),delete data.ruleArray),ZPFRules.addRule(others.formId)},ZPFRules.conditionSelectRecord=function(obj){$(obj).toggleClass("sel");var id=$(obj).find("span").attr("id"),className=$(obj).hasClass("sel")?"sel":"";$(obj).parents("[keyname=value]").children("#conditionDropdownSelection").find("span#"+id).parent("li").attr("class",className);var input=$(obj).parents("[keyname=value]").find("input").first().val(),val=$(obj).find("span").text();$(obj).hasClass("sel")?(input+=input.trim().length>0?",":"",input+=val):input=0==$(obj).siblings("li.sel").length?"":input.endsWith(val)?input.replace(","+val,""):input.replace(val+",",""),$(obj).parents("[keyname=value]").find("input").first().val(input)},ZPFRules.openOptionsPopup=function(obj){$(obj).siblings("input#fieldValue").val(),$(obj).popover({html:!0,content:function(){var clone=$($(this).siblings("#conditionDropdownSelection")).clone(!0).removeClass("DN");return clone}}),0==$(obj).siblings(".popover:visible").length&&$(obj).click(),$("body").on("click",function(e){$('[data-toggle="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})})},ZPFRules.searchOptions=function(obj){var searchStr=$(obj).val(),conditionId=null!=$(obj).parents("[id*=fieldValue]").attr("id").match(/[\d]+$/)?$(obj).parents("[id*=fieldValue]").attr("id").match(/[\d]+$/).toString():"",fcId=Layout.Page.container.find("#conditionFields"+conditionId).find("select").val(),formId=$(obj).parents("#bodyTag").attr("formid"),fieldDtl=ZPForm.Field.getFieldComponent(fcId,formId),options=ZPFRules.getAllOptions(fieldDtl),valArr=[];if(void 0!=ZPForm.FIELD_RULE_DETAILS[formId]&&$(obj).parents("[ruleid]").length>0)var ruleArr=ZPFRules.findObject(ZPForm.FIELD_RULE_DETAILS[formId],"ruleId",$(obj).parents("[ruleid]").attr("ruleid")),conditionObj=ZPFRules.findObject(ruleArr.conditionArray,"conditionId",conditionId),valArr=$.inArray(parseInt(conditionObj.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1?conditionObj.value.split(","):[conditionObj.value];$(obj).parents("#conditionDropdownSelection").find("#listBody").html(ZPFRules.constructOptions(options,valArr,searchStr))},ZPFRules.findObject=function(jsonArray,searchKey,searchValue,returnValue){var resultObject={};return $.each(jsonArray,function(index,json){return json[searchKey]==searchValue?(void 0==returnValue?resultObject=json:"index"==returnValue&&(resultObject.index=index),!1):void 0}),resultObject},ZPFRules.addNewRule=function(obj){var visibleRule=($(obj).parents("#rule").find("#dvAddruleparent [name=singleRuleDiv]").length,$(obj).parents("#rule").find("#dvAddruleparent [id*=dvRule]:visible"));if(0==visibleRule.length||!ZPFRules.validateRuleDiv(visibleRule)){var formId=$(obj).parents("#rule").find("#bodyTag").attr("formid"),cnt=$(obj).parents("#rule").find("#dvAddruleparent [name=singleRuleDiv]").length;$(obj).parents("#rule").find("#dvAddruleparent").append(ZPFRules.singleRuleAdd(++cnt,formId,{})),$(obj).parents("#rule").find("#dvAddruleparent #dvRule"+cnt).find("select").select2(),$(obj).parents("#rule").find("#dvAddruleparent [id*=dvRule]").length>1&&$(obj).parents("#rule").find("#dvAddruleparent #dvRule"+cnt).siblings("[name=ruleToggleDiv]").click()}},ZPFRules.deleteRule=function(data,params,others){var isRemoved=!1;if(params.hasOwnProperty("forPost")){var ruleParent=$(others.obj).parents("[name=singleRuleDiv]");0==$(ruleParent).find("[ruleid]").length?$(ruleParent).siblings("[name=singleRuleDiv]").length>0&&($(ruleParent).remove(),isRemoved=!0):(params={ruleId:$(ruleParent).find("[ruleid]").attr("ruleid"),formId:$(ruleParent).parents("#bodyTag").attr("formid"),method:"deleteRule"},delete params.forPost,tabCustom.param=[ZPFRules.url,params,ZPFRules.deleteRule,{obj:ruleParent}],ZPeople.confirm(null,"","Are you sure you want to delete this rule",tabCustom.deleteRequest,!1,!0))}else if("success"==data.msg.trim()){$(others.obj).remove(),isRemoved=!0;var formRuleArray=ZPForm.FIELD_RULE_DETAILS[params.formId],index=ZPFRules.findObject(formRuleArray,"ruleId",params.ruleId,"index").index;formRuleArray.splice(index,1),formRuleArray.formComponent=[],ZPForm.FIELD_RULE_DETAILS[params.formId]=formRuleArray,ZPFRules.formActionUsedFields[params.formId]=ZPFRules.getAllActions(formRuleArray),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.deletedmsg")])),""==Layout.Page.container.find("#dvAddruleparent").html().trim()&&Layout.Page.container.find("#rule #addRule").click()}else""!=data.msg.trim?ZPeople.confirm(null,"",data.message.trim(),"",!0,!0):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));isRemoved&&$.each(Layout.Page.container.find("#dvAddruleparent [name=singleRuleDiv]"),function(index,ruleDiv){0==index&&$(this).find("[name=ruleToggleDiv]").click(),$(this).find("[name=ruleToggleDiv] h6").text(ZPI18N.getString("zp.rule")+" "+(index+1));var id=$(this).find("[id*=dvRule]").attr("id");$(this).find("[name=ruleToggleDiv]").attr("data-target","#"+id.replace(/[\d]+$/,index+1)),$(this).find("[id*=dvRule]").attr("id",id.replace(/[\d]+$/,index+1))})},ZPFRules.findFirstFcId=function(fields,formId,tableName){var fcId=null,returnFlag=!0,fieldArray=ZPFRules.formActionUsedFields[formId];return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){return void 0!=field&&ZPFRules.isFieldAllowed(!0,field,[],tableName,fieldArray)&&(fcId=field.formComponentId,returnFlag=!1),returnFlag}),returnFlag}),returnFlag}),fcId},ZPFRules.getAllActions=function(rules){var actionArray=[],cnt=0;return $.each(rules,function(index,rule){$.each(rule.actionArray,function(index1,action){$.each(action.fieldArray,function(index2,field){actionArray[cnt++]=field})})}),actionArray},ZPFRules.addDeleteCondition=function(obj,isAdd){if(isAdd){var formId=$(obj).parents("#bodyTag").attr("formid"),fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,others={fields:fields},fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionActionDiv="",ruleDiv=ZPFRules.ruleConditionTemplate;others.fieldDtl=ZPForm.Field.getFieldComponent(fcId,formId),others.fieldArray=[fcId],others.formId=formId;var actionAdd=!1,selDiv="";ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv"),conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-3 ML15"),conditionActionDiv=conditionActionDiv.replace(/\$KEY\$/g,"conditionFields"),conditionActionDiv=conditionActionDiv.replace(/\$ID\$/g,"conditionFields"),selDiv=ZPFRules.addFieldsForSelect(others.fields,!0,others,!1),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-3"),conditionActionDiv=conditionActionDiv.replace(/\$KEY\$/g,"condition"),conditionActionDiv=conditionActionDiv.replace(/\$ID\$/g,"condition"),selDiv=ZPFRules.addConditionsForField(others.fieldDtl.fieldType,others.condition),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-4"),conditionActionDiv=conditionActionDiv.replace(/\$KEY\$/g,"fieldValue"),conditionActionDiv=conditionActionDiv.replace(/\$ID\$/g,"fieldValue"),selDiv=ZPFRules.changeFieldForValue(others.condition,others.fieldDtl,void 0!=others.fieldValue?others.fieldValue:"",others.formId),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv+=ZPFRules.addRemoveTemplate,$(conditionActionDiv).insertAfter($(obj).parents("[name=addRemoveDiv]")),actionAdd&&ZPFRules.updateActionArray(null,$(obj),!0),$(obj).parents("[id*=dvRule]").find("select").select2()}else $(obj).parents("[id*=dvRule]").find("[name=conditionDiv]").length>5&&($(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").remove())},ZPFRules.updateActionArray=function(event,obj,isAdd){var formId=$(obj).parents("#bodyTag").attr("formid"),formActionArray=ZPFRules.formActionUsedFields[formId],length=formActionArray.length,valArr=[],currentObj=$(obj).parents("[key=actionFields]");if("fcid"==$(obj).attr("keyname"))if(event.hasOwnProperty("removed")){if(formActionArray.length>0){valArr[0]=event.removed.id;var ind=$.inArray(event.removed.id,formActionArray);formActionArray.splice(ind,1),ZPFRules.formActionUsedFields[formId]=formActionArray,isAdd=!1}}else ZPFRules.formActionUsedFields[formId][length]=event.added.id,valArr[0]=event.added.id,isAdd=!0;else if($(obj).parents("[name=addRemoveDiv]").length>0)if(1==isAdd)(null==valArr||valArr.length>0)&&(currentObj=$(obj).parents("[name=addRemoveDiv]").next("[name=actionDiv]").next("[name=actionDiv]"),valArr=$(currentObj).find("select").val()),null!=valArr&&valArr.length>0&&(ZPFRules.formActionUsedFields[formId][length]=valArr[0]);else if(currentObj=$(obj).parents("[name=addRemoveDiv]").prev("[name=actionDiv]"),valArr=$(currentObj).find("select").val(),formActionArray.length>0)for(val in valArr)index=$.inArray(valArr[val],formActionArray),formActionArray.splice(ind,1),ZPFRules.formActionUsedFields[formId]=formActionArray;null!=valArr&&valArr.length>0&&(isAdd?$.each($(obj).parents("#bodyTag").find("[key=actionFields]").not(currentObj),function(index,selectDiv){for(val in valArr)$(this).find("[keyname=fcid]").find("option[value="+valArr[val]+"]").remove();$(this).find("[keyname=fcid]").select2()}):$.each($(obj).parents("#bodyTag").find("[key=actionFields]").not(currentObj),function(index,selectDiv){for(val in valArr){var fieldDtl=ZPForm.Field.getFieldComponent(valArr[val],formId),secId=ZPFRules.findSecId(formId,valArr[val]);$(this).find("[keyname=fcid] optgroup[secid="+secId+"]").append('<option value="'+valArr[val]+'">'+fieldDtl.displayName+"</option>")}$(this).find("[keyname=fcid]").select2()}))},ZPFRules.findTabularFieldIndex=function(formId,fcId){var index=0;return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){return void 0!=field&&field.formComponentId==fcId?(index=index3,!1):void 0})})}),index},ZPFRules.findSecId=function(formId,fcId){var secId=0;return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){return void 0!=field&&field.formComponentId==fcId?(secId=section.sectionId,!1):void 0})})}),secId},ZPFRules.setEmptyValue=function(){var editId=ZPForm.Field.Edit.FORMCOMP_ID,emptyFcs=ZPFRules.setEmptyFcs,value="";$.each(emptyFcs,function(index){value="";var fcComp=ZPForm.Field.getFieldComponent(emptyFcs[index]);ZPForm.Field.Edit.FORMCOMP_ID=emptyFcs[index],fcComp.fieldType==ZPForm.Field.CHECK_BOX?value="false":(fcComp.fieldType==ZPForm.Field.LOOKUP||fcComp.fieldType==ZPForm.Field.PICKLIST)&&(value=$.inArray(fcComp.displayType,[ZPForm.Field.MULTISELECT_DISPLYTYPE,ZPForm.Field.CHECK_BOXES_DISPLYTYPE])>-1?[]:"-Select-");var secDtls=ZPFRules.findSec(emptyFcs[index]);secDtls.isTabular?ZPFRules.setEmptyValueForTabColumn(emptyFcs[index],secDtls):value=ZPForm.Field.setValue(fcComp,value)}),ZPFRules.setEmptyFcs=[],ZPForm.Field.Edit.FORMCOMP_ID=editId},ZPFRules.isFieldAllowed=function(isRestrict,field,fieldArray,formTableName,actionArray){if(isRestrict){if(field.hasOwnProperty("displayType")&&$.inArray(field.displayType,[ZPForm.Field.MULTISELECT_DISPLYTYPE,ZPForm.Field.CHECK_BOXES_DISPLYTYPE])>-1)return!1;if($.inArray(field.fieldType,[ZPForm.Field.FILE_UPLOAD,ZPForm.Field.SCRIPT,ZPForm.Field.PLAIN_TEXT,ZPForm.Field.IMAGE,ZPForm.Field.AUTONUMBER])>-1)return!1;if("P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["BillableStatus","Hours"])>-1)return!1;if("P_PerformanceAppraisal"==formTableName&&$.inArray(field.labelName,["Rating","CurrentCTC"])>-1||"P_SelfAppraisal"==formTableName&&$.inArray(field.labelName,["AppriasalConfiguration","Rating"])>-1)return!1;if("P_EmployeeLeave"==formTableName&&$.inArray(field.labelName,["DateOfRequest","Daystaken"])>-1)return!1}else{if(field.isSystemMandatory)return!1;if(0==formTableName.indexOf("P_Timesheet")&&(field.isSystem||"P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["Reminder","ReminderTime"])>-1))return!1;if("P_EmployeeLeave"==formTableName&&field.isSystem&&$.inArray(field.labelName,["TeamEmailID","Reasonforleave"])<0)return!1;if("P_Goals"==formTableName&&field.isSystem&&$.inArray(field.labelName,["UserRating","ManagerRating"])>-1)return!1;if($.inArray(field.fieldType,[ZPForm.Field.AUTONUMBER])>-1)return!1;if($.inArray(field.formComponentId,fieldArray)<0&&$.inArray(field.formComponentId,actionArray)>-1)return!1}return!0},ZPFRules.containsAllElements=function(array1,array2){var isContains=!0;return array1.length==array2.length?$.each(array1,function(index){return array2.indexOf(array1[index])<0?(isContains=!1,!1):void 0}):isContains=!1,isContains},ZPFRules.validateRuleDiv=function(obj){var ruleDiv=$(obj),hasError=!1;$(ruleDiv).find("[errorid]").html(""),$(ruleDiv).find("[errorid]").hide(),$.each($(ruleDiv).find("[key=conditionFields]"),function(ind,condition){var conditionActionObject={};if(conditionActionObject.fcid=$(condition).find("[keyname]").val(),0==conditionActionObject.fcid.trim().length)$(condition).find("[errorid=errorDiv]").html("Please select a field for condition"),$(condition).find("[errorid=errorDiv]").show(),hasError=!0;else{var fieldValueObject=$(condition).next("[key=condition]").next("[key=fieldValue]");if(conditionActionObject.operator=$(condition).next("[key=condition]").find("[keyname]").val(),conditionActionObject.value=$(fieldValueObject).find("#fieldValue").val(),$(fieldValueObject).find("#optionsIcon").length>0&&$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var fieldDtls=ZPForm.Field.getFieldComponent(conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"));if(fieldDtls.fieldType==ZPForm.Field.LOOKUP||fieldDtls.fieldType==ZPForm.Field.PICKLIST){var valArr=$(fieldValueObject).find("#conditionDropdownSelection #listBody li.sel").length>1?conditionActionObject.value.split(","):[conditionActionObject.value],value="";for(val in valArr)value+=ZPFRules.findOptions(valArr[val],conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"),!0)+",";value=value.substring(0,value.length-1),conditionActionObject.value=value}}$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.TRUE,ZPNewView.OPERATORS.FALSE,ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])<0&&(void 0==conditionActionObject.value||"null"==conditionActionObject.value||0==conditionActionObject.value.trim().length)&&($(fieldValueObject).find("[errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),$(fieldValueObject).find("[errorid=errorDiv]").show(),hasError=!0)}});var showHideArray=[],actionsCount=0;if($.each($(ruleDiv).find("[key=action]"),function(index1,action){$(action).next("[key=actionFields]").find("[errorid=errorDiv]").hide(),showHideArray=$(action).next("#actionFields").find("select").val(),null!=showHideArray&&0!=showHideArray.length&&actionsCount++}),0==actionsCount){hasError=!0;var errorAt=$(ruleDiv).find("#actionFields").parent().children("[errorid=errorDiv]");$(errorAt).html(ZPI18N.getString("zp.showhidefield")),$(errorAt).show()}return hasError},ZPFRules.collapseElement=function(obj){var toggleDiv=$(obj).siblings($(obj).attr("data-target")),ruleDiv=$(obj).parents("#rule").find("[id*=dvRule]:visible");0!=ruleDiv.length&&ZPFRules.validateRuleDiv(ruleDiv)||($(toggleDiv).find("[errorid]").html(""),$(toggleDiv).find("[errorid]").hide(),$(toggleDiv).collapse("show"),$(ruleDiv).collapse("hide"))},ZPFRules.makeExecutefalse=function(fcs){if(void 0!=fcs&&fcs.length>0)for(;fcs.length>0;){var fcid=fcs.pop();if(void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]&&ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)){var rulesArray=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcid];if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){var rule=rulesArray[ruleIn];rule.isExecuted=!1}}}else void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]&&$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent,function(key,rulesArray){if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){var rule=rulesArray[ruleIn];rule.isExecuted=!1}})},ZPFRules.findSec=function(fcId){var sectionDtls={},fields=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails,returnFlag=!0;return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){return void 0!=field&&field.formComponentId==fcId?(sectionDtls=section,returnFlag=!1):void 0}),returnFlag}),returnFlag}),sectionDtls},ZPFRules.setEmptyValueForTabColumn=function(fcId,secDtls){var fieldObjects=ZPFRules.LAYOUT.find("[id=zp_field_outer_"+fcId+"]"),value="";if(0==fieldObjects.length){var sectionDiv=ZPFRules.LAYOUT.find("#zp_section_fields_"+secDtls.sectionId),resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",fcId,"index");0!=resultObj.length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",fcId,"index"));var index=resultObj.index+1;fieldObjects=sectionDiv.find("tbody tr td:nth-child("+index+")")}var findProp={},inputObject=fieldObjects.first(),inputDiv=$(inputObject).find("[id*=zp_field_]:visible");$(inputObject).parents("#zp_form_body").siblings("div").length>0&&(0==$(inputObject).find("#zp_fieldedit_comp").length||$(inputObject).find("#zp_fieldedit_comp").not(".DN").length>0)&&(inputDiv=$(inputObject).find("[id*=zp_field_]")),$(inputDiv).length>0?$(inputObject).find("select").length>0?findProp={find:"select option:selected",val:"text"}:$(inputObject).find("input").length>0?findProp=fcType==ZPForm.Field.CHECK_BOX?{find:"input",val:"checked"}:{find:"input",val:"val"}:$(inputObject).find("textarea").length>0&&(findProp={find:"textarea",val:"val"}):void 0!=$(inputObject).attr("displaytype")&&$(inputObject).attr("displaytype")==ZPForm.Field.RADIO_DISPLYTYPE?findProp=$(inputObject).find("input[type=radio]:visible").length>0?{find:"input[type=radio]:checked",val:"checked"}:{find:"span:first",val:"text"}:($(inputObject).find("span:visible").length>0&&(findProp={find:"span:visible",val:"text"}),findProp={val:"text"}),fieldObjects.each(function(){findProp.hasOwnProperty("find")?"text"==findProp.val?findProp.find.indexOf("span")>-1?$(this).find(findProp.find).text("-"):$(this).find(findProp.find).text(""):"val"==findProp.val?$(this).find(findProp.find).val(""):"checked"==findProp.val&&$(this).find(findProp.find).each(function(){$(this).prop("checked",!1),value=!1}):$(this).is("td")?$(this).text("-"):$(this).text("-")});var fieldValData={};if(secDtls.isGridType){var recordDtls=ZPForm.getSingleRecord();if(void 0!=recordDtls&&void 0!=recordDtls.record){var recData=recordDtls.record.recordDetails;$.each(recData.message.recordDetails,function(){return this.sectionId==secDtls.sectionId&&this.hasOwnProperty("datarows")?(fieldValData=this.datarows,!1):void 0});var resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",fcId,"index");0!=resultObj.length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",fcId,"index"));var index=resultObj.index;for(i in fieldValData){var row=fieldValData[i];row[index]=value}}}else{fieldValData=ZPForm.Field.getFieldValueData(fcId);for(i in fieldValData.componentValue)fieldValData.componentValue[i]=value}},ZPFRules.removeDeletedRows=function(deleteArray){for(i in deleteArray){var deleteRow=deleteArray[i],row=ZPFRules.LAYOUT.find("[rowid="+deleteRow+"]"),secId=row.attr("secid"),recordDtls=ZPForm.getSingleRecord();if(void 0!=recordDtls&&void 0!=recordDtls.record){var recData=recordDtls.record.recordDetails;$.each(recData.message.recordDetails,function(){if(this.isTabular){var fieldValData=this.recordIdArray;for(i in fieldValData)if(fieldValData[i]==deleteRow){if(this.hasOwnProperty("datarows"))this.datarows.splice(i,1);else{if(this.hasOwnProperty("column1"))for(fieldIndex in this.column1){var field=this.column1[fieldIndex];field.componentValue.splice(i,1)}if(this.hasOwnProperty("column2"))for(fieldIndex in this.column2){var field=this.column2[fieldIndex];field.componentValue.splice(i,1)}}return fieldValData.splice(i,1),this.noOfRows-=1,this.recordIdArray=fieldValData,!1}}})}0==row.siblings("[secid="+secId+"][row]").length?row.prop("rowid",""):row.remove()}},ZPFRules.hideFields=function(currentRow,prevRow){return prevRow.find("[id*=zp_field_outer_]").not(":visible").each(function(){var id=$(this).attr("id");$(this).is("td")?(currentRow.find("td#"+id).addClass("DN"),currentRow.find("td#"+id).attr("isActionHidden",!0)):(currentRow.find("#"+id).parent("div").addClass("DN"),currentRow.find("#"+id).attr("isActionHidden",!0))}),currentRow};var zpMassUpdate={formId:void 0,url:"/massUpdate.zp",params:{},callback:"",firstFieldId:void 0,isUser:!1};zpMassUpdate.massUpdateFields=function(isAddNew){this.formId=Layout.Page.urlparam.formId;var pageId=Layout.Page.container;void 0===this.formId&&(this.formId=Layout.Page.container.find("table#userListTable").attr("formid"),this.isUser=!0),ZPForm.CURRFORM_PARAM={formId:this.formId},pageId.find("#massUpdatePopup #saveUpdate").removeClass("disabled"),0==pageId.find("#bulkUpdFieldsTable tbody").children().length?(this.params={formid:this.formId,mode:"list"},this.callback=this.listBulkUpdateFields,ZPeople.Request.send(this.url,this.params,this.callback,isAddNew)):(pageId.find("#errormsg").hide(),pageId.find("div#massUpdatePopup [name=bulkRows]").not("#firstFieldRow").remove(),pageId.find("div#massUpdatePopup #firstFieldRow [name=fieldsSelBox]").val(this.firstFieldId).trigger("change"),pageId.find("div#massUpdatePopup").modal()),void 0===ZPForm.FORM_COMPONENT_DATA[this.formId]&&ZPeople.Request.send(ZPForm.URL,{formId:this.formId,mode:"getFormComponents"},this.setFormComponentData)},zpMassUpdate.setFormComponentData=function(resultObj){resultObj.iCache=!0,ZPForm.formatFields(resultObj.message),ZPForm.FORM_COMPONENT_DATA[zpMassUpdate.formId]=resultObj,ZPForm.populateFields(resultObj.message)},zpMassUpdate.listBulkUpdateFields=function(fieldsDtls,paramsObj,isAddNew){var pageId=Layout.Page.container;if(isAddNew){var addNewElms=pageId.find("div#massUpdatePopup #firstFieldRow").clone();addNewElms.attr("id",""),addNewElms.find("[name=fieldsSelBox]").attr("id",""),$(addNewElms).find("td").last().html('<div class="dvlist-action MT5"><a class="IC-remove" onclick=$(this).closest("tr").remove()></a></div>');var selectBox=addNewElms.find("[name=fieldsSelBox]").clone();addNewElms.find("[name=fieldsSelBox]").parent("td").html(selectBox),addNewElms.find("[name=fieldsSelBox]").select2(),$(addNewElms).find("[name=fieldsSelBox]").val(this.firstFieldId).trigger("change"),$(addNewElms).insertBefore(pageId.find("table#bulkUpdFieldsTable tbody a#addnewLnk").closest("tr[name='addnewlink']"))}else{var selectedFieldDtls=fieldsDtls.firstFldDtls.details;zpMassUpdate.firstFieldId=selectedFieldDtls.formComponentId;var labelName=selectedFieldDtls.labelName,editFieldsObj=zpMassUpdate.constructselectBoxForEditBulkUpd(fieldsDtls.sections),edtElms=zpMassUpdate.constructEditElms(selectedFieldDtls),initialElm="";initialElm+='<tr id="firstFieldRow" name = "bulkRows">',initialElm+="<td></td>",initialElm+='<td><select class="selectBox" id="firstFieldSelBox" name="fieldsSelBox" onchange="zpMassUpdate.getFcDtlsWhenFieldChange(this)"></select></td>',initialElm+='<td id="firstEdtbox"></td><td></td></tr>',$(editFieldsObj).find("option").length>1&&(initialElm+='<tr name="addnewlink">',initialElm+='<td colspan="4"><a class="btn btn-link ML5" id="addnewLnk"onclick="zpMassUpdate.listBulkUpdateFields(null,null,true)"><span class="IC-add MR5 S12"></span>'+ZPI18N.getString("zp.addnew")+"</a></td></tr>"),pageId.find("table#bulkUpdFieldsTable tbody").html(initialElm),pageId.find("td#firstEdtbox").html(edtElms);var bulkUpdTablObj=pageId.find("table#bulkUpdFieldsTable");bulkUpdTablObj.find("select#firstFieldSelBox").html(editFieldsObj),bulkUpdTablObj.find("select#firstFieldSelBox").attr("labelName",labelName),bulkUpdTablObj.find("select#firstFieldSelBox").attr("isMandatory",selectedFieldDtls.isMandatory),pageId.find("div#massUpdatePopup").find("select[id='firstFieldSelBox']").siblings("select[name='fieldsSelBox']").remove(),pageId.find("div#massUpdatePopup").modal(),ZPSetupCommon.isEmpty(selectedFieldDtls.autofillvalue)||pageId.find("td#firstEdtbox").find("*#editable"+labelName).val(ZPeople.decodeTxt(selectedFieldDtls.autofillvalue)),pageId.find("div#massUpdatePopup").find("select").select2(),ZPeople.isZPNewUI()&&pageId.find("[fieldType=26]").select2(ZPForm.select2.getSelect2Properties()),fieldsDtls.isWorkFlowAvailable&&0==$("table#bulkUpdFieldsTable").siblings("#zp_import_submitwork_flow").length&&($('<div id="zp_import_submitwork_flow" class="form-group"><div class="col-sm-6 col-sm-offset-3"><label class="checkbox DIB MR10"><input type="checkbox" name="workFlowOn" checked="checked"><span class="ML2">'+ZPI18N.getString("zp.executeeworkflow")+"</span></label></div></div>").insertAfter(pageId.find("table#bulkUpdFieldsTable")),ZPForm.isAdmin()||pageId.find("#zp_import_submitwork_flow").hide())}},zpMassUpdate.constructselectBoxForEditBulkUpd=function(fieldsDtls){var options="";return $.each(fieldsDtls,function(index,fcDtls){options+="<optgroup label='"+fcDtls.displayName+"' secNum='"+fcDtls.seqNum+"'>"+fcDtls.displayName,$.each(fcDtls.fields,function(ind,fieldDtls){options+="<option value='"+fieldDtls.fcId+"' columnNum='"+fieldDtls.columnNumber+"' fcNum='"+fieldDtls.columnSeq+"'>"+fieldDtls.displayName+"</option>"}),options+="</optgroup>"}),options},zpMassUpdate.getFcDtlsWhenFieldChange=function(thisObj){var formId=(Layout.Page.container,thisObj.value,this.formId);if(void 0!==ZPForm.FORM_COMPONENT_DATA[formId]){var columnName=(parseInt($(thisObj).find("option:selected").parent("optgroup").attr("secNum"))-1,$(thisObj).find("option:selected").attr("columnNum")),fcNum=parseInt($(thisObj).find("option:selected").attr("fcNum"));if(2==columnName){var lastIndex=parseInt($(thisObj).find("option:selected").parent("optgroup").find("option[columnnum=1]").last().attr("fcNum"));fcNum=fcNum-lastIndex-1}var fldDtls=this.findFCData(formId,$(thisObj).val());this.changeFields(fldDtls,thisObj)}},zpMassUpdate.changeFields=function(fieldDtlsObj,currElm){var selectFieldDtls=fieldDtlsObj,appendHere=$(currElm).closest("tr").find("td#firstEdtbox");appendHere.html(zpMassUpdate.constructEditElms(selectFieldDtls)),ZPSetupCommon.isEmpty(selectFieldDtls.autofillvalue)||appendHere.find("*[name=editable]").val(ZPeople.decodeTxt(selectFieldDtls.autofillvalue)),$(currElm).attr("labelName",selectFieldDtls.labelName),$(currElm).attr("isMandatory",selectFieldDtls.isMandatory),$(currElm).parent().find("div.dverrormsg").remove(),appendHere.removeClass("has-error"),appendHere.find("select").select2(),ZPeople.isZPNewUI()&&appendHere.find("[fieldType=26]").select2(ZPForm.select2.getSelect2Properties())},zpMassUpdate.constructEditElms=function(selectedFieldDtls){var editElms="",fieldType=selectedFieldDtls.fieldType,lblName=selectedFieldDtls.labelName;if(fieldType===ZPForm.Field.PICKLIST||selectedFieldDtls.fieldType==ZPForm.Field.LOOKUP&&!ZPeople.isZPNewUI()||fieldType===ZPForm.Field.BLOODGROUP||fieldType===ZPForm.Field.GENDER||fieldType===ZPForm.Field.COUNTRY){editElms+="<select class='selectBox' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"'>",editElms+="<option value='-Select-'>"+ZPI18N.getString("zp.select")+"</option>";var options=selectedFieldDtls.hasOwnProperty("isPrimaryLookup")&&selectedFieldDtls.isPrimaryLookup?selectedFieldDtls.hasOwnProperty("AddOptions")?selectedFieldDtls.AddOptions:selectedFieldDtls.EditOptions:selectedFieldDtls.Options;$.each(options,function(index,val){if(fieldType===ZPForm.Field.PICKLIST||fieldType===ZPForm.Field.BLOODGROUP||fieldType===ZPForm.Field.GENDER)editElms+="<option value='"+val+"'>"+val+"</option>";else if(fieldType===ZPForm.Field.COUNTRY){var name=val.name.toUpperCase();editElms+='<option code="'+val.code+'" value="'+name+'">'+name+"</option>"}else editElms+="<option value='"+val.Id+"'>"+val.Value+"</option>"}),editElms+="</select>"}else fieldType===DATE||fieldType===DATE_TIME?(editElms+="<div class='btnCal'>",editElms+=fieldType===DATE?"<input type='text' class='form-control' name='editable' onclick='Calendar.setUpCalendar(event,this)' id='editable"+lblName+"' fieldType = '"+fieldType+"' caltype='popup' />":"<input type='text' class='form-control' name='editable' onclick='Calendar.setUpCalendar(event,this,1)' id='editable"+lblName+"' fieldType = '"+fieldType+"' caltype='popup' />",editElms+="</div>"):editElms+=fieldType===TEXT_AREA?"<textarea rows='3' class='form-control' name='editable' fieldType = '"+fieldType+"'></textarea>":9===fieldType?"<input type='checkbox' class='form-control' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"'/>":selectedFieldDtls.fieldType==ZPForm.Field.LOOKUP?"<input type='text' id='editable"+lblName+"' name='editable' fcid='"+selectedFieldDtls.formComponentId+"' fieldType = '"+fieldType+"'/>":"<input type='text' class='form-control' id='editable"+lblName+"' name='editable' fcid='"+selectedFieldDtls.formComponentId+"' fieldType = '"+fieldType+"'/>";return editElms},zpMassUpdate.update=function(obj){var params,pageId=Layout.Page.container,formId=zpMassUpdate.formId,pkIds=[],fcIds=[],errorRef=[],duplicateErrRef=[];zpMassUpdate.selectedFieldIds=[];var userTableElm=null;$(obj).addClass("disabled"),zpMassUpdate.isUser?(userTableElm=pageId.find("table#userListTable"),$.each(userTableElm.find("input[name='userRowCheck']:checked"),function(index,obj){pkIds[index]=$(obj).closest("tr").attr("emperecno")})):(userTableElm=pageId.find("table#zp_views_records_table:visible"),$.each(userTableElm.find("tbody input#zp_view_sel_record:checked"),function(index,obj){pkIds[index]=$(this).parents("[recordid]").attr("recordid")})),$.each(pageId.find("select[name='fieldsSelBox']"),function(index,fields){fcIds[index]=$(fields).val()}),$("div.dverrormsg").remove(),params={formid:formId,mode:"edit",fcIds:JSON.stringify(fcIds),pkIds:JSON.stringify(pkIds),loginUserZUID:_LOGGEDIN_ZUID},pageId.find("#zp_import_submitwork_flow").length>0&&pageId.find("#zp_import_submitwork_flow [name=workFlowOn]").is(":checked")&&(params.isWfTrigger=!0),$.each(pageId.find("table#bulkUpdFieldsTable tbody").find("tr[name='bulkRows']"),function(index,rowObj){if("bulkRows"===$(rowObj).attr("name")){var value,fieldSelBox=$(rowObj).find("select[name='fieldsSelBox']"),fcId=fieldSelBox.val(),labelName=fieldSelBox.attr("labelName"),editableElm=fieldSelBox.closest("tr").find("*[name='editable']"),fieldType=editableElm.attr("fieldType");value="9"!==fieldType?editableElm.val():$(editableElm).is(":checked");var parentErrObj=$(rowObj).find("td#firstEdtbox");"true"===fieldSelBox.attr("isMandatory")&&ZPSetupCommon.isEmpty(value)?(parentErrObj.addClass("has-error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",new Array(labelName)),parentErrObj,"dverrormsg"),errorRef.push(labelName+index)):fieldType!=ZPForm.Field.EMAIL_ADDRESS||ZPSetupCommon.isEmpty(value)||ZPUtil.Validation.isEmail(value)?(value=fieldType==ZPForm.Field.DATE_TIME?Calendar.convertHourFormat(value):value,params[labelName]=value,parentErrObj.removeClass("has-error"),$("#"+labelName+index).remove(),-1!==errorRef.indexOf(labelName)&&errorRef.pop(labelName+index)):(parentErrObj.addClass("has-error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.validemail",new Array(labelName)),parentErrObj,"dverrormsg"),errorRef.push(labelName+index)),-1===zpMassUpdate.selectedFieldIds.indexOf(fcId)?(duplicateErrRef.length>0&&duplicateErrRef.pop(labelName+index),zpMassUpdate.selectedFieldIds.push(fcId)):(duplicateErrRef.push(labelName+index),ZPSetupCommon.showErr(ZPI18N.getString("zp.duplicatefield"),fieldSelBox.parent(),"dverrormsg"))}}),0===errorRef.length&&0===duplicateErrRef.length?ZPeople.Request.send("/massUpdate.zp",params,zpMassUpdate.handleResponseOfBulkUpdate):$(obj).removeClass("disabled")},zpMassUpdate.updateFields=function(obj){var pageId=Layout.Page.container,fcIds=[];if($.each(pageId.find("select[name='fieldsSelBox']"),function(index,fields){fcIds[index]=$(fields).val()}),ZPForm.isAllowedToEdit(fcIds,!0)){var key="zp.editapprovalconfirmmsg";ZPForm.CONF.approvalSettingsDetails.isVerifySend&&(key="zp.editapprsendconfirmmsg"),ZPeople.BSModal.confirm(zpMassUpdate.update,ZPI18N.getString("zp.confirm"),ZPI18N.getString(key))}else zpMassUpdate.update(obj)},zpMassUpdate.handleResponseOfBulkUpdate=function(resultObj,paramsObj){var pageId=Layout.Page.container,massUpdateElmId=pageId.find("div#massUpdatePopup");if(resultObj.isSuccess)if("EMPERRORS"===resultObj.errorType)ZPeople.Message.showFailureMsg(resultObj.invitationInactive.message);else{ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),pageId.find("div#zp_view_close_selection").click(),pageId.find("div#massUpdatePopup").modal("hide"),zpMassUpdate.isUser?User.ListUsers.getUserList():ZPView.refresh(!0);var pkIds=resultObj.modifiedPkIds;$.each(pkIds,function(index,val){ZPForm.SINGLE_RECORD_DTL[paramsObj.formid+"_"+index]=void 0})}else{if(resultObj.isAdminCountExceeded||resultObj.isLicenseCountExceeded){var errMsg=resultObj.isAdminCountExceeded?ZPI18N.getString("zp.rolelicenceexists"):ZPI18N.getString("zp.licensecountexceeded");ZPeople.Message.showFailureMsg(errMsg)}else{if("VALIDATION"===resultObj.errorType)massUpdateElmId.find("td").removeClass("has-error"),$.each(resultObj.errors,function(labelName,errObj){var appendHere=massUpdateElmId.find("#editable"+labelName),fieldType=appendHere.attr("fieldType");$(appendHere).parent().addClass("has-error");var errorAppendElm;errorAppendElm=fieldType==DATE||fieldType==DATE_TIME?$(appendHere).parent():$(appendHere).closest("td#firstEdtbox"),ZPSetupCommon.showErr(errObj.message,errorAppendElm,"dverrormsg")});else if("CUSTOMVALIDATIONFAILED"===resultObj.errorType)for(var resutarr=resultObj.errormessage,i=0;resutarr.length>i;i++){var tbodytr=jQuery("<tr />",{"class":"ZPLRow"}),recordId=resutarr[i].recordId,message=resutarr[i].message;tbodytr.append(jQuery("<td />").append("<a href='#form/view-formId:"+Layout.Page.urlparam.formId+"/recordId:"+recordId+"' target='_blank'>"+ZPI18N.getString("zp.viewRecord")+"</a>"));for(var td=jQuery("<td />"),keys=Object.keys(message),j=0;j<keys.length;j++){var key=keys[j],errObj=message[key];td.append(ZPeople.decodeTxt(errObj)+"<br><br>")}tbodytr.append(td),massUpdateElmId.find("#errormsg").find("#tablebody").html(tbodytr),massUpdateElmId.find("#errormsg").show()}else"EMPERRORS"===resultObj.errorType&&ZPeople.Message.showFailureMsg(resultObj.activeUserList.message);if(resultObj.isSuperAdminChange){var errMap=resultObj.errorMap;ZPSetupCommon.showErr(errMap.message,massUpdateElmId.find("#editable"+errMap.labelName).closest("td#firstEdtbox"),"dverrormsg")}}massUpdateElmId.find("#saveUpdate").removeClass("disabled")}},zpMassUpdate.findFCData=function(formId,fcId){var fldDtls={};return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(){var column1=this.column1;for(field in column1)if(column1[field].formComponentId==fcId)return fldDtls=column1[field],!1;var column2=this.column2;for(field in column2)if(column2[field].formComponentId==fcId)return fldDtls=column2[field],!1}),fldDtls};var ZPNewView={};ZPNewView={allComponents:{},crtSelectionRecords:{},crtSelectedRecords:{},criteriaCnt:null,fieldOptionConstruction:null,leftSideSelected:null,rightSideSelected:null,leftColumns:null,rightColumns:null,savedComponents:null,LAYOUT:null,INPUT_DROPDOWN:null,LASTVIEWID:null,localValues:null,headerComponents:null,mouseDownFlag:!1,childSelectFlag:!1,removeAscDescFlag:!1,removeGrpFlag:!1,removeSumFlag:!1,pickListComponent:null,isCustomView:!0,allCmpName:null,formName:null,firstTimeDecode:null,isEdit:!1,formId:null,fieldListCloneDom:{},OPERATORS:{EQUAL:18,NOT_EQUAL:19,LESS_THAN:20,GREATER_THAN:21,LESS_EQUAL:22,GREATER_EQUAL:23,STARTS_WITH:24,ENDS_WITH:25,CONTAINS:26,NOT_CONTAINS:27,EMPTY:29,NOT_EMPTY:30,YESTERDAY:31,TODAY:32,TOMORROW:33,IN:61,NOT_IN:62,LAST_MONTH:44,THIS_MONTH:45,NEXT_MONTH:46,TRUE:49,FALSE:50,LAST_YEAR:51,NEXT_YEAR:53,CURRENT_YEAR:52,LOGIN_USERS_DEPT:63,LOGIN_USER:64,LAST_WEEK:65,THIS_WEEK:66,NEXT_WEEK:67,LOGIN_USERS_DESIG:68},init:function(){ZPNewView.isCrtPropagationInit||($(document).on("click",'[isviewcrt="true"]',function(e){e.stopPropagation();var obj=$(e.target);"true"==obj.attr("isCrtFld")&&ZPNewView.fieldChange(obj)}),ZPNewView.isCrtPropagationInit=!0),ZPNewView.LAYOUT=$("<div class='PL30 PR30'><form style='width:70%;' class='form-horizontal pad' role='form'><div id='viewNameSection' class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.specifyviewname")+"</label><div class='col-sm-6'><input type='name' placeholder='"+ZPI18N.getString("zp.enterviewname")+"' class='form-control' id='zp_custom_view_name'><span id='zp_custom_view_name_error' class='error-msg'></span></div></div><div id='defaultViewSection' class='form-group'><div id='defaultViewSection' class='col-sm-6 col-sm-offset-3'><label class='checkbox DIB'><input id='zp_custom_view_default' type='checkbox'><span class='ML2'>"+ZPI18N.getString("zp.setdefaultview")+"</span></label></div></div><div id='view_approval_section' class='form-group'><div class='col-sm-6 col-sm-offset-3'><label class='checkbox DIB'><input id='zp_custom_view_approval' type='checkbox'><span class='ML2'>"+ZPI18N.getString("zp.showApproverDetails")+"</span></label></div></div><div id='viewPremissionSection' class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.viewPerm")+"</label><div class='col-sm-9'><div><label class='radio DIB'><input id='zp_custom_view_only_me' type='radio' name='view' onClick='ZPNewView.sharedTo()' checked><span class='ML2'>"+ZPI18N.getString("zp.onlytome")+"</span></label></div><div class='MT10'><label class='radio DIB'><input id='zp_custom_view_all_employees' type='radio' name='view' onClick='ZPNewView.sharedTo()'><span class='ML2'>"+ZPI18N.getString("zp.allowallemployeetoaccess")+"</span></label></div><div class='MT10'><label class='radio DIB'><input id='zp_custom_view_selected_users' type='radio' name='view' onClick='ZPNewView.sharedTo()'><span class='ML2'>"+ZPI18N.getString("zp.specificuser")+"</span></label></div></div></div><div class='form-group DN' id='zp_custom_view_sharedto'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.sharedto")+"</label><div id='applicableToComponent' class='col-sm-6'></div></div></form><h5>"+ZPI18N.getString("zp.selectcolumns")+"</h5><div class='row MB20'><div class='col-md-5'><div class='ZPSCdiv'><ul id='zp_custom_view_left_columns' class='list-group'></ul></div></div><div class='col-md-1 MT80'><div class='ZPCVatn'><div class='IC-ar-lft-2 blu S16 CP' onClick='ZPNewView.moveAllLeftToRight()'></div></div><div class='ZPCVatn'><div class='IC-ar-rgt blu S16 CP' onClick='ZPNewView.moveSelectedRowToRight()'></div></div><div class='ZPCVatn'><div class='IC-ar-lft blu S16 CP' onClick='ZPNewView.moveSelectedRowToLeft()'></div></div><div class='ZPCVatn'><div class='IC-ar-rgt-2 blu S16 CP' onClick='ZPNewView.moveAllRightToLeft()'></div></div></div><div class='col-md-6'><div class='ZPSCdiv' id='zp_rightSide'><ul id='zp_custom_view_right_columns' class='list-group'></ul></div><span class='error-msg DN' id='zp_right_column_error'></span></div></div><h5 id='criteriaHeader'>"+ZPI18N.getString("zp.criteria")+"</h5><div id='criteriaSection' style='border-top:1px solid #e9edf3;' class='outcontainer'><table class='table table-hover'><thead><tr><th width='100'>"+ZPI18N.getString("zp.andor")+"</th><th width='200'>"+ZPI18N.getString("zp.fieldname")+"</th><th width='180'>"+ZPI18N.getString("zp.condition")+"</th><th width='300'>"+ZPI18N.getString("zp.value")+"</th><th width='20'></th><th width='100'></th></tr></thead><tbody id='zp_custom_view_criteria_table_body'></tbody></table><span id='zp_criteria_error' class='error-msg'></div></div>"),ZPNewView.criteriaCnt=0,ZPNewView.firstTimeDecode=!0,ZPNewView.fieldOptionConstruction=null,ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.leftColumns={},ZPNewView.rightColumns={},ZPNewView.allCmpName={},ZPNewView.savedComponents=null,ZPNewView.localValues={},ZPNewView.headerComponents={},ZPNewView.pickListComponent=null,ZPNewView.formName=null,ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().remove(),ZPNewView.FIELDS_DROP_DOWN=null,ZPNewView.formId=ZPView.CURR_VIEWPARAMS.formId,ZPNewView.INPUT_DROPDOWN="<td id='lookupIcon' class='dropup PL0I'><i id='zp_crt_input_dropdown' class='IC-addlist S18 FL MT5 gry CP DN' data-toggle='dropdown' aria-expanded='false'></i><div id='crtDropdownSelection' class='dropdown-menu ZPCusPd ZPappBox ZptxtBox  ZPCmn-Arrow bottom rt gray'><div class='ZPTabVt'><div class='rhttabscrl'><div class='tab-content'><div class='tab-pane active' role='tabpanel'><div><div class='ZPtopSearch'><label class='checkbox DIB FL PT8 MR10'><input id='crtAllCheck' type='checkbox' onclick='ZPNewView.crtAllCheckSelect(this)'><span></span></label><div class='ZPsearch' id='ZPsearch'><div class='dvsearch Dropdown PR'><span class='ZPico-search FL MT2 ML8 ZPtooltip IC-lens S16' zptitle='Search Category'></span></div><input type='search' class='ZPselect' id='crtRecordSearch' placeholder='"+ZPI18N.getString("zp.search")+"' value='' name='Search'></div></div><div class='ZPapplCb'><ul id='ulList'></ul></div></div></div></div></div></div></div></td>"},createView:function(){$(".select2-dropdown-open").select2("close");var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,window.location.href="#"+Layout.UrlConf.getFormActionURL("createview")+"-formId:"+formID},editView:function(){var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,window.location.href="#"+Layout.UrlConf.getFormActionURL("editview")+"-formId:"+formID+"/viewId:"+ZPNewView.LASTVIEWID},showDelete:function(){ZPeople.BSModal.setup({id:"zp_modal_confirmpop",type:3,iconClass:"IC-alert",iconParenClass:"orgbgi",header:ZPI18N.getString("zp.zpalert"),body:ZPI18N.getString("zp.deleteconfirmmessage"),deleteOnHide:!0,closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.confirm"),successCallback:ZPNewView.deleteView})},deleteView:function(){var delFormID=ZPView.CURR_VIEWPARAMS.formId,delViewID=ZPView.CURR_VIEWPARAMS.viewId,url="/createViewAction.zp",params={mode:"deleteView",formID:delFormID,viewID:delViewID};ZPeople.Request.send(url,params,ZPNewView.afterDeleteAction)},getCreateViewPage:function(){ZPeople.BSModal.setup({id:"zp_createview",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.createview"),body:ZPeople.LOADING_HTML,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:ZPNewView.closeCallback,successCallback:ZPNewView.saveAction});var formID=ZPView.CURR_VIEWPARAMS.formId,url="/createViewAction.zp",params={mode:"newView",formID:formID};ZPeople.Request.send(url,params,ZPNewView.constructCreateViewPage)},getEditViewPage:function(){ZPeople.BSModal.setup({id:"zp_editview",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.editview"),body:ZPeople.LOADING_HTML,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:ZPNewView.closeCallback,successCallback:ZPNewView.updateAction});var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,void 0===ZPNewView.LASTVIEWID&&(ZPNewView.LASTVIEWID=Layout.Page.childUrlParam.viewId);var url="/createViewAction.zp",params={mode:"getViewDetails",formID:formID,viewID:ZPNewView.LASTVIEWID};ZPeople.Request.send(url,params,ZPNewView.constructEditViewPage)},constructCreateViewPage:function(data){if(void 0!==data.error)return void(void 0!==data.error.message?Layout.Page.container.find("#zp_createview").find(".modal-body").html("<p class='errorDiv'><b>"+data.error.message+"</b></p>"):void 0!==data.error.exception&&(Layout.Page.container.find("#zp_createview").find(".modal-body").html("<p class='errorDiv'><b>"+ZPI18N.getString("zp.erroroccurredloadingpage")+"</b></p>"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.erroroccurredloadingpage"))));ZPNewView.isEdit=!1,ZPNewView.allComponents=data.formDetailsMap,ZPNewView.init(),ZPNewView.FORM_NAME=data.formName,ZPNewView.isCustomView=!0,$.each(ZPNewView.allComponents,function(key,value){if(void 0!==value.childComponents&&Object.keys(value.childComponents).length>0){var tempObj={formCompID:value.formCompID,childComponents:value.childComponents,formCompName:value.formCompName};ZPNewView.headerComponents[value.formCompID+""]=tempObj}}),ZPNewView.initLeftColumns(),ZPNewView.initRightColumns();var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.defaultActions(),ZPNewView.fieldOptionPopOverInit(curr_criteria_id),Layout.UrlConf.isModuleForm()&&ZPNewView.LAYOUT.find("#defaultViewSection").remove(),ZPForm.isApprovalEnabled()||ZPNewView.LAYOUT.find("#view_approval_section").remove();var mdata=ZPeople.Module.getData();(!mdata.isAdmin||mdata.viewDetails.isLocAdmin||"P_MultiRater"==ZPForm.getTableName()||"P_MultiRater_Approval"==ZPForm.getTableName()||"P_Goals"==ZPForm.getTableName())&&ZPNewView.LAYOUT.find("#viewPremissionSection,#zp_custom_view_sharedto").remove(),Layout.Page.container.find("#zp_createview").find(".modal-body").html(ZPNewView.LAYOUT),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").removeAttr("disabled")},constructEditViewPage:function(data){if(void 0!==data.error)return void(void 0!==data.error.message?Layout.Page.container.find("#zp_editview").find(".modal-body").html("<p class='errorDiv style=''><b>"+data.error.message+"</b></p>"):void 0!==data.error.exception&&(Layout.Page.container.find("#zp_editview").find(".modal-body").html("<p class='errorDiv style=''><b>"+ZPI18N.getString("zp.erroroccurredloadingpage")+"</b></p>"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.erroroccurredloadingpage"))));ZPNewView.isEdit=!0;var viewDetails=data.viewDetails;ZPNewView.isCustomView=viewDetails.isCustomView;var viewObj=ZPNewView.getViewDetailByID(viewDetails.viewID);if(void 0!==viewObj&&(""===viewObj.ownerId||viewObj.ownerId.length<=0)&&(ZPNewView.isCustomView=!1),ZPNewView.allComponents=viewDetails.formDetailsMap,ZPNewView.init(),ZPNewView.FORM_NAME=viewDetails.formName,$.each(ZPNewView.allComponents,function(key,value){if(void 0!==value.childComponents&&Object.keys(value.childComponents).length>0){var tempObj={formCompID:value.formCompID,childComponents:value.childComponents,formCompName:value.formCompName};ZPNewView.headerComponents[value.formCompID+""]=tempObj}}),ZPNewView.LAYOUT.find("#zp_custom_view_name").val(ZPeople.decodeTxt(viewDetails.viewName)),ZPNewView.localValues.viewID=viewDetails.viewID,ZPNewView.localValues.expressionID=void 0===viewDetails.expressionID?0:viewDetails.expressionID,ZPNewView.localValues.reportPermissionID=0,ZPForm.isApprovalEnabled()||ZPNewView.LAYOUT.find("#view_approval_section").remove(),ZPNewView.LAYOUT.find("#zp_custom_view_approval").attr("checked",viewDetails.show_approver),ZPNewView.isCustomView){if(Layout.UrlConf.isModuleForm()&&ZPNewView.LAYOUT.find("#defaultViewSection").remove(),viewDetails.isDefaultView&&ZPNewView.LAYOUT.find("#zp_custom_view_default").attr("checked",!0),viewDetails.shareViewToAll)ZPNewView.LAYOUT.find("#zp_custom_view_all_employees").attr("checked",!0);else if(!viewDetails.shareViewToAll){var reportPermissionID=viewDetails.reportPermissionID;if(void 0!==reportPermissionID&&"0"!==reportPermissionID){ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").attr("checked",!0),ZPNewView.sharedTo(),ZPNewView.localValues.reportPermissionID=reportPermissionID;var reportPermissionData=viewDetails.reportPermissionData;Object.keys(reportPermissionData).length>0&&null!==ZPNewView.pickListComponent&&(ZPPickList.setSelectedUsers(reportPermissionData.empList),ZPPickList.setSelectedDepartments(reportPermissionData.deptList),ZPPickList.setSelectedRoles(reportPermissionData.roleList),ZPPickList.setSelectedLocations(reportPermissionData.locList))}else ZPNewView.LAYOUT.find("#zp_custom_view_only_me").attr("checked",!0)}var savedCriteria=viewDetails.criteria,tempCnt=0;if(0!==Object.keys(savedCriteria).length&&$.each(savedCriteria,function(key,value){var fcID=value.formComponentID,lkFcid=value.lookupFcId,obj=ZPNewView.allComponents[fcID];if(void 0==obj)return!0;var fc=fcID,pfcid=-1;if(void 0!=lkFcid&&!value.isBaseForm){if(obj=obj.childComponents[lkFcid],void 0==obj)return!0;pfcid=fcID,fc=lkFcid}var curr_criteria_id=ZPNewView.addCriteria();0!==tempCnt&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#operatorSelection").select2("val",value.conjunctiveCondn),ZPNewView.fiedpopoverclback(ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldOpetions"),pfcid,fc,!0),ZPNewView.fieldOptionPopOverInit(curr_criteria_id);var operator=value.Operator,originalCrtValue=ZPeople.decodeTxt(value.CrtVal);ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("val",operator),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").change();var fcType=obj.fcType;if(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST||operator!=ZPNewView.OPERATORS.IN&&operator!=ZPNewView.OPERATORS.NOT_IN)ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").val(ZPeople.decodeTxt(value.CrtVal));else{ZPNewView.loadCrtRequiredRecords(fc,fcType);var fcRecords1=ZPNewView.crtSelectionRecords[fc];if(void 0!==fcRecords1&&Object.keys(fcRecords1).length>0){var fcRecords=JSON.parse(JSON.stringify(fcRecords1));originalCrtValue="";var values=JSON.parse(value.CrtVal),selectedRecords=ZPNewView.crtSelectedRecords[curr_criteria_id];void 0===selectedRecords&&(selectedRecords=[]);var selVals=[];$.each(values,function(key,value){$.each(fcRecords,function(k,v){(value==v.VALUE&&!v.isChecked||value==v.ID)&&(selectedRecords.push(v.ID+""),v.isChecked=!0,selVals.push(ZPeople.decodeTxt(v.DISPVALUE)))})}),ZPNewView.crtSelectedRecords[curr_criteria_id]=selectedRecords,ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").val(selVals.toString())}}Timetracker.views.isTimetrackerSpecialFields(obj.tName,obj.labelName)&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("val",Timetracker.views.getDefaultValueForSearch(obj.labelName,value)).change(),tempCnt++}),0==tempCnt){var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.fieldOptionPopOverInit(curr_criteria_id)}}else ZPNewView.LAYOUT.find("#defaultViewSection,#viewPremissionSection,#criteriaHeader,#criteriaSection,#zp_custom_view_sharedto").remove();var selectedComps=viewDetails.components;0!==Object.keys(selectedComps).length&&(ZPNewView.savedComponents=selectedComps,ZPNewView.constructSelectedRightColumn()),ZPNewView.initLeftColumns(),ZPNewView.defaultActions();var mdata=ZPeople.Module.getData();(!mdata.isAdmin||mdata.viewDetails.isLocAdmin||"P_MultiRater"==ZPForm.getTableName()||"P_MultiRater_Approval"==ZPForm.getTableName()||"P_Goals"==ZPForm.getTableName())&&ZPNewView.LAYOUT.find("#viewPremissionSection,#zp_custom_view_sharedto").remove(),Layout.Page.container.find("#zp_editview").find(".modal-body").html(ZPNewView.LAYOUT),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").removeAttr("disabled")},defaultActions:function(){Layout.Page.container.find(".modal-body").scrollTop(0),$(document).on("show.bs.dropdown","#lookupIcon",function(event){var inp=$(event.target).parent().find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;ZPNewView.loadCrtRequiredRecords(fcid,fcType);var crtID=$(event.target).parent().attr("id");ZPNewView.constructCrtSelectionRecord(crtID,ZPNewView.crtSelectionRecords[fcid],fcType,fcid),void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID]),ZPNewView.LAYOUT.find("#crtRecordSearch").val("")}),$(document).on("keyup","#crtRecordSearch",function(e){var tr=$(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent(),fcID=$(tr).find('[iscrtfc="true"]').attr("fcid"),currRecords=ZPNewView.crtSelectionRecords[fcID];if(!(Object.keys(currRecords).length<=0)){var crtID=$(tr).attr("id"),searchStr=$(this).val().trim();if(searchStr.length<=0)return ZPNewView.constructCrtSelectionRecord(crtID,currRecords),void(void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID]));searchStr=searchStr.toLowerCase();var tempList=[];$.each(currRecords,function(key,value){var val=value.DISPVALUE;-1!==val.toLowerCase().indexOf(searchStr)&&tempList.push(value)}),ZPNewView.constructCrtSelectionRecord(crtID,tempList),void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID])}}),$(document).on("click","#crtDropdownSelection",function(e){$(this).hasClass("ZPCusPd")&&e.stopPropagation()}),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").sortable({start:function(event,ui){$(ui.item).find("#parentCompDiv").addClass("drag")},stop:function(event,ui){$(ui.item).find("#parentCompDiv").removeClass("drag")},beforeStop:function(event,ui){ZPNewView.mouseDownFlag=!0},update:function(event,ui){ZPNewView.setRightColumns()}}),ZPNewView.LAYOUT.find("#zp_rightSide").click(function(event){var focusInID=event.target.id,focusOutID=$(this).find("input").parent().attr("id");focusInID.length>1&&focusInID!==focusOutID&&$(this).find("input").blur()}),ZPNewView.LAYOUT.find("#zp_custom_view_name").keypress(function(){var subject=ZPNewView.LAYOUT.find("#zp_custom_view_name").val();subject.length<=0&&ZPNewView.LAYOUT.find("#zp_custom_view_name_error").hide()}),$(document).on("keyup","#fieldSearch",function(e){var parent=$(this).closest('[id^="fcid"]'),data=this.value.split(" "),allDataObj=$(parent).find("[name=list-group-item]");allDataObj.hide(),$.each(data,function(i,v){allDataObj=allDataObj.filter("*:Contains('"+v+"')")}),allDataObj.show()})},closeCallback:function(){if(ZPView.setViewPropertie("refreshStatus",!0),ZPView.setViewPropertie("refreshHeaders",!0),ZPView.removeViewProperty("groupBy"),ZPView.removeViewProperty("sortBy"),void 0===ZPNewView.LASTVIEWID||null===ZPNewView.LASTVIEWID)if(ZPeople.Module.getData().viewDetails.loaded=!1,ZPView.constructViews(),Layout.UrlConf.isModuleForm())ZPNewView.LASTVIEWID="systemview";else{var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option");ZPNewView.LASTVIEWID=extOptions[0].value}window.location.href=ZPView.getURL(ZPNewView.LASTVIEWID)},initLeftColumns:function(){ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){(void 0===ZPNewView.headerComponents[key+""]||key!==ZPNewView.headerComponents[key+""].formCompID)&&ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents()},initRightColumns:function(){ZPNewView.constructRightColumns()},sort:function(components){var sortResult=Object.keys(components);return sortResult.sort(),sortResult},constructLeftCoulmns:function(components){var sortedComponents=ZPUtil.sortByJSONValue(components,"formCompID",!0);ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").empty();for(var i=0;i<sortedComponents.length;i++){var singleComponent=sortedComponents[i],formCompID=singleComponent.formCompID;void 0===formCompID&&(formCompID=$(singleComponent).attr("id"));var cmpName=singleComponent.formCompName;void 0===cmpName&&(cmpName=ZPNewView.allCmpName[formCompID].data("cmpName"));var parentFCID=singleComponent.parentFCID;void 0===parentFCID&&(parentFCID=$(singleComponent).attr("parentFCID"));var refFormID=singleComponent.refFormID;void 0===refFormID&&(refFormID=$(singleComponent).attr("refFormID"));var childCnt=singleComponent.childCnt;void 0===childCnt&&(childCnt=$(singleComponent).attr("childCnt"));var sumRequired=singleComponent.sumRequired;void 0===sumRequired&&(sumRequired=$(singleComponent).attr("sumRequired"));var row="<li id="+formCompID+" parentFCID="+parentFCID+" refFormID="+refFormID+" sumRequired="+sumRequired+" childCnt="+childCnt+" side=\"left\"class='list-group-item' onclick='ZPNewView.componentSelect(event,\"left\",this,\"parent\")'><div id='parentCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div><span id='leftFormCompNameID'></span></div></li>",childPresent=ZPNewView.headerComponents[formCompID+""];void 0!==childPresent&&(row=ZPNewView.constructChildComponents(formCompID,parentFCID,refFormID,childCnt,cmpName,childPresent.childComponents)),ZPNewView.leftColumns[formCompID+""]=row,ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").append(row),ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children("#"+formCompID).find("#leftFormCompNameID").text(cmpName),void 0!==childPresent&&ZPNewView.setChildCompName(formCompID,childPresent.childComponents),ZPNewView.allCmpName.hasOwnProperty(formCompID)||(row=$(row),row.data("cmpName",cmpName),row.data("displayName",cmpName),ZPNewView.allCmpName[formCompID]=row)}},setChildCompName:function(parentFormID,childComponents){$.each(childComponents,function(key,value){var childFormCompID=parentFormID+"_"+value.formCompID,childCmpName=value.formCompName;ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children().find("#"+childFormCompID).find("#childCmpNameID").text(childCmpName)})},constructChildComponents:function(formCompID,parentFCID,refFormID,childCnt,cmpName,childComponents){var row="";if(void 0!==childComponents&&Object.keys(childComponents).length>0){row="<li id="+formCompID+" parentFCID="+parentFCID+" refFormID="+refFormID+" childCnt="+childCnt+" side=\"left\" class='list-group-item'onclick='ZPNewView.componentSelect(event,\"left\",this,\"parent\")'><div id='parentCompDiv' class='list-child'><div id='upAndDwn' class='IC-ar-dwn FL blu MR5 CP' onclick='ZPNewView.toggleLookupComponent(this)'></div><span id='leftFormCompNameID'></span><div class='IC-Lookup2-2x FR blu CP' onclick='ZPNewView.toggleLookupComponent(this)'></div></div>",row+="<ul class='list-group DN'>";var sortedChildComponents=ZPUtil.sortByJSONValue(childComponents,"formCompID",!0);$.each(sortedChildComponents,function(key,value){var childFormCompID=formCompID+"_"+value.formCompID,childCmpName=value.formCompName,childParentFCID=value.parentFCID,childRefFormID=value.refFormID,childCnt=0,subRow="<li id="+childFormCompID+" parentFCID="+childParentFCID+" refFormID="+childRefFormID+" childCnt="+childCnt+" side=\"left\"class='list-group-item' onclick='ZPNewView.childComponentSelect(event,\"left\",this,\"child\")'><div id='childCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div><span id='childCmpNameID'></span></div></li>",tempSubRow=subRow;ZPNewView.allCmpName.hasOwnProperty(childFormCompID)||(tempSubRow=$(tempSubRow),tempSubRow.data("cmpName",childCmpName),tempSubRow.data("displayName",childCmpName),ZPNewView.allCmpName[childFormCompID]=tempSubRow),row+=subRow}),row+="</ul></li>"}return row},constructRightColumns:function(components){ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").empty(),void 0!==components&&$.each(components,function(key,value){var cmpName=ZPNewView.allCmpName[key].data("displayName"),refFormID=$(value).attr("refFormID"),parentFCID=$(value).attr("parentFCID"),childCnt=$(value).attr("childCnt"),sumEnabled=$(value).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum"),isAscStr=$(value).find("#asc_desc").attr("value"),isAsc=void 0;isAsc=void 0===isAscStr||isAscStr.length<=0?void 0:"ASC"===isAscStr?!0:!1;var isGrp=$(value).find("#grpBy").attr("value");isGrp=void 0===isGrp||isGrp.length<=0||"GRP"!==isGrp?!1:!0;var row=ZPNewView.constructRightSideListComponent(key,parentFCID,refFormID,childCnt,cmpName,isGrp,isAsc,sumEnabled);ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").append(row);var decodeCmpName=cmpName,originalName=ZPNewView.getOriginalName(key);ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#originalFormCompNameID").text(originalName)),void 0!==parentFCID&&"0"!==parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(parentFCID))}),ZPNewView.setRightColumns()},constructSelectedRightColumn:function(){ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").empty();var sortedBySeq=ZPUtil.sortByJSONValue(ZPNewView.savedComponents,"sequenceNo",!0);$.each(sortedBySeq,function(key,value){var fcID=value.referredKey,cmpDisplayName=value.displayName;ZPNewView.firstTimeDecode&&(cmpDisplayName=ZPeople.decodeTxt(cmpDisplayName));var eachRow=ZPNewView.constructRightSideListComponent(fcID,value.parentFCID,value.refFormID,value.childCnt,cmpDisplayName,value.grouping,value.sorting,value.sumEnabled);ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").append(eachRow);var decodeCmpName=cmpDisplayName,originalName=ZPNewView.getOriginalName(fcID);ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#originalFormCompNameID").text(originalName)),void 0!==value.parentFCID&&"0"!==value.parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(value.parentFCID)),ZPNewView.rightColumns[fcID]=eachRow}),ZPNewView.firstTimeDecode=!1,ZPNewView.setRightColumns()},setRightColumns:function(htmlObj){ZPNewView.rightColumns={};var currRightComponents=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();$.each(currRightComponents,function(key,value){var id=$(this).attr("id");ZPNewView.rightColumns[id+""]=$(this)})},constructRightSideListComponent:function(key,parentFCID,refFormID,childCnt,cmpName,isGrp,isAsc,sumEnabled){var selected="<li id="+key+" value="+key+"  parentFCID="+parentFCID+" refFormID="+refFormID+" childCnt="+childCnt+" side=\"right\" class='list-group-item' onclick=ZPNewView.componentSelect(event,'right',this)>"+ZPNewView.listDiv(key,cmpName,parentFCID,isGrp,isAsc,sumEnabled);selected+="</li>";var tempObj=selected;return tempObj=$(tempObj),tempObj.data("cmpName",cmpName),tempObj.data("displayName",cmpName),ZPNewView.allCmpName[key]=tempObj,selected},listDiv:function(fcID,cmpName,parentFCID,isGrp,isAsc,sumEnabled){var displayName=cmpName,listDiv="<div id='parentCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div>",originalName=ZPNewView.getOriginalName(fcID);listDiv+=ZPNewView.isEqual(originalName,displayName)?"<span id='rightFormCompNameID'></span>":"<div class='Edtxt'><span id='editedFormCompNameID'></span><br><font class='S12' id='originalFormCompNameID'></font></div>";var formComp=ZPNewView.allComponents[fcID];if(void 0!==parentFCID&&"0"!==parentFCID&&(listDiv+="<i class='IC-ar-lft gry CP S13 ML5'></i><font id='parentFormCmpNameID'></font>",formComp=ZPNewView.allComponents[parentFCID].childComponents[fcID.split("_")[1]]),listDiv+="<i class='IC-pen gry CP S13 ML8 list-over' onmousedown='ZPNewView.enableTextBox(this)'></i>",ZPNewView.isCustomView&&formComp&&formComp.grpRequired){if(void 0===isAsc||isAsc.length<=0)listDiv+="<div id='asc_desc' class='asdc ML10 list-over' onmousedown='ZPNewView.setAscDesc(this)' value=''>"+ZPI18N.getString("zp.capitalasc")+"</div>";else{var srtValue=ZPI18N.getString("zp.capitalasc");isAsc||(srtValue=ZPI18N.getString("zp.capitaldesc")),listDiv+="<div id='asc_desc' class='asdc ML10' onmousedown='ZPNewView.setAscDesc(this)' value='"+srtValue+"'>"+srtValue+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i></div>"}listDiv+=void 0===isGrp||!isGrp||isGrp.length>0?"<div id='grpBy' class='asdc ML10 list-over' onmousedown='ZPNewView.setGroupBy(this)' value=''>"+ZPI18N.getString("zp.capitalgrp")+"</div>":"<div id='grpBy' class='asdc ML10' onmousedown='ZPNewView.setGroupBy(this)' value='"+ZPI18N.getString("zp.capitalgrp")+"'>"+ZPI18N.getString("zp.capitalgrp")+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeGrpBy(this)'></i></div>"}if(void 0!==formComp){var sumRequired=formComp.sumRequired;sumRequired&&(listDiv+=sumEnabled?"<div id='sumID' class='asdc ML10' onmousedown='ZPNewView.setSum(this)' value='"+ZPI18N.getString("zp.capitalsum")+"'>"+ZPI18N.getString("zp.capitalsum")+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeSum(this)'></i></div>":"<div id='sumID' class='asdc ML10 list-over' onmousedown='ZPNewView.setSum(this)' value=''>"+ZPI18N.getString("zp.capitalsum")+"</div>")}return listDiv+="</div>"},setSum:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeSumFlag)return void(ZPNewView.removeSumFlag=!1);var liObj=$(obj).parent().parent();$(obj).hasClass("list-over")&&($(liObj).find("#sumID").removeClass("list-over"),$(liObj).find("#sumID").attr("value",ZPI18N.getString("zp.capitalsum")),$(liObj).find("#sumID").html(ZPI18N.getString("zp.capitalsum")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeSum(this)'></i>"))},removeSum:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeSumFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#sumID").addClass("list-over"),$(liObj).find("#sumID").attr("value",""),$(liObj).find("#sumID").text(ZPI18N.getString("zp.capitalsum")),$(liObj).find("#sumID").find("i").remove()},setAscDesc:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeAscDescFlag)return void(ZPNewView.removeAscDescFlag=!1);var liObj=$(obj).parent().parent();$(obj).hasClass("list-over")?($(liObj).find("#asc_desc").removeClass("list-over"),$(liObj).find("#asc_desc").attr("value",ZPI18N.getString("zp.capitalasc")),$(liObj).find("#asc_desc").html(ZPI18N.getString("zp.capitalasc")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i>")):ZPNewView.toggleAscDesc(obj)},removeAscDesc:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeAscDescFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#asc_desc").addClass("list-over"),$(liObj).find("#asc_desc").attr("value",""),$(liObj).find("#asc_desc").text(ZPI18N.getString("zp.capitalasc")),$(liObj).find("#asc_desc").find("i").remove();var grpVal=$(liObj).find("#grpBy").attr("value");void 0!==grpVal&&grpVal===ZPI18N.getString("zp.capitalgrp")&&(ZPNewView.removeGrpBy($(liObj).find("#grpBy").find("i")),ZPNewView.removeGrpFlag=!1)},setGroupBy:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeGrpFlag)return void(ZPNewView.removeGrpFlag=!1);var liObj=$(obj).parent().parent();if($(obj).hasClass("list-over")){$(liObj).find("#grpBy").removeClass("list-over"),$(liObj).find("#grpBy").attr("value",ZPI18N.getString("zp.capitalgrp")),$(liObj).find("#grpBy").html(ZPI18N.getString("zp.capitalgrp")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeGrpBy(this)'></i>");var sortVal=$(liObj).find("#asc_desc").attr("value");(void 0===sortVal||sortVal.length<=0)&&ZPNewView.setAscDesc($(liObj).find("#asc_desc"))}},removeGrpBy:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeGrpFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#grpBy").addClass("list-over"),$(liObj).find("#grpBy").attr("value",""),$(liObj).find("#grpBy").text(ZPI18N.getString("zp.capitalgrp")),$(liObj).find("#grpBy").find("i").remove();var sortVal=$(liObj).find("#asc_desc").attr("value");void 0!==sortVal&&sortVal.length>0&&(ZPNewView.removeAscDesc($(liObj).find("#asc_desc").find("i")),ZPNewView.removeAscDescFlag=!1)},enableTextBox:function(textObj){ZPNewView.mouseDownFlag=!0;var liObj=$(textObj).parent().parent(),fcID=$(liObj).attr("id"),cmpName=ZPNewView.allCmpName[fcID].data("displayName"),inputButton="<div class='IC-drag FL gry MT5 MR5'></div><input type='text' class='form-control table-inpt  input-bb1' onmousedown='ZPNewView.removeSelectOnInputBox()'><i class='IC-tick S15 DIB grn ML5 MR10 MT5 CP' onmousedown='ZPNewView.disableTextBox(this)'></i><i class='IC-cls S12 red DIB  CP MT5' onmousedown='ZPNewView.disableTextBox(this,true)'></i>";if(void 0!==$(liObj).find("#grpBy")&&liObj.data("isGrp",$(liObj).find("#grpBy").attr("value")),void 0!==$(liObj).find("#asc_desc")&&liObj.data("isAsc",$(liObj).find("#asc_desc").attr("value")),void 0!==$(liObj).attr("parentFCID")&&liObj.data("parentFCID",$(liObj).attr("parentFCID")),void 0!==$(liObj).find("#sumID")){var sumEnabled=$(liObj).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum");liObj.data("sumEnabled",sumEnabled)}$(liObj).html(inputButton),setTimeout(function(){$(liObj).find("input").focus(),$(liObj).find("input").val(""),$(liObj).find("input").val(cmpName)},0),$(liObj).find("input").blur(function(){ZPNewView.disableTextBox($(this).next(),!0)})},disableTextBox:function(obj,isCancel){var liObj=$(obj).parent(),fcID=$(liObj).attr("id"),oldCmpName="";oldCmpName=isCancel?ZPNewView.allCmpName[fcID].data("displayName"):$(liObj).find("input").val();var isGrp=void 0;void 0!==liObj.data("isGrp")&&(isGrp=liObj.data("isGrp")===ZPI18N.getString("zp.capitalgrp"));var isAsc=void 0;void 0!==liObj.data("isAsc")&&(isAsc=liObj.data("isAsc"),isAsc=isAsc.length<=0?"":liObj.data("isAsc")===ZPI18N.getString("zp.capitalasc"));var parentFCID=void 0;void 0!==liObj.data("parentFCID")&&(parentFCID=liObj.data("parentFCID"));var sumEnabled=liObj.data("sumEnabled"),decodeCmpName=oldCmpName,originalName=ZPNewView.getOriginalName(fcID);if(void 0==decodeCmpName||0==decodeCmpName.trim().length)return void $(liObj).append('<div class="error-msg PL30">'+ZPI18N.getString("zp.relformerrmsg")+"</div>");ZPNewView.allCmpName[fcID].data("displayName",oldCmpName);var liHTML=ZPNewView.listDiv(fcID,oldCmpName,parentFCID,isGrp,isAsc,sumEnabled);$(liObj).html(liHTML),ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#originalFormCompNameID").text(originalName)),void 0!==parentFCID&&"0"!==parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(parentFCID)),ZPNewView.mouseDownFlag=!0},removeSelectOnInputBox:function(){ZPNewView.mouseDownFlag=!0},fieldChange:function(obj){var fcid=obj.attr("fcid"),pfcid=obj.attr("pfcid"),crtObj=obj.closest('[id^="zp_criteria"]'),fcObj=(crtObj.find('[iscrtfc="true"]'),ZPNewView.allComponents[fcid+""]),dispName="";-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""],dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),dispName=fcObj.formCompName+dispName,crtObj.find(".error-msg").hide(),crtObj.find("#txtValue").val(""),crtObj.find("#txtValue").removeAttr("disabled"),crtObj.find("#txtValue").removeAttr("onclick");var fcType=fcObj.fcType,formulaDType=fcObj.formulaDType;fcType==ZPForm.Field.SCRIPT&&void 0!=formulaDType&&-1!=formulaDType&&(fcType=formulaDType);var isLookup=!1,tName=fcObj.tName,cName=fcObj.columnName;fcType==ZPForm.Field.LOOKUP&&(cName=fcObj.reffColName,tName=fcObj.reffTname);var oprs="",defOptn=ZPNewView.OPERATORS.EQUAL,lkpDefOptn="";fcType==ZPForm.Field.LOOKUP&&(isLookup=!0,fcType=fcObj.reffcType,void 0==fcType&&(fcType=ZPForm.Field.TEXT),"P_Department"==tName||"P_DepartmentN1"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DEPT+"'>"+ZPI18N.getString("zp.loginUsersDept")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DEPT):("P_Employee"==tName||"P_EmployeeN1"==tName)&&(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USER+"'>"+ZPI18N.getString("zp.loginUser")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USER)),fcObj.isEncrypted?(oprs="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL):Timetracker.views.isTimetrackerSpecialFields(tName,fcObj.labelName,fcObj.reffTname)?(oprs+=Timetracker.views.getSearchOperationOptions(fcObj.labelName,!0),defOptn=Timetracker.views.getDefaultValueForSearch(fcObj.labelName)):fcType==ZPForm.Field.TEXT||fcType==ZPForm.Field.EMAIL_ADDRESS||fcType==ZPForm.Field.PHONE_NUMBER||fcType==ZPForm.Field.URL||fcType==ZPForm.Field.TEXT_AREA||fcType==ZPForm.Field.FILE_UPLOAD||fcType==ZPForm.Field.IMAGE||fcType==ZPForm.Field.BLOODGROUP||fcType==ZPForm.Field.GENDER||fcType==ZPForm.Field.COUNTRY?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='24'>"+ZPI18N.getString("zp.startswith")+"</option>",oprs+="<option value='25'>"+ZPI18N.getString("zp.endswith")+"</option>",oprs+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",oprs+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>"):fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>"):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>"),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.before")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.after")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.YESTERDAY+"'>"+ZPI18N.getString("zp.yesterday")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.TODAY+"'>"+ZPI18N.getString("zp.today")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.TOMORROW+"'>"+ZPI18N.getString("zp.tomorrow")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_WEEK+"'>"+ZPI18N.getString("zp.lastweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.THIS_WEEK+"'>"+ZPI18N.getString("zp.thisweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_WEEK+"'>"+ZPI18N.getString("zp.nextweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_MONTH+"'>"+ZPI18N.getString("zp.lastmonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.THIS_MONTH+"'>"+ZPI18N.getString("zp.thismonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_MONTH+"'>"+ZPI18N.getString("zp.nextmonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_YEAR+"'>"+ZPI18N.getString("zp.lastyear")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.CURRENT_YEAR+"'>"+ZPI18N.getString("zp.thisyear")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_YEAR+"'>"+ZPI18N.getString("zp.nextyear")+"</option>",fcType==ZPForm.Field.DATE_TIME?crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this,1)"):crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this)"),crtObj.find("#txtValue").attr("caltype","popup"),defOptn=ZPNewView.OPERATORS.TODAY):fcType==ZPForm.Field.CHECK_BOX?(oprs+="<option value='49'>"+ZPI18N.getString("zp.true")+"</option>",oprs+="<option value='50'>"+ZPI18N.getString("zp.false")+"</option>",defOptn=ZPNewView.OPERATORS.TRUE):fcType==ZPForm.Field.NUMBER||fcType==ZPForm.Field.CURRENCY||fcType==ZPForm.Field.DECIMAL?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.lesserthan")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.greaterthan")+"</option>",oprs+="<option value='22'>"+ZPI18N.getString("zp.lesserorequalto")+"</option>",oprs+="<option value='23'>"+ZPI18N.getString("zp.greaterorequalto")+"</option>"):fcType==ZPForm.Field.PICKLIST?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='24'>"+ZPI18N.getString("zp.startswith")+"</option>",oprs+="<option value='25'>"+ZPI18N.getString("zp.endswith")+"</option>",oprs+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",oprs+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.lesserthan")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.greaterthan")+"</option>",oprs+="<option value='22'>"+ZPI18N.getString("zp.lesserorequalto")+"</option>",oprs+="<option value='23'>"+ZPI18N.getString("zp.greaterorequalto")+"</option>",defOptn=ZPNewView.OPERATORS.IN):fcType==ZPForm.Field.TIME?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.before")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.after")+"</option>"):isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),""!=lkpDefOptn&&(defOptn=lkpDefOptn),crtObj.find("[isopr='true']").html(oprs),crtObj.find("[isopr='true']").attr("disabled",!1),crtObj.find("[isopr='true']").select2(),crtObj.find("[isopr='true']").select2("val",[defOptn]);var criteriaRowId=crtObj.attr("id");if(isLookup||fcType==ZPForm.Field.PICKLIST){var values=ZPNewView.crtSelectedRecords[criteriaRowId];void 0!==values&&delete ZPNewView.crtSelectedRecords[criteriaRowId]}ZPNewView.addPickListComponent(criteriaRowId,isLookup),isLookup||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE?crtObj.find("#txtValue").keydown(function(e){e.preventDefault()}):crtObj.find("#txtValue").unbind("keydown"),crtObj.find("[isopr='true']").change()},constructCriteria:function(){var criteriaRow="<tr id='zp_criteria_"+ZPNewView.criteriaCnt++ +"' class='ZPLRow ZPLErr'>";return criteriaRow+="<td>",ZPNewView.criteriaCnt>1&&(criteriaRow+="<select id='operatorSelection'><option value='AND'>"+ZPI18N.getString("zp.captialand")+"</option><option value='OR'>"+ZPI18N.getString("zp.captialor")+"</option></select>"),criteriaRow+="</td>",criteriaRow+="<td class='dropdown'><input id='fieldOpetions' value='"+ZPI18N.getString("zp.none")+"' fcid='-1' pfcid='-1' iscrtfc='true' class='form-control'data-placement='bottom' data-toggle='popover'><span class='error-msg DN' id='zp_criteria_field_error'></span></td>",criteriaRow+="<td><select isopr='true' onChange=ZPNewView.onConditionChange(this)><option value='-1'>"+ZPI18N.getString("zp.none")+"</option></select></td>",criteriaRow+="<td id='crtValueTD'><input id='txtValue' type='text' class='form-control'><span class='error-msg DN' id='zp_criteria_error'></span></td>",criteriaRow+=ZPNewView.INPUT_DROPDOWN,criteriaRow+="<td>",criteriaRow+="<div class='IC-plus-fill S16 blu FL MT5 CP' onclick=ZPNewView.addCriteria(this)></div>",criteriaRow+="<div class='IC-cls-fill S16 red FL MT5 ML5 CP' onclick=ZPNewView.removeCriteria(this)></div>",criteriaRow+="</td></tr>"},fieldOptionPopOverInit:function(crtID){var ruleFieldObj=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").find("#"+crtID).find("#fieldOpetions"),menuBoxContent=ZPNewView.constructFieldOptionsPopover(ruleFieldObj);menuBoxContent.find("#contentDiv").removeClass("ulItemrec"),ZPNewView.defaultActions(),$(ruleFieldObj).setPopOver({callback:ZPNewView.fiedpopoverclback,html:menuBoxContent,targetId:ruleFieldObj,keyname:"name=list-group-item",container:""})},constructFieldOptionsPopover:function(obj){var fieldListClone,formId=ZPNewView.formId,fcid=$(obj).attr("fcid"),pfcid=$(obj).attr("pfcid");if(!ZPNewView.fieldListCloneDom.hasOwnProperty(formId)){fieldListClone=AutomationCommon.getFormFieldsHtml().clone();var tabLi=fieldListClone.find("#dvRecipient li:first").clone(),contDiv=fieldListClone.find("#contentDiv :first").clone(),contLi=fieldListClone.find("[name=list-group-item]").clone();fieldListClone.find("#dvRecipient").empty(),fieldListClone.find("#contentDiv").empty();var cloneTagLiForBaseForm=tabLi.clone();cloneTagLiForBaseForm.attr({"class":"",id:"div"+ZPNewView.formId}),cloneTagLiForBaseForm.find("a").attr({"data-toggle":"tab",href:"#fcid"+ZPNewView.formId}).html(ZPNewView.FORM_NAME),fieldListClone.find("#dvRecipient").append(cloneTagLiForBaseForm),$.each(ZPNewView.headerComponents,function(key,value){var cloneTagLi=tabLi.clone();cloneTagLi.attr({"class":"",id:"div"+key}),cloneTagLi.find("a").attr({"data-toggle":"tab",href:"#fcid"+key}).text(value.formCompName),fieldListClone.find("#dvRecipient").append(cloneTagLi)});var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({"class":"tab-pane fade",id:"fcid"+ZPNewView.formId}),$.each(ZPNewView.allComponents,function(key,value){if("0"===value.parentFCID&&value.fcType!==ZPForm.Field.IMAGE&&!value.isMultiSelect){var li=contLi.clone(),fieldKey=value.formCompID;li.find("[name=optDiv]").attr({id:fieldKey,pfcid:"-1"}),li.find("[name=mOpt]").html(value.crtDispName),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li)}}),fieldListClone.find("#contentDiv").append(cloneContDiv),$.each(ZPNewView.headerComponents,function(key,value){var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({"class":"tab-pane fade",id:"fcid"+key}),$.each(value.childComponents,function(k,v){var tName=v.tName,columnName=v.columnName;if(("P_Rating"!=tName||"STARS"!=columnName)&&v.fcType!=ZPForm.Field.IMAGE){var li=contLi.clone(),fieldKey=k;li.find("[name=optDiv]").attr({id:fieldKey,pfcid:value.formCompID}),li.find("[name=mOpt]").html(v.crtDispName),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li)}}),fieldListClone.find("#contentDiv").append(cloneContDiv)}),ZPNewView.fieldListCloneDom[formId]=$(fieldListClone)}return fieldListClone=ZPNewView.fieldListCloneDom[formId].html(),fieldListClone=jQuery("<div />",{"class":"clone"}).append(fieldListClone),-1==fcid&&-1==pfcid?($(fieldListClone).find("#div"+ZPNewView.formId).attr("class","active"),$(fieldListClone).find("#fcid"+ZPNewView.formId).attr("class","tab-pane fade active in")):-1==pfcid&&-1!==fcid?($(fieldListClone).find("#div"+ZPNewView.formId).attr("class","active"),$(fieldListClone).find("#fcid"+ZPNewView.formId).attr("class","tab-pane fade active in"),$(fieldListClone).find("#fcid"+ZPNewView.formId).find('a[id="'+fcid+'"]').parent().attr("class","sel")):-1!==pfcid&&-1!==fcid&&($(fieldListClone).find("#div"+pfcid).attr("class","active"),$(fieldListClone).find("#fcid"+pfcid).attr("class","tab-pane fade active in"),$(fieldListClone).find("#fcid"+pfcid).find('a[id="'+fcid+'"]').parent().attr("class","sel")),fieldListClone},fiedpopoverclback:function(ele,pfcid,fcid,isFromEditView){var obj,dispName="";if(isFromEditView){var fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""],dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),dispName=fcObj.formCompName+dispName,obj=$(ele),$(obj).val(dispName),$(obj).attr({fcid:fcid,pfcid:pfcid,iscrtfc:!0})}else{var text=$(ele).find("span").text(),id=$(ele).find("a").attr("id"),pfcid=$(ele).find("a").attr("pfcid");"-1"!=pfcid&&(dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),text+=dispName,obj=$(ele).closest('[id^="popover"]').parent().find("#fieldOpetions"),$(obj).val(text),$(obj).attr({fcid:id,pfcid:pfcid,iscrtfc:!0})}ZPNewView.fieldChange(obj)},addCriteria:function(obj){if(void 0===obj||ZPNewView.validCriteria()){var criteria=ZPNewView.constructCriteria(),curr_criteria_id=$(criteria).attr("id");ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").append(criteria),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#operatorSelection").select2({minimumResultsForSearch:1/0});var fieldComponentsCnt=ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").children().length;fieldComponentsCnt>3?ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").select2():ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").select2({minimumResultsForSearch:1/0});var conditionEntriesCnt=ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").children().length;return conditionEntriesCnt>3?ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2():ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2({minimumResultsForSearch:1/0}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[iscrtfc='true']").keydown(function(e){e.preventDefault()}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").attr("disabled",!0),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2(),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("disable"),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find('[isviewcrt="true"]').parent().on("shown.bs.dropdown",function(){var fcid=$(this).find('[iscrtfc="true"]').attr("fcid"),pfcid=$(this).find('[iscrtfc="true"]').attr("pfcid");-1!=fcid?($(this).find('ul[pfcid="'+pfcid+'"]').collapse("show"),$(this).find('[isviewcrt="true"]').scrollTop($(this).find('[isviewcrt="true"]').scrollTop()+$(this).find('ul[pfcid="'+pfcid+'"]').find('a[value="'+fcid+'"]').position().top)):$(this).find('ul[pfcid="-1"]').collapse("show")}),0!=$(obj).length&&ZPNewView.fieldOptionPopOverInit(curr_criteria_id),Layout.Page.container.find(".modal-body").scrollTop(Layout.Page.container.find(".PL30").height()),curr_criteria_id}},removeCriteria:function(obj){var tr=$(obj).parent().parent(),criteriaRowId=tr.attr("id"),firstRowID=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children()[0].id;if(tr.remove(),ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().length<=0){ZPNewView.criteriaCnt=0;var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.fieldOptionPopOverInit(curr_criteria_id)}else firstRowID===criteriaRowId&&$(ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children()[0]).find("#operatorSelection").parent().empty()},validCriteria:function(){var isValid=!0;return $.each(ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().find('[iscrtfc="true"]'),function(key,value){"-1"==$(value).attr("fcid")&&(isValid=!1,$(this).parent().find("#zp_criteria_field_error").html(ZPI18N.getString("zp.pleaseselectfieldname")).show())}),isValid},validCriteriaValue:function(fcType,tr,operator,crtValue,isFromLookUpFilter){if(!isFromLookUpFilter)var crtValue=$(tr).find("#txtValue").val();var key,isFromLookupFilterResult={},isValid=!0;switch(fcType){case ZPForm.Field.EMAIL_ADDRESS:(operator==ZPNewView.OPERATORS.EQUAL||operator==ZPNewView.OPERATORS.NOT_EQUAL)&&(isValid=ZPUtil.Validation.isEmail(crtValue,!0));break;case ZPForm.Field.NUMBER:isValid=ZPUtil.Validation.isNumber(crtValue),isValid||(key=ZPI18N.getString("zp.enteravalidnumber"));break;case ZPForm.Field.DATE:isValid=ZPUtil.Validation.isDate(crtValue),isValid||(key=ZPI18N.getString("zp.holiday.dateerror"));break;case ZPForm.Field.DECIMAL:case ZPForm.Field.CURRENCY:isValid=!1;var decimalDtl=ZPUtil.getDecimalLength(crtValue);"SUCCESS"===decimalDtl.message&&(isValid=!0),isValid||(key=ZPI18N.getString("zp.enteravalidnumber"))}return crtValue.length<=0&&(isValid=!1),isFromLookUpFilter?(isFromLookupFilterResult.isValid=isValid,isFromLookupFilterResult.key=key,isFromLookupFilterResult):(isValid?$(tr).find("#zp_criteria_error").hide():$(tr).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid)},addPickListComponent:function(criteriaRowId,addFlag){addFlag?ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#zp_crt_input_dropdown").show():ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#zp_crt_input_dropdown").hide()},onConditionChange:function(obj){var optval=$(obj).val(),tr=$(obj).parent().parent(),criteriaRowId=tr.attr("id"),inp=ZPNewView.LAYOUT.find("#"+criteriaRowId).find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;if(ZPNewView.LAYOUT.find("#"+criteriaRowId).find(".error-msg").hide(),Timetracker.views.isTimetrackerSpecialFields(fcObj.tName,fcObj.labelName))return ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val(""),void ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0);if(29==optval||30==optval||optval==ZPNewView.OPERATORS.YESTERDAY||optval==ZPNewView.OPERATORS.TODAY||optval==ZPNewView.OPERATORS.TOMORROW||optval==ZPNewView.OPERATORS.LAST_MONTH||optval==ZPNewView.OPERATORS.THIS_MONTH||optval==ZPNewView.OPERATORS.NEXT_MONTH||optval==ZPNewView.OPERATORS.LAST_YEAR||optval==ZPNewView.OPERATORS.CURRENT_YEAR||optval==ZPNewView.OPERATORS.NEXT_YEAR||optval==ZPNewView.OPERATORS.LOGIN_USERS_DEPT||optval==ZPNewView.OPERATORS.LOGIN_USER||optval==ZPNewView.OPERATORS.THIS_WEEK||optval==ZPNewView.OPERATORS.LAST_WEEK||optval==ZPNewView.OPERATORS.NEXT_WEEK||optval==ZPNewView.OPERATORS.TRUE||optval==ZPNewView.OPERATORS.FALSE){if(ZPNewView.addPickListComponent(criteriaRowId,!1),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val(""),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0),fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST){var values=ZPNewView.crtSelectedRecords[criteriaRowId];void 0!==values&&delete ZPNewView.crtSelectedRecords[criteriaRowId]}}else if(optval==ZPNewView.OPERATORS.NOT_IN||optval==ZPNewView.OPERATORS.IN){if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST){ZPNewView.addPickListComponent(criteriaRowId,!0);var values=ZPNewView.crtSelectedRecords[criteriaRowId];return void 0!==values?ZPNewView.displayCrtTxt(criteriaRowId):(delete ZPNewView.crtSelectedRecords[criteriaRowId],ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val("")),void ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0)}ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").removeAttr("disabled")}else(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST)&&ZPNewView.addPickListComponent(criteriaRowId,!1),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").removeAttr("disabled");if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST){var optVal=ZPNewView.LAYOUT.find("#"+criteriaRowId).find("[isopr='true']").val();optVal==ZPNewView.OPERATORS.NOT_IN||optVal==ZPNewView.OPERATORS.IN?ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").keydown(function(e){e.preventDefault()}):ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").unbind("keydown")}},toggleLookupComponent:function(obj){var upAndDwn=$(obj).parent().find("#upAndDwn");ZPNewView.toggleUpAndDownArrow(upAndDwn)},toggleUpAndDownArrow:function(obj){ZPNewView.mouseDownFlag=!0,$(obj).hasClass("IC-ar-dwn")?($(obj).removeClass("IC-ar-dwn"),$(obj).addClass("IC-ar-top"),$(obj).parent().parent().addClass("subclm"),$(obj).parent().parent().children().next().removeClass("DN")):($(obj).removeClass("IC-ar-top"),$(obj).addClass("IC-ar-dwn"),$(obj).parent().parent().removeClass("subclm"),$(obj).parent().parent().children().next().addClass("DN"))},toggleAscDesc:function(obj){ZPNewView.mouseDownFlag=!0;var value=$(obj).attr("value");value=value===ZPI18N.getString("zp.capitalasc")?ZPI18N.getString("zp.capitaldesc"):ZPI18N.getString("zp.capitalasc"),$(obj).attr("value",value),$(obj).html(value+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i>")},isExistInRightSide:function(idx){var isExist=!1,currRightChildrens=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();return $.each(currRightChildrens,function(key,value){var id=$(value).attr("id");return id===idx?void(isExist=!0):void 0}),isExist},componentSelect:function(event,side,obj,part){if("child"!==part){if(ZPNewView.childSelectFlag)return void(ZPNewView.childSelectFlag=!1);var idx=$(obj).attr("id");if("left"===side){var isExist=ZPNewView.isExistInRightSide(idx);isExist&&(ZPNewView.mouseDownFlag=!0)}return ZPNewView.mouseDownFlag?void(ZPNewView.mouseDownFlag=!1):void ZPNewView.toggleSelectClass(side,idx,obj)}},childComponentSelect:function(event,side,obj,part){if("parent"!==part){var idx=$(obj).attr("id");ZPNewView.childSelectFlag=!0,"left"===side?ZPNewView.leftSideSelected.hasOwnProperty(idx)?($(obj).find("div#childCompDiv").removeClass("sel"),delete ZPNewView.leftSideSelected[idx]):($(obj).find("div#childCompDiv").addClass("sel"),ZPNewView.leftSideSelected[idx]=$(obj)):ZPNewView.rightSideSelected.hasOwnProperty(idx)?($(obj).find("div#childCompDiv").removeClass("sel"),delete ZPNewView.rightSideSelected[idx]):($(obj).find("div#childCompDiv").addClass("sel"),ZPNewView.rightSideSelected[idx]=$(obj))}},toggleSelectClass:function(side,idx,obj){"left"===side?ZPNewView.leftSideSelected.hasOwnProperty(idx)?($(obj).find("div#parentCompDiv").removeClass("sel"),delete ZPNewView.leftSideSelected[idx]):($(obj).find("div#parentCompDiv").addClass("sel"),ZPNewView.leftSideSelected[idx]=$(obj)):ZPNewView.rightSideSelected.hasOwnProperty(idx)?($(obj).find("div#parentCompDiv").removeClass("sel"),delete ZPNewView.rightSideSelected[idx]):($(obj).find("div#parentCompDiv").addClass("sel"),ZPNewView.rightSideSelected[idx]=$(obj))},moveSelectedRowToRight:function(){Object.keys(ZPNewView.leftSideSelected).length<1||($.each(ZPNewView.leftSideSelected,function(key,value){var key=$(this).attr("id");ZPNewView.rightColumns[key]=this,delete ZPNewView.leftColumns[key]}),ZPNewView.constructRightColumns(ZPNewView.rightColumns),ZPNewView.LAYOUT.find("#zp_right_column_error").hide(),$.each(ZPNewView.leftSideSelected,function(key,value){var id=$(value).attr("id");void 0===ZPNewView.headerComponents[id+""]||id!==ZPNewView.headerComponents[id+""].formCompID?$(this).remove():$(this).find("div#parentCompDiv").removeClass("sel")}),ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.formatLeftComponents())},formatLeftComponents:function(){var currLeftChildrens=ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children();$.each(currLeftChildrens,function(key,value){var idx=$(value).attr("id");if(void 0!==ZPNewView.headerComponents[idx+""]&&idx===ZPNewView.headerComponents[idx+""].formCompID){var currChildComponentsLength=$(value).children().next().children().length;0>=currChildComponentsLength&&ZPNewView.isExistInRightSide(idx)&&($(this).remove(),delete ZPNewView.leftColumns[idx])}})},moveSelectedRowToLeft:function(){Object.keys(ZPNewView.rightSideSelected).length<1||($.each(ZPNewView.rightSideSelected,function(key,value){$(this).remove(),delete ZPNewView.rightColumns[key],delete ZPNewView.allCmpName[key]}),ZPNewView.rightSideSelected={},ZPNewView.leftSideSelected={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){(void 0===ZPNewView.headerComponents[key+""]||key!==ZPNewView.headerComponents[key+""].formCompID)&&ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents())},moveAllLeftToRight:function(){Object.keys(ZPNewView.leftColumns).length<1||($.each(ZPNewView.leftColumns,function(key,value){ZPNewView.rightColumns[key]=value}),ZPNewView.constructRightColumns(ZPNewView.rightColumns),ZPNewView.LAYOUT.find("#zp_right_column_error").hide(),ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){(void 0===ZPNewView.headerComponents[key+""]||key!==ZPNewView.headerComponents[key+""].formCompID)&&ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents())},moveAllRightToLeft:function(){Object.keys(ZPNewView.rightColumns).length<1||(ZPNewView.allCmpName={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children().remove(),ZPNewView.rightColumns={},ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={})},updateAction:function(){ZPNewView.saveAction(null,!0)},saveAction:function(modal,isUpdate){var isValid=!0,isFirstErrMsg=!0;ZPNewView.LAYOUT.find(".error-msg").hide();var customViewName=ZPNewView.LAYOUT.find("#zp_custom_view_name").val().trim();(""===customViewName||customViewName.length<=0)&&(ZPNewView.LAYOUT.find("#zp_custom_view_name_error").html(ZPI18N.getString("zp.viewempty")).show(),Layout.Page.container.find(".modal-body").scrollTop(0),isFirstErrMsg=!1,isValid=!1);var rightSideColumns=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();if(rightSideColumns.length<=0){if(ZPNewView.LAYOUT.find("#zp_right_column_error").html(ZPI18N.getString("zp.pleaseselectonecolumn",new Array(ZPNewView.FORM_NAME))).show(),isFirstErrMsg){var height=Layout.Page.container.find(".modal-body").find(".form-horizontal.pad").height();height+=Layout.Page.container.find(".modal-body").find(".row.MB20").height(),Layout.Page.container.find(".modal-body").scrollTop(height),isFirstErrMsg=!1}isValid=!1}var isDefault=ZPNewView.LAYOUT.find("#zp_custom_view_default").is(":checked"),onlyMe=ZPNewView.LAYOUT.find("#zp_custom_view_only_me").is(":checked"),allEmployee=ZPNewView.LAYOUT.find("#zp_custom_view_all_employees").is(":checked"),show_approver=(ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").is(":checked"),ZPNewView.LAYOUT.find("#zp_custom_view_approval").is(":checked")),shareToAll=null,specificView=null;onlyMe||(shareToAll=allEmployee,shareToAll||(specificView={},null!==ZPNewView.pickListComponent&&(specificView.employee=ZPPickList.getSelectedUsers().toString(),specificView.department=ZPPickList.getSelectedDepartments().toString(),specificView.role=ZPPickList.getSelectedRoles().toString(),specificView.location=ZPPickList.getSelectedLocations().toString())));var selectedColumnsJsonObj=[],withoutParentFC=!0;if($.each(rightSideColumns,function(key,value){var parentFC=$(value).attr("parentFCID");withoutParentFC&&"0"===parentFC&&(withoutParentFC=!1);var formCompID=$(value).attr("id"),cmpDisplayName=ZPNewView.allCmpName[formCompID].data("displayName"),refFormID=$(value).attr("refFormID"),grpStr=$(value).find("#grpBy").attr("value"),isGrp=null;void 0!==grpStr&&grpStr===ZPI18N.getString("zp.capitalgrp")&&(isGrp=!0);var ascStr=$(value).find("#asc_desc").attr("value"),asc=null;void 0!==ascStr&&ascStr.length>0&&(asc=!1,ascStr===ZPI18N.getString("zp.capitalasc")&&(asc=!0),null===isGrp&&(isGrp=!1));var sumEnabled=$(value).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum"),column={formCompID:formCompID,displayName:cmpDisplayName,refFormID:refFormID,grouping:isGrp,sorting:asc,sumEnabled:sumEnabled};selectedColumnsJsonObj.push(column)}),withoutParentFC){if(ZPNewView.LAYOUT.find("#zp_right_column_error").html(ZPI18N.getString("zp.pleaseselectonecolumn",new Array(ZPNewView.FORM_NAME))).show(),isFirstErrMsg){var height=Layout.Page.container.find(".modal-body").find(".form-horizontal.pad").height();height+=Layout.Page.container.find(".modal-body").find(".row.MB20").height(),Layout.Page.container.find(".modal-body").scrollTop(height),isFirstErrMsg=!1}isValid=!1}var isValidCrt=!0,criteriaList=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children(),crtJson=[];if($.each(criteriaList,function(key){var conjunctiveCondn,criteria=this;conjunctiveCondn=0===key?"AND":$(criteria).find("#operatorSelection").val();var formComponentID=$(criteria).find('[iscrtfc="true"]').attr("fcid"),pfcid=$(criteria).find('[iscrtfc="true"]').attr("pfcid"),operator=$(criteria).find("[isopr='true']").val();if("-1"!==formComponentID&&"-1"!==operator){var crtValue=$(criteria).find("#txtValue").val(),txtValueAttr=$(criteria).find("#txtValue").attr("disabled"),trObj=$(criteria).find("#txtValue").parent().parent(),fcObj=ZPNewView.allComponents[formComponentID+""];if(-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[formComponentID+""]),Timetracker.views.isTimetrackerSpecialFields(fcObj.tName,fcObj.labelName)){var valueJson=Timetracker.views.getValueForField(fcObj.labelName,operator);crtValue=valueJson.value,operator=valueJson.operator}var fcType=fcObj.fcType,formulaDType=fcObj.formulaDType;if(fcType==ZPForm.Field.SCRIPT&&void 0!=formulaDType&&-1!=formulaDType&&(fcType=formulaDType),operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.YESTERDAY&&operator!=ZPNewView.OPERATORS.TODAY&&operator!=ZPNewView.OPERATORS.TOMORROW&&operator!=ZPNewView.OPERATORS.LAST_YEAR&&operator!=ZPNewView.OPERATORS.CURRENT_YEAR&&operator!=ZPNewView.OPERATORS.NEXT_YEAR&&operator!=ZPNewView.OPERATORS.LAST_MONTH&&operator!=ZPNewView.OPERATORS.THIS_MONTH&&operator!=ZPNewView.OPERATORS.NEXT_MONTH&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_DEPT&&operator!=ZPNewView.OPERATORS.LOGIN_USER&&operator!=ZPNewView.OPERATORS.THIS_WEEK&&operator!=ZPNewView.OPERATORS.LAST_WEEK&&operator!=ZPNewView.OPERATORS.NEXT_WEEK&&operator!=ZPNewView.OPERATORS.TRUE&&operator!=ZPNewView.OPERATORS.FALSE&&0==crtValue.length&&($(criteria).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1),fcType==ZPForm.Field.DATE_TIME&&(operator==ZPNewView.OPERATORS.EQUAL||operator==ZPNewView.OPERATORS.NOT_EQUAL||operator==ZPNewView.OPERATORS.GREATER_THAN||operator==ZPNewView.OPERATORS.LESS_THAN)){var dateValueSplit=crtValue.split(" ");isValid=ZPUtil.Validation.isDate(dateValueSplit[0]),isValid||$(criteria).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show()}if(void 0!==txtValueAttr||ZPNewView.validCriteriaValue(fcType,criteria,operator)||($(criteria).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1),isValid&&fcObj.isEncrypted&&operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.EQUAL&&operator!=ZPNewView.OPERATORS.NOT_EQUAL&&($(criteria).find("#zp_criteria_error").html(ZPI18N.getString("zp.EncryptedCriteriaError")).show(),isValid=!1),isValid){var crt={formComponentID:formComponentID,Operator:operator,CrtVal:crtValue,conjunctiveCondn:conjunctiveCondn};if(-1!=pfcid?(crt.lookupFcId=formComponentID,crt.formComponentID=pfcid,crt.isBaseForm=!1,fcType==ZPForm.Field.LOOKUP&&(crt.lookupFcId2=fcObj.lkpFcid)):fcType==ZPForm.Field.LOOKUP&&(crt.lookupFcId=fcObj.lkpFcid,crt.isBaseForm=!0),!(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST||operator!=ZPNewView.OPERATORS.NOT_IN&&operator!=ZPNewView.OPERATORS.IN)){var crtValArray=[],crtID=$(trObj).attr("id"),selectedRecords=ZPNewView.crtSelectedRecords[crtID],selectionRecords=ZPNewView.crtSelectionRecords[formComponentID];void 0==selectedRecords||void 0==selectionRecords||selectedRecords.length<=0?($(criteria).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1):($.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.ID+""&&crtValArray.push(v.VALUE)})}),crt.dispVal=crtValArray.toString(),crt.CrtVal=selectedRecords)}crtJson.push(crt)}else isValidCrt=!1}}),isFirstErrMsg&&!isValidCrt){var bodyHeight=Layout.Page.container.find(".modal-body").find(".PL30.PR30").height();Layout.Page.container.find(".modal-body").scrollTop(bodyHeight+100),isFirstErrMsg=!1}if(isValid){var formID=ZPView.CURR_VIEWPARAMS.formId,tabID="P_Task"===ZPForm.getTableName()?$("#zp_maintab_task").attr("tabid"):$("#zp_hometabs").find('[class="dropdown active"]').attr("tabid"),url="/createViewAction.zp",params={mode:void 0!==isUpdate&&isUpdate?"updateView":"saveView",formID:formID,viewID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.viewID:0,tabID:tabID,expressionID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.expressionID:0,reportPermissionID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.reportPermissionID:0,viewName:customViewName,isDefaultView:isDefault,show_approver:show_approver,crtJson:JSON.stringify(crtJson),components:JSON.stringify(selectedColumnsJsonObj),shareViewToAll:shareToAll,specificView:JSON.stringify(specificView)};Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").attr("disabled",!0),ZPeople.Request.send(url,params,ZPNewView.afterSaveAction)}},afterSaveAction:function(data){if(Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").removeAttr("disabled"),void 0!==data.error)return void ZPNewView.showErrorMessage(data,"zp.addmodifyerror");if(!data.viewDetails.isSuccess&&!data.viewDetails.isValidCriteria)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidentries"));ZPNewView.LASTVIEWID=data.viewDetails.viewId;var mdata=ZPeople.Module.getData(),viewDetails=mdata.viewDetails.message;if("true"===data.viewDetails.isDefaultView&&$.each(viewDetails,function(key,value){this.isDefaultView=!1}),"ADD"===data.action){var newObj={displayName:data.viewDetails.displayName,isDefaultView:"true"===data.viewDetails.isDefaultView?!0:!1,viewId:data.viewDetails.viewId,viewName:data.viewName,isCustomView:"true"===data.viewDetails.isCustomView?!0:!1,isSharedView:"true"===data.viewDetails.isSharedView?!0:!1,ownerId:data.viewDetails.ownerId};mdata.viewDetails.message.push(newObj)}else{var oldViewObj=ZPNewView.getViewDetailByID(data.viewDetails.viewId);if(void 0!==oldViewObj){var index=mdata.viewDetails.message.indexOf(oldViewObj);mdata.viewDetails.message.splice(index,1),oldViewObj.displayName=data.viewDetails.displayName,"true"===data.viewDetails.isDefaultView?oldViewObj.isDefaultView=!0:oldViewObj.isDefaultView=!1,"true"===data.viewDetails.isCustomView?oldViewObj.isCustomView=!0:oldViewObj.isCustomView=!1,"true"===data.viewDetails.isSharedView?oldViewObj.isSharedView=!0:oldViewObj.isSharedView=!1,mdata.viewDetails.message.push(oldViewObj)}}mdata.viewDetails.loaded=!1,ZPView.constructViews();var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option");extOptions.length>3?Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(extOptions).select2().select2("val",[ZPNewView.LASTVIEWID]):Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(extOptions).select2({minimumResultsForSearch:1/0}).select2("val",[ZPNewView.LASTVIEWID]),Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").change(),ZPeople.BSModal.hide()},afterDeleteAction:function(data){if(void 0!==data.error)return void ZPNewView.showErrorMessage(data,"zp.errordeleteview");ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.viewdeletedsuccess")),ZPNewView.LASTVIEWID=data.defaultViewID,Layout.UrlConf.isModuleForm()&&(ZPNewView.LASTVIEWID="systemview");for(var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option"),newOptions="",i=0;i<extOptions.length;i++)extOptions[i].value!==data.deletedViewID&&(newOptions+='<option value="'+extOptions[i].value+'">'+extOptions[i].text+"</option>");var oldViewObj=ZPNewView.getViewDetailByID(data.deletedViewID);if(void 0!==oldViewObj){var mdata=ZPeople.Module.getData(),index=mdata.viewDetails.message.indexOf(oldViewObj);mdata.viewDetails.message.splice(index,1)}var currSize=extOptions.length-1;currSize>3?Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(newOptions).select2().select2("val",[ZPNewView.LASTVIEWID]):Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(newOptions).select2({minimumResultsForSearch:1/0}).select2("val",[ZPNewView.LASTVIEWID]),Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").change(),window.location.href=ZPView.getURL(ZPNewView.LASTVIEWID)},sharedTo:function(){var selectedUsers=ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").is(":checked"),shareToDiv=ZPNewView.LAYOUT.find("#zp_custom_view_sharedto");if(selectedUsers){if(shareToDiv.removeClass("DN"),null===ZPNewView.pickListComponent){var sharedTempTxt=$(ZPPickList.picklistComponentTemplate);ZPNewView.LAYOUT.find("#applicableToComponent").html(sharedTempTxt);var keys=[];keys.push(ZPPickList.CONSTANTS.USERS),keys.push(ZPPickList.CONSTANTS.DEPARTMENTS),keys.push(ZPPickList.CONSTANTS.ROLES),keys.push(ZPPickList.CONSTANTS.LOCATIONS),ZPNewView.pickListComponent=ZPPickList.init(keys)}ZPNewView.LAYOUT.find("#applicableToComponent").html(ZPNewView.pickListComponent),ZPNewView.LAYOUT.find("#applicableToComponent").find("#pickListComp").find(".dropdown-menu").addClass("ZPSchPoP")}else shareToDiv.addClass("DN")},loadCrtRequiredRecords:function(fcID,fcType){void 0===ZPNewView.crtSelectionRecords[fcID]&&void 0!==fcID&&$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:fcID,fcType:fcType},success:function(data){ZPNewView.crtSelectionRecords[fcID]=data.lookupDetailsList}})},constructCrtSelectionRecord:function(crtID,selectionRecord,fcType,fcId){if(jQuery.isEmptyObject(selectionRecord)||selectionRecord.length<=0)return void ZPNewView.LAYOUT.find("#"+crtID+" #ulList").html(ZPI18N.getString("zp.norec"));var li="";$.each(selectionRecord,function(key,value){li+="<li id='"+value.ID+"'><div class='MT3'><label class='checkbox DIB PT8 MR10'><input id='"+value.ID+"' type='checkbox' onclick='ZPNewView.crtSelectRecord(this)'><span class='ML2'>"+value.DISPVALUE+"</span></label></div></li>"}),ZPNewView.LAYOUT.find("#"+crtID+" #ulList").html(li)},crtAllCheckSelect:function(obj){var isAllChecked=$(obj).is(":checked"),childList=$(obj).parent().parent().parent().find("#ulList").children(),childLength=childList.length;isAllChecked?childLength>0?($.each(childList,function(key,value){$(this).find("input")[0].checked=!0,ZPNewView.crtSelectRecord($(this).find("input"))}),$(obj)[0].checked=!0):$(obj).removeAttr("checked"):childLength>0&&$.each(childList,function(key,value){$(this).find('.checkbox input[type="checkbox"]').removeAttr("checked"),ZPNewView.crtSelectRecord($(this).find("input"))})},crtSelectRecord:function(obj){var isChecked=$(obj).is(":checked"),tr=$(obj).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent(),inp=tr.find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType,isAllChecked=$(tr).find("#crtAllCheck").is(":checked");if(isAllChecked)$(tr).find("#crtAllCheck").removeAttr("checked");else{var childList=$(tr).find("#ulList").children(),totalChildLength=childList.length,checkedListLength=childList.find(".checkbox input[type='checkbox']:checked").length;totalChildLength===checkedListLength&&($(tr).find("#crtAllCheck")[0].checked=!0)}var crtID=$(tr).attr("id"),selectedRecords=ZPNewView.crtSelectedRecords[crtID];void 0===selectedRecords&&(selectedRecords=[]);var id=$(obj).attr("id"),index=selectedRecords.indexOf(id);isChecked?-1===index&&selectedRecords.push(id):-1!==index&&selectedRecords.splice(index,1),ZPNewView.crtSelectedRecords[crtID]=selectedRecords,ZPNewView.displayCrtTxt(crtID,fcType)},displayCrtTxt:function(crtID,fcType){ZPNewView.LAYOUT.find("#"+crtID).find("#crtValueTD #txtValue").val(void 0);var fcID=ZPNewView.LAYOUT.find("#"+crtID).find('[iscrtfc="true"]').attr("fcid"),nameArr=ZPNewView.getRecordNamesByFcID(crtID,fcID,fcType);ZPNewView.LAYOUT.find("#"+crtID).find("#crtValueTD #txtValue").val(nameArr.toString())},getRecordNamesByFcID:function(crtID,fcID,fcType){if(void 0===fcID)return null;var selectedRecords=ZPNewView.crtSelectedRecords[crtID],selectionRecords=ZPNewView.crtSelectionRecords[fcID],tempList=[];return void 0===selectedRecords||void 0===selectionRecords?tempList:($.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.ID+""&&tempList.push(ZPeople.decodeTxt(v.DISPVALUE))})}),tempList)},makeSelectable:function(crtID,selectedRecord){ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").removeAttr("checked");var fcID=ZPNewView.LAYOUT.find("#"+crtID).find('[iscrtfc="true"]').attr("fcid"),childList=ZPNewView.LAYOUT.find("#"+crtID).find("#ulList").children(),originalTotalLength=ZPNewView.crtSelectionRecords[fcID].length;if(!(0>=originalTotalLength)){selectedRecord.length===originalTotalLength&&(ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck")[0].checked=!0),$.each(selectedRecord,function(key,value){var row=$(childList).find("input#"+value);void 0!==row&&row.length>0&&(row[0].checked=!0)});var checkBoxSelectedCount=ZPNewView.LAYOUT.find("#"+crtID).find("#ulList").children("li").find("input[type='checkbox']:checked").length,currChildlength=$(childList).length;0===checkBoxSelectedCount&&0===currChildlength?ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").removeAttr("checked"):checkBoxSelectedCount===currChildlength?ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck")[0].checked=!0:ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").removeAttr("checked")}},getViewDetailByID:function(viewID){var viewDetailObj=void 0;return $.each(ZPeople.Module.getData().viewDetails.message,function(key,value){return value.viewId===viewID?void(viewDetailObj=value):void 0}),viewDetailObj},showErrorMessage:function(data,msg){void 0!==data.error&&(void 0!==data.error.message?ZPeople.Message.showFailureMsg(data.error.message):void 0!==data.error.exception&&ZPeople.Message.showFailureMsg(ZPI18N.getString(msg)))},getParentCompNameByID:function(parentFCID){var name=void 0;return void 0!==parentFCID&&"0"!==parentFCID&&(name=ZPNewView.headerComponents[parentFCID+""].formCompName),name},getOriginalName:function(fcID){var name=void 0;if(void 0!==fcID)if(-1!==fcID.indexOf("_")){var ids=fcID.split("_"),childComps=ZPNewView.allComponents[ids[0]].childComponents;name=childComps[ids[1]].formCompName}else name=ZPNewView.allComponents[fcID].formCompName;return name},isEqual:function(obj1,obj2){return obj1===obj2?!0:!1}},Task={OPEN_SYSVALUE:1,COMPLETED_SYSVALUE:2,UNASSIGNED_SYSVALUE:-1,ALLSTATUS_SYSVALUE:0,HIGH_SYSVALUE:1,MODERATE_SYSVALUE:2,LOW_SYSVALUE:3,RELATETASKTEMPLATE:$('<li><div id="taskContainer"><i class="IC-task-unchk" id="rt_completebutton"></i><i id="unassignedicon" data-toggle="tooltip" data-placement="top" data-original-title='+ZPI18N.getString("zp.pick")+' onclick="ZPeople.confirm(this,\'\',\'zp.taskpickmessage\', Task.pickupTask)"></i><div class="ZP_photo" data-toggle="tooltip" data-placement="top" data-original-title="" id="rt_taskownerpic"><img></div><div class="zp_txtbx"><div id="rt_taskname"></div></div><div class="zp_txtbx"><input id="rt_duedate" type="textbox"><i id="rt_delete" class="IC-delete"></i></div></div></li>'),getHelpKey:"",initiateUsers:function(){var pageId=$("#"+Layout.Page.pageId),searchJson={id:"employeeCombo",inpFormat:"select",placeHolder:ZPI18N.getString("zp.allusers"),searchMode:"TASKS_VIEW",type:1,limit:10,searchType:"emp"};pageId.find("#empPhoto").attr("src",ZPeople.CURR_USER.avatar),Task.viewPerm!=zpconst.Permission.SUB_DATA&&(searchJson.initialSelection=Task.initialUser()),searchJson.defaultOption=Task.getAllUserOption(),ZPComponents.Search.reset(searchJson,!0),ZPComponents.Search.create(searchJson)},initialUser:function(){var initialUser={},userDtls=ZPeople.getUserDetailsById(erecno);return initialUser.text=ZPeople.decodeTxt(userDtls.empid+" "+userDtls.name),initialUser.html=userDtls.empid+" "+userDtls.name,initialUser.id=erecno,initialUser.photo=userDtls.thumb,initialUser},getAllUserOption:function(){var allUserObj={};return allUserObj.text=allUserObj.html=ZPI18N.getString("zp.allusers"),allUserObj.id="0",allUserObj.photo="people/images/user.png",allUserObj},addTask:function(formId){var formlinkname=ZPUtil.Form_Link_Names.getFormLinkName(formId,!0),formnameString="-formLinkName:";void 0==formlinkname&&(formnameString="-formId:",formlinkname=formId),window.location.href="#task/mytasks/addtask"+formnameString+formlinkname},initiateChecklistPage:function(){var pageId=$("#"+Layout.Page.pageId),searchJson={id:"checklistReqEmployeeCombo",inpFormat:"select",placeHolder:ZPI18N.getString("zp.select"),searchMode:"TASKS",type:1,limit:10,searchType:"emp"};searchJson.initialSelection=Task.initialUser(),pageId.find("#empPhoto").attr("src",ZPeople.CURR_USER.avatar),ZPComponents.Search.reset(searchJson,!0),ZPComponents.Search.create(searchJson),pageId.find("#empSearch").removeClass("DN")},initiateListing:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());if(isadmin||isAdminProfile||Task.viewPerm==zpconst.Permission.ALL_DATA||Task.viewPerm==zpconst.Permission.TEAM_DATA||Task.viewPerm==zpconst.Permission.MY_DATA)AutomationCommon.constructInitialEmpCombo("employeeCombo");else if(Task.viewPerm==zpconst.Permission.NO_DATA)return pageId.find(".mainhead").remove(),pageId.find("#taskStatusFooter").remove(),pageId.find("#taskpreview").html("").append('<div class="ZPNdata"><div id="notaskfound"></div><p class="no-para">'+ZPI18N.getString("zp.permissiondeniedtoaccessthispage")+"</p></div>"),void ZPUtil.noDataSVG("notaskfound","newzp/images/svg/no-permission.svg");Task.viewPerm==zpconst.Permission.SUB_DATA&&(pageId.find("#unassigned_count").remove(),pageId.find("#empPhoto").addClass("DN"),pageId.find("#taskStatusCombo").find("[sysvalue=-1]").remove()),isadmin||Task.addPerm!=zpconst.Permission.NO_DATA||pageId.find("#zp_record_add_btn").remove(),Task.initiateUsers(),Task.createTaskFilters(),ZPChecklist.regFilterClickEvent(),AutomationCommon.constructFormListCombo(TASK_MODE,"taskCombo","","listView")},createNewTask:function(related_formid,related_recordid){Task.getTaskFormid();var params={formId:Task.taskformid,formMode:"ADD",viewRefresh:!0,callback:Task.closePreview,disableUrlTrack:!1};void 0!=related_formid&&void 0!=related_recordid&&(params.related_recordid=related_recordid,params.related_formid=related_formid),ZPForm.load(params)},addQuickTask:function(status){var params={},pageId=$("#"+Layout.Page.pageId);if(params.zp_formId=ZPForm.CURRFORM_PARAM.formId,params.zp_recordId=ZPForm.CURRFORM_PARAM.recordId,params.conreqcsr=csrfToken,params.taskname=pageId.find("#quicktaskname").val(),params.dueDate=pageId.find("#quicktaskdue").val(),params.taskowner=pageId.find("#tUser").attr("ownervalueid"),params.method="addQuickTask",""===params.taskname)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.tasknameerromsg"));void 0!==status&&(Task.getStatusOptionValuesBySysVal(),params.status=ZPeople.decodeTxt(Task.statusBySysVal[status].VALUE));var newtaskrow=pageId.find("#newquicktask").after(Task.RELATETASKTEMPLATE.clone()).next();newtaskrow.find("#rt_taskname").text(params.taskname),""===params.dueDate?(newtaskrow.find("#rt_duedate").val(ZPI18N.getString("zp.today")),params.dueDate=Calendar.getCurrentDate(!0)):newtaskrow.find("#rt_duedate").val(params.dueDate),pageId.find("#quicktaskname").val(""),pageId.find("#quicktaskdue").val(""),$.post("/addQuickTask.zp",params,function(data){return"{}"!==data.errors?(ZPeople.Message.showFailureMsg(data.errors),void newtaskrow.remove()):(newtaskrow.attr("id","rt_"+data.taskid),newtaskrow.attr("taskid",data.taskid),newtaskrow.attr("onclick",ZPeople.isZPNewUI()?'Task.showTaskDetails("'+data.taskid+'", true, "'+params.zp_formId+'", "'+params.zp_recordId+'")':"ZPView.Record.getFormPage('VIEW', \""+data.taskid+'", this)'),newtaskrow.find("#rt_delete").attr("onclick",'Task.deleteTaskConfirmation("'+data.taskid+'")'),newtaskrow.find("#rt_completebutton").attr("onclick","Task.changeTaskStatus(this)"),newtaskrow.find("#rt_taskownerpic").remove(),newtaskrow.find("#rt_completebutton").after(pageId.find("#newquicktask").find("#tUser").clone()),Task.getTaskFormid(),void 0!==status&&newtaskrow.find("#taskContainer").addClass("zp_cmpl"),newtaskrow.find("#rt_completebutton").click(function(event){event.stopPropagation()}),void newtaskrow.find("#rt_delete").click(function(event){event.stopPropagation()}))})},getTaskFormid:function(){if(void 0===Task.taskformid){var param={method:"getTaskFormid",conreqcsr:csrfToken};$.ajax({url:"/taskformid.zp",type:"POST",data:param,async:!1,success:function(data){Task.taskformid=data.taskformid}})}},getPriorityOptionValuesBySysVal:function(){if(void 0===Task.priorityBySysVal){Task.priorityBySysVal={};for(i in Task.priorityArray)Task.priorityBySysVal[Task.priorityArray[i].SYSVALUE]=Task.priorityArray[i]}},getStatusOptionValuesBySysVal:function(){if(void 0===Task.statusBySysVal){Task.statusBySysVal={};for(i in Task.statusArray)Task.statusBySysVal[Task.statusArray[i].SYSVALUE]=Task.statusArray[i]}return Task.statusBySysVal},populateTask:function(){var daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},calObj=new NewCalendar.calObj;calObj.curYear=(new Date).getFullYear(),calObj.curMonth=(new Date).getMonth(),calObj.calcontId="monthcalendardiv",calObj.outerdivId=Layout.Page.pageId,calObj.daysObj=daysObj,calObj.callback=Leave.View.Calendar.get,calObj.divid="caldiv",calObj.mode="leave",calObj.tdonclick=null,calObj.totaldata=!1,calObj.prearrow="IC-ar-lft",calObj.nextarrow="IC-ar-rgt",Leave.Util.reg(),Leave.View.Calendar.calObj=calObj,NewCalendar.initCalendar(calObj)},initiateCalendarView:function(){Task.populateTask()},initiateTaskListPage:function(){var url=Layout.Page.hash;if(Task.initiateUsers(),-1!==url.indexOf("mytasks/addtask"))Task.createNewTask();else if(-1!==url.indexOf("mytasks/edittask"))Task.editRec(Task.taskformid,Layout.Page.childUrlParam.taskid);else if(-1!==url.indexOf("mytasks/viewtask"))Task.showTaskDetails(Layout.Page.childUrlParam.taskid);else if(-1!==url.indexOf("task/mytasks")){var totalTasks=$("#count_total").text(),openTasks=$("#count_open").text();Task.getTaskCount(),void 0!=Task.isPreviewClosed&&Task.isPreviewClosed&&(Task.isPreviewClosed=!1,(totalTasks!=$("#count_total").text()||openTasks!=$("#count_open").text())&&Task.getTasks("reset"))}},viewTaskDetails:function(taskid){window.location.href="#task/mytasks/viewtask-taskid:"+taskid},redirectEditUrl:function(obj){var pageId=Layout.Page.pageId,formId=ZPForm.CURRFORM_PARAM.formId,recordId=ZPForm.CURRFORM_PARAM.recordId;if(ZPForm.isrelfieldsingelrecview)Layout.Page.container.find("#zp_relfielsingle_record_"+ZPForm.CURRFORM_PARAM.formId).modal("hide"),ZPForm.load({formId:ZPForm.CURRFORM_PARAM.formId,formMode:"EDIT",isfromrelfieldedit:!0,recordId:ZPForm.CURRFORM_PARAM.recordId});else if(-1!==Layout.Page.hash.indexOf("admin/employeerecords/user")||$(obj).attr("isFromChecklist"))ZPForm.load({formId:ZPForm.CURRFORM_PARAM.formId,formMode:"EDIT",recordId:ZPForm.CURRFORM_PARAM.recordId,disableUrlTrack:!0,tableName:"P_Task"});else if(-1!==pageId.indexOf("task-list")){var formlinkname=ZPUtil.Form_Link_Names.getFormLinkName(formId,!0),formnameString="-formLinkName:";void 0==formlinkname&&(formnameString="-formId:",formlinkname=formId),window.location.href="#task/list/edit"+formnameString+formlinkname+"/recordId:"+recordId}else window.location.href="#task/mytasks/edittask-taskid:"+recordId},getRelatedRecordParams:function(params){void 0!==ZPForm.CURRFORM_PARAM.related_formid&&void 0!==ZPForm.CURRFORM_PARAM.related_recordid&&(params.related_formid=ZPForm.CURRFORM_PARAM.related_formid,params.related_recordid=ZPForm.CURRFORM_PARAM.related_recordid)},createTaskFilters:function(){var pageId=$("#"+Layout.Page.pageId),options=Task.getOptionValues();Task.constructComboBox("taskStatusCombo",options.Status),Task.constructComboBox("taskPriorityCombo",options.Priority),pageId.find("#taskStatusCombo").select2(),pageId.find("#taskPriorityCombo").select2(),pageId.find("#taskStatusCombo").find("[sysvalue=1]").prop("selected",!0).change()},getOptionValues:function(){var options={};if(void 0===Task.statusArray||void 0===Task.priorityArray){var params={method:"getTaskOptionValues",conreqcsr:csrfToken,mode:"list"};$.ajax({url:"/getOptionValues.zp",type:"POST",data:params,async:!1,success:function(data){Task.statusArray=data.Status,Task.priorityArray=data.Priority,Task.statusObj=Task.getOptionValueByName(Task.statusArray),Task.priorityObj=Task.getOptionValueByName(Task.priorityArray)}})}return options.Status=Task.statusArray,options.Priority=Task.priorityArray,options},getOptionValueByName:function(optionArr){var optionObj={};for(i in optionArr)optionObj[optionArr[i].VALUE]=optionArr[i];return optionObj},constructComboBox:function(id,list){var selectObj=$("#"+Layout.Page.pageId).find("#"+id);selectObj.html(""),"taskStatusCombo"==id?(selectObj.append(jQuery("<option />",{value:"",sysvalue:Task.ALLSTATUS_SYSVALUE}).text(ZPI18N.getString("zp.allstatus"))),selectObj.append(jQuery("<option />",{value:"-1",sysvalue:Task.UNASSIGNED_SYSVALUE}).text(ZPI18N.getString("zp.unassigned")))):"taskPriorityCombo"==id&&selectObj.append(jQuery("<option />",{value:""}).text(ZPI18N.getString("zp.allpriority")));for(i in list)selectObj.append(jQuery("<option />",{value:list[i].ID,sysvalue:list[i].SYSVALUE,label:list[i].VALUE}).text(ZPeople.decodeTxt(list[i].DISPVALUE)))},getTasks:function(mode){var pageId=$("#"+Layout.Page.pageId),taskobj={};if(ZPChecklist.isValideTaskFilter()){if(void 0!=mode&&"reset"==mode){if(pageId.find("#taskpreview").children().hide(),pageId.find("#taskCustomisedList").children().remove(),pageId.find("#taskpreview").append(ZPeople.LOADING_HTML),pageId.find("#taskStatusCombo").find("[sysvalue=2]").val()===pageId.find("#taskStatusCombo").val()?pageId.find("#taskCustomisedList").addClass("zp_cpl"):pageId.find("#taskCustomisedList").removeClass("zp_cpl"),pageId.find("#dvFiltersec").is(":visible")&&(taskobj.name=pageId.find("#taskSearchString").val(),taskobj.formid=0==pageId.find("#taskCombo").val()?"":pageId.find("#taskCombo").val(),taskobj.sDate=pageId.find("#datePicker").val(),taskobj.sDate==CUSTOM_DATE)){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);taskobj.sDate=dates.from,taskobj.eDate=dates.to}taskobj.status=pageId.find("#taskStatusCombo").val(),taskobj.empIds=0==pageId.find("#employeeCombo").val()?"":pageId.find("#employeeCombo").val(),taskobj.priority=pageId.find("#taskPriorityCombo").val(),Task.getTaskCrt=taskobj}Task.getTaskCrt.index=pageId.find("#taskCustomisedList").children().length+1,$.post("/gettasks.zp",{conreqcsr:csrfToken,method:"getTasks",criteria:JSON.stringify(Task.getTaskCrt)},function(data){"reset"===mode&&(pageId.find("#taskpreview").children().show(),pageId.find("#zp_page_loading").remove()),Task.cloneTaskRow(data.tasks,"taskCustomisedList"),data.hasNextPage&&ZPeople.FireScroll.reset()})}},deleteTaskConfirmation:function(taskid){ZPeople.BSModal.confirm(Task.deleteTask),Task.deleteTaskId=taskid},deleteTask:function(taskid){var params={mode:"deleteRecords",recordIds:Task.deleteTaskId,formId:Task.taskformid},callback=ZPeople.isZPNewUI()?ZPTasks.removeTaskRow:Task.removeTaskRow;ZPeople.Request.send(ZPForm.URL,params,callback)},removeTaskRow:function(result,params){var pageId=$("#"+Layout.Page.pageId);if(7e3===result.code){Layout.Page.hash;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskdeletedsuccessfully")),-1!==Layout.Page.hash.indexOf("task/mytasks")&&void 0===ZPForm.CURRFORM_PARAM.formId?(Task.getTaskCount(),pageId.find(".zpl[taskid="+params.recordIds+"]").remove()):pageId.find("[id=rt_"+params.recordIds+"]").remove()}else ZPeople.Message.showFailureMsg(result.message)},cloneTaskRow:function(taskArr,bodyToAppend){var currentRow="",pageId=$("#"+Layout.Page.pageId);pageId.find("#tasklisthead").removeClass("zp_dyn"),0==taskArr.length?0==$("#"+bodyToAppend).children().length&&(pageId.find("#taskCustomisedList").html("").append('<div class="ZPNdata"><div id="notaskfound"></div><p class="no-para">'+ZPI18N.getString("zp.notaskforfilter")+"</p></div>"),ZPUtil.noDataSVG("notaskfound","newzp/images/svg/no-records.svg"),pageId.find("#tasklisthead").addClass("zp_dyn")):$.each(taskArr,function(index,row){currentRow=$("#taskrow").cloneRow("#"+bodyToAppend),currentRow.removeClass("zp_dyn"),currentRow.find(".zp_ctit").parents(".zpDtl").attr("onclick",'Task.viewTaskDetails("'+row.id+'")'),currentRow.find(".zp_ctit").find("b").html(row.name),row.isDeletable?currentRow.find(".zpricn").attr("onclick",'Task.deleteTaskConfirmation("'+row.id+'")'):currentRow.find(".IC-delete").remove(),void 0!=row.recordowner&&(void 0!=row.recordowner.employeePhoto?(currentRow.find("#recordDetails").find("#recordownername").text(ZPeople.decodeTxt(row.recordowner.name)+" "+row.recordowner.employeeID),currentRow.find(".ZP_photo").find("img").attr("src",row.recordowner.employeePhoto),currentRow.find("#recordownername, .ZP_photo").attr("onclick",'ZPACommon.viewRecord("'+ZPeople.EMP_FORMID+'","'+row.recordowner.erecno+'")'),currentRow.find("#recordownername, .ZP_photo").click(function(event){event.stopPropagation()})):currentRow.find(".ZP_photo").find("img").attr("alt",Task.getShortName(row.recordowner.name))),void 0!=row.formname?(currentRow.find("#recordDetails").find("#formname").html(row.formname),currentRow.find("#recordDetails").attr("onclick",'ZPACommon.viewRecord("'+row.formid+'","'+row.recordid+'","'+row.formtablename+'")'),currentRow.find("#recordDetails").click(function(event){event.stopPropagation()})):currentRow.find("#recordDetails").hide(),currentRow.attr("taskid",row.id),currentRow.attr("taskformid",row.taskformid),void 0==row.endtime?currentRow.find("#duedate").text(ZPI18N.getString("zp.noduedate")):currentRow.find("#duedate").text(row.endtime),currentRow.find("#taskowner").text(ZPeople.decodeTxt(row.assignedto)),row.taskowner==pageId.find("#employeeCombo").val()&&currentRow.find("#taskowner").hide(),isadmin||row.unassigned||ZPForm.Permission.isAllowed([row.taskowner],Task.editPerm)||currentRow.find("#closeButton").remove(),void 0!=row.priority&&(1===Task.priorityObj[row.priority].SYSVALUE?currentRow.find(".IC-task-unchk").addClass("zp_rclr"):3===Task.priorityObj[row.priority].SYSVALUE&&currentRow.find(".IC-task-unchk").addClass("zp_oclr")),row.iscompleted?(currentRow.addClass("zp_cmpl"),currentRow.find("#duedate").text(row.dispCompletedTime)):void 0!=row.unassigned&&row.unassigned?(currentRow.find("#pickup").removeClass("zp_dyn"),currentRow.find(".zp_link").click(function(event){event.stopPropagation()}),isadmin&&currentRow.find("#assignedto").removeClass("zp_dyn")):row.isoverdue&&currentRow.find("#duedate").addClass("zp_rclr")})},selectRow:function(obj){var pageId=$("#"+Layout.Page.pageId),rootRow=$(obj).parents("div.zpl");rootRow.hasClass("sel")?rootRow.removeClass("sel zp_check"):rootRow.addClass("sel zp_check"),0!=pageId.find(".sel").length?pageId.find("#bulkComplete").removeClass("DN"):pageId.find("#bulkComplete").addClass("DN")},changeEmpCombo:function(){var pageId=$("#"+Layout.Page.pageId);pageId.find("#empPhoto").removeClass("DN"),pageId.find("#empPhoto").attr("src",pageId.find(".select2-choice").data().select2Data.photo),-1===Layout.Page.hash.indexOf("task/mychecklist")?Task.getEmpTasks():ZPChecklist.resetChecklistReqPage()},getEmpTasks:function(){var pageId=$("#"+Layout.Page.pageId);pageId.find("#employeeCombo").val()==erecno?(pageId.find("#taskStatusCombo").find("[value=-1]").removeClass("zp_dyn"),pageId.find("#unassigned_count").removeClass("zp_dyn")):(pageId.find("#unassigned_count").addClass("zp_dyn"),"-1"==pageId.find("#taskStatusCombo").val()&&pageId.find("#taskStatusCombo").find("[sysvalue=1]").prop("selected",!0).change(),pageId.find("#taskStatusCombo").find("[value=-1]").addClass("zp_dyn")),Task.getTasks("reset"),Task.getTaskCount()},getTaskCount:function(){if(isadmin||Task.viewPerm!=zpconst.Permission.NO_DATA){var pageId=$("#"+Layout.Page.pageId),erecno=pageId.find("#employeeCombo").val(),params={erecno:erecno,method:"getTaskCount",conreqcsr:csrfToken};$.ajax({url:"/gettaskcount.zp",type:"POST",async:!1,data:params,success:function(data){pageId.find("#count_total").text(data.total),pageId.find("#count_open").text(data.open),pageId.find("#count_completed").text(data.completed),pageId.find("#count_unassigned").text(data.unassigned)}})}},getTaskPermission:function(){if(void 0===Task.viewPerm)if(isadmin)Task.viewPerm=zpconst.Permission.ALL_DATA,Task.editPerm=zpconst.Permission.ALL_DATA,Task.addPerm=zpconst.Permission.ALL_DATA;else{var params={method:"getTaskPermission",conreqcsr:csrfToken};$.ajax({url:"/taskPermission.zp",type:"POST",async:!1,data:params,success:function(perm){Task.viewPerm=perm.viewPermission,Task.editPerm=perm.editPermission,Task.addPerm=perm.createPermission}})}},saveComment:function(getThis){var textArea=$(getThis).parent().parent().find("textarea"),taskid=ZPForm.CURRFORM_PARAM.recordId,comment=textArea.val(),params={taskid:taskid,comment:comment,method:"addTaskComment",conreqcsr:csrfToken};""!=comment&&(ZPChecklist.newComment(comment),textArea.val(""),$.post("/addTaskComment.zp",params,function(data){}),Task.resetTaskId=taskid)},loadComment:function(comments){var pageId=$("#"+Layout.Page.pageId).find("#"+ZPForm.LAYOUT.data().curpageid).find("[id=zp_form_outer_container]").find("#commentContainer");pageId.find("#commentHead").siblings().remove();var comment="";$.each(comments,function(index,commentDtl){comment=pageId.find("#commentBodyDummy").clone().removeAttr("style"),pageId.find("#checklistComments").append(comment),comment.find("b").text(ZPeople.decodeTxt(commentDtl.name)),comment.find("img").attr("src",commentDtl.employeePhoto),comment.find("p").text(commentDtl.comment),comment.find("span").text(commentDtl.createdTime),comment.attr("id","taskcomment")});var commentHeadMsg="",commentsCount=comments.length;0==commentsCount?(commentHeadMsg=ZPI18N.getString("zp.comment"),pageId.find("#commentHead").find("a").attr("expanded",!0)):3>=commentsCount?(commentHeadMsg=ZPI18N.getString("zp.viewingallcomments",[commentsCount]),pageId.find("#commentHead").find("a").attr("expanded",!0)):(commentHeadMsg=ZPI18N.getString("zp.viewallcomments",[commentsCount]),pageId.find("#commentHead").siblings().slice(0,commentsCount-3).hide(),pageId.find("#commentHead").find("a").attr("expanded",!1)),pageId.find("#commentHead").find("a").text(commentHeadMsg),pageId.find("#commentHead").find("a").attr("count",commentsCount),pageId.find("#commentHead").find("a").click(function(){ZPChecklist.viewAllComments(this)}),ZPForm.LAYOUT.find("#checklistComments").append('<div class="modalComment" id="taskCommentBox"><div class="media"><div class="media-left"><img src="" class="Usrimg FL MR10 MT5"></div><div class="media-body"><div class="media-resize"><div class="mentions-input-box"><div class="mentions"></div><textarea placeholder="'+ZPI18N.getString("zp.writeacomment")+'" class="form-control ZP-postcmt"></textarea><div  class="mentions-autocomplete-list"></div></div><div class="text-right ZP-cmtbtn DB PT10"><div class="mentions"></div><button class="btn btn-primary" onclick="Task.saveComment(this)">'+ZPI18N.getString("zp.post")+'</button><div class="mentions-autocomplete-list"></div></div></div></div>'),pageId.find("#taskCommentBox").find("img").attr("src",ZPeople.CURR_USER.avatar)},showQuickTask:function(obj){var pageId=$("#"+Layout.Page.pageId);pageId.find("#rt_table").is(":visible")?(pageId.find("#newquicktask").removeClass("zp_dyn"),pageId.find("#zp_views_list_container_rel-1").find("#forms_norecordfound").remove()):(0!==$(obj).siblings().length?$(obj).siblings().click():$("#zp_profile_expandcola").click(),Task.isQuickTaskVisible=!0)},constructRelatedTask:function(resultObj,extraParam){var pageId=$("#"+Layout.Page.pageId);pageId.find("#rt_table").remove();var isfrommodule=1==extraParam?!0:!1,result=isfrommodule?resultObj:resultObj.recordDetails.message,norecord='<div class="label-body" id="forms_norecordfound"><h4 class="ZPNdt text-center" id="zp_views_nodata">'+ZPI18N.getString("zp.notaskfound")+"</h4></div>",quickui='<div class="zp_Task" id="rt_table">'+(isfrommodule?'<div class="zp_pshead">'+ZPI18N.getString("zp.tasks")+"</div>":"")+'<div class="zp_TLst"><ul><li id="newquicktask" class="zp_dyn"><i class="IC-task-unchk" onclick="Task.addQuickTask(Task.COMPLETED_SYSVALUE)"></i><div class="zp_txtbx"><input type="textbox" id="quicktaskname"></div><div class="ZP_photo" id="tUser" ownervalueid='+erecno+' onclick="Dropdown.taskUserdropdown(this)"><img src='+ZPeople.CURR_USER.avatar+'></div><div class="zp_txtbx"><input class="zp_ntsk" type="textbox" id="quicktaskdue" caltype ='+Task.getCalType()+'  onclick="Calendar.setUpCalendar(event,this,null,null,Task.addTaskByDate)"></div></li></ul></div>';pageId.find("#zp_views_list_container_rel-1").append(quickui),pageId.find("#quicktaskname").attr("placeholder",ZPI18N.getString("zp.taskname")),pageId.find("#quicktaskdue").attr("placeholder",ZPI18N.getString("zp.duedate")),Task.cloneRelatedTaskRow(result),Task.isQuickTaskVisible||isfrommodule?(pageId.find("#newquicktask").removeClass("zp_dyn"),Task.isQuickTaskVisible=!1):0===result.length&&pageId.find("#zp_views_list_container_rel-1").append(norecord),isadmin||Task.addPerm!==zpconst.Permission.NO_DATA||pageId.find("#newquicktask").remove(),pageId.find("#quicktaskname").keydown(function(key){13==key.which&&Task.addQuickTask()})},getCalType:function(){var url=Layout.Page.hash;return-1!==url.indexOf("admin/employeerecords/user")?"profile":-1!==url.indexOf("#hrcase/list/view")||-1!==url.indexOf("#hrcase/myrequest/view")||-1!==url.indexOf("cases/list")||-1!==url.indexOf("hrcase/report")||-1!==url.indexOf("#hrcase/allcases/view")?"HR_case":"popup"},getCheckRootTasks:function(getThis,isRefresh){var checkrootId=$(getThis).attr("checkrootId"),pageId=$("#"+Layout.Page.pageId);if(0==pageId.find("#taskRootDiv_"+checkrootId).length||isRefresh){$(getThis).attr("recordId");$(getThis).attr("id","taskRootDiv_"+checkrootId),$(getThis).find("tr").find("#taskClName").addClass("CP").attr("data-target","#taskDtlsDiv_"+checkrootId),$(getThis).find("#taskDtlsDiv").attr("id","taskDtlsDiv_"+checkrootId).addClass("zp_Task zp_TLst");var params={method:"getCheckRootTasks",checkitemrootid:checkrootId,conreqcsr:csrfToken};$.ajax({url:"/getCheckRootTasks.zp",type:"POST",data:params,success:function(data){var parentDiv=pageId.find("#taskDtlsDiv_"+checkrootId).find("ul").attr("checkrootid",checkrootId);parentDiv.children().remove(),0!=data.length&&Task.cloneRelatedTaskRow(data.tasks,$(parentDiv)),data.isCompleted?$(getThis).find("#rootStatus").html('<div class="grn">'+ZPI18N.getString("zp.completed")+"</div>"):$(getThis).find("#rootStatus").html('<div class="org">'+ZPI18N.getString("zp.inprogress")+"</div>")}})}},addTaskByDate:function(){var pageId=$("#"+Layout.Page.pageId);if(!pageId.find("#singlecalendar").is(":visible")){var taskname=pageId.find("#quicktaskname").val();if(""===taskname)return;window.setTimeout(Task.addQuickTask,100)}},cloneRelatedTaskRow:function(taskArr,parentDiv){var pageId=$("#"+Layout.Page.pageId),currentRow="",row="";Task.getTaskPermission(),Task.getOptionValues();for(var index=0;index<taskArr.length;index++){if(row=taskArr[index],currentRow=Task.RELATETASKTEMPLATE.clone().attr("id","rt_"+row.id),currentRow.attr("taskid",row.id),currentRow.find("#rt_taskname").html(row.name),row.isDeletable&&!row.isDraft?currentRow.find("#rt_delete").attr("onclick",'Task.deleteTaskConfirmation("'+row.id+'")'):currentRow.find("#rt_delete").remove(),void 0==row.endtime?currentRow.find("#rt_duedate").val(ZPI18N.getString("zp.noduedate")):currentRow.find("#rt_duedate").val(row.endtime),isadmin||row.istaskowner||ZPForm.Permission.isAllowed([row.taskowner],Task.editPerm)?currentRow.find("#rt_completebutton").attr("onclick","Task.changeTaskStatus(this)"):currentRow.find("#rt_completebutton").remove(),void 0!=row.priority&&(1===Task.priorityObj[row.priority].SYSVALUE?currentRow.find("#rt_completebutton").addClass("zp_rclr"):3===Task.priorityObj[row.priority].SYSVALUE&&currentRow.find("#rt_completebutton").addClass("zp_oclr")),row.iscompleted?(currentRow.find("#taskContainer").addClass("zp_cmpl"),currentRow.find("#rt_duedate").val(row.dispCompletedTime)):row.isoverdue&&currentRow.find("#rt_duedate").addClass("zp_rclr"),void 0!==row.taskownerdetail?(currentRow.find("#rt_taskownerpic").find("img").attr("src",row.taskownerdetail.employeePhoto),currentRow.find("#rt_taskownerpic").attr("popup","user").attr("empid",row.taskownerdetail.zuid),currentRow.find("#unassignedicon").remove()):row.isDraft||!row.istaskowner?currentRow.find("#rt_taskownerpic").find("img").attr("alt",Task.getShortName(row.assignedto)):(currentRow.find("#rt_taskownerpic").addClass("zp_dyn"),currentRow.find("#unassignedicon").addClass("IC-add-usr")),row.isDraft?(currentRow.find("#rt_completebutton").addClass("zp_dyn"),currentRow.find("#rt_duedate").val(ZPI18N.getString("zp.chkyettostart")),currentRow.click(function(event){event.stopPropagation()})):currentRow.find("#taskContainer").attr("onclick",ZPeople.isZPNewUI()?void 0!=ZPForm.CURRFORM_PARAM.formId?'Task.showTaskDetails("'+row.id+'", true, "'+ZPForm.CURRFORM_PARAM.formId+'", "'+ZPForm.CURRFORM_PARAM.recordId+'")':'Task.showTaskDetails("'+row.id+'", true)':'Task.viewRelatedTask("'+row.id+'", this)'),void 0===parentDiv)pageId.find("#newquicktask").parent().append(currentRow);else{var parentTaskDivId="#rt_"+row.parenttaskid;void 0===row.parenttaskid||0==row.parenttaskid?parentDiv.append(currentRow):0!=parentDiv.find(parentTaskDivId).length?(parentDiv.find(parentTaskDivId).append("<ul childid="+row.id+"></ul>"),parentDiv.find("[childid="+row.id+"]").append(currentRow)):taskArr.push(row)}currentRow.find("#rt_completebutton").click(function(event){event.stopPropagation()}),currentRow.find("#rt_delete").click(function(event){event.stopPropagation()}),currentRow.find("#unassignedicon").click(function(event){event.stopPropagation()}),void 0===Task.taskformid&&(Task.taskformid=row.taskformid)}},viewRelatedTask:function(taskid,obj){delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid];var checkrootid=$(obj).parents("ul[checkrootid]").attr("checkrootid"),isFromChecklist=void 0!==checkrootid,pageId=$("#"+Layout.Page.pageId),recordId=ZPForm.CURRFORM_PARAM.recordId,formId=ZPForm.CURRFORM_PARAM.formId;if(isFromChecklist){pageId.find("#rootTaskTriggerDtlsPage");pageId.find("#rootTaskTriggerDtlsPage").remove(),Task.showTaskDetails(taskid,!0),$($(".modal-backdrop.in")[1]).remove(),pageId.find("#task_closebutton").click(function(){void 0===recordId?($(".modal-backdrop").remove(),ZPChecklist.checklistTriggerData(ZPChecklist.rootLink)):ZPChecklist.getChecklistsForRecord(recordId,formId)}),pageId.find("#task_editicon").attr("isFromChecklist",!0)}else ZPView.Record.getFormPage("VIEW",taskid,obj)},changeStatusCombo:function(sysvalue){$("#"+Layout.Page.pageId).find("#taskStatusCombo").find("[sysvalue="+sysvalue+"]").prop("selected",!0).change()},editRec:function(formid,taskid){ZPForm.load({formId:formid,formMode:"EDIT",tableName:"P_Task",recordId:taskid,callback:Task.redirectClosePage,disableUrlTrack:!1})},redirectClosePage:function(taskid){Task.closePreview(),void 0!=taskid&&Task.viewTaskDetails(taskid)},changeTaskStatus:function(obj){var isFromTaskPage=-1!==Layout.Page.hash.indexOf("task/mytasks")&&void 0===ZPForm.CURRFORM_PARAM.formId,rootRow=isFromTaskPage?$(obj).parents("div.zpl"):$(obj).parent().parent("li"),taskid=0!=rootRow.length?rootRow.attr("taskid"):$(obj).attr("taskid"),isFromWidget=$(obj).parents("[widget]").attr("widget"),checkrootId=$(obj).parents("div[checkrootid]").attr("checkrootid"),status="";0!=rootRow.length?(status=rootRow.hasClass("zp_cmpl")||rootRow.find("#taskContainer").hasClass("zp_cmpl")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,taskid=rootRow.attr("taskid")):(status=0!=$(obj).parents(".modal-content").find(".zp_cmpl").length?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,taskid=ZPForm.CURRFORM_PARAM.recordId);var params={taskid:taskid,method:"changeTaskStatus",status:status,conreqcsr:csrfToken},pageId=$("#"+Layout.Page.pageId);0!=rootRow.length&&(status==Task.OPEN_SYSVALUE?isFromTaskPage?rootRow.removeClass("zp_cmpl"):rootRow.find("#taskContainer").removeClass("zp_cmpl"):isFromTaskPage?rootRow.addClass("zp_cmpl"):rootRow.find("#taskContainer").addClass("zp_cmpl"),delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid]),$.post("/changeTasksStatus.zp",params,function(data){if("success"==data.Status){var successmsg=status==Task.OPEN_SYSVALUE?ZPI18N.getString("zp.taskreopenedsuccess"):ZPI18N.getString("zp.taskcompletedsuccess");if(ZPeople.Message.showSuccessMsg(successmsg),isFromTaskPage)Task.getTaskCount();else if(isFromWidget){var countBox=pageId.find("#MYPENDINGTASKS").parent().find("#zpdash_widgetcnt").find("b");status==Task.COMPLETED_SYSVALUE?countBox.text(parseInt(countBox.text())-1):status==Task.OPEN_SYSVALUE&&countBox.text(parseInt(countBox.text())+1)}if(0==rootRow.length){var fcid=pageId.find("#commentSlideBody").find("[folabel=Status]").attr("id").split("_").pop(),status_optionvalue=Task.getOptionValue(fcid,ZPForm.CURRFORM_PARAM.formId,status);if(pageId.find("#commentSlideBody").find("[folabel=Status]").find("span").text(ZPeople.decodeTxt(status_optionvalue)),status==Task.COMPLETED_SYSVALUE){var currentTime=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),timesplit=currentTime.constructor().split(" ");pageId.find("#commentSlideBody").find("[folabel=Completed_On]").find("span").text(timesplit[1]+" "+timesplit[2]+" "+timesplit[3]+" "+timesplit[4]),pageId.find("#commentSlideBody").find("[folabel=Completed_By]").find("span").text(ZPeople.decodeTxt(ZPeople.getUserDetailsById(erecno).name))}Task.fillDetailViewPage()}if(void 0!==checkrootId){var checkRootDiv="#taskRootDiv_"+checkrootId;Task.getCheckRootTasks(pageId.find(checkRootDiv),!0)}}else ZPeople.Message.showFailureMsg(data.message),0!=rootRow.length&&(status!==Task.OPEN_SYSVALUE?isFromTaskPage?rootRow.removeClass("zp_cmpl"):rootRow.find("#taskContainer").removeClass("zp_cmpl"):isFromTaskPage?rootRow.addClass("zp_cmpl"):rootRow.find("#taskContainer").addClass("zp_cmpl"))})},pickupTask:function(obj){var pageId=$("#"+Layout.Page.pageId),isFromTaskPage=-1!==Layout.Page.hash.indexOf("task/mytasks")&&void 0===ZPForm.CURRFORM_PARAM.formId,rootRow=isFromTaskPage?$(obj).parents("div.zpl"):$(obj).parents("li"),taskid=0!=rootRow.length?rootRow.attr("taskid"):ZPForm.CURRFORM_PARAM.recordId,params={taskid:taskid,method:"changeTaskOwner",mode:"pickup",conreqcsr:csrfToken};$.post("/changeTaskOwner.zp",params,function(data){"success"==data.Status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskassignedsuccess")),0!=rootRow.length?(isFromTaskPage?(rootRow.find("#assignedto").hide(),rootRow.find("#pickup").hide(),rootRow.find("#taskowner").show().text(ZPeople.decodeTxt(ZPeople.CURR_USER.name))):(rootRow.find("#rt_taskownerpic").removeClass("zp_dyn").find("img").attr("src",ZPeople.CURR_USER.avatar),rootRow.find("#unassignedicon").remove()),delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid]):(ZPForm.refreshRecord(taskid),ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.recordDetails.message.ownerID[0]=erecno,pageId.find("[folabel=Task_Owner]").find("span").text(ZPeople.decodeTxt(ZPeople.CURR_USER.name)),Task.fillDetailViewPage())):ZPeople.Message.showFailureMsg(data.message)})},showTaskDetails:function(taskid,disableUrl,related_formid,related_recordid){var pageId=$("#"+Layout.Page.pageId);ZPACommon.hideSlideBodyContent(),pageId.find("#taskDetailPage").modal("show"),pageId.find("#task_editicon").removeClass("DN"),pageId.find("#completebutton,#tdtls_taskname,#task_editicon").addClass("zp_dyn"),pageId.find("#detail_pannel").addClass("zp_dyn"),Task.getTaskFormid();var formid=Task.taskformid,params={formId:formid,recordId:taskid,formMode:"VIEW",isCustomLayout:!0};disableUrl&&(params.disableUrlTrack=!1),ZPForm.load(params),pageId.find("#task_header").val(formid),pageId.find("[name=task_slider]").addClass("zp_tskFl"),pageId.find("#taskDetailPage").find("td[id]").text(""),pageId.find("#tdtls_taskowner").parents("dd").removeClass("zp_link").removeAttr("onclick"),pageId.find("#task_editicon").attr("taskid",taskid),pageId.find("#task_editicon").attr("formid",formid),pageId.find("#completebutton").attr("taskid",taskid),void 0!=related_formid&&void 0!=related_recordid&&pageId.find("#tdtls_close").attr("onclick",'ZPACommon.viewRecord("'+related_formid+'","'+related_recordid+"\", '', true)")},fillDetailViewPage:function(){var page=ZPForm.LAYOUT.data().curpageid,pageId=$("#"+Layout.Page.pageId).find("#"+page),duedate=$(pageId.find("[folabel=Due_Date]").find("span")[0]).text(),taskname=$(pageId.find("[folabel=Task_Name]").find("span")[0]).text();"-"!==duedate?pageId.find("#tdtls_duedate").text(duedate):pageId.find("#tdtls_duedate").text(ZPI18N.getString("zp.noduedate")),pageId.find("#tdtls_taskname").text(taskname),-1!==page.indexOf("relfielsingle")&&pageId.find("#task_closebutton").attr("onclick","ZPForm.Field.formCloseBtn()");var status=$(pageId.find("[folabel=Status]").find("span")[0]).text(),status_sysvalue=Task.getSysValue(pageId.find("[folabel=Status]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,status),status_color="";status_sysvalue==Task.COMPLETED_SYSVALUE?(status_color="zp_gclr",pageId.find("#taskSlideHead").parent().addClass("zp_cmpl"),pageId.find("[folabel=Completed_On]").parent().removeClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().removeClass("zp_dyn"),"-"===pageId.find("[folabel=Task_Owner]").find("span").text()&&pageId.find("[folabel=Task_Owner]").find("span").text(ZPeople.CURR_USER.name)):(pageId.find("#taskSlideHead").parent().removeClass("zp_cmpl"),pageId.find("[folabel=Completed_On]").parent().addClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().addClass("zp_dyn")),pageId.find("#tdtls_status").text(status).parent().attr("class",status_color);var taskowner=$(pageId.find("[folabel=Task_Owner]").find("span")[0]).text();if("-"!=taskowner){var taskownererecno="";if(pageId.find("#tdtls_taskowner").text(taskowner),pageId.find("#tdtls_taskowner_image").attr("alt",Task.getShortName(taskowner)),pageId.find("[folabel=Assigned_To]").parent().addClass("zp_dyn"),void 0!==pageId.find("[folabel=Task_Owner]").find("select").val())taskownererecno=pageId.find("[folabel=Task_Owner]").find("select").val();else if(void 0!==ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId]){var owner=ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.ownerID;taskownererecno=owner[0],isAdminProfile||ZPForm.Permission.isAllowed(owner,ZPForm.Permission.getEditPerm())||(pageId.find("#task_editicon").remove(),pageId.find("#completebutton").remove())}if(""!==taskownererecno){var taskownerimg=ZPeople.getUserDetailsById(taskownererecno).avatar;pageId.find("#tdtls_taskowner_image").attr("src",taskownerimg)}else pageId.find("#tdtls_taskowner_image").removeAttr("src")}else{var assignedTo=ZPeople.escapeHtml($(pageId.find("[folabel=Assigned_To]").find("span")[0]).text());pageId.find("#tdtls_taskowner").text("").append("<span>"+assignedTo+"</span>").append("<span class=\"zp_ldot zp_link\" onclick=\"ZPeople.confirm(this,'','zp.taskpickmessage', Task.pickupTask)\">"+ZPI18N.getString("zp.pick")+"</span>").parents("dd").attr("taskid",pageId.find("#completebutton").attr("taskid")),pageId.find("[folabel=Assigned_To]").parent().removeClass("zp_dyn"),pageId.find("#tdtls_taskowner_image").attr("alt",Task.getShortName(assignedTo))}var priority_sysvalue=Task.getSysValue(pageId.find("[folabel=Priority]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,$(pageId.find("[folabel=Priority]").find("span")[0]).text()),priority_color="";priority_sysvalue==Task.LOW_SYSVALUE?priority_color="zp_oclr":priority_sysvalue==Task.HIGH_SYSVALUE&&(priority_color="zp_rclr"),pageId.find("#completebutton").removeClass("zp_oclr zp_rclr").addClass(priority_color),pageId.find("#completebutton,#tdtls_taskname,#task_editicon").removeClass("zp_dyn"),pageId.find("#detail_pannel").removeClass("zp_dyn"),ZPACommon.showSlideBodyContent(),Task.taskformid=ZPForm.CURRFORM_PARAM.formId;var taskrow=$("#taskCustomisedList").find("[taskid="+ZPForm.CURRFORM_PARAM.recordId+"]");if(0!=taskrow.length){var priority_color="";priority_sysvalue==Task.LOW_SYSVALUE?priority_color="zp_oclr":priority_sysvalue==Task.HIGH_SYSVALUE&&(priority_color="zp_rclr"),status_sysvalue==Task.COMPLETED_SYSVALUE?taskrow.addClass("zp_cmpl"):taskrow.removeClass("zp_cmpl"),taskrow.find(".IC-task-unchk").removeClass("zp_oclr zp_rclr").addClass(priority_color),""!==taskname&&taskrow.find(".zp_ctit").find("b").text(taskname)}},getSysValue:function(fcId,formId,optionValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,sysvalue=0;return $.each(options,function(index,row){return ZPeople.decodeTxt(row.Value)==optionValue?void(sysvalue=row.SysValue):void 0}),sysvalue},getOptionValue:function(fcId,formId,sysValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,optionvalue=0;return $.each(options,function(index,row){return row.SysValue==sysValue?void(optionvalue=row.Value):void 0}),optionvalue},closePreview:function(taskid){var url=Layout.Page.hash,pageId=$("#"+Layout.Page.pageId);ZPeople.isZPNewUI()?(-1!==url.indexOf("task/mytask")||-1!==url.indexOf("task/alltask"))&&(void 0!=taskid?(window.location.href="#task/tracktask",ZPTasks.resetMyTask=!0,ZPTasks.resetAllTask=!0,ZPTasks.resetTrackTask=!0,$("#zp_t_task_mytask").attr("href","#task/mytask")):window.location.href=void 0==Task.parentUrl?"#task/mytask":Task.parentUrl):(-1!==url.indexOf("task/mytasks")&&(window.location.href="#task/mytasks"),pageId.find("#commentSlideBody div[id^='zp_addedit_record_']").attr("id","taskFormPage"),Task.isPreviewClosed=!0,void 0!==Task.resetTaskId&&""!==Task.resetTaskId&&(delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+Task.resetTaskId],Task.resetTaskId=""))},getShortName:function(name){var shortname="";if(void 0!=name){var splitname=ZPeople.decodeTxt(name).split(" ");shortname=splitname[0].charAt(0),shortname+=void 0!=splitname[1]?splitname[1].charAt(0):void 0!=splitname[0].charAt(1)?splitname[0].charAt(1):""}return shortname},isTaskAvailable:function(){var taskRestrictedTables=["P_PerfAppraisal","P_Location","P_LeaveType","P_AppraisalConfiguration","P_KRA","P_KRA_User","P_Rating","P_EmployeeJobs","P_Holiday","P_Goals","P_TimesheetJob","P_TimesheetJobsList","P_Timesheet","P_TimesheetList","P_TimesheetBudget","P_ClientDetails"];return-1!==taskRestrictedTables.indexOf(ZPForm.getTableName())?!1:!0}};var Dropdown={taskUserdropdown:function(obj){Task.addPerm!=zpconst.Permission.NO_DATA&&Task.addPerm!=zpconst.Permission.MY_DATA&&$(obj).zparrowmenu({id:"taskUserList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","TASKS")},callback:Dropdown.updateTaskUser})},updateTaskUser:function(obj,initObj){var result=($("#"+Layout.Page.pageId),$(obj).find("img")),ownervalueId=$(obj).attr("id");$(initObj).attr("ownervalueid",ownervalueId),$(initObj).find("img").replaceWith(result)}},WF_ACTION_ADD=1,WF_ACTION_EDIT=2,WF_ACTION_DELETE=3,WF_ACTION_APPROVE=4,WF_ACTION_REJECT=5,WF_ACTION_ADDOREDIT=8,WF_ACTION_FIELDVALUECHANGE=9,WF_ACTION_REMINDER=10,CHECKLIST_REC_PERPAGE=25,CUSTOM_DATE=36,TOMORROW=33,NEXT_7_DAYS=39,ZPChecklist={CHECKITEMROOT_TEMPLATE:'<div id="rootTaskTriggerDtlsPage"  class="modal popRgtModel PopMdxModel modal-right " aria-hidden="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"> <a data-dismiss="modal" class="close"><span class="IC-cls-1px red" id="rootClose"></span></a><h6><div class="txttrim FL">'+ZPI18N.getString("zp.checklist")+'</div><span data-placement="bottom" title="" class="S14 FL gry ML15 ZPtitle hide" data-original-title="Edit Permissions"><i class="IC-pen S14 MR5"></i></span> </h6></div><div class="row dvTaskdetail" id = "checklistDetails" style="display:none"><div><table class="table table-hover M0"><tbody><tr data-toggle="collapse"><th><div class="FL MR10"data-toggle="tooltip" data-placement="top" data-container="body"><img class="Usrimg FL MR10 MT5" src="" id="taskOwnerImg" /></div><div class="tragcont"><div class="S16" id="taskClName"></div><p id="myReqTriggerInfo"></p></div></th><th width="260" id="rootStatus"></th></tr></tbody></table><div id="taskDtlsDiv"><ul class="ulTaskdetail"></ul></div></div></div><div class="modal-body" id="checkrootList"></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-default">'+ZPI18N.getString("zp.close")+"</a></div></div></div></div>",CHECKLISTITEM_TEMPLATE:'<div class="modal popRgtModel PopMdxModel PopComtsfixed modal-right" tabindex="-1" id="myClReqComment"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"> <a class="close" data-dismiss="modal"><span class="IC-cls-1px red"></span></a><div class="txttrim FL" id="commentSlideHead"><h6><span class="S14 FL gry ML15 ZPtitle hide" title="Edit Permissions" data-placement="bottom"><i class="IC-pen S14 MR5"></i></span> </h6></div></div><div class="modal-body" id="commentSlideBody"><div class="row dvchklstcom"><div class="dvchkhead"><table class="table table-responsive"><tr><th id="checkitemDetail"></th><th width="260"></th></tr></table></div><div class="col-md-8 PT10 ML40"><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.formname")+'</label><div class="form-group col-md-8"><a id="checklistFormName" name="record" formid="" recordid=""></a></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.taskowner")+'</label><div class="form-group col-md-8" id="checklistTaskOwner"><div class="form-group"><span class="IC-role gry MR10 ZPtitle" title="Role"></span><span name="taskOwner"></span></div><div class="form-group"><span class="gry MR10 ZPtitle" title="Groups"></span><span name="taskOwner"></span></div><div class="form-group"><span class="IC-team gry MR10 ZPtitle" title="Department"></span><span name="taskOwner"></span></div><div class="form-group"><span class="IC-user gry MR10 ZPtitle" title="Employee"></span><span name="taskOwner"></span></div></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.initiatedby")+'</label><div class="form-group col-md-8"><span id="checklistInitiatedBy"></span></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.initiatedon")+'</label><div class="form-group col-md-8"><span id="checklistInitiatedOn"></span></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.triggeredaction")+'</label><div class="form-group col-md-8"><span id="checklistTriggeredOn"></span></div></div></div><div class="main-media CL FL MT20"><div class="media-comments"><div class="media" id="commentBodyDummy" style="display:none"><div class="media-left"> <img src="" class="media-object" /></div><div class="media-body"><div class="media-resize"><a><b></b></a> <span class="dt-time"></span><p class="post-content MT8"></p></div></div></div><div id="checklistComments"><div class="media" id="commentHead"><div class="media-left"> <span class="IC-chat S16"></span> </div><div class="media-body"><a id="cmtCount"></a></div></div></div></div></div></div></div><div class="modal-footer"><div class="media"><div class="media-left"><img src="" class="Usrimg FL MR10 MT5"></div><div class="media-body"><div class="media-resize"><div class="mentions-input-box"><div class="mentions"></div><textarea placeholder="'+ZPI18N.getString("zp.writeacomment")+'" class="form-control ZP-postcmt"></textarea><div  class="mentions-autocomplete-list"></div></div><div class="text-right ZP-cmtbtn DB PT10"><div class="mentions"></div><button class="btn btn-primary" onclick="ZPChecklist.saveComment(this)">'+ZPI18N.getString("zp.post")+'</button><div class="mentions-autocomplete-list"></div></div></div></div></div></div></div></div></div>',getChecklistData:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId()),formId=pageId.find("#myChecklistComboBox").val(),mode=pageId.find("#checklistStatusCombo").val(),url="",params={formId:formId,mode:mode,method:"getMyChecklistItem",conreqcsr:csrfToken};if(isadmin?(params.method="getAdminChecklistItem",params.erecno=pageId.find("#employeeChecklistCombo").val(),url="/checklistAdminAction.zp"):(params.method="getMyChecklistItem",url="/checklistAction.zp"),"pending"===mode||"overdue"===mode?params.index=pageId.find(".IC-rou-tik.gry").length+1:params.index=pageId.find(".IC-rou-tik").length+1,0==pageId.find(".IC-rou-tik").length&&ZPACommon.showEmptyListPage("pageloading"),pageId.find("#dvFiltersec").is(":visible")&&(params.searchString=pageId.find("#taskSearchString").val(),params.sDate=pageId.find("#datePicker").val(),params.sDate==CUSTOM_DATE)){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);params.sDate=dates.from,params.eDate=dates.to}ZPeople.Request.send(url,params,ZPChecklist.appendDataInHead)},regFilterClickEvent:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#filterIcon").click(function(){pageId.find("#dvFiltersec").is(":visible")?(pageId.find("#dvFiltersec").addClass("DN"),pageId.find("#contWrapper").removeClass("open"),pageId.find("#filterIcon").removeClass("active")):(pageId.find("#dvFiltersec").removeClass("DN"),pageId.find("#contWrapper").addClass("open"),pageId.find("#datePicker").select2(),pageId.find("#filterIcon").addClass("active"))})},splitFromToDate:function(dateStr){var parts=dateStr.split("-"),dates={};return 2==parts.length?(dates.from=parts[0],dates.to=parts[1]):6==parts.length&&(dates.from=parts[0]+"-"+parts[1]+"-"+parts[2],dates.to=parts[3]+"-"+parts[4]+"-"+parts[5]),dates},resetChecklistTaskPage:function(){$(".ERR").remove(),ZPChecklist.isValideTaskFilter()&&($("#"+AutomationCommon.getCurrentPageId()).find("#myChecklistTable").html(""),ZPChecklist.getChecklistData())},isValideTaskFilter:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId()),sDate=pageId.find("#datePicker").val(),mode=pageId.find("#checklistStatusCombo").val();if(pageId.find("#customDateErr").remove(),pageId.find("#dvFiltersec").is(":visible")){if(sDate==CUSTOM_DATE){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);if(void 0==dates.from||void 0==dates.to||!Calendar.isvalidDate(dates.from)||!Calendar.isvalidDate(dates.to))return pageId.find("#customDatePicker").append('<div class="ERR WNW" id="customDateErr">'+ZPI18N.getString("zp.selectfromandto")+"</div>"),!1;if(Calendar.parseDate(dates.from,uidateFormat)>Calendar.parseDate(dates.to,uidateFormat))return pageId.find("#customDatePicker").append('<div class="ERR WNW" id="customDateErr">'+ZPI18N.getString("zp.holiday.datefromtoerror")+"</div>"),!1}if("completed"===mode&&(sDate==TOMORROW||sDate==NEXT_7_DAYS))return pageId.find("#datePicker").parent().append('<div class="ERR WNW" id="customDateErr">'+ZPI18N.getString("zp.entervalidperiod")+"</div>"),!1}return!0},appendDataInHead:function(data){var pageId=$("#"+AutomationCommon.getCurrentPageId()),listTable="";0==pageId.find(".IC-rou-tik").length?(pageId.find("#myChecklistTable").html(""),0==data.length?listTable='<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.nochecklistassigned")+"</h2></div>":(listTable='<div class="table-responsive"><table class="table table-hover"><thead><tr><th width="70"></th><th width="35%"><span >'+ZPI18N.getString("zp.tasks")+'</span></th><th  width="20%">'+ZPI18N.getString("zp.initiatedby")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th>",listTable+='<th width="20%">'+ZPI18N.getString("zp.status")+"</th></tr></thead><tbody>",listTable+=ZPChecklist.constructList(data)+"</tbody></table></div>"),pageId.find("#myChecklistTable").append(listTable),ZPChecklist.setup()):(listTable=ZPChecklist.constructList(data),listTable=ZPChecklist.regClickEvents($(listTable)),pageId.find("#myChecklistTable").find("tbody").append(listTable)),data.length==CHECKLIST_REC_PERPAGE&&ZPeople.FireScroll.reset()},constructList:function(data){var listTable="",tickColor="",status="",onClick="",endDate="",relatedRecordOwnerName="",employeePhoto="",deptName="",relatedRecordOwnerErecno="",empId="";return void 0==ZPeople.EMP_FORMID&&(ZPeople.EMP_FORMID=data[0].employeeFormId),$.each(data,function(){status=ZPChecklist.getStatus(this.isCompleted,this.isOverDue,this.endDate),this.isCompleted?(tickColor="grn",onClick="",endDate=this.actualEndTime,status+=" "+endDate):(tickColor="gry",onClick="onclick=ZPChecklist.changeStatus('"+this.checkItemDataId+"')",endDate=this.endDate),void 0!=this.related_recordOwnerDetails&&void 0!=this.related_recordOwnerDetails.employeePhoto?(employeePhoto=this.related_recordOwnerDetails.employeePhoto,deptName=ZPeople.getUserDetailsById(this.related_recordOwnerDetails.erecno).deptName,deptName=void 0!=deptName?", "+deptName:"",empId=this.related_recordOwnerDetails.employeeID,relatedRecordOwnerName=this.related_recordOwnerDetails.name,relatedRecordOwnerErecno=this.related_recordOwnerDetails.erecno):(employeePhoto=this.recordOwnerDetails.employeePhoto,deptName=ZPeople.getUserDetailsById(this.recordOwnerDetails.erecno).deptName,deptName=void 0!=deptName?", "+deptName:"",empId=this.recordOwnerDetails.employeeID,relatedRecordOwnerName=this.recordOwnerDetails.name,relatedRecordOwnerErecno=this.recordOwnerDetails.erecno),listTable+='<tr><td><span id="checkSpan_'+this.checkItemDataId+'" class="IC-rou-tik '+tickColor+' S20 ML20 ZPtitle" title="Task Success" '+onClick+"></span></td>",listTable+='<td><div class="FL MR10"data-toggle="tooltip" data-placement="top" data-original-title="'+empId+" - "+relatedRecordOwnerName+'"><img src="'+employeePhoto+'" class="Usrimg MT5" /></div><div class="tragcont PL0"><a class="lnk" data-target="#myClTaskComment" data-toggle="modal" name="commentlink" checkitemdataid=\''+this.checkItemDataId+"'>"+this.displayName+"</a>",listTable+="<p>"+empId+' - <a class="lnk" name="record" formid=\''+ZPeople.EMP_FORMID+"' recordid='"+relatedRecordOwnerErecno+"'>"+relatedRecordOwnerName+"</a>"+deptName+"</p></div></td>",listTable+='<td><p><a class="lnk" name="record" formid=\''+ZPeople.EMP_FORMID+"' recordid='"+this.recordOwnerDetails.erecno+"'>"+this.recordOwnerDetails.name+"</a></p></td>",listTable+='<td><a name="record" formid=\''+this.checklist.formId+"' recordid='"+this.checklist.recordId+"'>"+this.checklist.formName+"</a></td>",listTable+='<td name="status">'+status+"</td></tr>"}),listTable},isCustomDate:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#datePicker").val()==CUSTOM_DATE?pageId.find("#customDatePicker").removeClass("DN"):pageId.find("#customDatePicker").addClass("DN")},getStatus:function(isCompleted,isOverDue,endDate){var status="";if(isCompleted)status='<div class="grn">'+ZPI18N.getString("zp.completed")+'</div> <span class="gry"> '+ZPI18N.getString("zp.on")+"</span>";else{var spanColor=isOverDue?"red":"org",statusMsg=isOverDue?"zp.overdue":"zp.inprogress",dueDateMsg=isOverDue?"zp.wasdueon":"zp.dueon";status='<div class="'+spanColor+'">'+ZPI18N.getString(statusMsg)+"</div> <span>"+ZPI18N.getString(dueDateMsg)+" "+endDate+"</span>"}return status},commentSlide:function(checkItemDataId){var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#assignedToList").html("");var params={checkItemDataId:checkItemDataId,method:"getComments",conreqcsr:csrfToken};$.post("/getChecklistComments.zp",params,function(data){var employeePhoto="",empId="",relatedRecordOwnerName="";void 0!=data[0].related_recordOwnerDetails&&void 0!=data[0].related_recordOwnerDetails.employeePhoto?(employeePhoto=data[0].related_recordOwnerDetails.employeePhoto,empId=data[0].related_recordOwnerDetails.employeeID,relatedRecordOwnerName=data[0].related_recordOwnerDetails.name):(employeePhoto=data[0].recordOwnerDetails.employeePhoto,empId=data[0].recordOwnerDetails.employeeID,relatedRecordOwnerName=data[0].recordOwnerDetails.name);var checkitemDetail=(data[0].isCompleted?data[0].actualEndTime:data[0].endDate,'<div class="FL MR10"data-toggle="tooltip" data-placement="top" data-container="body" data-original-title="'+empId+" - "+relatedRecordOwnerName+'"><img src="'+employeePhoto+'" class="Usrimg FL MR10 ML5" /></div><div class="tragcont"><div class="S16">'+data[0].displayName+"</div></div>"),taskOwners="",rowIndex=0;data[0].actualEndTime=void 0==data[0].actualEndTime?"":data[0].actualEndTime,pageId.find("#commentSlideHead").find("h6").text(ZPeople.decodeTxt(data[0].checklist.checklistName)),pageId.find("#commentSlideHead").attr("checkid",data[0].checkItemDataId),pageId.find("#checkitemDetail").html(checkitemDetail),pageId.find("#checklistFormName").attr("formid",data[0].checklist.formId),pageId.find("#checklistFormName").attr("recordid",data[0].checklist.recordId),pageId.find("#checklistInitiatedBy").text(ZPeople.decodeTxt(data[0].recordOwnerDetails.name)),pageId.find("#checklistInitiatedOn").html(data[0].startDate),pageId.find("#checklistTriggeredOn").html(ZPI18N.getString(ZPChecklist.triggerAction(data[0])));var closedByImg=void 0!=data[0].closeBy?'<img class="Usrimg FL MR10 MT5" src="'+data[0].closeBy.employeePhoto+'">':"";pageId.find("#checkitemDetail").siblings("th").html(closedByImg+ZPChecklist.getStatus(data[0].isCompleted,data[0].isOverDue,data[0].endDate)+" "+data[0].actualEndTime),pageId.find("#checklistFormName").text(ZPeople.decodeTxt(data[0].checklist.formName)),pageId.find("#checklistTaskOwner").children().attr("style","display:none").removeAttr("visible").find("[name=taskOwner]").html(""),$.each(data[0].taskOwners,function(taskOwner,row){taskOwners="",0!=this.length&&($.each(row,function(index,assignedTo){""!=taskOwners&&(taskOwners+=","),taskOwners+=" "+assignedTo.value}),$(pageId.find("#checklistTaskOwner").children()[rowIndex]).show().attr("visible","true").attr("class","form-group").find("span").last().html(taskOwners)),rowIndex++}),pageId.find("#checklistTaskOwner").children("[visible=true]").last().removeAttr("class"),pageId.find("#commentHead").siblings().remove(),$.each(data[0].comments,function(index,commentDtl){comments=pageId.find("#commentBodyDummy").cloneRow("#checklistComments"),comments.find("b").text(ZPeople.decodeTxt(commentDtl.name)),comments.find("img").attr("src",commentDtl.employeePhoto),comments.find("p").text(commentDtl.comment),comments.find("span").text(commentDtl.createdTime)});var commentHeadMsg="",commentsCount=data[0].comments.length;0==commentsCount?(commentHeadMsg=ZPI18N.getString("zp.comment"),pageId.find("#commentHead").find("a").attr("expanded",!0)):3>=commentsCount?(commentHeadMsg=ZPI18N.getString("zp.viewingallcomments",[commentsCount]),pageId.find("#commentHead").find("a").attr("expanded",!0)):(commentHeadMsg=ZPI18N.getString("zp.viewallcomments",[commentsCount]),$("#commentHead").siblings().slice(0,commentsCount-3).hide(),pageId.find("#commentHead").find("a").attr("expanded",!1)),pageId.find("#commentHead").find("a").text(commentHeadMsg),pageId.find("#commentHead").find("a").attr("count",commentsCount),pageId.find("div.modal-footer").find("img").attr("src",ZPeople.CURR_USER.avatar),pageId.find("#myClReqComment").modal("show"),$($(".modal-backdrop")[0]).siblings(".modal-backdrop").remove()})},viewAllComments:function(getThis){0!=$("#"+AutomationCommon.getCurrentPageId()).find("#commentHead").siblings().length&&($(getThis).text(ZPI18N.getString("zp.viewingallcomments",[$(getThis).attr("count")])),$(getThis).attr("expanded",!0),$(getThis).parent().parent().siblings().show())},viewRecord:function(formId,pkId){$($(".modal-backdrop")[0]).remove(),$("#"+AutomationCommon.getCurrentPageId()).find("#rootTaskTriggerDtlsPage").remove(),$("#"+AutomationCommon.getCurrentPageId()).find("#myClReqComment").remove(),ZPACommon.viewRecord(formId,pkId),ZPChecklist.setup()},changeStatus:function(dataId){var currentRow=$("#checkSpan_"+dataId).closest("tr"),params={dataid:dataId,method:"completeTask",conreqcsr:csrfToken};$.post("/changeCheckitemStatus.zp",params,function(data){"success"==data&&($("#checkSpan_"+dataId).removeClass("gry").addClass("grn").removeAttr("onclick"),currentRow.find("[name=status]").html(ZPChecklist.getStatus("true")+" "+ZPI18N.getString("zp.today")))})},triggerInfo:function(obj){var triggerDetail="";if(void 0!=obj.workflowdetails)switch(obj.workflowdetails.action){case WF_ACTION_ADD:triggerDetail="zp.triggermessageadd";break;case WF_ACTION_EDIT:triggerDetail="zp.triggermessageedit";break;case WF_ACTION_DELETE:triggerDetail="zp.triggermessagedelete";break;case WF_ACTION_APPROVE:triggerDetail="zp.triggermessageapprove";break;case WF_ACTION_REJECT:triggerDetail="zp.triggermessagereject";break;case WF_ACTION_ADDOREDIT:triggerDetail="zp.triggermessageaddoredit";break;case WF_ACTION_FIELDVALUECHANGE:triggerDetail="zp.triggermessagefieldvalue";break;case WF_ACTION_REMINDER:triggerDetail="zp.triggermessageremainder"}else triggerDetail="zp.triggermessageadd";return triggerDetail},triggerAction:function(obj){var triggerDetail="";if(void 0!=obj.workflowdetails)switch(obj.workflowdetails.action){case WF_ACTION_ADD:triggerDetail="zp.create";break;case WF_ACTION_EDIT:triggerDetail="zp.edit";break;case WF_ACTION_DELETE:triggerDetail="zp.delete";break;case WF_ACTION_APPROVE:triggerDetail="zp.approved";break;case WF_ACTION_REJECT:triggerDetail="zp.rejected";break;case WF_ACTION_ADDOREDIT:triggerDetail="zp.workflow.createoredit";break;case WF_ACTION_FIELDVALUECHANGE:triggerDetail="zp.fieldupdates";break;case WF_ACTION_REMINDER:triggerDetail="zp.date"}else triggerDetail="zp.workflow.createoredit";return triggerDetail},filterChanges:function(thisObj){var pageId=$("#"+AutomationCommon.getCurrentPageId());$(thisObj).toggleClass("active");var filterObj=pageId.find("div#filterSec");pageId.find("div.ZPcontwrap").hasClass("open")?(pageId.find("div.ZPcontwrap").removeClass("open"),filterObj.removeClass("in"),filterObj.addClass("hide")):(pageId.find("div.ZPcontwrap").addClass("open"),filterObj.addClass("in"),filterObj.fadeIn("slow"),filterObj.removeClass("hide"))},saveComment:function(getThis){var textArea=$(getThis).parent().parent().find("textarea"),checkid=$("#"+AutomationCommon.getCurrentPageId()).find("#commentSlideHead").attr("checkid"),params={checkid:checkid,notes:textArea.val(),conreqcsr:csrfToken};$.post("/AddChecklistComment.zp",params,function(data){ZPChecklist.newComment(textArea.val()),textArea.val("")})},newComment:function(comment){var pageId=$("#"+Layout.Page.pageId),newRow=pageId.find("#commentBodyDummy").clone();pageId.find("#taskCommentBox").before(newRow);var count=parseInt(pageId.find("#cmtCount").attr("count"))+1,isExpanded=pageId.find("#commentHead").find("a").attr("expanded");newRow.attr("id","taskcomment").removeAttr("style"),newRow.find("b").text("Me"),newRow.find("p").text(comment),newRow.find("span").text(ZPI18N.getString("zp.today")),newRow.find("img").attr("src",ZPeople.CURR_USER.avatar),pageId.find("#commentHead").find("a").attr("count",count),pageId.find("#commentSlideBody").animate({scrollTop:pageId.find("#checklistComments").find(".media").last().position().top}),$.parseJSON(isExpanded)?pageId.find("#commentHead").find("a").text(ZPI18N.getString("zp.viewingallcomments",[count])):pageId.find("#commentHead").find("a").text(ZPI18N.getString("zp.viewallcomments",[count]))},getMyChecklistReqData:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId()),formId=pageId.find("#myChecklistReqComboBox").val(),mode=pageId.find("#myReqStatusCombo").val(),params={mode:mode,method:"getMyChecklistReq",conreqcsr:csrfToken};0!=formId&&(params.formId=formId);var url="";if(isadmin||isAdminProfile?(url="/getAdminChecklistReq.zp",params.method="getAdminChecklistReq",params.erecno=pageId.find("#checklistReqEmployeeCombo").val()):(url="/getMyChecklistReq.zp",params.method="getMyChecklistReq"),0==pageId.find("#myChecklistReqTable").find("tbody").children().length&&ZPACommon.showEmptyListPage("pageloading"),params.index=$("#myChecklistReqTable").find("tbody").children().length+1,pageId.find("#dvFiltersec").is(":visible")&&(params.searchString=pageId.find("#taskSearchString").val(),params.sDate=pageId.find("#datePicker").val(),params.sDate==CUSTOM_DATE)){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);if(void 0==dates.from||void 0==dates.to||!Calendar.isvalidDate(dates.from)||!Calendar.isvalidDate(dates.to))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.selectfromandto")+"</div>"),void pageId.find("#myChecklistReqTable").html("").append('<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.checklistnottriggered")+"</h2></div>");if(Calendar.parseDate(dates.from,uidateFormat)>Calendar.parseDate(dates.to,uidateFormat))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.holiday.datefromtoerror")+"</div>"),void pageId.find("#myChecklistReqTable").html("").append('<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.checklistnottriggered")+"</h2></div>");params.sDate=dates.from,params.eDate=dates.to}ZPeople.Request.send(url,params,ZPChecklist.appendToCheckReqHead)},resetChecklistReqPage:function(){$(".ERR").remove(),ZPChecklist.isValidChecklistFilter()&&($("#"+AutomationCommon.getCurrentPageId()).find("#myChecklistReqTable").html(""),ZPChecklist.getMyChecklistReqData())},isValidChecklistFilter:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());if(pageId.find("#dvFiltersec").is(":visible")){var sDate=pageId.find("#datePicker").val();if(sDate==CUSTOM_DATE){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);if(void 0==dates.from||void 0==dates.to||!Calendar.isvalidDate(dates.from)||!Calendar.isvalidDate(dates.to))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.selectfromandto")+"</div>"),!1;if(Calendar.parseDate(dates.from,uidateFormat)>Calendar.parseDate(dates.to,uidateFormat))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.holiday.datefromtoerror")+"</div>"),!1}}return!0},appendToCheckReqHead:function(data){var pageId=$("#"+AutomationCommon.getCurrentPageId()),listTable="";0==pageId.find("#myChecklistReqTable").find("tbody").children().length?(pageId.find("#myChecklistReqTable").html(""),0==data.length?listTable='<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.checklistnottriggered")+"</h2></div>":(listTable='<div class="table-responsive"><table class="table table-hover"><thead><thead><tr><th width="20"></th>',listTable+="<th><span>"+ZPI18N.getString("zp.workflow.checklist")+'</span></th><th width="32%">'+ZPI18N.getString("zp.status")+"</th></tr></thead><tbody>",listTable+=ZPChecklist.constructMyChecklistReq(data)+"</tbody></table>"),pageId.find("#myChecklistReqTable").append(listTable),ZPChecklist.setup()):(listTable=ZPChecklist.constructMyChecklistReq(data),listTable=ZPChecklist.regClickEvents($(listTable)),pageId.find("#myChecklistReqTable").find("tbody").append(listTable)),data.length==CHECKLIST_REC_PERPAGE&&ZPeople.FireScroll.reset()},constructMyChecklistReq:function(data){var listTable="",triggerDetail="",status="",employeePhoto="",empId="",relatedRecordOwnerName="";return $.each(data,function(){void 0!=this.related_recordOwnerDetails&&void 0!=this.related_recordOwnerDetails.employeePhoto?(employeePhoto=this.related_recordOwnerDetails.employeePhoto,empId=this.related_recordOwnerDetails.employeeID,relatedRecordOwnerName=this.related_recordOwnerDetails.name):(employeePhoto=this.recordOwnerDetails.employeePhoto,empId=this.recordOwnerDetails.employeeID,relatedRecordOwnerName=this.recordOwnerDetails.name),status=this.isCompleted?'<div class="grn">'+ZPI18N.getString("zp.completed")+"</div>":'<div class="org">'+ZPI18N.getString("zp.inprogress")+"</div>",triggerDetail=ZPChecklist.getMyreqTriggerInfo(this),listTable+='<tr><td></td><td><div class="FL MR10"data-toggle="tooltip" data-placement="top" data-container="body" data-original-title="'+empId+" - "+relatedRecordOwnerName+'"><img src="'+employeePhoto+'" class="Usrimg FL MR10 MT5" /></div><div class="tragcont PL0"><a class="lnk ZPbold S15" checkrootid='+this.checkItemRootId+" recordid="+this.recordId+' data-toggle="modal">'+this.checklistName+"</a>",listTable+='<p class="S13">'+triggerDetail+"</p>",listTable+="</div></td><td>"+status+"</td></tr>"}),listTable},getChecklistsForRecord:function(recordId,formId){void 0===recordId&&(recordId=ZPForm.CURRFORM_PARAM.recordId,formId=ZPForm.CURRFORM_PARAM.formId);var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#rootTaskTriggerDtlsPage").is(":visible")||ZPChecklist.setup(),pageId.find("#zp_addedit_record_"+formId).remove();var rootTaskPage=pageId.find("#rootTaskTriggerDtlsPage");$(rootTaskPage.find("#checkrootList").children(0)).show(),rootTaskPage.find("#checkrootList").children().remove(),$(rootTaskPage.find("#checkrootList").children(0)).hide();var params={method:"getCheckItemRootDetails",recordId:recordId,conreqcsr:csrfToken};$.post("/getCheckitemRootDetails.zp",params,function(data){if(0!==data.length)$.each(data,function(index,checklistRoot){var checkroot=ZPChecklist.constructChecklistRoot(checklistRoot);ZPChecklist.regClickEvents(checkroot)}),rootTaskPage.find("#checkrootList").children().click(function(){$(this).siblings().find(".collapse.in").parent().children().find("tr").click(),Task.getCheckRootTasks(this)}),$(rootTaskPage.find("#checkrootList").children()[0]).find("tr").click(),$(rootTaskPage.find("#checkrootList").children()[0]).children().attr("class","dvchkhead");else{var placeToAppend=$("#"+AutomationCommon.getCurrentPageId()).find("div.modal-body:visible#checkrootList");placeToAppend.children().hide(),placeToAppend.append('<div class="ZPNdata"><div id="nochecklist"></div><p class="no-para">'+ZPI18N.getString("zp.nochecklistsassociated")+"</p></div>"),ZPUtil.noDataSVG("nochecklist","newzp/images/svg/no-records.svg")}rootTaskPage.modal({backdrop:"static"}),$($(".modal-backdrop")[1]).remove()}),ZPForm.CURRFORM_PARAM.recordId=recordId,ZPForm.CURRFORM_PARAM.formId=formId,$("#"+AutomationCommon.getCurrentPageId()).find("#rootClose").click(function(){$(".modal-backdrop").remove(),ZPACommon.viewRecord(formId,recordId,"",!0)})},checklistTriggerData:function(getThis){var pageId=$("#"+AutomationCommon.getCurrentPageId()),rootTaskPage=pageId.find("#rootTaskTriggerDtlsPage");0===rootTaskPage.length&&(pageId.append(ZPChecklist.CHECKITEMROOT_TEMPLATE),rootTaskPage=pageId.find("#rootTaskTriggerDtlsPage")),rootTaskPage.modal({backdrop:"static"}),pageId.find("#checkrootList").children().remove();var rootDetail=$(getThis).parent().parent().parent().clone(),currentCheckrootDummy=$($("#"+AutomationCommon.getCurrentPageId()).find("#rootTaskTriggerDtlsPage").find("#checkrootList").siblings(".row")).clone(),currentCheckroot=currentCheckrootDummy.cloneRow("#checkrootList");currentCheckroot.find("tr").replaceWith(rootDetail),currentCheckroot.attr("id","taskRootDiv"),rootTaskPage.find("#taskRootDiv").attr("checkrootid",$(getThis).attr("checkrootid")),Task.getCheckRootTasks(rootTaskPage.find("#taskRootDiv"),!0)},constructChecklistRoot:function(data){var status=data.checklist.isCompleted?'<div class="grn">'+ZPI18N.getString("zp.completed")+'</div><span class="gry"> '+ZPI18N.getString("zp.on")+"</span> "+data.checklist.endTime:'<div class="org">'+ZPI18N.getString("zp.inprogress")+"</div>",recordOwnerDetails=data.recordOwnerDetails,checklistDisplayName=data.checklist.checklistName;data.isCommentSlide=!0;var triggerInfo=ZPI18N.getString(ZPChecklist.triggerInfo(data),["",'<a name="record" onclick="ZPChecklist.viewRecord(\''+data.checklist.formId+"', '"+data.checklist.recordId+"')\">"+data.checklist.formName+"</a>"]),currentCheckrootDummy=$($("#"+AutomationCommon.getCurrentPageId()).find("#rootTaskTriggerDtlsPage").find("#checkrootList").siblings(".row")).clone(),currentCheckroot=currentCheckrootDummy.cloneRow("#checkrootList"),employeePhoto="",empId="",empName="";return void 0!=data.related_recordOwnerDetails&&void 0!=data.related_recordOwnerDetails.employeePhoto?(employeePhoto=data.related_recordOwnerDetails.employeePhoto,empId=data.related_recordOwnerDetails.employeeID,empName=data.related_recordOwnerDetails.name):(employeePhoto=recordOwnerDetails.employeePhoto,empId=recordOwnerDetails.employeeID,empName=recordOwnerDetails.name),currentCheckroot.attr("checkRootId",data.checklist.checkItemRootId),currentCheckroot.attr("recordId",data.checklist.recordId),currentCheckroot.find("#taskClName").text(ZPeople.decodeTxt(checklistDisplayName)),currentCheckroot.find("#taskOwnerImg").attr("src",employeePhoto),currentCheckroot.find("#taskOwnerImg").parent().attr("data-original-title",empId+" - "+ZPeople.decodeTxt(empName)),currentCheckroot.find("#rootStatus").html(status),currentCheckroot.find("#myReqTriggerInfo").html(triggerInfo),currentCheckroot.find("#taskForm").text(data.formName),currentCheckroot},getChecklistItem:function(getThis,callback){var checklistId=$(getThis).attr("checkrootId"),pageId=$("#"+AutomationCommon.getCurrentPageId());if(0==pageId.find("#taskRootDiv_"+checklistId).length||callback){var recordId=$(getThis).attr("recordId");$(getThis).attr("id","taskRootDiv_"+checklistId),$(getThis).find("tr").find("#taskClName").addClass("CP").attr("data-target","#taskDtlsDiv_"+checklistId),$(getThis).find("#taskDtlsDiv").attr("id","taskDtlsDiv_"+checklistId);var params={method:"getChecklistTriggerData",recordId:recordId,checklistId:checklistId,conreqcsr:csrfToken};$.ajax({url:"/getClTriggerData.zp",type:"POST",data:params,success:function(data){void 0!=data.checklist&&(ZPChecklist.taskParentDtls=data,1==callback?(pageId.find("#checkrootList").children().remove(),getThis=ZPChecklist.constructChecklistRoot(ZPChecklist.taskParentDtls),$.each(data.parentDtls[0],function(index,parentTaskId){$(getThis).find("ul").append(ZPChecklist.taskDtlsRecursion(parentTaskId)),ZPChecklist.regClickEvents($(getThis))})):$.each(data.parentDtls[0],function(index,parentTaskId){$(getThis).find("#taskDtlsDiv_"+checklistId).find("ul").append(ZPChecklist.taskDtlsRecursion(parentTaskId))}))}})}},taskDtlsRecursion:function(taskItemId){var taskParentDtls=ZPChecklist.taskParentDtls.parentDtls,checklistItemDtls=ZPChecklist.taskParentDtls.checklistItem[taskItemId],taskChildArray=taskParentDtls[taskItemId],li=ZPChecklist.getTaskDtlsRecHtml(checklistItemDtls);if(void 0===taskChildArray)return li;var parentDiv=li.append($("<ul>",{parentTask:taskItemId}));return $.each(taskChildArray,function(index,childTaskItem){parentDiv.find("ul[parentTask='"+taskItemId+"']").append(ZPChecklist.taskDtlsRecursion(childTaskItem))}),parentDiv},getTaskDtlsRecHtml:function(checklistItemDtls){var isComp=-1,action=ZPI18N.getString("zp.chkyettostart"),statusColor="org",process="",date="",li="",isValidChecklistItem=!0;if(checklistItemDtls.isCompleted===!0?(isComp=1,action=ZPI18N.getString("zp.completed"),process=ZPI18N.getString("zp.on"),date=checklistItemDtls.actualEndTime,statusColor="grn"):checklistItemDtls.isCompleted===!1?(isComp=0,checklistItemDtls.isOverDue===!0?(action=ZPI18N.getString("zp.overdue"),statusColor="red",process=ZPI18N.getString("zp.wasdueon")):(action=ZPI18N.getString("zp.chkinprogress"),statusColor="org",process=ZPI18N.getString("zp.dueon")),date=checklistItemDtls.endDate):void 0==checklistItemDtls.parentCheckItemId||0==checklistItemDtls.parentCheckItemId?isValidChecklistItem=!1:void 0!=checklistItemDtls.parentCheckItemId&&(isValidChecklistItem=!ZPChecklist.taskParentDtls.checklistItem[checklistItemDtls.parentCheckItemId].isCompleted),isValidChecklistItem){var cmtlink="";void 0!=checklistItemDtls.checkItemDataId&&(cmtlink='name="cmtlink" checkitemdataid=\''+checklistItemDtls.checkItemDataId+"'");var col1='<div class="collst1"> <div class="PT10 PL15"><a  class="lnk" '+cmtlink+">"+checklistItemDtls.displayName+"</a></div></div>",col2='<div class="collst2"></div>',col3='<div class="collst3"> <div class="PT5 PB3 '+statusColor+'">'+action+'</div><span class="gry">'+process+"</span> "+date+" </div>";li=$("<li>",{id:checklistItemDtls.checklistItemId}),li.append(col1,col2,col3),li.find("[name=cmtlink]").click(function(){ZPChecklist.commentSlide($(this).attr("checkitemdataid"))})}return li},getMyreqTriggerInfo:function(obj){var triggerDetail="";if(void 0!=obj.workflowdetails)switch(obj.workflowdetails.action){case WF_ACTION_ADD:triggerDetail="zp.triggerreqmessageadd";break;case WF_ACTION_EDIT:triggerDetail="zp.triggerreqmessageedit";break;case WF_ACTION_DELETE:triggerDetail="zp.triggerreqmessagedelete";break;case WF_ACTION_APPROVE:triggerDetail="zp.triggerreqmessageapprove";break;case WF_ACTION_REJECT:triggerDetail="zp.triggerreqmessagereject";break;case WF_ACTION_ADDOREDIT:triggerDetail="zp.triggerreqmessageaddoredit";break;case WF_ACTION_FIELDVALUECHANGE:triggerDetail="zp.triggerreqmessagefieldvalue";break;case WF_ACTION_REMINDER:triggerDetail="zp.triggerreqmessageremainder"}else triggerDetail="zp.triggerreqmessageadd";return ZPI18N.getString(triggerDetail,['<a name="record" formid=\''+obj.formId+"' recordid='"+obj.recordId+"'>"+obj.formName+"</a>",obj.startDate])},setup:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.append(ZPChecklist.CHECKITEMROOT_TEMPLATE),ZPChecklist.regClickEvents()},regClickEvents:function(obj){return obj=void 0==obj?$("#"+AutomationCommon.getCurrentPageId()):obj,obj.find("[name=record]").click(function(){ZPChecklist.viewRecord($(this).attr("formid"),$(this).attr("recordid"))}),obj.find("[name=commentlink]").click(function(){ZPChecklist.commentSlide($(this).attr("checkitemdataid"))}),obj.find("a[checkrootid]").click(function(){ZPChecklist.checklistTriggerData(this),ZPChecklist.rootLink=this}),obj}},ZPTasks={loadHeader:function(){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash;Task.getTaskFormid(),Task.getOptionValues(),Task.getStatusOptionValuesBySysVal(),pageId.removeClass("zp_Pshw"),AdvancedFilter.hideFilter(),Layout.CustomizedUrl.isService()&&pageId.find("#add_task_btn").addClass("zp_dyn"),-1!==url.indexOf("mytask/addtask")||-1!==url.indexOf("alltask/addtask")?Task.createNewTask():-1!==url.indexOf("task/mytask")?(pageId.find("#tasklist_header").text(ZPI18N.getString("zp.mytasks")),ZPTasks.viewType="list",(void 0==ZPTasks.resetMyTask||ZPTasks.resetMyTask)&&ZPTasks.getMyTasks("reset")):-1!==url.indexOf("task/alltask")||Layout.CustomizedUrl.isService()&&-1!==url.indexOf("/alltask")?(ZPTasks.viewType="list",(void 0==ZPTasks.resetAllTask||ZPTasks.resetAllTask)&&ZPTasks.getAllTasks("reset"),pageId.find("#tasklist_header").text(ZPI18N.getString("zp.alltasks"))):-1!==url.indexOf("task/unassignedtask")?(ZPTasks.viewType="list",(void 0==ZPTasks.resetUnassignedTask||ZPTasks.resetUnassignedTask)&&ZPTasks.getMyTasks("reset"),pageId.find("#tasklist_header").text(ZPI18N.getString("zp.unassigned"))):-1!==url.indexOf("task/tracktask")?(ZPTasks.viewType="list",(void 0==ZPTasks.resetTrackTask||ZPTasks.resetTrackTask)&&ZPTasks.getAllTasks("reset"),pageId.find("#tasklist_header").text(ZPI18N.getString("zp.tracktasks"))):-1!==url.indexOf("task/relatedchecklist")?((void 0==ZPTasks.resetRelatedChecklist||ZPTasks.resetRelatedChecklist)&&ZPTasks.getMyChecklist(),pageId.find("#checklist_header_title").text(ZPI18N.getString("zp.relatedchecklists"))):-1!==url.indexOf("task/trackchecklist")&&((void 0==ZPTasks.resetTrackChecklist||ZPTasks.resetTrackChecklist)&&ZPTasks.getMyChecklist(),pageId.find("#checklist_header_title").text(ZPI18N.getString("zp.trackchecklists"))),(-1!==url.indexOf("mytask/viewtask")||-1!==url.indexOf("alltask/viewtask")||-1!==url.indexOf("unassignedtask/viewtask")||-1!==url.indexOf("tracktask/viewtask"))&&(Task.showTaskDetails(Layout.Page.childUrlParam.taskid),pageId.find("[name=task_slider]").removeClass("zp_tskFl"))},getMyTasks:function(mode){var pageId=$("#"+Layout.Page.pageId),filterBox=pageId.find("#filterOption"),headtag=pageId.find("#headtag"),taskobj={},url=Layout.Page.hash;-1!==url.indexOf("mytask")?ZPTasks.resetMyTask=!1:ZPTasks.resetUnassignedTask=!1,void 0==mode||"reset"!=mode&&"1"!=mode?taskobj.index=pageId.find("#list_container").children().length+1:(pageId.find("#list_container").children().remove(),pageId.find("#list_header").addClass("zp_dyn"),pageId.find("#list_container").append(ZPeople.LOADING_HTML),taskobj.index=1),0!=headtag.length?(CommonTemplates.toCheckEmpty("statusInput_input",taskobj,"status"),CommonTemplates.toCheckEmpty("priorityInput_input",taskobj,"priority"),CommonTemplates.toCheckEmpty("formInput_input",taskobj,"formid"),taskobj.name=filterBox.find("#searchDiv_input").val()):(taskobj.isInitialLoad=!0,-1!==url.indexOf("mytask")&&(taskobj.status=Task.statusBySysVal[Task.OPEN_SYSVALUE].ID)),-1!==url.indexOf("unassignedtask")&&(taskobj.status=Task.UNASSIGNED_SYSVALUE),$.post("/mytasks.zp",{conreqcsr:csrfToken,method:"getMyTasks",criteria:JSON.stringify(taskobj)},function(data){var countBox=pageId.find("#task_count");1==taskobj.index&&((void 0==countBox.attr("reset")||"true"==countBox.attr("reset"))&&ZPTasks.setTaskCount(data.count),pageId.find("#zp_page_loading").remove()),countBox.attr("reset",!0),ZPTasks.cloneTaskRow(data.tasks,"list_container",taskobj.index),data.hasNextPage&&ZPeople.FireScroll.reset()})},getAllTasks:function(mode){var pageId=$("#"+Layout.Page.pageId),filterBox=pageId.find("#filterOption"),headtag=pageId.find("#headtag"),taskobj={},url=Layout.Page.hash;-1!==url.indexOf("tracktask")?(ZPTasks.resetTrackTask=!1,taskobj.isTrack=!0):ZPTasks.resetAllTask=!1,void 0!=mode&&"reset"==mode||"1"==mode?(pageId.find("#list_container").children().remove(),pageId.find("#list_header").addClass("zp_dyn"),pageId.find("#list_container").append(ZPeople.LOADING_HTML),taskobj.index=1):taskobj.index=pageId.find("#list_container").children().length+1,0!=headtag.length?(CommonTemplates.toCheckEmpty("statusInput_input",taskobj,"status"),CommonTemplates.toCheckEmpty("priorityInput_input",taskobj,"priority"),CommonTemplates.toCheckEmpty("taskownerInput_input",taskobj,"erecno"),CommonTemplates.toCheckEmpty("formInput_input",taskobj,"formid"),taskobj.name=filterBox.find("#searchDiv_input").val()):(taskobj.isInitialLoad=!0,taskobj.status=Task.statusBySysVal[Task.OPEN_SYSVALUE].ID+","+Task.UNASSIGNED_SYSVALUE),void 0==taskobj.formid&&Layout.CustomizedUrl.isService()&&(taskobj.service=Layout.CustomizedUrl.getServiceName()),$.post("/alltasks.zp",{conreqcsr:csrfToken,method:"getAllTasks",criteria:JSON.stringify(taskobj)},function(data){var countBox=pageId.find("#task_count");ZPTasks.cloneTaskRow(data.tasks,"list_container",taskobj.index),1==taskobj.index&&((void 0==countBox.attr("reset")||"true"==countBox.attr("reset"))&&ZPTasks.setTaskCount(data.count),pageId.find("#zp_page_loading").remove()),data.hasNextPage&&ZPeople.FireScroll.reset()})},addTask:function(){Task.parentUrl=Layout.Page.hash,window.location.href="#task/mytask/addtask"},getChecklistsForRecord:function(){var recordId=ZPForm.CURRFORM_PARAM.recordId,modalid="record_checklist_"+recordId,pageId=$("#"+Layout.Page.pageId);if(0==pageId.find("#"+modalid).length){var slider='<div class="zp_pv checklist zp_tskFl" name=checklist_slider id='+modalid+'><div class="zp_pwrap"><div class="zp_pvhd zp_miHd"><div class="zp_mark"><span>'+ZPI18N.getString("zp.workflow.checklist")+'</span></div><div class="zp_micn"><ul><li><b><span id="checklist_close"><i class="IC-cls"></i></span></b></li></ul></div></div><div class="zp_pvcnt" id="zp_modal_body"></div></div></div></div>';pageId.append(slider),pageId.find("#checklist_close").click(function(){Layout.Page.container.removeClass("zp_Pshw"),pageId.find("#"+modalid).addClass("zp_dyn")});var params={method:"getCheckItemRootDetails",recordId:recordId,conreqcsr:csrfToken};$.post("/getCheckitemRootDetails.zp",params,function(data){var modalbody=$("#"+Layout.Page.pageId).find("#"+modalid).find("#zp_modal_body");modalbody.children().remove(),modalbody.addClass("zp_Lstwrap"),ZPTasks.constructChecklist(data,modalid),$(modalbody.children()[0]).click()})}else pageId.find("#"+modalid).removeClass("zp_dyn");Layout.Page.container.addClass("zp_Pshw")},getMyChecklist:function(index){var pageId=$("#"+Layout.Page.pageId),filterBox=pageId.find("#filterOption"),headtag=pageId.find("#headtag"),params={mode:"all",conreqcsr:csrfToken},url="";isadmin?(url="/getAdminChecklistReq.zp",params.method="getAdminChecklistReq",params.erecno=erecno):(url="/getMyChecklistReq.zp",params.method="getMyChecklistReq"),0!=headtag.length?(CommonTemplates.toCheckEmpty("clistStatusInput_input",params,"mode"),params.mode=void 0===params.mode||""===params.mode?"all":params.mode,CommonTemplates.toCheckEmpty("clistInitInput_input",params,"erecno"),params.searchString=filterBox.find("#searchDiv_input").val(),CommonTemplates.toCheckEmpty("formInput_input",params,"formId")):params.mode="pending",void 0!=index||0==pageId.find("#checklistHead").children().length?(params.index=1,pageId.find("#checklist_header").addClass("zp_dyn"),pageId.find("#checklistHead").children().remove()):params.index=pageId.find("#checklistHead").children().length+1,-1!=Layout.Page.hash.indexOf("relatedchecklist")?(params.isRelated=!0,ZPTasks.resetRelatedChecklist=!1):ZPTasks.resetTrackChecklist=!1,ZPeople.Request.send(url,params,ZPTasks.constructChecklist),Task.getTaskFormid()},getRootTasks:function(rootId,body){var pageId=$("#"+Layout.Page.pageId);if("true"!=$(body).attr("isexpanded")){$(body).attr("isexpanded",!0);var params={method:"getCheckRootTasks",checkitemrootid:rootId,conreqcsr:csrfToken};$.ajax({url:"/getCheckRootTasks.zp",type:"POST",data:params,success:function(data){ZPTasks.constructRootTaskTree(data.tasks,$(body),rootId),void 0===ZPTasks.expandTrack&&(ZPTasks.expandTrack={}),ZPTasks.expandTrack[rootId]={isExpanded:!0},$(body).click(function(){var toggleObj=pageId.find("[checkrootid="+rootId+"]");toggleObj.last().addClass("zp_dyn"),ZPTasks.expandTrack[rootId].isExpanded=ZPTasks.expandTrack[rootId].isExpanded?!1:!0,pageId.find("[checkrootid="+rootId+"]").slideToggle("slow",function(){ZPTasks.expandTrack[rootId].isExpanded||toggleObj.last().removeClass("zp_dyn")})}),$(body).click()}})}},constructRootTaskTree:function(tasks,body,rootId){for(var pageId=$("#"+Layout.Page.pageId),dispTime="",completeClass="",list="",assignedTo="",imgSrc="",row="",rootRow="",taskOwnerPopup="",priority="",tickMsg="",index=0;index<tasks.length;index++)if(row=tasks[index],dispTime=void 0===row.dispCompletedTime?row.endtime:row.dispCompletedTime,row.iscompleted?(completeClass="zp_cmpl",tickMsg=ZPI18N.getString("zp.reopen")):(completeClass="",tickMsg=ZPI18N.getString("zp.complete")),void 0==row.taskownerdetail?(assignedTo=row.assignedto,imgSrc="<i class=\"IC-user-plu zp_rBf\" name=pick onclick=\"ZPeople.confirm(this,'','zp.taskpickmessage', ZPTasks.pickTask)\" taskid="+row.id+"></i>"):(assignedTo=row.taskownerdetail.employeeID+" - "+row.taskownerdetail.name,taskOwnerPopup='popup="user" empid= '+row.taskownerdetail.zuid,imgSrc='<div class="ZP_photo" '+taskOwnerPopup+"><img src="+row.taskownerdetail.employeePhoto+"></div>"),priority="",row.prioritySysValue==Task.LOW_SYSVALUE?priority='<em class="zp_gbg"></em>':row.prioritySysValue==Task.HIGH_SYSVALUE&&(priority='<em class="zp_rbg"></em>'),list='<div class="zp_Lst '+completeClass+'" onclick="Task.showTaskDetails(\''+row.id+"', "+!0+')" id=pt_'+row.id+" taskid='"+row.id+'\'><div><div class="zp_Ldtl"><div class="zp_Ctre"><i class="IC-task-unchk" data-toggle="tooltip" data-placement="bottom" data-original-title='+tickMsg+' name="completeButton" onclick="ZPTasks.changeStatus(this, ZPACommon.CHECKLIST_MODE)"></i></div><div class="zp_Tdts"><h3>'+priority+row.name+"</h3><em>"+dispTime+'</em></div></div><div class="zp_Lass">'+imgSrc+'</div><div class="zp_Lrgt"><i name=delete class="IC-delete-1px zp_rB" onclick="Task.deleteTaskConfirmation(\''+row.id+"')\"></i></div></div></div>",rootRow=body.siblings("[checkrootid="+rootId+"]"),void 0===row.parenttaskid||0==row.parenttaskid){var bodyToAppend=0==rootRow.length?body:rootRow.last();bodyToAppend.after('<div class="zp_LClst" style="display:none" checkrootid='+rootId+">"+list+"</div>")}else 0!=rootRow.find("[taskid="+row.parenttaskid+"]").length?0==body.siblings().find("#pt_"+row.parenttaskid).next(".zp_LClst").length?body.siblings().find("#pt_"+row.parenttaskid).after('<div class="zp_LClst" style="display:none" checkrootid='+rootId+">"+list+"</div>"):pageId.find("#pt_"+row.parenttaskid).next().append(list):tasks.push(row);$.each(rootRow.find(".zp_Lst"),function(index,taskRow){$(taskRow).hasClass("zp_cmpl")||$(taskRow).next(".zp_LClst").addClass("zp_op5")}),pageId.find("[name=completeButton]").click(function(event){event.stopPropagation()}),pageId.find("[checkrootid="+rootId+"]").find(".zp_LClst").find(".zp_Lst:last").addClass("zp_nbdr"),pageId.find("[name=pick]").click(function(event){event.stopPropagation()}),pageId.find("[name=delete]").click(function(event){event.stopPropagation()})},changeStatus:function(obj,extraParam){var pageId=$("#"+Layout.Page.pageId),rootRow="slider"==extraParam?$(obj).parent().parent():$(obj).parents("div.zp_Lst"),status=rootRow.hasClass("zp_cmpl")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,taskid=rootRow.attr("taskid"),params={taskid:taskid,method:"changeTaskStatus",status:status,conreqcsr:csrfToken},url=Layout.Page.hash;status==Task.OPEN_SYSVALUE?rootRow.removeClass("zp_cmpl"):rootRow.addClass("zp_cmpl"),"slider"!=extraParam&&delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid],Task.getOptionValues(),Task.getStatusOptionValuesBySysVal(),$.post("/changeTasksStatus.zp",params,function(data){if("success"==data.Status){var successmsg=status==Task.OPEN_SYSVALUE?ZPI18N.getString("zp.taskreopenedsuccess"):ZPI18N.getString("zp.taskcompletedsuccess");if(ZPeople.Message.showSuccessMsg(successmsg),Task.resetTaskId=taskid,void 0!=extraParam&&extraParam==ZPACommon.CHECKLIST_MODE||-1!=url.indexOf("checklist")||pageId.find("[name=checklist_slider]").is(":visible")){var currentTaskRow=pageId.find("#pt_"+taskid),statusBar="checklist"==extraParam.MODE?$(pageId.find("[status="+rootRow.parent("[checkrootid]").attr("checkrootid")+"]")[0]):pageId.find("#root_"+currentTaskRow.parent().attr("checkrootid")),completed=parseInt(statusBar.find("#completed_cltask_count").text()),total=parseInt(statusBar.find("#total_cltask_count").text());status==Task.OPEN_SYSVALUE?(completed-=1,currentTaskRow.next(".zp_LClst").addClass("zp_op5"),currentTaskRow.removeClass("zp_cmpl"),currentTaskRow.find("[name=completeButton]").attr("data-original-title",ZPI18N.getString("zp.complete"))):(currentTaskRow.find("[name=completeButton]").attr("data-original-title",ZPI18N.getString("zp.reopen")),completed+=1,currentTaskRow.addClass("zp_cmpl"),currentTaskRow.next().removeClass("zp_op5")),statusBar.find("#completed_cltask_count").text(completed),statusBar.find("[style]").attr("style","width:"+completed/total*100+"%"),!Layout.Page.container.hasClass("zp_Pshw")||-1==url.indexOf("checklist")&&-1==url.indexOf("task")||Task.showTaskDetails(taskid)}if("slider"==extraParam){var fcid=pageId.find("[name=task_slider]").find("[folabel=Status]").attr("id").split("_").pop(),status_optionvalue=Task.getOptionValue(fcid,ZPForm.CURRFORM_PARAM.formId,status);if(pageId.find("[name=task_slider]").find("[folabel=Status]").find("span").text(ZPeople.decodeTxt(status_optionvalue)),status==Task.COMPLETED_SYSVALUE){var currentTime=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),timesplit=currentTime.constructor().split(" ");pageId.find("[name=task_slider]").find("[folabel=Completed_On]").find("span").text(timesplit[1]+" "+timesplit[2]+" "+timesplit[3]+" "+timesplit[4]),pageId.find("[name=task_slider]").find("[folabel=Completed_By]").find("span").text(ZPeople.decodeTxt(ZPeople.getUserDetailsById(erecno).name))}ZPTasks.fillDetailViewPage()}else status!==Task.OPEN_SYSVALUE?rootRow.find("[name=cmplButton]").attr("data-original-title",ZPI18N.getString("zp.reopen")):rootRow.find("[name=cmplButton]").attr("data-original-title",ZPI18N.getString("zp.complete")),!Layout.Page.container.hasClass("zp_Pshw")||-1==url.indexOf("checklist")&&-1==url.indexOf("task")||Task.showTaskDetails(taskid);var count_box=pageId.find("#task_count");if(count_box.is(":visible")){var taskRow=pageId.find("[rowid="+taskid+"]"),statusid=taskRow.attr("statusid"),updated_statusid=Task.statusBySysVal[status].ID,old_status_box=count_box.find("#status_"+statusid),new_status_box=count_box.find("#status_"+updated_statusid),old_count=parseInt(old_status_box.find("#status_count").text()),new_count=parseInt(new_status_box.find("#status_count").text());old_status_box.find("#status_count").text(old_count-1),new_status_box.find("#status_count").text(new_count+1),taskRow.attr("statusid",updated_statusid)}}else ZPeople.Message.showFailureMsg(data.message.Status),status!==Task.OPEN_SYSVALUE?rootRow.removeClass("zp_cmpl"):rootRow.addClass("zp_cmpl")})},pickTask:function(obj){var pageId=$("#"+Layout.Page.pageId),taskid=$(obj).attr("taskid"),params={taskid:taskid,method:"changeTaskOwner",mode:"pickup",conreqcsr:csrfToken};$.post("/changeTaskOwner.zp",params,function(data){if("success"==data.Status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskassignedsuccess")),$(obj).addClass("zp_dyn");var headerBand=$(obj).parents("#detail_pannel");ZPTasks.resetUnassignedTask=!1,0==headerBand.length?($(obj).parent().parent().find("#taskowner_img").html("").append('<img src="'+ZPeople.CURR_USER.avatar+'">'),$(obj).siblings().removeClass("zp_dyn"),delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid],Layout.Page.container.hasClass("zp_Pshw")&&Task.showTaskDetails(taskid)):(ZPForm.refreshRecord(taskid),ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.ownerID[0]=erecno,pageId.find("[folabel=Task_Owner]").find("span").html(ZPeople.CURR_USER.name),ZPTasks.fillDetailViewPage())}else ZPeople.Message.showFailureMsg(data.message)})},constructChecklist:function(data,modalid){var pageId=$("#"+Layout.Page.pageId),body="",bodyToAppend=pageId.find("#checklistHead");$.each(data,function(index,row){void 0!==row.related_recordOwnerDetails&&(body+='<div class="zp_Lst" id="root_'+row.checkItemRootId+'" onclick="ZPTasks.getRootTasks(\''+row.checkItemRootId+'\', this)"><div><div class="zp_Ldtl "><div class="ZP_photo" popup="user" empid="'+row.related_recordOwnerDetails.zuid+'"><img src="'+row.related_recordOwnerDetails.employeePhoto+'"></div><div class="zp_Tdts"><h3>'+row.checklistName+'</h3><p popup="user" empid="'+row.related_recordOwnerDetails.zuid+'">'+row.related_recordOwnerDetails.employeeID+" - "+row.related_recordOwnerDetails.name+'</p><em class="zp_ldot">'+row.initiatedOn+'</em><a class="zp_ldot" name="clist_related_record" onclick="ZPACommon.viewRecord(\''+row.formId+"', '"+row.recordId+"')\">"+row.formName+'</a></div></div><div class="zp_Lass"><div status=\''+row.checkItemRootId+'\'><span class="DB"><font class="zp_bclr" id="completed_cltask_count">'+row.taskcount.completed+'</font>/<font id="total_cltask_count">'+row.taskcount.total+"</font>"+ZPI18N.getString("zp.completed")+'</span><div class="ZPprobar progress MT5I MB0I"><div class="progress-bar ZPprogrs PR" style="width:'+row.taskcount.completed/row.taskcount.total*100+'%"></div></div></div></div><div class="zp_Lrgt"></div></div></div>')}),void 0!==modalid&&void 0===modalid.method&&(bodyToAppend=pageId.find("#"+modalid).find("#zp_modal_body")),0==data.length&&0==bodyToAppend.children().length?bodyToAppend.append(CommonTemplates.noDataSVG("checklistHead",!0,ZPI18N.getString("zp.nodatafound"))):(bodyToAppend.append(body),void 0===modalid||void 0!==modalid.method?(pageId.find("#checklist_header").removeClass("zp_dyn"),data.length==CHECKLIST_REC_PERPAGE&&ZPeople.FireScroll.reset(),bodyToAppend.find("[name=clist_related_record]").click(function(event){event.stopPropagation()})):bodyToAppend.find("[name=clist_related_record]").addClass("zp_dyn"))},cloneTaskRow:function(taskArr,bodyToAppend,index){var currentRow="",pageId=$("#"+Layout.Page.pageId);if(pageId.find("#tasklisthead").removeClass("zp_dyn"),0==taskArr.length)1==index&&pageId.find("#"+bodyToAppend).html("").append(CommonTemplates.noDataSVG("task_container",!0,ZPI18N.getString("zp.notaskforfilter")));else{pageId.find("#list_header").removeClass("zp_dyn");var isFromMytaskPage=-1!=Layout.Page.hash.indexOf("mytask");isFromMytaskPage&&pageId.find("#task_container").find("[name=assignedto]").remove(),$.each(taskArr,function(index,row){currentRow=$("#taskrow").cloneRow("#"+bodyToAppend),currentRow.removeClass("zp_dyn"),currentRow.attr("taskid",row.id),currentRow.attr("statusid",row.statusId),currentRow.attr("onclick",'ZPTasks.viewTaskDetails("'+row.id+'")'),currentRow.find("#task_name").append(row.name),void 0!=row.recordowner?"list"===ZPTasks.viewType&&void 0!=row.recordowner.employeePhoto&&(currentRow.find("#recordowner_name").html(row.recordowner.employeeID+" - "+row.recordowner.name),currentRow.find("#recordowner_img").find("img").attr("src",row.recordowner.employeePhoto),currentRow.find("#recordowner_name, #recordowner_img").attr("empid",row.recordowner.zuid)):void 0!=row.createdBy&&(currentRow.find("#recordowner_name").html(row.createdBy.employeeID+" - "+row.createdBy.name),currentRow.find("#recordowner_img").find("img").attr("src",row.createdBy.employeePhoto),currentRow.find("#recordowner_name, #recordowner_img").attr("empid",row.createdBy.zuid)),void 0!=row.formname?(currentRow.find("#form_name").html(row.formname),currentRow.find("#form_name").attr("onclick",'ZPACommon.viewRecord("'+row.formid+'","'+row.recordid+'","'+row.formtablename+'")'),currentRow.find("#form_name").click(function(event){event.stopPropagation()})):currentRow.find("#form_name").addClass("zp_dyn"),isFromMytaskPage?currentRow.find("#task_assignedto").remove():void 0!==row.taskownerdetail?void 0!=row.taskownerdetail.employeePhoto&&(currentRow.find("#taskowner_img").html("").append('<img src="'+row.taskownerdetail.employeePhoto+'">'),currentRow.find("#taskowner_img").attr("empid",row.taskownerdetail.zuid)):(currentRow.find("#taskowner_img").addClass(CommonTemplates.getColorCode(Task.getShortName(row.assignedto))),currentRow.find("#taskowner_img").html(Task.getShortName(row.assignedto))),void 0===row.taskownerdetail&&(currentRow.find("#task_pick").removeClass("zp_dyn"),currentRow.find("#task_pick").attr("taskid",row.id),currentRow.find("#taskowner_img").addClass("zp_dyn"),currentRow.find("#task_pick").click(function(event){event.stopPropagation()})),currentRow.find("[name=cmplButton]").click(function(event){event.stopPropagation()}),currentRow.attr("rowid",row.id),void 0==row.endtime?currentRow.find("#task_duedate").text(ZPI18N.getString("zp.noduedate")):currentRow.find("#task_duedate").text(row.endtime),currentRow.find("#task_delete").attr("onclick",'Task.deleteTaskConfirmation("'+row.id+'")'),currentRow.find("#task_delete").click(function(event){event.stopPropagation()}),void 0!=row.priority&&(currentRow.find("#task_priority").addClass("zp_dyn"),1===Task.priorityObj[row.priority].SYSVALUE?currentRow.find("#task_priority").removeClass("zp_dyn").addClass("zp_rbg"):3===Task.priorityObj[row.priority].SYSVALUE&&currentRow.find("#task_priority").removeClass("zp_dyn").addClass("zp_gbg")),row.iscompleted?(currentRow.find("[name=cmplButton]").attr("data-original-title",ZPI18N.getString("zp.reopen")),currentRow.addClass("zp_cmpl")):void 0!=row.unassigned&&row.unassigned?(currentRow.find("#pickup").removeClass("zp_dyn"),currentRow.find(".zp_link").click(function(event){event.stopPropagation()}),isadmin&&currentRow.find("#assignedto").removeClass("zp_dyn")):row.isoverdue&&currentRow.find("#task_duedate").addClass("zp_rclr")})}},removeTaskRow:function(result,params){var pageId=$("#"+Layout.Page.pageId);if(7e3===result.code){var url=Layout.Page.hash;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskdeletedsuccessfully")),0!=pageId.find("[id=rt_"+params.recordIds+"]").length?pageId.find("[id=rt_"+params.recordIds+"]").remove():-1!==url.indexOf("task/trackchecklist")?pageId.find("[taskid="+params.recordIds+"]").remove():pageId.find("[taskid="+params.recordIds+"]").remove()}else ZPeople.Message.showFailureMsg(result.message)},getMyTaskCount:function(){var params=($("#"+Layout.Page.pageId),{method:"getMyTaskCount",conreqcsr:csrfToken});$.ajax({url:"/getmytaskcount.zp",type:"POST",async:!1,data:params,success:function(data){ZPTasks.setTaskCount(data)}})},setTaskCount:function(data){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash,statusObj={},isInitialLoad=0==pageId.find("#headtag").length;pageId.find("#task_count").children().remove(),CommonTemplates.toCheckEmpty("statusInput_input",statusObj,"status"),pageId.find("#count_pannel").removeClass("zp_dyn"),0!==data[0].count?($.each(data,function(index,status){if((isInitialLoad||void 0===statusObj.status||-1!==statusObj.status.indexOf(status.option_id))&&(-1===url.indexOf("task/unassignedtask")||-1==status.option_id)){var countBox=pageId.find("#taskcount_box").cloneRow("#task_count");countBox.find("#status_value").html(status.option_value),countBox.find("#status_count").text(status.count),countBox.attr("id","status_"+status.option_id),Task.statusBySysVal[Task.OPEN_SYSVALUE].ID==status.option_id?(countBox.find("#status_count").addClass("zp_bclr"),isInitialLoad&&countBox.addClass("sel")):Task.statusBySysVal[Task.COMPLETED_SYSVALUE].ID==status.option_id&&countBox.find("#status_count").addClass("zp_gclr"),countBox.click(function(){ZPSelect.clearAllValues(pageId.find("#statusInput_input")),0!=status.option_id&&pageId.find("#statusInput_input").zpselect({selectedVal:[{id:status.option_id,text:status.option_value}],checkbox:!0}),Layout.Page.container.find("#aplFltr").trigger("click"),countBox.addClass("sel"),countBox.siblings().removeClass("sel"),pageId.find("#task_count").attr("reset",!1)})}}),2==pageId.find("#task_count").children().length&&$(pageId.find("#task_count").children()[0]).addClass("zp_dyn"),-1!=url.indexOf("task/mytask")&&pageId.find("#status_-1").addClass("zp_dyn")):pageId.find("#count_pannel").addClass("zp_dyn")},viewTaskDetails:function(taskid){var url=Layout.Page.hash,selectedRow=$("#"+Layout.Page.pageId).find(".zp_Lst[taskid="+taskid+"]");selectedRow.addClass("sel"),selectedRow.siblings().removeClass("sel"),-1!==url.indexOf("task/mytask")||-1!==url.indexOf("task/alltask")||-1!==url.indexOf("task/unassignedtask")||-1!==url.indexOf("task/tracktask")?window.location.href=Layout.Page.hash.split("/viewtask")[0]+"/viewtask-taskid:"+taskid:Task.showTaskDetails(taskid,!0)},backToListView:function(){var url=Layout.Page.hash;window.location.href=url.split("/")[0]+"/"+url.split("/")[1]},switchView:function(obj){if(!$(obj).hasClass("sel")){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash;$(obj).siblings().removeClass("sel"),$(obj).addClass("sel"),pageId.find("#taskpreview").removeClass("zp_kanb"),pageId.find("#taskhead").find(".zp_lwrap").remove();var view=$(obj).attr("view");-1!==url.indexOf("task/mytask")?"list"===view?(ZPTasks.viewType="list",ZPTasks.getMyTasks("reset")):"kanban"===view&&(ZPTasks.viewType="kanban",ZPTasks.getMyKanbanView("Status")):-1!==url.indexOf("task/alltask")&&("list"===view?(ZPTasks.viewType="list",ZPTasks.getAllTasks("reset")):"kanban"===view&&(ZPTasks.viewType="kanban",ZPTasks.getAllKanbanView("Status")))}},getViewList:function(obj){var pageId=$("#"+Layout.Page.pageId),prevMode=pageId.find("#taskhead").attr("mode");$(obj).attr("selectedids",prevMode);var LIST=[{id:"Status",value:ZPI18N.getString("zp.status")},{id:"Priority",value:ZPI18N.getString("zp.priority")}];$(obj).zpmenu({dropdownclass:"zp_drop",scrollclass:"ob_center",level:1,id:"viewList",data:LIST,callback:ZPTasks.switchKanbType})},switchKanbType:function(obj){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash;$(obj).addClass("sel"),$(obj).siblings().removeClass("sel"),pageId.find(".zp_lwrap").remove(),-1!==url.indexOf("task/mytask")?ZPTasks.getMyKanbanView($(obj).attr("id")):-1!==url.indexOf("task/alltask")&&ZPTasks.getAllKanbanView($(obj).attr("id"))},getMyKanbanView:function(mode){var pageId=$("#"+Layout.Page.pageId),taskobj={},ddobj={};taskobj.status="",taskobj.priority="",pageId.find("#taskhead").children().remove(),$.ajax({url:"/mykanbanview.zp",type:"POST",async:!1,data:{conreqcsr:csrfToken,method:"getMyKanbanView",mode:mode,criteria:JSON.stringify(taskobj)},success:function(data){pageId.find("#taskpreview").addClass("zp_kanb"),pageId.find("#taskhead").attr("mode",mode),ddobj.fcid=Object.keys(data)[0],ddobj.mode=mode,ddobj.callback=ZPTasks.doAfterKanbUpdate,ddobj.formid=Task.taskformid,ddobj.tablename="P_Task";var columnNo=1;$.each(data[ddobj.fcid],function(val,rows){var columnId=pageId.find("#taskhead").createNewColumn(!0,val,ddobj.mode+columnNo++);ZPTasks.cloneTaskRow(rows.tasks,columnId+" .zp_liscr")})}}),pageId.find("#taskhead").createDragAndDrop(ddobj)},getAllKanbanView:function(mode){var pageId=$("#"+Layout.Page.pageId),taskobj={},ddobj={};taskobj.status="",taskobj.priority="",pageId.find("#taskhead").children().remove(),$.ajax({url:"/allkanbanview.zp",type:"POST",async:!1,data:{conreqcsr:csrfToken,method:"getAllKanbanView",mode:mode,criteria:JSON.stringify(taskobj)},success:function(data){pageId.find("#taskpreview").addClass("zp_kanb"),pageId.find("#taskhead").attr("mode",mode),ddobj.fcid=Object.keys(data)[0],ddobj.mode=mode,ddobj.callback=ZPTasks.doAfterKanbUpdate,ddobj.formid=Task.taskformid,ddobj.tablename="P_Task";var columnNo=1;$.each(data[ddobj.fcid],function(val,rows){var columnId=pageId.find("#taskhead").createNewColumn(!0,val,ddobj.mode+columnNo++);ZPTasks.cloneTaskRow(rows.tasks,columnId+" .zp_liscr")})}}),pageId.find("#taskhead").createDragAndDrop(ddobj)},updateField:function(data){var params={};params.loginUserZUID=_LOGGEDIN_ZUID,params.zp_tableName=data.tablename,params.zp_formId=data.formid,params.zp_mode="updateRecord",params.zp_recordId=data.rowid,params.isSingleEdit=!0,params.fcId=data.fcid,params.isDraft=!1,params.conreqcsr=csrfToken,params[data.mode]=$(data.to).parent().val(),data.callback(data),$.ajax({url:"/addUpdateRecord.zp",type:"POST",async:!1,data:params,success:function(result){}})},fillDetailViewPage:function(){var page=ZPForm.LAYOUT.data().curpageid,pageId=$("#"+Layout.Page.pageId).find("#"+page),duedate=$(pageId.find("[folabel=Due_Date]").find("span")[0]).text(),taskname=$(pageId.find("[folabel=Task_Name]").find("span")[0]).text();"-"!==duedate?pageId.find("#tdtls_duedate").text(duedate):pageId.find("#tdtls_duedate").text(ZPI18N.getString("zp.noduedate")),pageId.find("#tdtls_taskname").text(taskname),pageId.find("[name=tdtls_complete]").removeClass("zp_dyn"),-1!==page.indexOf("relfielsingle")&&pageId.find("#task_closebutton").attr("onclick","ZPForm.Field.formCloseBtn()"),Task.taskformid=ZPForm.CURRFORM_PARAM.formId,pageId.find("#tdtls_initiator").html("").append("<em>"+ZPI18N.getString("zp.initiatedby")+"</em>"+ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.cAuditInfo.cInfo.user.dispName),pageId.find(".modal-footer").remove(),$(pageId.find("#zp_form_outer_container").find("H3")[0]).addClass("zp_dyn");var status=$(pageId.find("[folabel=Status]").find("span")[0]).text(),status_sysvalue=Task.getSysValue(pageId.find("[folabel=Status]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,status),status_color="";status_sysvalue==Task.COMPLETED_SYSVALUE?(status_color="zp_gclr",pageId.find("#taskDtlsHeader").addClass("zp_cmpl"),pageId.find("[name=tdtls_complete]").attr("data-original-title",ZPI18N.getString("zp.reopen")),pageId.find("[folabel=Completed_On]").parent().removeClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().removeClass("zp_dyn"),"-"===pageId.find("[folabel=Task_Owner]").find("span").text()&&pageId.find("[folabel=Task_Owner]").find("span").html(ZPeople.CURR_USER.name)):(pageId.find("#taskDtlsHeader").removeClass("zp_cmpl"),pageId.find("[name=tdtls_complete]").attr("data-original-title",ZPI18N.getString("zp.complete")),pageId.find("[folabel=Completed_On]").parent().addClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().addClass("zp_dyn")),pageId.find("#tdtls_status").text(status).parent().attr("class",status_color);var taskrow=0!=$("#"+Layout.Page.pageId).find("#MYPENDINGTASKS").length?$("#"+Layout.Page.pageId).find("#rt_"+ZPForm.CURRFORM_PARAM.recordId):$("#"+Layout.Page.pageId).find("#list_container").find("[taskid="+ZPForm.CURRFORM_PARAM.recordId+"]"),taskowner=$(pageId.find("[folabel=Task_Owner]").find("span")[0]).text();if("-"!=taskowner){var taskownererecno="";if(pageId.find("#tdtls_taskowner").text(taskowner),pageId.find("#tdtls_taskowner_image").addClass(CommonTemplates.getColorCode(Task.getShortName(taskowner))),pageId.find("#tdtls_taskowner_image").html(Task.getShortName(taskowner)),pageId.find("[folabel=Assigned_To]").parent().addClass("zp_dyn"),taskrow.find("[name=pickButton]").remove(),pageId.find("#detail_pannel").find("[name=pickButton]").remove(),void 0!==pageId.find("[folabel=Task_Owner]").find("select").val())taskownererecno=pageId.find("[folabel=Task_Owner]").find("select").val();else if(void 0!==ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId]){var owner=ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.ownerID;taskownererecno=owner[0],ZPForm.Permission.isAllowed(owner,ZPForm.Permission.getEditPerm())||(pageId.find("#task_editicon").remove(),pageId.find("#completebutton").remove())}""!==taskownererecno&&pageId.find("#tdtls_taskowner_image").html("").append('<img src="'+ZPeople.getUserDetailsById(taskownererecno).avatar+'">')}else{var assignedTo=ZPeople.escapeHtml($(pageId.find("[folabel=Assigned_To]").find("span")[0]).text());pageId.find("#tdtls_taskowner").html(assignedTo).after('<i name="pickButton" class="IC-user-plu zp_rB" taskid="'+ZPForm.CURRFORM_PARAM.recordId+"\"  onclick=\"ZPeople.confirm(this,'','zp.taskpickmessage', ZPTasks.pickTask)\"></i>"),pageId.find("[folabel=Assigned_To]").parent().removeClass("zp_dyn"),pageId.find("#tdtls_taskowner_image").addClass(CommonTemplates.getColorCode(Task.getShortName(assignedTo))),pageId.find("#tdtls_taskowner_image").html(Task.getShortName(assignedTo))}pageId.find("#completebutton,#tdtls_taskname,#task_editicon").removeClass("zp_dyn"),pageId.find("#detail_pannel").removeClass("zp_dyn"),pageId.find("#taskDtlsHeader").attr("taskid",ZPForm.CURRFORM_PARAM.recordId),ZPACommon.showSlideBodyContent();var priority_sysvalue=Task.getSysValue(pageId.find("[folabel=Priority]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,$(pageId.find("[folabel=Priority]").find("span")[0]).text());0!=taskrow.length&&(taskrow.find("#task_priority").attr("class","zp_dyn"),priority_sysvalue==Task.LOW_SYSVALUE?taskrow.find("#task_priority").attr("class","zp_gbg"):priority_sysvalue==Task.HIGH_SYSVALUE&&taskrow.find("#task_priority").attr("class","zp_rbg"),status_sysvalue==Task.COMPLETED_SYSVALUE?taskrow.addClass("zp_cmpl"):taskrow.removeClass("zp_cmpl"),taskrow.addClass("sel"),taskrow.siblings().removeClass("sel"),""!==taskname&&taskrow.find("#task_priority").next(taskname))},closePreview:function(){var url=Layout.Page.hash,pageid=$("#"+Layout.Page.pageId);pageid.find("#commentSlideBody div[id^='zp_addedit_record_']").attr("id","taskFormPage"),pageid.find("#list_container").find(".zp_Lst").removeClass("sel"),Task.isPreviewClosed=!0,pageid.find("#caseDtls").is(":visible")?pageid.find("#caseDtls").siblings("[name=task_slider]").addClass("zp_dyn"):pageid.find("[name=checklist_slider]").is(":visible")?pageid.find("[name=checklist_slider]").siblings("[name=task_slider]").addClass("zp_dyn"):Layout.Page.container.removeClass("zp_Pshw"),void 0!==Task.resetTaskId&&""!==Task.resetTaskId&&(delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+Task.resetTaskId],Task.resetTaskId=""),-1!==url.indexOf("task/mytask")||-1!==url.indexOf("task/alltask")||-1!==url.indexOf("task/unassignedtask")||-1!==url.indexOf("task/tracktask")?ZPTasks.backToListView():-1!==url.indexOf("task/list")&&(window.location.href="#task/list-formId:"+ZPView.CURR_VIEWPARAMS.formId+"/viewId:"+ZPView.CURR_VIEWPARAMS.viewId)},initiateFilter:function(){var url=Layout.Page.hash,filterArr=[],callback=($("#"+Layout.Page.pageId).find("#task_filter"),"");ZPACommon.getFormList(CHECKLIST_MODE),-1==url.indexOf("checklist")?(filterArr.push({parentDiv:"searchDiv",type:"search",title:ZPI18N.getString("zp.entertaskname")}),filterArr.push({parentDiv:"priorityInput",type:"select",menuProperties:ZPTasks.filterDropDown("priority"),title:ZPI18N.getString("zp.priority")}),filterArr.push({parentDiv:"formInput",type:"select",menuProperties:ZPTasks.filterDropDown("form"),title:ZPI18N.getString("zp.relatedforms")}),callback=ZPTasks.getMyTasks,-1!==url.indexOf("alltask")?(filterArr.push({parentDiv:"taskownerInput",type:"select",menuProperties:ZPTasks.filterDropDown("taskowner"),title:ZPI18N.getString("zp.taskowner")}),callback=ZPTasks.getAllTasks):-1!==url.indexOf("tracktask")&&(callback=ZPTasks.getAllTasks),-1===url.indexOf("unassignedtask")&&filterArr.push({parentDiv:"statusInput",type:"select",menuProperties:ZPTasks.filterDropDown("status"),title:ZPI18N.getString("zp.status")})):(filterArr.push({parentDiv:"searchDiv",type:"search",title:ZPI18N.getString("zp.enterchecklistname")}),filterArr.push({parentDiv:"clistStatusInput",type:"select",menuProperties:ZPTasks.filterDropDown("clist_status"),title:ZPI18N.getString("zp.status")}),filterArr.push({parentDiv:"formInput",type:"select",menuProperties:ZPTasks.filterDropDown("form"),title:ZPI18N.getString("zp.relatedforms")}),callback=ZPTasks.getMyChecklist,isadmin&&filterArr.push({parentDiv:"clistInitInput",type:"select",menuProperties:ZPTasks.filterDropDown("taskowner"),title:ZPI18N.getString("zp.checklistinitiator")})),AdvancedFilter.constructFilter(filterArr,callback)},filterDropDown:function(mode){if("taskowner"===mode){var taskOwnerObj={id:"taskowner_list",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","TASKS_VIEW")},checkbox:!0};return taskOwnerObj}if("status"===mode){var statusArr=[];return $.each(Task.statusArray,function(key,value){var param={id:value.ID,value:value.DISPVALUE};statusArr.push(param)}),{id:"mainmenu",data:statusArr,checkbox:!0}}if("priority"===mode){var priorityArr=[];return $.each(Task.priorityArray,function(key,value){var param={id:value.ID,value:value.DISPVALUE};priorityArr.push(param)}),{id:"mainmenu",data:priorityArr,checkbox:!0}}if("form"===mode){var formArr=[],formMode=CHECKLIST_MODE;return Layout.CustomizedUrl.isService()&&(formMode+="_"+Layout.CustomizedUrl.getServiceName()),$.each(ZPACommon[formMode+"_formList"],function(key,value){var param={id:value.formId,value:value.dispName};formArr.push(param)}),{id:"mainmenu",data:formArr,checkbox:!0}}if("clist_status"===mode){var statusArr=[];return statusArr.push({id:"completed",value:ZPI18N.getString("zp.completed")}),statusArr.push({id:"pending",value:ZPI18N.getString("zp.pending")}),{id:"mainmenu",data:statusArr,checkbox:!1}}},doAfterKanbUpdate:function(rowdetail){var currentVal=$(rowdetail.to).parent().val(),currentSysVal="";"Priority"===rowdetail.mode?(currentSysVal=Task.priorityObj[currentVal].SYSVALUE,1===currentSysVal?rowdetail.updatedRow.find(".zplicn").find("i").attr("class","IC-task-unchk zp_rclr"):3===currentSysVal?rowdetail.updatedRow.find(".zplicn").find("i").attr("class","IC-task-unchk zp_oclr"):rowdetail.updatedRow.find(".zplicn").find("i").attr("class","IC-task-unchk")):"Status"===rowdetail.mode&&(currentSysVal=Task.statusObj[currentVal].SYSVALUE,2===currentSysVal?rowdetail.updatedRow.addClass("zp_cmpl"):rowdetail.updatedRow.removeClass("zp_cmpl"))},constructWidgetTasks:function(taskDetails){var pageId=$("#"+Layout.Page.pageId),taskRowsContainer=pageId.find("#MYPENDINGTASKS"),quickui="",pendingCount=taskDetails.count[0].count;0!==pendingCount?(quickui='<div class="zp_Task" id="rt_table"><div class="zp_TLst"><ul><li id="newquicktask" class="zp_dyn"><i class="IC-task-unchk" onclick="Task.addQuickTask(Task.COMPLETED_SYSVALUE)"></i><div class="zp_txtbx"><input type="textbox" id="quicktaskname"></div><div class="ZP_photo" id="tUser" ownervalueid='+erecno+' onclick="Dropdown.taskUserdropdown(this)"><img src='+ZPeople.CURR_USER.avatar+'></div><div class="zp_txtbx"><input class="zp_ntsk" type="textbox" id="quicktaskdue" caltype ='+Task.getCalType()+'  onclick="Calendar.setUpCalendar(event,this,null,null,Task.addTaskByDate)"></div></li></ul></div>',taskRowsContainer.append(quickui),taskRowsContainer.find("#quicktaskname").attr("placeholder",ZPI18N.getString("zp.taskname")),taskRowsContainer.find("#quicktaskdue").attr("placeholder",ZPI18N.getString("zp.duedate")),Task.cloneRelatedTaskRow(taskDetails.tasks)):(quickui='<div class="dash-noimg"><img src="/newzp/images/zpbee.png" alt=""><h5>'+ZPI18N.getString("zp.notaskforfilter")+"</h5></div>",taskRowsContainer.append(quickui)),taskRowsContainer.find("#zp_page_loading").remove()},widgetFireScroll:function(){var taskobj={},taskBox=$("#"+Layout.Page.pageId).find("#rt_table").find("ul");Task.getStatusOptionValuesBySysVal(),taskobj.status=Task.statusBySysVal[Task.OPEN_SYSVALUE].ID,taskobj.index=taskBox.find("li").length-taskBox.find("li.zp_cmpl").length,$.post("/mytasks.zp",{conreqcsr:csrfToken,method:"getMyTasks",criteria:JSON.stringify(taskobj)},function(data){data.hasNextPage&&ZPeople.FireScroll.reset(),Task.cloneRelatedTaskRow(data.tasks)})},editTaskDetails:function(taskid,labelname,value){var result="",params={};return params.method="editTaskDetail",params.labelname=labelname,params.taskid=taskid,params.value=value,params.conreqcsr=csrfToken,$.ajax({url:"/taskSingleEdit.zp",type:"POST",async:!1,data:params,success:function(data){result=data}}),result}};!function($){$.fn.createNewColumn=function(titleNeeded,title,columnNo){var newColumn="",columnId="listcontainer";return titleNeeded?(columnId="listcontainer_"+columnNo,newColumn=$("<div/>",{"class":"zp_lwrap",id:columnId}),newColumn.append("<div class = 'zp_Tttl' id = 'listtitle'>"+title+"</div><div class = 'zp_liscr'></div>"),newColumn.val(title),newColumn.addClass("zp_Kgybg")):newColumn=$("<div/>",{"class":"zp_lwrap",id:"listcontainer"}),this.append(newColumn),columnId},$.fn.createDragAndDrop=function(ddObj){var pageId=$("#"+Layout.Page.pageId);pageId.find(".zp_liscr").sortable({connectWith:pageId.find(".zp_liscr"),scroll:!0,scrollSensitivity:80,scrollSpeed:3,placeholder:"zpl active",start:function(event,row){ddObj.from=event.target,ddObj.onclickobj=row.item.find(".zpDtl").clone(),row.item.find(".zpDtl").removeAttr("onclick"),pageId.find(".zp_clist").addClass("zp_Kdg")},update:function(event,row){ddObj.to=event.target,ddObj.updatedRow=row.item,ddObj.rowid=row.item.attr("rowid"),pageId.find(".zp_clist").removeClass("zp_Kdg"),$(ddObj.to).find(".no-para").parent().remove(),ddObj.from!==ddObj.to&&ZPTasks.updateField(ddObj),row.item.find(".zpDtl").remove(),row.item.find(".zpLst").append(ddObj.onclickobj)}}).disableSelection()},$.fn.cloneRow=function(bodyToAppend){var obj=this.clone();return obj.removeAttr("id").removeAttr("style").appendTo("#"+Layout.Page.pageId+" "+bodyToAppend),obj}}(jQuery);var ZPACommon={CHECKLIST_MODE:"checklist",TASK_MODE:"task",getUrlMode:function(){var url=this.getUrl(),mode="";return-1!==url.indexOf("/task/list")||-1!==url.indexOf("hrcase/")||-1!==url.indexOf("/delegation/list")?mode="":-1!==url.indexOf("/list")?mode=NewWorkFlow.MODE:-1!==url.indexOf("mailalert")?mode=Mailalerts.MODE:-1!==url.indexOf("/task")?mode=ZPACommon.TASK_MODE:-1!==url.indexOf("/fieldupdate")?mode=Fieldupdate.MODE:-1!==url.indexOf("/checklist")?mode=ZPACommon.CHECKLIST_MODE:-1!==url.indexOf("/webhook")?(mode=Webhook.MODE,-1!==url.indexOf("webhook/failurewebhook")?mode=Webhook.FAILUREMODE:-1!==url.indexOf("webhook/successwebhook")&&(mode=Webhook.SUCCESSMODE)):-1!==url.indexOf("/customfunction")?mode=NewCustomFunction.MODE:-1!==url.indexOf("formslayout/formedit")?mode="formBuilder":-1!==url.indexOf("formslayout/customaction")?mode=CustomAction.MODE:-1!==url.indexOf("timetracker/settings/")?mode="timetracker":-1!==url.indexOf("attendance/settings/regularization")?mode="attendance":-1!==url.indexOf("admin/dashboard")?mode="dashboardSet":-1!==url.indexOf("esign")&&(mode=esign.MODE),mode},getUrl:function(){Layout.Page.hash;return Layout.Page.hash.replace("#admin/automation/workflow","").split("-")[0]},viewRecord:function(formId,pkId,tableName,needUrlTrack){tableName=void 0===tableName||""===tableName?ZPUtil.Form_Link_Names.getFormLinkName(formId,!0):tableName;var params={formId:formId,recordId:pkId,isEmbed:!0,formMode:"VIEW",editCallback:ZPACommon.editRecord};void 0!==needUrlTrack&&needUrlTrack&&-1===Layout.Page.hash.indexOf("task/mytasks")||(params.disableUrlTrack=!0),"P_EmployeeLeave"===tableName||"leave"===tableName?Leave.viewRec(formId,pkId,params):"P_Compensatory"===tableName?Leave.Compensatory.RecordView.get(pkId):"P_HR_Case"===tableName?HRCase.DetailedView.viewCaseDetails(pkId):(-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&(params.callback=ZPApprovals.closePopCallback),ZPForm.load(params))},editRecord:function(){ZPForm.load({formId:ZPForm.CURRFORM_PARAM.formId,recordId:ZPForm.CURRFORM_PARAM.recordId,isEmbed:!0,formMode:"EDIT",disableUrlTrack:!0})},getMode:function(){var parentPage=$parentPageId(),mode="";if($.each(parentPage.find("[type=mainPage]"),function(i,mainDivs){return-1===$(mainDivs).attr("class").indexOf("default")?void(mode=$(mainDivs).parent().attr("id")):void 0}),mode=""===mode||void 0===mode?this.getUrlMode():mode,""===mode){var formSelectObj=parentPage.find("[name=formSelect]"),mode=formSelectObj.attr("mode");void 0!==formSelectObj&&0===formSelectObj.length&&(mode=parentPage.find("#editmode").attr("mode"))}return mode},showEmptyListPage:function(mode,dispMessage){var pageDiv=$("#"+AutomationCommon.getCurrentPageId(mode)),emptyPageMsg="",scrollDiv="div.ZPTscrlcont";0!==pageDiv.find("div.zp_center").length&&(scrollDiv="div.zp_center");var placeToAppend=pageDiv.find(scrollDiv).html("");"pageloading"==mode?emptyPageMsg=ZPeople.LOADING_HTML:(emptyPageMsg='<div class="ZPTscrlcont" id="emptyListPage"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div>',emptyPageMsg+='<p class="PT20 S15">'+dispMessage+"</p></div></div></div></div>"),placeToAppend.append(emptyPageMsg)},hideSlideBodyContent:function(){$pageId().find("#atmn_page_loading").addClass("ctshow")},showSlideBodyContent:function(){$pageId().find("#atmn_page_loading").removeClass("ctshow")},getFormList:function(mode){var param={method:"getFormList",mode:mode,conreqcsr:csrfToken};Layout.CustomizedUrl.isService()&&(param.serviceName=Layout.CustomizedUrl.getServiceName(),mode+="_"+param.serviceName);var getFormsListFromCache=ZPACommon[mode+"_formList"];return void 0!==getFormsListFromCache&&""!==getFormsListFromCache?void(Automation.formList=getFormsListFromCache):void $.ajax({url:"/formlist.zp",type:"POST",data:param,async:!1,success:function(data){Automation.formList=data,ZPACommon[mode+"_formList"]=Automation.formList}})},constructCmtRw:function(cmtData,appndContainer,jsonObj){$("#"+Layout.Page.pageId);cmtData.actOwner=ZPeople.getUserDetailsById(erecno),cmtData.totalComments>3&&(cmtData.viewallcomments=ZPI18N.getString("zp.viewallcomments",[cmtData.totalComments]),cmtData.showMoreCallback=jsonObj.calback),cmtData.subBtnName=jsonObj.subBtnName;var bcontainer=ZPFeeds.Construction.bottomContainerConstruction(cmtData);$(appndContainer).append(bcontainer),(void 0===cmtData||void 0!==cmtData.comments&&0==cmtData.comments.length)&&$(appndContainer).find("#bottomcont").append(ZPFeeds.Construction.constructTextArea(!0,cmtData)),ZPFeeds.Like.iterateLikedUsers(cmtData.likedUsers)}},ADMIN_VIEW="adminView";ZPServices.View={constructHeaderButton:function(hasReference,isAgent,hasFaqList,askUsBtn,isNeedAddRec){var url=($("#"+Layout.Page.pageId),Layout.Page.hash),buttonTag="",buttonhtml="";return hasReference&&(buttonTag+='<button  id="relatedDoc">'+ZPI18N.getString("zp.relateddoc")+"</button>",buttonhtml+='<button  class="zpthm" id="relatedDoc">'+ZPI18N.getString("zp.relateddoc")+"</button>"),askUsBtn&&(buttonTag+='<button  onclick="ZPServices.View.showAskUs()">'+ZPI18N.getString("zp.createcase")+"</button>"),buttonhtml+='<button  class="zpthm" onclick="ZPServices.View.showAskUs()">'+ZPI18N.getString("zp.askaquestion")+"</button>",hasFaqList&&(buttonTag+='<button  onclick="ZPServices.View.faqList()">'+ZPI18N.getString("zp.faq")+"</button>"),-1!==url.indexOf("/dashboard")?html='<div class="zp_btn">'+buttonhtml+"</div>":html='<div class="zp_btn">'+buttonTag+"</div>"},showAskUs:function(){var url=($("#"+Layout.Page.pageId),Layout.Page.hash);$("#addHRCase").length<=0&&$("body").append(HRCaseCommon.askUsHtml()),-1!==url.indexOf("/dashboard")?HRCase.AddCase.resetPage(void 0,$("#userServiceView").attr("categoryid")):HRCase.AddCase.resetPage(void 0,$("#gotoservicebutton").attr("categoryid")),$("#addHRCase").addClass("zp_shw")},serviceViewPage:function(){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hashDtl.hash,serviceName=Layout.Page.hash.split("/")[0].substring(1);if(Layout.UrlConf.isServiceMode||Layout.UrlConf.isSystemService){var categoryprm={serviceName:serviceName,conreqcsr:csrfToken,mode:"serviceView"};$.ajax({url:"/fetchServiceDetails.zp",type:"POST",data:categoryprm,success:function(data){pageId.find("#serviceView").removeClass("zp_dyn"),"failure"!==data.status&&-1!==url.indexOf(serviceName+"/generalsettings")&&ZPServices.View.adminViewPage(data)}})}},adminViewPage:function(data){var pageId=$("#"+Layout.Page.pageId);pageId.addClass("services"),pageId.find("#edSrv").off("click").on("click",function(){ZPServices.Edit.editService(data)}),ZPServices.View.basicTabDetails(data),isadmin?(pageId.find("#tgForm").removeClass("zp_dyn"),pageId.find("#tgForm").off("click").on("click",function(){ZPServices.MoveForms.getFormsSlider(ZPServices.SERVICE_JSON,data.id)})):pageId.find("#tgForm").addClass("zp_dyn");var formsList=data.formIds;pageId.find("#sfrmList").empty();var addFrm=ZPServices.View.addFormHtml();addfrm=addFrm.replace("$SERVICEID$",data.id),pageId.find("#sfrmList").append(addfrm),ZPServices.View.viewFormList(formsList,!1),data.hasOwnProperty("FAQ_LIST")&&pageId.find("#FaqView").empty().append(FAQ.faqList(data.FAQ_LIST,!1,!1,"adminView")),pageId.find("#serviceView").removeClass("zp_dyn"),pageId.find("#userServiceView").addClass("zp_dyn")},formSettingsList:function(pcId,isActive,isDel){var sObj=[];return isActive&&(sObj.push({id:"fCus",value:ZPI18N.getString("zp.customize")}),sObj.push({id:"fPer",value:ZPI18N.getString("zp.permissions")}),sObj.push({id:"fApp",value:ZPI18N.getString("zp.approvals")}),sObj.push({id:"fAut",value:ZPI18N.getString("zp.automation")})),isDel&&sObj.push({id:"delForm",value:ZPI18N.getString("zp.deleteform")}),sObj},settingCallBack:function(dataObj,pcId){var id=$(dataObj).attr("id");switch(id){case"fCus":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.customize,pcId);break;case"fPer":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.permissions,pcId);break;case"fApp":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.approvals,pcId);break;case"fAut":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.automation,pcId);break;case"delForm":ZPeople.BSModal.confirm(function(){ZPServices.Configure.deleteForm(pcId)},"",ZPI18N.getString("zp.formdelconfirm"))}},viewFormList:function(formsList,isAddForm){var pageId=$("#"+Layout.Page.pageId);if(void 0!=formsList&&formsList.length>0){var cnt=0;isAddForm||pageId.find("#sfrmList").find("[formId]").remove(),$.each(formsList,function(i,v){var formsHtml=ZPServices.View.formLstHtml(),alt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(v.dispName)));formsHtml=formsHtml.replace("$PCID$",v.pcId),formsHtml=formsHtml.replace("$FORMALTTEXT$",alt),formsHtml=formsHtml.replace("$FORMNAME$",v.dispName),formsHtml=formsHtml.replace("$FORMCOLOR$",ZPServices.View.getFormBgColor(alt)),pageId.find("#sfrmList").append(formsHtml);var formObj=pageId.find("#sfrmList").find("[formId = "+v.pcId+"]");formObj.find("#enbDisForm").attr("checked",v.isActive),formObj.find("#enbDisForm").attr("checked",v.isActive),v.isActive?formObj.removeClass("zp_dAct"):formObj.addClass("zp_dAct"),v.isActive&&formObj.off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.customize,v.pcId)});var settingsList=ZPServices.View.formSettingsList(v.pcId,v.isActive,v.isCustom);settingsList.length>0?formObj.find("#formSett").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).addClass("zp_shw"),$(this).zparrowmenu({id:"fSett",width:155,position:ZPArrow.RIGHT_TOP,data:settingsList,callbackonclose:function(sourceObj){$(sourceObj).removeClass("zp_shw")},callback:function(dataObj,sourceObj){$(sourceObj).removeClass("zp_shw"),ZPServices.View.settingCallBack(dataObj,v.pcId)}})}):formObj.find("#formSett").remove(),v.isEnableDis?formObj.find("#enbDisForm").closest("label").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();var obj=$(this),isActive=$(obj).find("#enbDisForm").is(":checked");isActive?ZPeople.BSModal.confirm(function(){ZPServices.Configure.enabledisableForm(v,isActive,obj)},"",ZPI18N.getString("zp.disableform")):ZPServices.Configure.enabledisableForm(v,isActive,obj)}):formObj.find(".zp_SFswtch").remove(),cnt+=1})}},basicTabDetails:function(data){var pageId=$("#"+Layout.Page.pageId);pageId.find("#serviceView").attr("categoryId",data.categoryId),pageId.find("#cgeName").html(data.dispName);var desc=""!=data.desc.trim()?data.desc:CommonTemplates.noDataSVG("cgeDesc",!1,ZPI18N.getString("zp.emptydesc"),!1);pageId.find("#cgeDesc").html(desc);var iconClass=Icons.getIconClass(data.icon).iconClass;if(pageId.find("#srvicon").attr("class","zp_Si "+iconClass),data.serviceOwner.hasOwnProperty("dispName")){var agntData={};agntData.text=data.serviceOwner.dispName,agntData.imageSrc="",agntData.imageAlt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.serviceOwner.dispName))),agntData.text=data.serviceOwner.dispName,data.serviceOwner.ownerTypeId==OWNER_EMPLOYEE&&(agntData.imageSrc=ZPeople.getUserDetailsById(data.serviceOwner.ownerValueId).avatar),pageId.find("#serviceOwner").closest("div").removeClass("zp_dyn"),pageId.find("#serviceOwner").html(CommonTemplates.cloneTag([agntData],!1))}else pageId.find("#serviceOwner").html(CommonTemplates.noDataSVG("serviceOwner",!1,ZPI18N.getString("zp.emptyserviceowner"),!1));if(data.hasOwnProperty("enable_hrcase")&&data.enable_hrcase&&!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))){var html='<div class="zp_sttl"><span class="nobdr">'+ZPI18N.getString("zp.agent")+"</span></div><div>"+HRCategory.View.cloneAgentRow(data.agentDetails,!0)+"</div>";pageId.find("#enHRcase").html(html)}else pageId.find("#enHRcase").html("");data.hasOwnProperty("assoContents")?pageId.find("#docuList").html(HRCategory.View.cloneContentRow(data.assoContents,data.categoryId)):pageId.find("#docuList").html("")},addFormHtml:function(){return'<div onclick="ZPServices.Configure.addForm(\'$SERVICEID$\');" class="zp_svc SC1"><span><div class="zp_SFOpts"></div><label class="zp_serIcn"><i class="zp_Si zp_app0"></i></label><h3>'+ZPI18N.getString("zp.addnewform")+"</h3></span></div>"},formLstHtml:function(){var html='<div formId="$PCID$" class="zp_svc"><span><div class="zp_SFOpts"><label class="zp_SFswtch"><input id="enbDisForm" class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"><span></span></label><i id="formSett" class="IC-setting" title='+ZPI18N.getString("zp.more")+"></i></div>";return html+'<label class="zp_serIcn $FORMCOLOR$">$FORMALTTEXT$</label><h3>$FORMNAME$</h3></span></div>'},faqList:function(){var pageId=$("#"+Layout.Page.pageId),param={mode:"faqList",conreqcsr:csrfToken,categoryId:pageId.find("#gotoservicebutton").attr("categoryid")};ZPeople.Request.send("/faqList.zp",param,function(data){$("#sliderPopup").length<=0&&$("body").append(CommonTemplates.sliderPop()),$("#sliderPopup").addClass("services zp_shw"),$("#sliderName").append(ZPI18N.getString("zp.faqAbbre")),$("#sliderContent").empty().append(FAQ.faqList(data.FAQ_LIST,!1,!0)),$("[name=closeSlider]").off("click").on("click",function(){CommonTemplates.closeSlider()})})},getRelatedDoc:function(categoryId){var param=($("#"+Layout.Page.pageId),{mode:"relatedDoc",conreqcsr:csrfToken,categoryId:categoryId});ZPeople.Request.send("/getRelatedDoc.zp",param,function(data){ZPServices.View.showRelatedDoc(data)})},showRelatedDoc:function(data){$("#"+Layout.Page.pageId);$("#sliderPopup").length<=0&&$("body").append(CommonTemplates.sliderPop()),$("#sliderPopup").addClass("services zp_shw"),$("#sliderName").append(ZPI18N.getString("zp.relateddoc")),$("#sliderContent").empty().append(HRCategory.View.cloneContentRow(data.FilesList,data.categoryId,!0)),$("[name=closeSlider]").off("click").on("click",function(){CommonTemplates.closeSlider()})},getFormBgColor:function(text){for(var len=text.length,code=0,i=0;len>i;i++)code+=text.charCodeAt(i);return code=code%4+1,"GC"+code}},ZPServices.SELECTED_SERVICE={},ZPServices.SERVICE_LIST_DIV='<div class="zp_svc $SERVICECOLOR$" tab="$SERVICELBL$"><span><i id="info" class="IC-info"></i><label class="zp_serIcn"><i class="$SERVICEICON$"></i></label><h3>$SERVICENAME$</h3></span></div>',ZPServices.SERVICE_CLOSE_HTML='<a class="zp_svcls" onclick="ZPServices.resetServicePage(event)"><i class="IC-cls" title='+ZPI18N.getString("zp.close")+"></i></a>",ZPServices.SERVICE_DESC_DIV='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.description")+'</span></div><div class="zp_txt"><p>$SERVICEDESC$</p></div>',ZPServices.SERVICE_HANDLE_DIV='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.serviceowner")+"</span></div>",ZPServices.SERVICE_GOTO_BTN='<div class="zp_btn"><button class="zpthm" id="gotoservicebutton" onclick="ZPServices.gotoService(this)" categoryId="$CATEGORYID$">$GOTO$</button></div>',ZPServices.SERVICE_HEADER='<div class="zp_sR" id="hrServiceHeader"><div class="zp_sRIn"><div class="zp_sRBx"><i class="IC-lens"></i><input type="text" placeholder="Search" onkeyup="ZPServices.search(this)"></div>$SETTINGSDIV$</div><div class="zp_sLIn"><h2>'+ZPI18N.getString("zp.allservices")+"</h2></div></div>",ZPServices.constructServicePage=function(){var serviceDv=$("#"+Layout.Page.pageId).find("#serviceMainDv");if(ZPServices.SERVICE_JSON.length>0){serviceDv.find("[name=hrService]").length<1&&serviceDv.append('<div class="zp_sRcnt" name="hrService"></div>');var mainDv=serviceDv.find("[name=hrService]");mainDv.empty(),mainDv.siblings(".ZPNdata").remove(),ZPServices.SELECTED_SERVICE={};var settingsDv="";if(isadmin){settingsDv='<a href="#admin/formslayout/tabs" title="'+ZPI18N.getString("zp.settings")+'"><i class="IC-setting zp_rB"></i></a>';var addServiceDV=ZPServices.serviceListRow({dispName:ZPI18N.getString("zp.newservice"),tabName:"",icon:"add"});mainDv.html(addServiceDV),mainDv.find('[tab=""] span').attr("onclick","ZPServices.Configure.addNewService()"),mainDv.find('[tab=""]').addClass("addService"),$("#"+Layout.Page.pageId).find("#serviceMainDv").find(".addService").find(".IC-info").remove(),$("#"+Layout.Page.pageId).find("#serviceMainDv").find(".addService").find(".zp_serIcn").addClass("GC1")}serviceDv.find("#hrServiceHeader").length<1?serviceDv.prepend(ZPServices.SERVICE_HEADER.replace("$SETTINGSDIV$",settingsDv)):serviceDv.find("#hrServiceHeader input").val(""),mainDv.find(".zp_sRBx .IC-lens").on("click",function(){$(this).siblings("input").trigger("focus")}),$.each(ZPServices.SERVICE_JSON,function(index,service){if(void 0!=service.tabName&&(service.activeFormCount>0||ZPUtil.checkIsExistInArray(zpconst.systemServices,service.tabName.toLowerCase()))&&service.isActive){var serviceDiv=ZPServices.serviceListRow(service);mainDv.append(serviceDiv),mainDv.find('[tab="'+service.tabName+'"] span').click(function(){ZPServices.SELECTED_SERVICE={},ZPServices.gotoService(this)});var systemService=["organization","timetracker","leavetracker","attendance","files","performance"];ZPUtil.checkIsExistInArray(systemService,service.tabName.toLowerCase())?mainDv.find('[tab="'+service.tabName+'"] span #info').remove():mainDv.find('[tab="'+service.tabName+'"] span #info').click(function(event){ZPServices.showServiceDtl(this,event)})}})}},ZPServices.serviceListRow=function(data){var icon=Icons.getIconClass(data.icon),addServiceDV=ZPServices.SERVICE_LIST_DIV;return addServiceDV=addServiceDV.replace(/\$SERVICENAME\$/g,data.dispName),addServiceDV=addServiceDV.replace(/\$SERVICELBL\$/g,data.tabName),addServiceDV=addServiceDV.replace(/\$SERVICEICON\$/g,"zp_Si "+icon.iconClass),addServiceDV=addServiceDV.replace(/\$SERVICECOLOR\$/g,icon.iconColor)},ZPServices.resetServicePage=function(event){void 0!=event&&event.preventDefault(),$("#"+Layout.Page.pageId).find("#serviceMainDv .zp_svc").removeClass("zp_sel"),$("#"+Layout.Page.pageId).find("#serviceMainDv .zp_svcpv").remove(),$("#"+Layout.Page.pageId).find("#serviceMainDv .ZPNdata").remove()},ZPServices.showServiceDtl=function(getThis,event){event.preventDefault(),event.stopPropagation();var pageId=$("#"+Layout.Page.pageId);return $(getThis).closest(".zp_svc").hasClass("zp_sel")?void ZPServices.resetServicePage():(ZPServices.resetServicePage(),void setTimeout(function(){$(getThis).closest(".zp_svc").addClass("zp_sel");var tabName=$(getThis).closest(".zp_svc").attr("tab"),service=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0);if(void 0!=service){var height=parseInt($(getThis).closest(".zp_svc").offset().top+190),descDV='<div class="zp_svcpv zp_shw" id="serviceDtls">'+ZPServices.constructServiceDtl(service)+"</div>";$(getThis).closest(".zp_svc").append(descDV),$(getThis).parent().siblings("#serviceDtls").offset({top:height}),pageId.find("[id=relatedDoc]").off("click").on("click",function(){ZPServices.View.getRelatedDoc(pageId.find("#gotoservicebutton").attr("categoryId"))}),pageId.find("#serviceDtls")[0].scrollIntoView({behavior:"smooth"}),ZPServices.SELECTED_SERVICE=service}},200))},ZPServices.constructDesc=function(service){var descDiv="";void 0!=service.desc&&""!==service.desc&&(descDiv=ZPServices.SERVICE_DESC_DIV.replace(/\$SERVICEDESC\$/g,service.desc));var agentDiv="";if(service.serviceOwner.hasOwnProperty("dispName")){var owner=service.serviceOwner.dispName,src="",alt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(owner)));if(service.serviceOwner.ownerTypeId==OWNER_EMPLOYEE){var userDtl=ZPeople.getUserDetailsById(service.serviceOwner.ownerValueId);src=userDtl.avatar}var imageHtml=CommonTemplates.returnImgDiv(src,alt),agentHTML=CommonTemplates.tagHtml("agent",owner,imageHtml,!1,!0);agentDiv=ZPServices.SERVICE_HANDLE_DIV+'<div class="zp_txt" title="'+owner+'">'+agentHTML+"</div>"}return descDiv+=agentDiv+ZPServices.SERVICE_GOTO_BTN.replace(/\$GOTO\$/g,ZPI18N.getString("zp.goto",[service.dispName])).replace(/\$CATEGORYID\$/g,void 0!=service.categoryid?service.categoryid:"-1"),descDiv='<div class="zp_svcdesc">'+descDiv+"</div>"},ZPServices.constructFormList=function(service){var formList='<div class="zp_flt">';$.each(service.forms,function(index,form){form.isActive&&(formList+='<a onclick="ZPServices.openForm(this,event)" formid="'+form.pcId+'" viewid="'+form.viewId+'">'+form.dispName+(form.isAddPerm?"<span>+</span>":"")+"</a>")}),formList+="</div>";var askUsBtn=!1;return service.hasOwnProperty("enable_hrcase")&&!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))&&(askUsBtn=service.enable_hrcase),formList+=ZPServices.View.constructHeaderButton(service.hasReference,service.isServiceAdmin,service.hasFAQList,askUsBtn),formList='<div class="zp_svcreq">'+formList+"</div>"},ZPServices.openForm=function(getThis,event){event.preventDefault();var formId=$(getThis).attr("formid");if($(event.target).is("span")){var params={formId:formId,disableUrlTrack:!0};ZPForm.load(params)}else{var viewId=$(getThis).attr("viewid"),serviceName=$(getThis).closest(".zp_svc").attr("tab");window.location.href="#"+ZPServices.getViewFormUrl(serviceName,formId,viewId)}},ZPServices.constructServiceDtl=function(service){var descDiv=ZPServices.SERVICE_CLOSE_HTML;return descDiv+=ZPServices.constructDesc(service),descDiv+=ZPServices.constructFormList(service)},ZPServices.gotoService=function(getThis){var tabName=$(getThis).closest(".zp_svc").attr("tab");if(Object.keys(ZPServices.SELECTED_SERVICE).length<1&&(ZPServices.SELECTED_SERVICE=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0)),void 0!=ZPServices.SELECTED_SERVICE&&!ZPServices.setShowMainTab(ZPServices.SELECTED_SERVICE)){ZPTabs.Actions.addTabsInUserTabs(ZPServices.SELECTED_SERVICE);var firstForm=ZPServices.SELECTED_SERVICE.forms[0];window.location.href="#"+ZPServices.getViewFormUrl(ZPServices.SELECTED_SERVICE.tabName.toLowerCase(),firstForm.pcId,firstForm.viewId)}},ZPServices.setShowMainTab=function(service){var mainTabName=service.tabName;mainTabName=ZPServices.selectTab(mainTabName);var selTab=ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",mainTabName,!0);return void 0!=selTab?(window.location.href="#"+ZPTabs.getMainTabUrl(selTab.subtabs,mainTabName),!0):!1},ZPServices.getViewFormUrl=function(serviceName,formId,viewId){return void 0!==formId&&void 0!==viewId?serviceName.toLowerCase()+"/form/listview-formId:"+formId+"/viewId:"+viewId:""},ZPServices.search=function(getThis){ZPServices.resetServicePage();var value=$(getThis).val(),searchDiv=Layout.Page.container.find("[tab]");if(ZPUtil.Validation.isEmpty(value))return void $(searchDiv).show();$(searchDiv).hide();for(var servIdx=0;servIdx<ZPServices.SERVICE_JSON.length;servIdx++){var service=ZPServices.SERVICE_JSON[servIdx];if(ZPeople.decodeTxt(service.dispName).match(new RegExp(value,"iu")))Layout.Page.container.find('[tab="'+service.tabName+'"]').show();else for(var formIdx=0;formIdx<service.forms.length;formIdx++)if(ZPeople.decodeTxt(service.forms[formIdx].dispName).match(new RegExp(value,"iu"))){Layout.Page.container.find('[tab="'+service.tabName+'"]').show();break}}Layout.Page.container.find("[tab]").is(":visible")||Layout.Page.container.find("#serviceMainDv").append(ZPServices.getNoDataHTML(ZPI18N.getString("zp.noservice")))},ZPServices.getNoDataHTML=function(noDataMsg){return'<div class="ZPNdata"><i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+noDataMsg+"</h5></div>"},ZPServices.addFormInService=function(formsData,isAddForm,serviceName,isActive){var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0);if(void 0!=currentService){var formSubTab,tab=Layout.UrlConf.isSystemService?void 0:ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",serviceName,!0);void 0!=tab&&(formSubTab=tab.subtabs[0],tab.subtabs.length<2&&(formSubTab={isDiretTabs:!0,tabName:"",displayName:ZPI18N.getString("zp.forms"),formArr:[]},tab.subtabs.splice(0,0,formSubTab,{displayName:ZPI18N.getString("zp.tasks"),tabURL:serviceName+"/alltask"},{displayName:ZPI18N.getString("zp.analytics"),tabURL:serviceName+"/analytics/list"})),isAddForm||(formSubTab.formArr=[])),isAddForm||(currentService.forms=[],currentService.activeFormCount=0),$.each(formsData,function(index,form){var formId=form.pcId,formName=isAddForm?AutomationCommon.htmlEncode(form.dispName):form.dispName,viewId=form.viewId;if(isAddForm)if(void 0==isActive)currentService.forms.push({dispName:formName,isAddPerm:isadmin,label:form.label,pcId:formId,viewId:viewId,isMoveable:!0,isActive:!0,isEnableDis:!0,isCustom:!0});else{var form=ZPServices.getObjectFormArray(currentService.forms,"pcId",formId,!0,!0);form.isActive=isActive}else currentService.forms.push(form);(form.isActive||void 0==isActive)&&(++currentService.activeFormCount,void 0!=formSubTab&&formSubTab.formArr.push({pcId:formId,displayName:formName,tabURL:ZPServices.getViewFormUrl(serviceName,formId,viewId)}))}),ZPTabs.constructSubtabsBasedOnHash(!1,serviceName,"0"===ZPeople.USER_CUST_SETTINGS.USER_TAB_MINIMIZE)}},ZPServices.removeFormInService=function(removeFormIds,serviceName,isActive){var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0);if(void 0!=currentService){var tab=Layout.UrlConf.isSystemService?void 0:ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",serviceName,!0),formTabArr=[];void 0!=tab&&void 0!=tab.subtabs[0].formArr&&tab.subtabs[0].formArr.length>0&&(formTabArr=tab.subtabs[0].formArr);var forms=currentService.forms;$.each(removeFormIds,function(index,formId){var form=ZPServices.getObjectFormArray(forms,"pcId",formId,!0,!0);void 0!=form&&(void 0==isActive?forms.splice(form.index,1):form.isActive=isActive,--currentService.activeFormCount);var formTab=ZPServices.getObjectFormArray(formTabArr,"pcId",formId,!0,!0);void 0!=formTab&&formTabArr.splice(formTab.index,1)}),void 0!=tab&&formTabArr.length<1&&tab.subtabs.splice(0,tab.subtabs.length,{displayName:ZPI18N.getString("zp.settings"),tabURL:serviceName+"/generalsettings"}),Layout.CustomizedUrl.getServiceName()===serviceName&&ZPTabs.constructSubtabsBasedOnHash(!1,serviceName,"0"===ZPeople.USER_CUST_SETTINGS.USER_TAB_MINIMIZE)}},ZPServices.addUpdateService=function(serviceId,serviceLName,srName,srSDesc,srvIcon,categoryId,srOwnValueId,srOwnTypeId,srOwnerName,enable_hrcase){var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceLName,!1);void 0===currentService&&(currentService={categoryid:categoryId,id:serviceId,forms:[],hasFAQList:!1,isApprovalEnabled:!1,icon:"star",isActive:!0,activeFormCount:0},ZPServices.SERVICE_JSON.push(currentService)),currentService.enable_hrcase=enable_hrcase,currentService.tabName=serviceLName,currentService.dispName=srName,currentService.desc=srSDesc;var oldIcon=currentService.icon;currentService.icon=srvIcon,ZPUtil.Validation.isEmpty(srOwnValueId)&&(srOwnTypeId=OWNER_EMPLOYEE,srOwnValueId=erecno,srOwnerName=ZPeople.CURR_USER.name),currentService.serviceOwner={},currentService.serviceOwner.ownerTypeId=srOwnTypeId,currentService.serviceOwner.ownerValueId=srOwnValueId,currentService.serviceOwner.dispName=AutomationCommon.htmlEncode(srOwnerName),ZPServices.updateTab(serviceLName,srName,oldIcon,srvIcon)},ZPServices.updateTab=function(serviceLName,srName,oldIcon,newIcon){var currentTab=ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",serviceLName,!0);void 0==currentTab||ZPeople.decodeTxt(currentTab.disName)===srName&&oldIcon===newIcon||(currentTab.disName=srName,ZPTabs.construct(currentTab),ZPServices.selectTab(serviceLName))},ZPServices.updateHasFAQ=function(faqDiv){var service=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",Layout.CustomizedUrl.getServiceName(),!0);void 0!=service&&(service.hasFAQList=faqDiv.find(".zpfaq").length>0)},ZPServices.Configure={addServiceHtml:function(sliderName){return sliderName=void 0==sliderName?ZPI18N.getString("zp.newservice"):sliderName,'<div id="newService" class="zp_NSPop active"><div class="zp_popInner"><h4>'+sliderName+'</h4><i class="IC-cls" onclick="ZPServices.Configure.closeSlide()"></i><div data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.chooseicon")+'" class="zp_sIcn"><label id="serIcon" class="zp_serIcn"><i class="zp_Si zp_app0"></i></label></div><div class="zp_formncls"><div id="svNameDiv" class="zp_fm"></div><span class="etxt"></span><div id="svSDescDiv" class="zp_fm"></div><span class="etxt"></span></div><div class="zp_btn"><button class="zpthm zpn_btn" id="svServBtn" onclick="ZPServices.Configure.saveService()"><b>'+ZPI18N.getString("zp.save")+'</b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+'</label></button><button onclick="ZPServices.Configure.closeSlide()">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>"},addNewService:function(){isadmin&&(ZPServices.resetServicePage(),Layout.Page.container.find("#serviceMainDv").append(ZPServices.Configure.addServiceHtml()),ZPServices.Configure.resetPage())},closeSlide:function(){Layout.Page.container.find("#newService").remove()},resetPage:function(){var pageId=$("#"+Layout.Page.pageId),parentId=pageId.find("#newService");CommonTemplates.removeErrorMessagesinContainerDiv("newService"),CommonTemplates.getInputTextBox({id:"svName",placeholder:ZPI18N.getString("zp.enterservicename")},ZPI18N.getString("zp.name"),!0,parentId.find("[id=svNameDiv]")),parentId.find("[id=serIcon]").off("click").on("click",function(){ZPServices.Configure.chooseIcon(this)}),CommonTemplates.getInputTextBox({id:"svSDesc",placeholder:ZPI18N.getString("zp.enterdesc")},ZPI18N.getString("zp.description"),!0,parentId.find("[id=svSDescDiv]"))},chooseIcon:function(obj){var params=[];$.each(Icons.ICONS_LIST,function(i,v){"add"!=i&&params.push({iconVal:i,value:"zp_Si "+v})}),$(obj).zparrowmenu({id:"iconsList",data:params,icon:!0,callback:function(listedObj,sourceObj){$(sourceObj).closest("div").attr("class","zp_sIcn "+Icons.getIconClass($(listedObj).attr("iconVal")).iconColor),$(sourceObj).find("i").attr("class",$(listedObj).attr("name"))}})},addNewFormCallBack:function(data){var serviceName=Layout.CustomizedUrl.getServiceName();ZPServices.View.viewFormList([{pcId:data.formId,dispName:data.formName,isCustom:!0,isEnableDis:!1}],!0),ZPServices.addFormInService([{pcId:data.formId,dispName:data.formName,label:data.labelName,viewId:data.viewId}],!0,serviceName),window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl("admin/formslayout/formedit",data.formId)},addForm:function(serviceId){AppsCustom.addNewApp({},{tabid:serviceId,successCallback:ZPServices.Configure.addNewFormCallBack})},deleteForm:function(formid){var params=($("#"+Layout.Page.pageId),{method:"deleteForm",formid:formid}),others={callback:ZPServices.removeFormInService([params.formid],Layout.CustomizedUrl.getServiceName())};ZPeople.Request.send("/formOperations.zp",params,tabCustom.deleteForm,others)},enabledisabelFormCallBack:function(data,others,params){var inObj=others.obj.find("#enbDisForm"),serviceName=(params.hidden,Layout.CustomizedUrl.getServiceName());params.hidden?(inObj.prop("checked",!1),inObj.closest("[formId]").addClass("zp_dAct"),ZPServices.removeFormInService([others.formData.pcId],serviceName,!1)):(inObj.prop("checked",!0),inObj.closest("[formId]").removeClass("zp_dAct"),ZPServices.addFormInService([others.formData],!0,serviceName,!0));var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0,!1);ZPServices.View.viewFormList(currentService.forms,!1)},enabledisableForm:function(formData,hidden,obj){var formid=formData.pcId,params={method:"formCustOperations",mode:"showhideform",formid:formid,hidden:hidden},others={formData:formData,obj:obj,successCallback:ZPServices.Configure.enabledisabelFormCallBack};ZPeople.Request.send("/formCustOperations.zp",params,tabCustom.enableDisableForm,others)},validateServiceName:function(headerDiv,excludeName){var data=$.trim($("#"+headerDiv).find("#svName").val()),results=[];if(excludeName=void 0==excludeName?"":excludeName,results=$.grep(ZPServices.SERVICE_JSON,function(ele){return ele.dispName.toLowerCase()==data.toLowerCase()&&data.toLowerCase()!=excludeName.toLowerCase()}),results.length>0||""==data||data.length>50){var errorMsg=ZPI18N.getString("zp.serviceavailable");""==data?errorMsg=ZPI18N.getString("zp.serviceempty"):data.length>50&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.hrservicename"),"50"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#svName"),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#svName"))},validateSDesc:function(headerDiv,currentId){var shortDesc=$("#"+headerDiv).find("#"+currentId).val(),data=$.trim(shortDesc);if(""==data||shortDesc.length>250){var errorMsg=ZPI18N.getString("zp.servicedesc");shortDesc.length>250&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.description"),"250"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId))},saveService:function(){var pageId=$("#"+Layout.Page.pageId),parentId=pageId.find("#newService");CommonTemplates.waitTillSave("svServBtn"),CommonTemplates.removeErrorMessagesinContainerDiv("newService");var params={mode:"add"},servDtl={},srName=parentId.find("#svName").val(),srSDesc=parentId.find("#svSDesc").val(),srIcon=parentId.find("#serIcon").find("i").attr("class");srIcon=srIcon.replace("zp_Si","");var srvIcon=Icons.getIconName(srIcon.trim());return servDtl={serviceName:srName,serviceDescription:srSDesc,serviceIcon:srvIcon},params.serviceDtls=JSON.stringify(servDtl),ZPServices.Configure.validateServiceName("newService"),ZPServices.Configure.validateSDesc("newService","svSDesc"),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?void CommonTemplates.saveComplete("svServBtn"):void ZPeople.Request.send("/services.zp",params,function(data){if(CommonTemplates.saveComplete("svServBtn"),"success"==data.status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.servicesaved")),ZPServices.Configure.closeSlide(),Layout.UrlConf.SERVICE_MODULE.push(data.tabName.toLocaleLowerCase());var srvOwner={ownerTypeId:"",ownerValueId:"",dispName:""};data.serviceOwner.hasOwnProperty("dispName")&&(srvOwner.ownerTypeId=data.serviceOwner.ownerTypeId,srvOwner.ownerValueId=data.serviceOwner.ownerValueId,srvOwner.dispName=data.serviceOwner.dispName),ZPServices.addUpdateService(data.id,data.tabName,data.dispName,data.desc,data.icon,data.categoryId,srvOwner.ownerValueId,srvOwner.ownerTypeId,srvOwner.dispName,!1),tabCustom.addNewTabEntry(data.id,data.dispName),window.location.href="#"+data.tabName.toLocaleLowerCase()+"/generalsettings"}else ZPeople.Message.showFailureMsg(data.msg)},"",function(xhr){CommonTemplates.saveComplete("svServBtn");var error_response=xhr.responseText;ZPeople.Message.showFailureMsg(error_response.error)})}},ZPServices.MoveForms={popupHtml:'<div class="zp_whtbg zp_shw" id="moveform"><div class="zp_pop"><div class="zp_Ptl zp_wthBdr"><h3>'+ZPI18N.getString("zp.moveform")+'</h3></div><div id="mvFormCont" class="zp_pcnt">$FORMSDRAGDROP$</div><div class="zp_btn"><button name="closeSlider">'+ZPI18N.getString("zp.close")+'</button></div></div><i name="closeSlider" title='+ZPI18N.getString("zp.close")+' class="IC-cls"></i></div>',dragColumn:'<div name="$ULTYPE$" class="zp_mvFmOut"><div class="zp_ttl">$COLUMNTTL$</div><div class="zp_mvFrm $ALIGN$">$COLFORMS$</div></div>',formsList:'<ul serviceid="$SERVICEID$" name="$ULTYPE$" class="zp_fmCont">$FORMSLIST$</ul>',dragableDiv:'<li class="zp_drgBle"></li>',singleForm:'<li $FATTR$ formid="$FORMID$"><i class="$DRAGICON$"></i> $FORMNAME$</li>',noForm:'<li type="noform">'+ZPI18N.getString("zp.noformsavailable")+"</li>",serviceList:'<li serviceid="$SERVICEID$" class=""><span>$SRVDISPNAME$</span>$FRMLST$</li>',allServiceHtml:'<div class="zp_mvSr"><input id="srcTabForm" placeholder="'+ZPI18N.getString("zp.search")+'" type="text"><i class="IC-lens"></i></div><ul>$SRVLIST$</ul>',getFormsAndServices:function(serviceId){ZPeople.Request.send("/getFormAndTabs.zp",{method:"formsAndTabsPage"},function(data){ZPServices.MoveForms.getFormsSlider(data.tabList,serviceId)},"")},search:function(getThis){var pageId=$("#"+Layout.Page.pageId),parentId=pageId.find("#moveform"),value=$(getThis).val(),searchDiv=parentId.find("li[serviceid]");if(ZPUtil.Validation.isEmpty(value))return void $(searchDiv).show();$(searchDiv).hide();for(var servIdx=0;servIdx<ZPServices.SERVICE_JSON.length;servIdx++){var service=ZPServices.SERVICE_JSON[servIdx];if(ZPeople.decodeTxt(service.dispName).match(new RegExp(value,"iu")))parentId.find('li[serviceid="'+service.id+'"]').show(),parentId.find('li[serviceid="'+service.id+'"]').addClass("zp_heAd");else for(var formIdx=0;formIdx<service.forms.length;formIdx++)if(ZPeople.decodeTxt(service.forms[formIdx].dispName).match(new RegExp(value,"iu"))){parentId.find('li[serviceid="'+service.id+'"]').show(),parentId.find('li[serviceid="'+service.id+'"]').addClass("zp_heAd");break}}},getFormsSlider:function(data,serviceId){var serviceForms=ZPServices.MoveForms.dragColumn,allsrvList="";$.each(data,function(i,v){if(v.id==serviceId){var currForms="";v.hasOwnProperty("forms")&&v.forms.length>0&&(currForms=ZPServices.MoveForms.getFormsList(v.forms));var formsList=ZPServices.MoveForms.formsList;formsList=formsList.replace("$FORMSLIST$",currForms),formsList=formsList.replace("$ULTYPE$","to"),formsList=formsList.replace("$SERVICEID$",v.id),serviceForms=serviceForms.replace("$COLUMNTTL$",v.dispName),serviceForms=serviceForms.replace("$ALIGN$","zp_aAct"),serviceForms=serviceForms.replace("$COLFORMS$",formsList),serviceForms=serviceForms.replace("$ULTYPE$","to")}else{var srvHtml=ZPServices.MoveForms.serviceList;srvHtml=srvHtml.replace("$SRVDISPNAME$",v.dispName),srvHtml=srvHtml.replace("$SERVICEID$",v.id);var srvForms="";srvForms=v.hasOwnProperty("forms")&&v.forms.length>0?ZPServices.MoveForms.getFormsList(v.forms):ZPServices.MoveForms.noForm,srvHtml=srvHtml.replace("$FRMLST$",ZPServices.MoveForms.formsList),srvHtml=srvHtml.replace("$SERVICEID$",v.id),srvHtml=srvHtml.replace("$FORMSLIST$",srvForms),srvHtml=srvHtml.replace("$ULTYPE$","from"),allsrvList+=srvHtml}});var allForms=ZPServices.MoveForms.dragColumn;allForms=allForms.replace("$COLUMNTTL$",ZPI18N.getString("zp.allformsandservices")),allForms=allForms.replace("$ALIGN$",""),allForms=allForms.replace("$COLFORMS$",ZPServices.MoveForms.allServiceHtml),allForms=allForms.replace("$SRVLIST$",allsrvList),allForms=allForms.replace("$ULTYPE$","from");var sliderHtml=ZPServices.MoveForms.popupHtml;sliderHtml=sliderHtml.replace("$FORMSDRAGDROP$",allForms+serviceForms),Layout.Page.container.append(sliderHtml),Layout.Page.container.find("[name=closeSlider]").off("click").on("click",function(){$(this).closest("#moveform").remove()}),Layout.Page.container.find("li[serviceid]").find("span").off("click").on("click",function(){$(this).closest("li[serviceid]").toggleClass("zp_heAd")}),ZPServices.MoveForms.getDraggableOption(serviceId),Layout.Page.container.find("#srcTabForm").off("keyup").on("keyup",function(){var obj=$(this);setTimeout(function(){ZPServices.MoveForms.search(obj)},500)})},getFormsList:function(formDetailsMap){var currForms="";return $.each(formDetailsMap,function(index,val){var fhtml=ZPServices.MoveForms.singleForm;fhtml=fhtml.replace("$FORMID$",val.pcId);var attribute="";val.isActive||(fhtml=fhtml.replace("$DRAGICON$","IC-lock"),attribute='type="inactive"'),val.hasOwnProperty("isMoveable")&&val.isMoveable?(fhtml=fhtml.replace("$DRAGICON$","CR-drag"),attribute+=' moveable="true" '):fhtml=fhtml.replace("$DRAGICON$","IC-lock"),fhtml=fhtml.replace("$FATTR$",attribute),fhtml=fhtml.replace("$FORMNAME$",val.dispName),currForms+=fhtml}),formDetailsMap.length<=0&&(currForms=ZPServices.MoveForms.noForm),currForms},getDraggableOption:function(currentServiceId){var pageId=$("#"+Layout.Page.pageId),isSorted=(pageId.find("#moveform"),!1);pageId.find("ul.zp_fmCont").sortable({handle:".CR-drag",items:"li[formid][moveable=true]",cancel:"li[type=inactive]",connectWith:[".zp_fmCont"],placeholder:"zp_drgBle",helper:"clone",forceHelperSize:!0,appendTo:"body",containment:"document",dropOnEmpty:!0,distance:.5,scroll:!0,tolerance:"touch",start:function(event,ui){$(ui.helper).addClass("zp_dragList"),$(ui.helper).css({height:"auto"}),startElement=$(this),isSorted=!1,sortType="",senderArray={},receiverArray={}},update:function(ev,ui){endElement=$(this),null==ui.sender?(senderArray.serviceid=$(this).attr("serviceid"),senderArray.forms=$(this).sortable("toArray",{attribute:"formid"}),receiverArray.serviceid=$(this).attr("serviceid"),receiverArray.forms=$(this).sortable("toArray",{attribute:"formid"}),sortType="reorder"):null!=ui.sender&&(receiverArray.serviceid=$(this).attr("serviceid"),receiverArray.forms=$(this).sortable("toArray",{attribute:"formid"}),sortType="tag"),isSorted=!0},stop:function(ev,ui){if(isSorted){var formId=$(ui.item).attr("formid"),otherformids=[],currentFormIds=[],receiverserviceName="",receiverlblName="",senderlblName="",formName="";if("reorder"==sortType){if(senderArray.serviceid!=currentServiceId)return $(startElement).sortable("cancel"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.moveformnotallowed"));otherformids=senderArray.forms,currentFormIds=senderArray.forms;var currentFormDetails=new Array(currentFormIds.length),otherFormDetails=new Array(otherformids.length);$.each(ZPServices.SERVICE_JSON,function(i,v){return v.id==currentServiceId?(senderlblName=v.tabName,receiverlblName=v.tabName,receiverserviceName=v.dispName,void $.each(v.forms,function(index,value){var inArray=$.inArray(value.pcId,currentFormIds);-1!=inArray&&(currentFormDetails[inArray]=value,otherFormDetails[inArray]=value)})):void 0})}else if("tag"==sortType){if($(endElement).attr("name")==$(startElement).attr("name"))return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.moveformnotallowed")),void $(startElement).sortable("cancel");currentServiceId==receiverArray.serviceid?(currentFormIds=receiverArray.forms,otherformids=senderArray.forms):(currentFormIds=senderArray.forms,otherformids=receiverArray.forms);var currentFormDetails=new Array(currentFormIds.length),otherFormDetails=new Array(otherformids.length);$.each(ZPServices.SERVICE_JSON,function(i,v){(v.id==senderArray.serviceid||v.id==receiverArray.serviceid)&&(v.id==senderArray.serviceid&&(senderlblName=v.tabName),$.each(v.forms,function(index,value){formId==value.pcId&&(formName=value.dispName);var inArray=$.inArray(value.pcId,currentFormIds);-1!=inArray&&(currentFormDetails[inArray]=value);var otherArray=$.inArray(value.pcId,otherformids);-1!=otherArray&&(otherFormDetails[otherArray]=value)}),v.id==receiverArray.serviceid&&(receiverlblName=v.tabName,receiverserviceName=v.dispName))})}var formIdstr=receiverArray.forms.join(","),params={method:"formCustOperations",mode:"reorderform",parenttabid:receiverArray.serviceid,formIds:formIdstr};ZPeople.Request.send("/formCustOperations.zp",params,function(data){if("success"==data.msg.trim()){if(ZPServices.View.viewFormList(currentFormDetails,!1),ZPServices.addFormInService(currentServiceId==receiverArray.serviceid?currentFormDetails:otherFormDetails,!1,receiverlblName),receiverlblName!=senderlblName&&ZPServices.removeFormInService([formId],senderlblName.toLowerCase()),"from"==$(endElement).attr("name")){var noform=$(endElement).find("li[type=noform]");noform.length>0&&noform.remove()}"from"==$(startElement).attr("name")&&$(startElement).find("li").length<=0&&$(startElement).html(ZPServices.MoveForms.noForm),"reorder"==sortType?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reorderformsuccess")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.moveformsuccess",new Array(formName,receiverserviceName)))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))},{},function(resultData){$(startElement).sortable("cancel"),ZPeople.Message.showFailureMsg(resultData.error)})}}})}},ZPServices.Edit={srvHtml:function(){var enableCase="";$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))||(enableCase='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.addtohrcases")+'</span></div><div class="ZPFnoti zp_addHrC"><div class="FL"><label class="checkbox DIB"><input id="enbHRC" type="checkbox"><span></span></label></div><div class="ZPckmain">'+ZPI18N.getString("zp.enablehrcase")+'<i data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.enablehrcaseinfo")+'" class="IC-info"></i></div></div>');var agentDiv='<div id="svAgentDiv" class="zp_fm"></div><span class="etxt"></span>',assCont='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.associatedcontent")+"</span></div>"+HRCategory.ConfigureCategory.cloneAddContentsBox(),html='<div data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.chooseicon")+'" class="zp_sIcn"><label id="serIcon" class="zp_serIcn"><i class=""></i></label></div><div class="zp_formncls"><div id="svNameDiv" class="zp_fm"></div><span class="etxt"></span><div id="svSDescDiv" class="zp_fm"></div><span class="etxt"></span><div id="svSOwnerDiv" class="zp_fm"></div><span class="etxt"></span>'+enableCase+agentDiv+assCont+"</div>";return html},editService:function(data){var pageId=$("#"+Layout.Page.pageId);pageId.append(CommonTemplates.sliderPop(!0));var parentId=pageId.find("#sliderPopup");parentId.find("#sliderContent").html(ZPServices.Edit.srvHtml()),parentId.find("[id=serIcon]").closest("div").addClass(Icons.getIconClass(data.icon).iconColor),parentId.find("[id=serIcon]").find("i").attr("class","zp_Si "+Icons.getIconClass(data.icon).iconClass),parentId.find("[id=serIcon]").off("click").on("click",function(){ZPServices.Configure.chooseIcon(this)}),CommonTemplates.getInputTextBox({id:"svName",value:data.dispName},ZPI18N.getString("zp.name"),!0,parentId.find("[id=svNameDiv]")),CommonTemplates.getInputTextBox({id:"svSDesc",value:data.desc},ZPI18N.getString("zp.description"),!0,parentId.find("[id=svSDescDiv]"));var menuProp=HRCaseDropdown.cgymemberdropdown();if(menuProp.callback=function(obj,parentObj){var agentType=($("#"+Layout.Page.pageId),$(obj).attr("agenttype"));$(parentObj).siblings("div.zp_Tg").remove(),$(parentObj).attr("agenttype",agentType);var valueId=$(obj).attr("id");ownerImage=agentType==OWNER_EMPLOYEE.toString()?ZPeople.getUserDetailsById(valueId).avatar:"";var selectedValObj={id:valueId,text:ZPeople.escapeHtml($(obj).attr("name")),imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText($(obj).attr("name"))),image:ownerImage};parentId.find("#svSOwner").zpselect({selectedVal:[selectedValObj],checkbox:!0}),parentId.find("#svSOwner").attr("agenttype",agentType)},CommonTemplates.getSelectMenu(menuProp,parentId.find("[id=svSOwnerDiv]"),{id:"svSOwner"},{needTag:!0,isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.serviceowner")}),data.serviceOwner.hasOwnProperty("dispName")){ownerImage=data.serviceOwner.ownerTypeId==OWNER_EMPLOYEE.toString()?ZPeople.getUserDetailsById(data.serviceOwner.ownerValueId).avatar:"";var selectedValObj={id:data.serviceOwner.ownerValueId,text:data.serviceOwner.dispName,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.serviceOwner.dispName))),image:ownerImage};parentId.find("#svSOwner").zpselect({selectedVal:[selectedValObj],checkbox:!0}),parentId.find("#svSOwner").attr("agenttype",data.serviceOwner.ownerTypeId)}if(!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))){if(parentId.find("#svAgentDiv").addClass("zp_dyn"),CommonTemplates.getSelectMenu(HRCaseDropdown.cgymemberdropdown(),parentId.find("[id=svAgentDiv]"),{id:"svAgent"},{needTag:!0,isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.agent")}),data.enable_hrcase&&data.hasOwnProperty("agentDetails")){parentId.find("#svAgentDiv").removeClass("zp_dyn"),parentId.find("#enbHRC").attr("checked","checked"),ownerImage=data.agentDetails.agentTypeId==OWNER_EMPLOYEE.toString()?ZPeople.getUserDetailsById(data.agentDetails.agentValueId).avatar:"";var selectedValObj={id:data.agentDetails.agentValueId,text:data.agentDetails.owner,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agentDetails.owner))),image:ownerImage};parentId.find("#svAgent").zpselect({selectedVal:[selectedValObj]})}else ZPSelect.clearAllValues(parentId.find("#svAgent"));parentId.find("#enbHRC").off("click").on("click",function(){$(this).is(":checked")?parentId.find("#svAgentDiv").removeClass("zp_dyn"):parentId.find("#svAgentDiv").addClass("zp_dyn")})}var referencesObjects=[];referencesObjects=data.hasOwnProperty("assoContents")?data.assoContents:[],referencesObjects.length>0&&$.each(referencesObjects,function(i,v){switch(v.formType){case LINK_URL:var linkHtml=HRCategory.ConfigureCategory.cloneAssociatedURLBox("edit");$(linkHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=parentId.find("div[contType]").last();$(contObj).find("#linkUrl").val(decodeURIComponent(v.link));break;case LINK_FILE:var linkName=v.link.split("/")[v.link.split("/").length-1],fileHtml=HRCategory.ConfigureCategory.cloneAssociatedDocumentsBox("edit");$(fileHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=parentId.find("div[contType]").last();$(contObj).find("#fName").html(linkName),$(contObj).attr("linkId",v.linkId)}var contObj=parentId.find("div[contType]").last();$(contObj).attr("linkId",v.linkId),$(contObj).find("input[type=text]").attr("disabled",!0),""==v.linkName&&$(contObj).find("#linkDispName").closest("div.zp_fm").remove(),$(contObj).find("#linkDispName").val(ZPeople.decodeTxt(v.linkName))}),CommonTemplates.openSlider(ZPI18N.getString("zp.settings")),parentId.find("#submitBtn").off("click"),parentId.find("#submitBtn").on("click",function(){ZPServices.Edit.updateService(data.dispName,data.tabName)}),parentId.find("[name=closeSlider]").off("click").on("click",function(){parentId.remove()})},updateService:function(serviceDispName,serviceLName){var pageId=$("#"+Layout.Page.pageId),parentId=pageId.find("#sliderPopup");CommonTemplates.waitTillSave("submitBtn"),CommonTemplates.removeErrorMessagesinContainerDiv("sliderPopup");var servDtl={},srName=parentId.find("#svName").val(),srSDesc=parentId.find("#svSDesc").val(),srOwnTypeId=void 0==parentId.find("#svSOwner").attr("agenttype")?"":parentId.find("#svSOwner").attr("agenttype"),srOwnValueId=void 0==parentId.find("#svSOwner").attr("selectedIds")?"":parentId.find("#svSOwner").attr("selectedIds"),sragentTypeId=(parentId.find("#svSOwnerDiv").find(".zp_Tg").text(),void 0==parentId.find("#svAgent").attr("agenttype")?"":parentId.find("#svAgent").attr("agenttype")),sragentValueId=void 0==parentId.find("#svAgent").attr("selectedIds")?"":parentId.find("#svAgent").attr("selectedIds"),srIcon=parentId.find("#serIcon").find("i").attr("class");srIcon=srIcon.replace("zp_Si","");var srvIcon=Icons.getIconName(srIcon.trim());servDtl={serviceLName:serviceLName,serviceName:srName,serviceDescription:srSDesc,serviceIcon:srvIcon};var formData=new FormData;formData.append("conreqcsr",csrfToken),""!=srOwnValueId?(servDtl.ownerType=srOwnTypeId,servDtl.ownerValue=srOwnValueId,CommonTemplates.removeErrorMessageinTextBox(parentId.find("#svSOwner"))):CommonTemplates.setErrorMessageinTextBox(parentId.find("#svSOwner"),ZPI18N.getString("zp.serviceownerneeded")),$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))||(parentId.find("#enbHRC").is(":checked")&&""==sragentValueId&&CommonTemplates.setErrorMessageinTextBox(parentId.find("#svAgent"),ZPI18N.getString("zp.selectagent")),servDtl.enable_hrcase=parentId.find("#enbHRC").is(":checked")&&""!=sragentValueId,servDtl.enable_hrcase&&(servDtl.agentType=sragentTypeId,servDtl.agentValue=sragentValueId));var assoContents=[],deleteLinks=[],filecount=0;return parentId.find("div[conttype]:not([class=zp_dyn]):not([linkId])").each(function(i){var refObj={};refObj=HRCategory.ConfigureCategory.validateContentBox($(this),filecount,formData),$(this).attr("contType")==LINK_FILE&&(filecount=refObj.file_count),refObj.hasOwnProperty("isError")&&1==refObj.isError?HRCategory.ConfigureCategory.cancelContentBox(this):(refObj.linkOrder=i+1,assoContents.push(refObj))}),parentId.find("div.zp_dyn[linkId]").each(function(i){deleteLinks.push($(this).attr("linkId"))}),servDtl.assoContents=assoContents,servDtl.deleteLinks=deleteLinks.join(","),formData.append("serviceDtls",JSON.stringify(servDtl)),ZPServices.Configure.validateServiceName("sliderPopup",serviceDispName),ZPServices.Configure.validateSDesc("sliderPopup","svSDesc"),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?void CommonTemplates.saveComplete("submitBtn"):void $.ajax({url:"/services.zp?mode=update",type:"POST",data:formData,processData:!1,contentType:!1,async:!1,error:function(xhr){CommonTemplates.saveComplete("submitBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(data){if(CommonTemplates.saveComplete("submitBtn"),"success"==data.status){ZPServices.View.basicTabDetails(data),pageId.find("#edSrv").off("click").on("click",function(){ZPServices.Edit.editService(data)});var srvOwner={ownerTypeId:"",ownerValueId:"",dispName:""};data.serviceOwner.hasOwnProperty("dispName")&&(srvOwner.ownerTypeId=data.serviceOwner.ownerTypeId,srvOwner.ownerValueId=data.serviceOwner.ownerValueId,srvOwner.dispName=data.serviceOwner.dispName),ZPServices.addUpdateService(data.id,data.tabName,data.dispName,data.desc,data.icon,data.categoryId,srvOwner.ownerValueId,srvOwner.ownerTypeId,srvOwner.dispName,servDtl.enable_hrcase),parentId.find("[name=closeSlider]").trigger("click")}else ZPeople.Message.showFailureMsg(data.msg)}})}};var OWNER_EMPLOYEE=1,OWNER_DEPARTMENT=2,OWNER_GROUP=3,LINK_URL="0",LINK_FILE="2",ADD_ICON="IC-add",STATUS={},FEEDSTATUS={},CATEGORY_LIST=[],USERVIEW_CATEGORY_LIST=[],ADMINVIEW_CATEGORY_LIST=[],AGENTVIEW_CGY_LIST=[],PERIOD_OF_TIME=[],MORE_OPTION=[],DEFAULT_ICON="star",HR_CASE_ATTACHEMENTS="1",HR_CATEGORY_ATTACHEMENTS="2",HRCASE_FAQ_ATTACHEMENTS="3",MAX_EDITOR_HEIGHT=200,SUBMIT_CASE="submitCase",DEFAULT_GENERAL_CATEGORY="1",SERVICE_CATEGORY="2",LOCATION_DROPDOWN={},RECORDS_PER_PAGE=25,USER_CGY_LISTING="userListing",ADMIN_CGY_LISTING="adminListing",AGENT_CGY_LISTING="agentListing",USER_VIEW="userView",ADMIN_VIEW="adminView",REQ_TYPE_MYREQUEST="myRequest",REQ_TYPE_MYCASES="myCase",REQ_TYPE_ALLCASES="allCase",REQ_TYPE_UNASSIGNCASES="unassignCases",REQ_TYPE_FOLLOWS="followedCases",ADMIN_REPORT="adminreport",USER_REPORT="userreport",AGENT_REPORT="agentreport",HRCaseTableName="P_HR_Case",POST="POST",HRCategory={adminDetails:{},userDetails:{},manageUrl:function(){var url=Layout.Page.hash;$.isEmptyObject(STATUS)&&HRCases.getStatusList(),(-1!==url.indexOf("#hrcase/category/")||-1!==url.indexOf("#hrcase/settings/"))&&(Layout.Page.container.find("#categoryHeader #cgyCloseBtn").remove(),Layout.Page.container.find("#showNotes").hasClass("shw")?pageId.find("#showNotes").removeClass("shw"):"",-1!==url.indexOf("#hrcase/settings/")?(isadmin||isManageHRCase)&&(HRCase.Header.getCategoryHeader(ADMIN_CGY_LISTING),-1!==url.indexOf("#hrcase/settings/categorylist")&&HRCategory.showPage("adminCategoryList"),-1!==url.indexOf("#hrcase/settings/categoryview")&&(Layout.Page.container.find("#categoryHeader .zp_hdtit").append('<i id="cgyCloseBtn" class="IC-cls"  title='+ZPI18N.getString("zp.close")+' onclick="HRCategory.closeSlide()"></i>'),HRCategory.View.getAdminPage(Layout.Page.childUrlParam.categoryid))):(HRCase.Header.getCategoryHeader(USER_CGY_LISTING),-1!==url.indexOf("#hrcase/category/add")&&(isadmin||isManageHRCase)&&(HRCase.Header.getCategoryHeader(ADMIN_CGY_LISTING),HRCategory.ConfigureCategory.addCategoryPage()),-1!==url.indexOf("#hrcase/category/list")&&HRCategory.showPage("userCategoryList"),-1!==url.indexOf("#hrcase/category/view")&&(Layout.Page.container.find("#categoryHeader .zp_hdtit").append('<i id="cgyCloseBtn" class="IC-cls" title='+ZPI18N.getString("zp.close")+' onclick="HRCategory.closeSlide()"></i>'),HRCategory.View.getUserPage(Layout.Page.childUrlParam.categoryid))),-1===url.indexOf("#hrcase/category/add")&&Layout.Page.container.find("#newcg").removeClass("zp_shw"))},showPage:function(pageDiv){var pageId=Layout.Page.container,pageList=["userCategoryList","adminCategoryList","userviewCgy","aviewCgy"];$.each(pageList,function(i,page){page==pageDiv?pageId.find("#"+page).removeClass("zp_dyn"):pageId.find("#"+page).addClass("zp_dyn")})},getIconColor:function(indexVal){var iconColor="GC",text=indexVal%4+1;return iconColor+text+""},closeSlide:function(){-1!==Layout.Page.hash.indexOf("#hrcase/category/add")?window.location.href="#hrcase/settings/categorylist":-1!==Layout.Page.hash.indexOf("#hrcase/category/")?window.location.href="#hrcase/category/list":-1!==Layout.Page.hash.indexOf("#hrcase/settings/")&&(window.location.href="#hrcase/settings/categorylist")},getCgyList:function(mode){var caseCatalog={method:"fetchCategoryList",conreqcsr:csrfToken,mode:mode};$.ajax({url:"/listAllCatalogs.zp",type:"POST",data:caseCatalog,async:!1,success:function(data){switch(mode){case SUBMIT_CASE:CATEGORY_LIST=data;break;case USER_CGY_LISTING:USERVIEW_CATEGORY_LIST=data;break;case ADMIN_CGY_LISTING:ADMINVIEW_CATEGORY_LIST=data;break;case AGENT_CGY_LISTING:AGENTVIEW_CGY_LIST=data}}})}};HRCategory.UserViewCategoryList={getMyHrCategoryList:function(){var pageId=Layout.Page.container,contentDiv="userCategoryList",cloneRow="userCategoryRow",caseCatalog={method:"fetchCategoryList",conreqcsr:csrfToken,mode:USER_CGY_LISTING};$.ajax({url:"/listAllCatalogs.zp",type:POST,data:caseCatalog,async:!1,success:function(data){data.viewUrl="#hrcase/category/view-categoryid:",USERVIEW_CATEGORY_LIST=data,pageId.find("#"+contentDiv).empty(),HRCase.Header.getCategoryHeader(USER_CGY_LISTING),HRCategory.UserViewCategoryList.getCategoryList(data,contentDiv,cloneRow),pageId.find("#"+contentDiv).removeClass("zp_dyn")}})},getCategoryList:function(data,contentDiv,cloneRow){var pageId=Layout.Page.container;0==pageId.find("div[categoryId]").length&&pageId.find("#"+contentDiv+" div").remove(),0!=data.length?$.each(data,function(index,value){var catalogRow=pageId.find("#"+cloneRow).clone();$(catalogRow).removeAttr("id"),$(catalogRow).removeClass("zp_dyn"),$(catalogRow).attr("categoryId",this.categoryId),value.hasOwnProperty("isAgent")&&value.isAgent&&$(catalogRow).find("[name=cgyDtl]").append('<i title="'+ZPI18N.getString("zp.youareanagent")+'" class="IC-per-my"></i>');var icon=Icons.getIconClass(this.categoryIcon);$(catalogRow).find("[name=icon]").addClass(icon.iconClass),$(catalogRow).closest("div").addClass(icon.iconColor),$(catalogRow).find("[name=categoryName]").html(this.categoryName),null!=this.categoryShortDescription&&$(catalogRow).find("[name=desc]").html(this.categoryShortDescription),$(catalogRow).find("[name=moreinfo]").click(function(e){e.stopPropagation(),e.preventDefault(),window.location.href=data.viewUrl+value.categoryId}),$(catalogRow).find("[name=askUs]").click(function(e){e.stopPropagation(),e.preventDefault(),HRCase.AddCase.addCasePage("",value.categoryId)}),pageId.find("div#"+contentDiv).append(catalogRow)}):0==data.length&&0==pageId.find("div[categoryId]").length&&pageId.find("#userCategoryList").append(CommonTemplates.noDataSVG("userCategoryList",!0,ZPI18N.getString("zp.nodatafound"))),data.length==RECORDS_PER_PAGE&&ZPeople.FireScroll.reset()}},HRCategory.adminViewCategoryList={sortColumn:function(){var pageId=Layout.Page.container,jsonObj=[];pageId.find("#adminCategoryList div[categoryid]").each(function(){var id=$(this).attr("categoryid");jsonObj.push(id)});var params={method:"reorderCategoryList",conreqcsr:csrfToken,sequenceList:JSON.stringify(jsonObj)};$.ajax({url:"/reorderAllCatalogs.zp",type:POST,data:params,async:!1,success:function(data){}})},getMyHrCategoryList:function(){var pageId=Layout.Page.container,contentDiv="adminCategoryList",cloneRow="adminCategoryRow",params={method:"fetchCategoryList",conreqcsr:csrfToken,mode:ADMIN_CGY_LISTING};$.ajax({url:"/listAllCategories.zp",type:POST,data:params,async:!1,success:function(data){ADMINVIEW_CATEGORY_LIST=data,data.viewUrl="#hrcase/settings/categoryview-categoryid:",pageId.find("#"+contentDiv).empty(),HRCase.Header.getCategoryHeader(ADMIN_CGY_LISTING),HRCategory.adminViewCategoryList.getCategoryList(data,contentDiv,cloneRow),pageId.find("#"+contentDiv).removeClass("zp_dyn")}})},getCategoryList:function(data,contentDiv,cloneRow){var pageId=Layout.Page.container;0==pageId.find("div[categoryId]").length&&pageId.find("#"+contentDiv+" div").remove(),0!=data.length?$.each(data,function(index,value){var catalogRow=pageId.find("#"+cloneRow).clone();value.isEnabled||($(catalogRow).addClass("zp_op5"),$(catalogRow).find("[name=count]").closest("div").addClass("zp_dyn")),$(catalogRow).removeAttr("id"),$(catalogRow).removeClass("zp_dyn"),$(catalogRow).attr("categoryId",this.categoryId),"undefined"==typeof hCLocAccess&&value.isEnabled&&$('<i class="CR-drag"></i>').insertBefore($(catalogRow).find("[name=icon]"));var icon=Icons.getIconClass(this.categoryIcon);$(catalogRow).find("[name=icon]").addClass(icon.iconClass),$(catalogRow).find("[name=categoryName]").html(this.categoryName),null!=this.categoryShortDescription&&$(catalogRow).find("[name=desc]").html(this.categoryShortDescription),$(catalogRow).find("[name=count]").html(this.count),$(catalogRow).find("[name=caselist]").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),window.location.href="#hrcase/allcases/list-categoryid:"+value.categoryId+"/status:1"}),$(catalogRow).click(function(e){e.stopPropagation(),e.preventDefault(),window.location.href=data.viewUrl+value.categoryId}),pageId.find("div#"+contentDiv).append(catalogRow)}):0==data.length&&0==pageId.find("div[categoryId]").length&&pageId.find("#adminCategoryList").append(CommonTemplates.noDataSVG("adminCategoryList",!0,ZPI18N.getString("zp.nodatafound"))),data.length==RECORDS_PER_PAGE&&ZPeople.FireScroll.reset()}};var HRCaseFAQ={ALL_LOCATION_ID:"0",FAQ_LOCATION_DROPDOWN:{},selectLocation:function(locationId,sourceObj){Layout.Page.container;locationId==HRCaseFAQ.ALL_LOCATION_ID?($(sourceObj).attr("selectedIds",""),$(sourceObj).siblings("div[class=zp_Tg]").remove(),$(sourceObj).zpselect({selectedVal:[{id:HRCaseFAQ.ALL_LOCATION_ID,text:ZPI18N.getString("zp.alllocations")}],checkbox:!0}),ZPMenu.removeDropDown(!0,sourceObj,"zp_drop")):ZPMenu.clearValue($(sourceObj).siblings("div.zp_Tg").find("i[id=0]"),$(sourceObj),"")},checkEmptyError:function(id){var pageId=Layout.Page.container,isEmpty=!1,value=pageId.find("#"+id).val();return"faqLocInput"==id&&(value=pageId.find("#"+id).attr("selectedids")),(""==value||null==value||void 0==value)&&(CommonTemplates.setErrorMessageinTextBox(pageId.find("#"+id)),isEmpty=!0),isEmpty},closePage:function(){var pageId=Layout.Page.container;pageId.find("#newFAQ").removeClass("zp_shw")},removeFileDiv:function(obj){Layout.Page.container;""!=$(obj).closest("div.attachedFile").attr("fileid")&&void 0!=$(obj).closest("div.attachedFile").attr("fileid")?$(obj).closest("div.attachedFile").addClass("zp_dyn"):$(obj).closest("div.attachedFile").remove()}};HRCategory.cgydropdown=function(mode){var allfn="",params=[],categoryList=[];switch(mode=void 0==mode?SUBMIT_CASE:mode){case SUBMIT_CASE:$.isEmptyObject(CATEGORY_LIST)&&HRCategory.getCgyList(mode),categoryList=CATEGORY_LIST;break;case USER_CGY_LISTING:$.isEmptyObject(USERVIEW_CATEGORY_LIST)&&HRCategory.getCgyList(mode),categoryList=USERVIEW_CATEGORY_LIST;break;case ADMIN_CGY_LISTING:$.isEmptyObject(ADMINVIEW_CATEGORY_LIST)&&HRCategory.getCgyList(mode),categoryList=ADMINVIEW_CATEGORY_LIST;break;case AGENT_CGY_LISTING:$.isEmptyObject(AGENTVIEW_CGY_LIST)&&HRCategory.getCgyList(mode),categoryList=AGENTVIEW_CGY_LIST}allfn=HRCases.changeIconAddCase,$.each(categoryList,function(index,value){var param1={};param1.value=value.categoryName,param1.id=value.categoryId,param1.icon=value.categoryIcon,param1.iconClass="zp_Si "+Icons.getIconClass(this.categoryIcon).iconClass,params.push(param1)});var menuparameter={id:"cgyList",search:!0,data:params,callback:allfn};return menuparameter},HRCategory.View={cloneAgentRow:function(data,returnTagOnly){var html="",agentTag="";if(!$.isEmptyObject(data)){var src="",agentZuid="",alt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.owner)));if(data.agentTypeId==OWNER_EMPLOYEE){var userDtl=ZPeople.getUserDetailsById(data.agentValueId);src=userDtl.avatar,agentZuid=userDtl.id}var agentData=[{text:data.owner,imageSrc:src,imageAlt:alt,imgZuid:agentZuid}],agentTag=HRCaseCommon.cloneTag(agentData);if(returnTagOnly)return agentTag;html='<div class="zp_txt"><div class="zp_ttl"><span>'+ZPI18N.getString("zp.agent")+"</span></div>"+agentTag+"</div>"}return html},cloneContentRow:function(data,categoryId,returnContentListOnly){var contentListHtml=$('<ul class="zp_Alst"></ul>'),linkName="",tempDiv=$("<div></div>");if(data.length>0){if($.each(data,function(i,value){var contentList=$("<li><a></a></li>"),icon="IC-url",title="";switch(value.formType){case LINK_URL:icon="IC-url",value.link=value.link.match(/^http[s]*:\/\//)?escape(value.link):"https://"+escape(value.link),title=value.link,contentList.find("a").attr("rel","noopener noreferrer"),contentList.find("a").attr("onclick","window.open('"+value.link+"','_blank');"),contentList.find("a").attr("title",decodeURIComponent(title));break;case LINK_FILE:icon="IC-docs",title=value.link.split("/")[value.link.split("/").length-1];var extn="";-1!=value.link.lastIndexOf(".")&&(extn=value.link.substr(value.link.lastIndexOf(".")+1,value.link.length)),linkName=""!=value.linkName?value.linkName:title,contentList.find("a").attr("onclick","HRCaseCommon.getFileContent('"+value.linkId+"','"+categoryId+"','"+HR_CATEGORY_ATTACHEMENTS+"','"+escape(linkName)+"','"+escape(extn)+"')")}linkName=""!=value.linkName?value.linkName:title,contentList.find("i").attr("class",icon),contentList.find("a").html('<i class="'+icon+'"></i>'+linkName),contentListHtml.append(contentList)}),returnContentListOnly)return contentListHtml;tempDiv.html('<div id="vcont" class="zp_txt"><div id="vcontEdit" class="zp_ttl"><span>'+ZPI18N.getString("zp.associatedcontent")+'</span></div><div id="vcontent"></div></div>'),tempDiv.find("#vcontent").html(contentListHtml)}return tempDiv.html()},cloneLocationDetailsBox:function(data,isViewOnly){var locationName=data.isAllLoc?ZPI18N.getString("zp.alllocations"):HRCategory.View.getLocationNames(data.locationId),icMenu=[],noDelete=data.typeOthers==DEFAULT_GENERAL_CATEGORY&&data.isAllLoc,locationarr=data.locationId.split(",");$.each(locationarr,function(key,val){HRCategory.ConfigureCategory.removeFromLocationList(val)});var deleteParams="this"+(data.isAllLoc?"":",'"+data.locationGroupId+"','"+data.locationId+"','"+data.typeOthers+"'"),deleteMethod="HRCategory.Edit.deleteLocationConfig("+deleteParams+")",editIcon="";if(!isViewOnly)if("undefined"!=typeof hCLocAccess){var res=$.grep(locationarr,function(ele){return $.inArray(ele,hCLocAccess)<0});res.length<=0&&(editIcon='<i class="IC-pen-1px"  data-placement="bottom" data-toggle="tooltip" data-original-title='+ZPI18N.getString("zp.edit")+' id="editLocConf"></i>',icMenu.push({attributes:{id:"delLocConf",onclick:deleteMethod},iconsList:[{"class":"IC-delete","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.delete")}]}))}else editIcon='<i class="IC-pen-1px"   data-placement="bottom" data-toggle="tooltip" data-original-title='+ZPI18N.getString("zp.edit")+' id="editLocConf"></i>',icMenu.push({attributes:{id:"delLocConf",onclick:deleteMethod},iconsList:[{"class":"IC-delete","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.delete")}]});var iconMenu=CommonTemplates.getIconMenuBar(icMenu);noDelete&&(iconMenu="");var confDtlHTml=HRCategory.View.cloneAgentRow(data.categoryAgents)+""+HRCategory.View.cloneContentRow(data.categoryReferences,Layout.Page.childUrlParam.categoryid),html=(""!=confDtlHTml?'<div id="confDtl" locationGroupId='+data.locationGroupId+">"+confDtlHTml+"</div>":"",'<div class="zp_Clbx" locGrp='+data.locationGroupId+'><div class="zp_ttl"><span><i class="IC-location-1px"></i>'+locationName+"</span>"+editIcon+'<div class="zp_frt zp_micn">'+iconMenu+"</div></div>"+confDtlHTml+"</div>");return html},toggleView:function(obj){$(obj).closest("div[locGrp]").find("#confDtl").toggleClass("zp_dyn"),$(obj).closest("div[locGrp]").find("#confDtl").hasClass("zp_dyn")?$(obj).find("i").attr("class","IC-ar-top"):$(obj).find("i").attr("class","IC-ar-dwn")},getLocationNames:function(locationIds){var locationarr=locationIds.split(","),locationNameArr=[];return $.isEmptyObject(ZPUtil.Location.ALL_LOCATION)&&ZPUtil.Location.load(!0),$.each(locationarr,function(key,val){locationNameArr.push(ZPUtil.Location.ALL_LOCATION[val])}),locationNameArr.join(", ")},updateFAQData:function(data,categoryId,mode,operation){var categoryDetails={};if(categoryDetails=mode==ADMIN_VIEW?HRCategory.adminDetails[categoryId]:HRCategory.userDetails[categoryId],void 0!=categoryDetails){if("add"==operation)categoryDetails.faqList.push(data[0]);else{var faqID=data[0].faqID;$.each(categoryDetails.faqList,function(index,faq){return faq.faqID==faqID?("edit"==operation?categoryDetails.faqList[index]=data[0]:"delete"==operation&&categoryDetails.faqList.splice(index,1),!1):void 0})}mode==ADMIN_VIEW?HRCategory.adminDetails[categoryId]=categoryDetails:HRCategory.userDetails[categoryId]=categoryDetails}},getUserPage:function(categoryId){var categoryData=(Layout.Page.container,Layout.Page.hash,HRCategory.userDetails[categoryId]);if(void 0==categoryData||$.isEmptyObject(categoryData)){var categoryprm={method:"fetchCatalogDetails",categoryId:categoryId,conreqcsr:csrfToken,mode:USER_VIEW};$.ajax({url:"/fetchCatalog.zp",type:"POST",data:categoryprm,async:!1,success:function(data){"failure"===data.status?HRCategory.closeSlide():(HRCategory.userDetails[categoryId]=data,HRCategory.View.viewUserPage(data,categoryId))}})}else HRCategory.View.viewUserPage(categoryData,categoryId)},viewUserPage:function(data,categoryId){var pageId=Layout.Page.container;Layout.Page.hash;pageId.find("#userviewCgy").find("div[locGrp]").remove(),HRCase.Header.getCategoryHeader(USER_VIEW,{name:data.categoryName,shrtDesc:data.categoryShortDescription,iconClass:Icons.getIconClass(data.categoryIcon).iconClass}),pageId.find("#vCgyName").html('<i id="cIcon" class="zp_Si '+Icons.getIconClass(data.categoryIcon).iconClass+'"></i><span id="cName" >'+data.categoryName+'</span><label><font title="'+data.categoryShortDescription+'">'+data.categoryShortDescription+"</font></label>"),CommonTemplates.checkEditorEmpty(data.description)?pageId.find("[type=desc]").closest("div").addClass("zp_dyn"):pageId.find("[type=desc]").closest("div").removeClass("zp_dyn"),pageId.find("#vDesc").html(ZPFeeds.Activity.getSmileys(data.description)),$.each(data.categoryConfiguration,function(i,v){if(pageId.find("#vagent").html(HRCategory.View.cloneAgentRow(v.categoryAgents,!0)),pageId.find("#vcontent").html(""),pageId.find("#vcont").removeClass("zp_dyn"),data.assocontentOwners.length<=0){var contrws=HRCategory.View.cloneContentRow(v.categoryReferences,categoryId,!1);""!=contrws?pageId.find("#vcont").replaceWith(HRCategory.View.cloneContentRow(v.categoryReferences,categoryId,!1)):pageId.find("#vcont").addClass("zp_dyn")}else{pageId.find("#editACont").remove(),pageId.find("#vcontEdit span").append('<i data-placement="bottom" data-toggle="tooltip" data-original-title='+ZPI18N.getString("zp.edit")+' id="editACont" class="IC-pen-1px"></i>'),pageId.find("#editACont").off("click"),pageId.find("#editACont").on("click",function(){HRCategory.Edit.editAssociatedContent(data.assocontentOwners)});var contRow=HRCategory.View.cloneContentRow(v.categoryReferences,categoryId,!0);""==contRow&&(contRow=CommonTemplates.noDataSVG("vcontEdit",!1,ZPI18N.getString("zp.noassociatedcontents"))),pageId.find("#vcontent").append(contRow)}}),pageId.find("#userviewCgy").find("#faqDiv").remove(),data.isAgent===!0?pageId.find("#userviewCgy").append(FAQ.faqList(data.faqList,data.isAgent,!1,USER_VIEW)):data.isAgent===!1&&0!==data.faqList.length&&pageId.find("#userviewCgy").append(FAQ.faqList(data.faqList,data.isAgent,!1,USER_VIEW)),HRCategory.showPage("userviewCgy")},getAdminPage:function(categoryId){var categoryData=(Layout.Page.container,Layout.Page.hash,HRCategory.adminDetails[categoryId]);if(void 0==categoryData||$.isEmptyObject(categoryData)){var categoryprm={method:"fetchCatalogDetails",categoryId:categoryId,conreqcsr:csrfToken,mode:ADMIN_VIEW};$.ajax({url:"/fetchCategoryDetails.zp",type:"POST",data:categoryprm,async:!1,success:function(data){"failure"===data.status?HRCategory.closeSlide():(HRCategory.adminDetails[categoryId]=data,HRCategory.View.viewAdminPage(data,categoryId))}})}else HRCategory.View.viewAdminPage(categoryData,categoryId)},confirmationPopup:function(msg,calback){ZPeople.BSModal.confirm(calback,"",ZPI18N.getString(msg))},viewAdminPage:function(data,categoryId){var pageId=Layout.Page.container,isViewOnly=(Layout.Page.hash,data.typeOthers==SERVICE_CATEGORY?!0:!1);HRCategory.ConfigureCategory.resetLocationList(),HRCategory.ConfigureCategory.restrictLocList(),pageId.find("#adminviewCgy").find("div[locGrp]").remove(),pageId.find("#adminviewCgy").find("div.zp_sbx").remove();var headerData={name:data.categoryName,shrtDesc:data.categoryShortDescription,iconClass:Icons.getIconClass(data.categoryIcon).iconClass,isViewOnly:isViewOnly||data.typeOthers==DEFAULT_GENERAL_CATEGORY};pageId.find("#hdName, #editdesc").off("click"),pageId.find("#editdesc").addClass("zp_dyn"),data.typeOthers==DEFAULT_GENERAL_CATEGORY||isViewOnly||"undefined"==typeof hCLocAccess&&(headerData.isEnabled=data.isEnabled),HRCase.Header.getCategoryHeader(ADMIN_VIEW,headerData),isViewOnly||(pageId.find("#editdesc").removeClass("zp_dyn"),pageId.find("#hdName, #editdesc").on("click",function(){HRCategory.Edit.editBasicDetailBox(data)}));var hasGeneralSettings=!1;if(CommonTemplates.checkEditorEmpty(data.description)?pageId.find("#aDescription").closest("div").addClass("zp_dyn"):pageId.find("#aDescription").closest("div").removeClass("zp_dyn"),pageId.find("#vCgyDesc").html(ZPFeeds.Activity.getSmileys(data.description)),data.categoryConfiguration.sort(function(a,b){var aName=a.locationGroupId,bName=b.locationGroupId;return a.isAllLoc?-1:b.isAllLoc?1:bName>aName?-1:aName>bName?1:0}),$.each(data.categoryConfiguration,function(i,v){v.typeOthers=data.typeOthers,hasGeneralSettings=v.isAllLoc?!0:hasGeneralSettings,pageId.find("#adminviewCgy").append(HRCategory.View.cloneLocationDetailsBox(v,isViewOnly)),pageId.find("#adminviewCgy").find("div[locGrp]").last().find("#editLocConf").off("click"),isViewOnly||pageId.find("#adminviewCgy").find("div[locGrp]").last().find("#editLocConf").on("click",function(){HRCategory.Edit.editLocationConfigBox(v)})}),!isViewOnly){var needLocSettings=$.isEmptyObject(ZPUtil.Location.ALL_LOCATION)||$.isEmptyObject(LOCATION_DROPDOWN)?!1:!0;if(pageId.find("#adminviewCgy").append(HRCategory.Edit.cloneAddConfigBox(!hasGeneralSettings,needLocSettings)),needLocSettings||!hasGeneralSettings){var confBoxData={};confBoxData.typeOthers=data.typeOthers,pageId.find("#genSet").off("click"),pageId.find("#genSet").on("click",function(){confBoxData.isAllLoc=!0,HRCategory.Edit.editLocationConfigBox(confBoxData)}),pageId.find("#locSet").off("click"),pageId.find("#locSet").on("click",function(){confBoxData.isAllLoc=!1,HRCategory.Edit.editLocationConfigBox(confBoxData)})}}HRCategory.showPage("aviewCgy"),pageId.find("#aviewCgy").find("#faqDiv").remove(),pageId.find("#aviewCgy").append(FAQ.faqList(data.faqList,!0,!1,ADMIN_VIEW))}},HRCategory.ConfigureCategory={chooseCategoryIcon:function(obj){var params=[];$.each(Icons.ICONS_LIST,function(i,v){if("add"!=i){var param1={iconVal:i,value:"zp_Si "+v};params.push(param1)}}),$(obj).zparrowmenu({id:"iconsList",data:params,icon:!0,callback:function(listedObj,sourceObj){$(sourceObj).attr("class",$(listedObj).attr("name"))}})},chooseFile:function(obj){var pageId=Layout.Page.container;pageId.find("[id=browseFile]").trigger("click"),pageId.find("[id=browseFile]").on("change",function(){var filename=$(this).val();filename=filename.replace("C:\\fakepath\\",""),HRCategory.ConfigureCategory.setFileDetails(pageId.find("[id=browseFile]")[0].files[0],filename,obj,"localUpload")})},chooseCloudFile:function(obj){Layout.Page.container;HRCategory.calledObject=obj,Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl,"HRCategory"),$(obj).closest("[id=fileDiv]").find("[id=linkDispName]").val(decodeURIComponent(Files.uploadedDocObj.docName))},setFileDetails:function(file,filename,obj,mode){$(obj).closest("#fileNameDiv").addClass("zp_aftFle"),$(obj).closest("div[id=fileDiv]").data("uploadMode",mode),$(obj).closest("div[id=fileDiv]").data("uploadedFile",file),$(obj).closest("[id=fileDiv]").find("[id=linkDispName]").val(filename),$(obj).closest("div").html('<i class="IC-note"></i><span>'+ZPeople.escapeHtml(filename)+"</span>")},resetLocationList:function(){$.isEmptyObject(ZPUtil.Location.ALL_LOCATION)&&ZPUtil.Location.load(!0);for(var k in ZPUtil.Location.ALL_LOCATION)LOCATION_DROPDOWN[k]=ZPUtil.Location.ALL_LOCATION[k]},chooseLocation:function(){var params=[];$.each(LOCATION_DROPDOWN,function(i,v){var param1={id:i,value:v};params.push(param1)});var menuProperties={id:"locationList",data:params,checkbox:!0,callback:function(obj,obj1){var locationId=$(obj).attr("id");HRCategory.ConfigureCategory.removeFromLocationList(locationId)},callbackOnCancel:function(obj,obj1){var locationId=$(obj).find("i").attr("id");HRCategory.ConfigureCategory.addToLocationList(locationId)}};return menuProperties},restrictLocList:function(){"undefined"!=typeof hCLocAccess&&$.each(LOCATION_DROPDOWN,function(key,value){-1==$.inArray(key.toString(),hCLocAccess)&&delete LOCATION_DROPDOWN[key]})},addToLocationList:function(locationId){var locationName=ZPUtil.Location.ALL_LOCATION[locationId];LOCATION_DROPDOWN[locationId]=locationName},removeFromLocationList:function(locationId){$.each(LOCATION_DROPDOWN,function(key,value){key==locationId&&delete LOCATION_DROPDOWN[key]})},resetPage:function(){var pageId=Layout.Page.container,parentId=pageId.find("#newcg");CommonTemplates.removeErrorMessagesinContainerDiv("newcg");var inputProperties={isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.categoryname"),leftIcon:"zp_Si "+Icons.getIconClass("star").iconClass};CommonTemplates.getInputTextIcon({id:"newCgyName"},inputProperties,parentId.find("[id=cgyNameDiv]")),parentId.find("[id=cgyNameDiv]").find("i.zp_Si").off("click").on("click",function(){HRCategory.ConfigureCategory.chooseCategoryIcon(this)}),CommonTemplates.getInputTextIcon({id:"newCgyPrefix",maxlength:"5"},{inputHeaderName:ZPI18N.getString("zp.prefix"),isMandatory:!1},parentId.find("[id=cgyPrefixDiv]")),CommonTemplates.getInputTextBox({id:"newCgyShortDesc"},ZPI18N.getString("zp.shortDescription"),!0,parentId.find("[id=cgyShortDescDiv]")),CommonTemplates.getInputTextBox({id:"newCgyDescEditor"},ZPI18N.getString("zp.description"),!1,parentId.find("[id=cgyDesEditor]")),parentId.find("#newCgyDescEditor").one("focus",function(){EditorTemplate.editorConstruct("cgyDesEditor",!1,"newcg",!0),EditorTemplate.replaceWithEditor("cgyDesEditor","descEditor",!0)}),HRCategory.ConfigureCategory.resetLocationList(),pageId.find(".zp_sbx").remove(),pageId.find("#addCgyContent").append(HRCategory.ConfigureCategory.cloneLocationconfigBox("undefined"!=typeof hCLocAccess,"undefined"==typeof hCLocAccess||"undefined"!=typeof hCLocAccess&&hCLocAccess.length>1,!0)),HRCategory.ConfigureCategory.restrictLocList(),CommonTemplates.getSelectMenu(HRCategory.ConfigureCategory.chooseLocation(),pageId.find("[id=cgyLocationDiv]").last(),{id:"newCgyLoc",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.locations")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.locations")}),CommonTemplates.getSelectMenu(HRCaseDropdown.cgymemberdropdown(),pageId.find("#addCgyContent #cgyAgentDiv").last(),{id:"newCgyAgent",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.agent")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.agent")})},addCategoryPage:function(){if(isadmin||isManageHRCase){var pageId=Layout.Page.container;HRCategory.ConfigureCategory.resetPage(),pageId.find("#newcg").addClass("zp_shw"),pageId.find("#newcg").find("[id=cgyNameDiv]").find("i.zp_Si").trigger("click"),setTimeout(function(){pageId.find("#newCgyName").trigger("focus")},400)}else HRCategory.closeSlide()},cloneLocationconfigBox:function(needLocation,needAddConfigBox,needCloseBox){var html="",isAllLoc=needLocation?'isAllLoc = "false"':'isAllLoc = "true"',locationHtml=needLocation?'<div id="cgyLocationDiv"></div><span class="etxt zp_dyn"></span>':"",agentsHtml='<div id="cgyAgentDiv"></div>',assoContents='<div id="cgyContentDiv" class="zp_sttl"><span>'+ZPI18N.getString("zp.associatedcontent")+"</span></div>"+HRCategory.ConfigureCategory.cloneAddContentsBox(),addConfigBox=needAddConfigBox?HRCategory.ConfigureCategory.addConfBox():"",closeIcon=needCloseBox?'<i class="IC-delete" onclick="HRCategory.ConfigureCategory.closeConfigBox(this)"></i>':"",boxFeel=needCloseBox?' class="zp_sbx" ':"";return html='<div id="configBox" '+isAllLoc+boxFeel+' locGrp = "">'+locationHtml+agentsHtml+assoContents+closeIcon+'</div><span class="etxt zp_dyn"></span>'+addConfigBox},addConfBox:function(){var addConfigBox='<div class="zp_sbx"><span class="zp_link" onclick="HRCategory.ConfigureCategory.insertConfigBox(this)">'+ZPI18N.getString("zp.configurelocationsettings")+"</span></div>";return addConfigBox},insertConfigBox:function(obj){var configObj={},isFBox=!0,pageId=Layout.Page.container;pageId.find("div[id=configBox]:not([isallloc=true])").length>0&&(configObj=HRCategory.ConfigureCategory.validateLocationConfigBox(pageId.find("div[id=configBox]:not([isallloc=true])").last()),isFBox=!1),configObj.hasOwnProperty("isConfErr")&&1==configObj.isConfErr||!isFBox&&$.isEmptyObject(configObj)?(pageId.find("div[id=configBox]:not([isallloc=true])").last().next("span").html(ZPI18N.getString("zp.incompleteconfiguration")),pageId.find("div[id=configBox]:not([isallloc=true])").last().next("span").removeClass("zp_dyn")):configObj.hasOwnProperty("isError")||($(obj).closest("div").replaceWith(HRCategory.ConfigureCategory.cloneLocationconfigBox(!0,!0,!0)),CommonTemplates.getSelectMenu(HRCategory.ConfigureCategory.chooseLocation(),pageId.find("[id=cgyLocationDiv]").last(),{id:"newCgyLoc",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.locations")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.locations")}),CommonTemplates.getSelectMenu(HRCaseDropdown.cgymemberdropdown(),pageId.find("[id=cgyAgentDiv]").last(),{id:"newCgyAgent",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.agent")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.agent")}))},closeConfigBox:function(obj){if($(obj).closest("div[locGrp]").find("#newCgyLoc").length>0){var locationIds=$(obj).closest("div[locGrp]").find("#newCgyLoc").attr("selectedIds");if(void 0!=locationIds&&""!=locationIds){var locArr=locationIds.split(",");$.each(locArr,function(i,v){LOCATION_DROPDOWN[v]=ZPUtil.Location.ALL_LOCATION[v]})}}$(obj).closest("div[locGrp]").remove()},cloneAddContentsBox:function(){var html='<div class="zp_Add"><div><i class="IC-attcloud"></i><a onclick="HRCategory.ConfigureCategory.replaceWithContentBox(this,'+LINK_FILE+')">'+ZPI18N.getString("zp.attachment")+'</a></div><div><i class="IC-url"></i><a onclick="HRCategory.ConfigureCategory.replaceWithContentBox(this,'+LINK_URL+')">'+ZPI18N.getString("zp.associatedUrl")+'</a></div></div><div class="zp_note">'+ZPI18N.getString("zp.maxfsize",new Array("10","5MB"))+"</div>";return html},cloneAssociatedURLBox:function(mode){var closeIcon="IC-cls-1px",borderClass="edit"==mode?"nobdr":"",innerHtml='<div class=" zp_fm"><div class="nobdr"><i class="IC-url"></i><input id="linkUrl" required="" placeholder="'+ZPI18N.getString("zp.associatedUrl")+'" type="text"></div></div><div class=" zp_fm"><div class="'+borderClass+'"><input id="linkDispName" required="" placeholder="'+ZPI18N.getString("zp.displayname")+'" type="text"></div></div><i class="'+closeIcon+'" onclick="HRCategory.ConfigureCategory.cancelContentBox(this)"></i>',html='<div class="zp_fc2" contType = "'+LINK_URL+'">'+innerHtml+'</div><span class="etxt zp_dyn"></span>';return html},cloneAssociatedDocumentsBox:function(mode){var closeIcon="IC-cls-1px",alignClass="edit"==mode?"zp_aftFle":"",innerHtml="";if("edit"==mode)var innerHtml='<div class="zp_fm '+alignClass+'" id="fileNameDiv"><div class="nobdr"><i class="IC-note"></i><span id="fName"></span></div></div><div class=" zp_fm"><div class="nobdr"><input id="linkDispName" required="" placeholder="'+ZPI18N.getString("zp.displayname")+'" type="text"></div></div><i class="'+closeIcon+'" onclick="HRCategory.ConfigureCategory.cancelContentBox(this)"></i></div>';else innerHtml='<div class="zp_fm '+alignClass+'" id="fileNameDiv"><div class="nobdr"><a onclick="HRCategory.ConfigureCategory.chooseFile(this)"><i class="IC-system"></i> '+ZPI18N.getString("zp.files.desktop")+'</a><a onclick="HRCategory.ConfigureCategory.chooseCloudFile(this)"><i class="IC-attcloud"></i>'+ZPI18N.getString("zp.files.cloud")+'</a></div></div><div class="zp_fm"><div><input id="linkDispName" required="" placeholder="'+ZPI18N.getString("zp.displayname")+'" type="text"></div></div><i class="'+closeIcon+'" onclick="HRCategory.ConfigureCategory.cancelContentBox(this)"></i></div>';var html='<div id="fileDiv" class="zp_fc2" contType = "'+LINK_FILE+'">'+innerHtml+'</div><span class="etxt zp_dyn"></span>';return html},replaceWithContentBox:function(obj,mode){var pageId=Layout.Page.container,newHtml="",refObj={};switch(pageId.find("div[conttype]").length>0&&(refObj=HRCategory.ConfigureCategory.validateContentBox(pageId.find("div[conttype]").last(),0)),mode.toString()){case LINK_URL:newHtml=HRCategory.ConfigureCategory.cloneAssociatedURLBox();break;case LINK_FILE:newHtml=HRCategory.ConfigureCategory.cloneAssociatedDocumentsBox()}$(newHtml).insertBefore($(obj).closest("div.zp_Add"))},cancelContentBox:function(obj){void 0!=$(obj).closest("div[conttype]").attr("linkId")&&""!=$(obj).closest("div.zp_fatt").attr("linkId")?$(obj).closest("div[conttype]").addClass("zp_dyn"):$(obj).closest("div[conttype]").remove()},saveCategory:function(){var pageId=Layout.Page.container,parentId=pageId.find("#newcg");CommonTemplates.waitTillSave("saveCatalog"),CommonTemplates.removeErrorMessagesinContainerDiv("newcg");var formData=new FormData;formData.append("conreqcsr",csrfToken),formData.append("methodName","saveCatalog");var categoryDetails={},categoryName=parentId.find("#newCgyName").val(),categoryShortDesc=parentId.find("#newCgyShortDesc").val(),prefixCase=parentId.find("#newCgyPrefix").val(),classList=parentId.find("[id=cgyNameDiv]").find("i.zp_Si").attr("class").split(" ");classList.splice($.inArray("zp_Si",classList),1);var categoryIcon=Icons.getIconName(classList[0]),editorId="descEditor",editor=ZPFeeds.Editor.editorList[editorId],description="";void 0!=editor&&(description=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1)),categoryDetails={categoryName:categoryName,categoryShortDescription:categoryShortDesc,prefixCase:prefixCase,categoryIcon:categoryIcon,description:description,isEnabled:!0,categoryId:""};var categoryConfig=[],hasAgent=!1;return categoryConfig=HRCategory.ConfigureCategory.saveLocationBasedConfiguration("newcg",formData),categoryConfig.length>0?$.each(categoryConfig,function(i,val){if(!$.isEmptyObject(val)){var agentObj=JSON.parse(val.categoryAgents);hasAgent=$.isEmptyObject(agentObj)?hasAgent:!0}}):hasAgent=!1,HRCategory.ConfigureCategory.validateCategoryName("newcg"),HRCategory.ConfigureCategory.validatePrefix("newcg"),HRCategory.ConfigureCategory.validateShortDescription("newcg"),parentId.find("div[id=configBox]:not([isallloc=true])").each(function(i){var configObj={};configObj=HRCategory.ConfigureCategory.validateLocationConfigBox($(this)),configObj.hasOwnProperty("isConfErr")&&1==configObj.isConfErr&&($(this).next("span").html(ZPI18N.getString("zp.incompleteconfiguration")),$(this).next("span").removeClass("zp_dyn"))}),hasAgent||(parentId.find("#genSettingError").html(ZPI18N.getString("zp.noagentserror")),parentId.find("#genSettingError").removeClass("zp_dyn")),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?(parentId.find("#addCgyContent").scrollTop(parentId.find("span[class=etxt]:not([class=zp_dyn])").first().offset().top+parentId.find("#addCgyContent").scrollTop()-parentId.find("#addCgyContent").offset().top),void CommonTemplates.saveComplete("saveCatalog")):(categoryDetails.categoryConfiguration=JSON.stringify(categoryConfig),formData.append("categoryParam",JSON.stringify(categoryDetails)),$.ajax({url:"/saveCatalog.zp",type:"POST",data:formData,contentType:!1,processData:!1,async:!1,error:function(xhr){CommonTemplates.saveComplete("saveCatalog");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(data){CommonTemplates.saveComplete("saveCatalog");var res=JSON.parse(data);"success"==res.status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.catalogsuccessmsg")),HRCategory.closeSlide(),HRCategory.adminViewCategoryList.getMyHrCategoryList(),HRCategory.ConfigureCategory.resetPage()):res.hasOwnProperty("isAvailable")&&!res.isAvailable?(CommonTemplates.setErrorMessageinTextBox($("#newcg").find("#newCgyName"),ZPI18N.getString("zp.categorynameexists")),parentId.find("#addCgyContent").scrollTop(parentId.find("span[class=etxt]:not([class=zp_dyn])").first().offset().top+parentId.find("#addCgyContent").scrollTop()-parentId.find("#addCgyContent").offset().top)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.catalogunsuccessmsg"))}}),void 0)},saveLocationBasedConfiguration:function(headerDiv,formData){var pageId=Layout.Page.container,parentId=pageId.find("#"+headerDiv),filecount=0,categoryConfig=[];return parentId.find("div[id=configBox]").each(function(i){var configObj={};configObj=HRCategory.ConfigureCategory.validateLocationConfigBox($(this),filecount,formData),configObj.hasOwnProperty("isConfErr")&&1==configObj.isConfErr?($(this).next("span").html(ZPI18N.getString("zp.incompleteconfiguration")),$(this).next("span").removeClass("zp_dyn")):configObj.hasOwnProperty("isError")||$.isEmptyObject(configObj)||(filecount=configObj.filecount,delete configObj.filecount,categoryConfig.push(configObj))}),categoryConfig},validateLocationConfigBox:function(object,filecount,formData,isEdit){var configObj={},isAllLoc=$(object).attr("isallloc"),isLocEmpty=!1,isAgentEmpty=!1,isContentEmpty=!1,locationGroupId=$(object).find("#newCgyLoc").attr("locationGroupId");locationGroupId=""!=locationGroupId&&void 0!=locationGroupId&&"true"!=isAllLoc?locationGroupId:"";var locationId=$(object).find("#newCgyLoc").attr("selectedIds");locationId="true"!=isAllLoc&&void 0!=locationId&&""!=locationId?locationId:"",isLocEmpty=""==locationId&&"true"!=isAllLoc?!0:!1;var categoryAgents={};categoryAgents.agentTypeId=$(object).find("#newCgyAgent").attr("agenttype"),categoryAgents.agentValueId=$(object).find("#newCgyAgent").attr("selectedIds"),isAgentEmpty=""==categoryAgents.agentValueId||void 0==categoryAgents.agentValueId?!0:!1;var cgyAgentId=$(object).find("#newCgyAgent").attr("cgyAgentId");categoryAgents.cgyAgentId=""!=cgyAgentId&&void 0!=cgyAgentId?cgyAgentId:"",isAgentEmpty&&(categoryAgents={});var categoryReferences=[],deleteLinks=[];return $(object).find("div[conttype]:not([class=zp_dyn]):not([linkId])").each(function(i){var refObj={};refObj=HRCategory.ConfigureCategory.validateContentBox($(this),filecount,formData),$(this).attr("contType")==LINK_FILE&&(filecount=refObj.file_count),refObj.hasOwnProperty("isError")&&1==refObj.isError?HRCategory.ConfigureCategory.cancelContentBox(this):(refObj.linkOrder=i+1,categoryReferences.push(refObj))}),$(object).find("div.zp_dyn[linkId]").each(function(i){deleteLinks.push($(this).attr("linkId"))}),isContentEmpty=$(object).find("div[conttype]").length<1?!0:isContentEmpty,isLocEmpty&&isContentEmpty&&isAgentEmpty?(HRCategory.ConfigureCategory.closeConfigBox(this),configObj):!isContentEmpty||!isAgentEmpty||"true"!=isAllLoc||void 0!=isEdit&&isEdit?(isLocEmpty?(configObj.isError=!0,CommonTemplates.setErrorMessageinTextBox($(object).find("#newCgyLoc"),ZPI18N.getString("zp.chooselocations"))):!isContentEmpty||!isAgentEmpty||void 0!=isEdit&&isEdit?configObj={isAllLoc:isAllLoc,locationGroupId:locationGroupId,locationId:locationId,categoryAgents:JSON.stringify(categoryAgents),categoryReferences:JSON.stringify(categoryReferences)}:(configObj.isError=!0,configObj.isConfErr=!0),configObj.deleteLinks=deleteLinks.length>0?deleteLinks.join(","):"",void 0!=formData&&(configObj.filecount=filecount),configObj):configObj},validateContentBox:function(object,filecount,formData){var isError=!1,formType=$(object).attr("contType"),linkName=$(object).find("#linkDispName").val(),refObj={};switch(refObj={linkId:"",linkName:"",link:"",formId:"",formType:formType,file_count:0},formType){case LINK_URL:refObj.link=$(object).find("#linkUrl").val(),isError=""==$.trim(refObj.link)?!0:isError,isError||(refObj.linkName=""!=linkName&&void 0!=linkName?linkName:refObj.link);break;case LINK_FILE:isError=void 0==$(object).data("uploadedFile")?!0:isError,isError||(filecount+=1,refObj.file_count=filecount,refObj.linkName=""!=linkName&&void 0!=linkName?linkName:"",void 0!=formData&&(formData.append("uploadMode_"+filecount,$(object).data("uploadMode")),"localUpload"==$(object).data("uploadMode")?formData.append("file_upload_"+filecount,$(object).data("uploadedFile")):formData.append("cloudUploadDoc_"+filecount,$(object).data("uploadedFile"))))}return isError&&(refObj.isError=isError),refObj},validateCategoryName:function(headerDiv,excludeName){var data=$.trim($("#"+headerDiv).find("#newCgyName").val());if(excludeName=void 0==excludeName?"":excludeName,ADMINVIEW_CATEGORY_LIST.length<=0&&HRCategory.getCgyList(ADMIN_CGY_LISTING),""==data||data.length>20){var errorMsg=ZPI18N.getString("zp.emptycategoryname");""!=data&&data.length>20&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.categoryname"),"20"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#newCgyName"),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#newCgyName"))},validatePrefix:function(headerDiv){$("#"+headerDiv).find("#newCgyPrefix").attr("maxlength","5");var data=$.trim($("#"+headerDiv).find("#newCgyPrefix").val());if(data.length>5){var errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.prefix"),"5"));CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#newCgyPrefix"),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#newCgyPrefix"))},validateShortDescription:function(headerDiv){var shortDesc=$("#"+headerDiv).find("#newCgyShortDesc").val(),data=$.trim(shortDesc);if(""==data||shortDesc.length>250){var errorMsg=ZPI18N.getString("zp.emptyshortdescription");shortDesc.length>250&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.description"),"250"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#newCgyShortDesc"),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#newCgyShortDesc"))},deleteCategory:function(){var params={conreqcsr:csrfToken,method:"deleteCategory",categoryId:Layout.Page.childUrlParam.categoryid};$.ajax({url:"/deleteCategory.zp",type:"POST",data:params,async:!1,success:function(data){"success"==data.status?(window.location.href="#hrcase/settings/categorylist",$("[id=adminCategoryList]").find('div[categoryid="'+params.categoryId+'"]').remove(),$("[id=userCategoryList]").find('div[categoryid="'+params.categoryId+'"]').remove()):ZPeople.Message.showFailureMsg(data.desc)}})},disableCategory:function(){var pageId=Layout.Page.container,params={conreqcsr:csrfToken,method:"disableCategory",categoryId:Layout.Page.childUrlParam.categoryid};$.ajax({url:"/disableCategory.zp",type:"POST",data:params,async:!1,success:function(data){if("success"==data.status){var cgyRow=Layout.Page.container.find("#adminCategoryList").find("div[categoryid="+Layout.Page.childUrlParam.categoryid+"]");cgyRow.addClass("zp_op5"),cgyRow.find("[name=count]").closest("div").addClass("zp_dyn"),cgyRow.find('[class="CR-drag"]').remove(),$("[id=userCategoryList]").find('div[categoryid="'+params.categoryId+'"]').remove();var enableButton='<button id="enableCgy" class="" onclick="HRCategory.ConfigureCategory.enableCategory()" >'+ZPI18N.getString("zp.enable")+"</button>";pageId.find("#disableCgy").replaceWith(enableButton),ZPeople.Message.showSuccessMsg("Category disabled successfully"),HRCategory.adminDetails[params.categoryId].isEnabled=!1}else ZPeople.Message.showFailureMsg(data.desc)}})},enableCategory:function(){var pageId=Layout.Page.container,params={conreqcsr:csrfToken,method:"enableCategory",categoryId:Layout.Page.childUrlParam.categoryid};$.ajax({url:"/enableCategory.zp",type:"POST",data:params,async:!1,success:function(data){if("success"==data.status){cgyRow=Layout.Page.container.find("#adminCategoryList").find("div[categoryid="+Layout.Page.childUrlParam.categoryid+"]"),cgyRow.removeClass("zp_op5"),cgyRow.find("[name=count]").closest("div").removeClass("zp_dyn"),$('<i class="CR-drag"></i>').insertBefore(cgyRow.find("[name=icon]"));var disableButton='<button id="disableCgy" class="dis" onclick="HRCategory.View.confirmationPopup(\'zp.catalogdisablemsg\', HRCategory.ConfigureCategory.disableCategory)">'+ZPI18N.getString("zp.disable")+"</button>";pageId.find("#enableCgy").replaceWith(disableButton),ZPeople.Message.showSuccessMsg("Category enabled successfully"),HRCategory.adminDetails[params.categoryId].isEnabled=!0}else ZPeople.Message.showFailureMsg(data.desc)}})}},HRCategory.Edit={openSlider:function(sliderName){$("body").append(CommonTemplates.sliderPop(!0));var parentId=$("#sliderPopup");parentId.find("#sliderName").html(sliderName),$("#sliderPopup").addClass("zp_shw"),parentId.find("#submitBtn").off("click"),CommonTemplates.saveComplete("submitBtn"),parentId.find("[name=closeSlider]").attr("onclick","HRCategory.Edit.closeSlider()"),parentId.find("[name=closeSlider]").attr("title",ZPI18N.getString("zp.close"))},closeSlider:function(){$("#sliderPopup").remove()},basicDetailHtml:function(){var html="",categoryName='<div id="cgyNameDiv" class="zp_lp zp_c7"></div>',categoryPrefix='<div id="cgyPrefixDiv" class="zp_c3"> </div><span class ="etxt zp_dyn"></span>',categoryShortDesc='<div id="cgyShortDescDiv"> </div><span class ="etxt zp_dyn"></span>',categoryDescEditor='<div id="cgyDEditor" class="zp_fm"></div>';return html=categoryName+categoryPrefix+categoryShortDesc+categoryDescEditor},editBasicDetailBox:function(data){HRCategory.Edit.openSlider(ZPI18N.getString("zp.basicdetails"));var parentId=$("#sliderPopup");parentId.find("#sliderContent").html(HRCategory.Edit.basicDetailHtml());var categoryName=data.categoryName;parentId.find("#submitBtn").off("click"),parentId.find("#submitBtn").on("click",function(){HRCategory.Edit.updateBasicDetails(categoryName)});var inputProperties={isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.categoryname"),leftIcon:"zp_Si "+Icons.getIconClass(data.categoryIcon).iconClass};CommonTemplates.getInputTextIcon({id:"newCgyName",value:categoryName},inputProperties,parentId.find("[id=cgyNameDiv]")),parentId.find("[id=cgyNameDiv]").find("label").addClass("zp_act"),parentId.find("[id=cgyNameDiv]").find("i.zp_Si").off("click").on("click",function(){HRCategory.ConfigureCategory.chooseCategoryIcon(this)}),CommonTemplates.getInputTextIcon({id:"newCgyPrefix",value:data.prefixCase,maxlength:"5"},{inputHeaderName:ZPI18N.getString("zp.prefix"),isMandatory:!1},parentId.find("[id=cgyPrefixDiv]")),CommonTemplates.getInputTextBox({id:"newCgyShortDesc",value:data.categoryShortDescription},ZPI18N.getString("zp.shortDescription"),!0,parentId.find("#cgyShortDescDiv")),EditorTemplate.editorConstruct("cgyDEditor",!1,"sliderContent",!0),EditorTemplate.replaceWithEditor("cgyDEditor","descEditor",!0),setTimeout(function(){parentId.find("#descEditor iframe").contents().find("body").html(ZPFeeds.getSmileysAndMentions(data.description,!1)),parentId.find("#cgyNameDiv").trigger("focus")},300)},updateBasicDetails:function(categoryName){var parentId=$("#sliderPopup"),params={conreqcsr:csrfToken,method:"singleFieldCategoryEdit",mode:"basicDetails",categoryId:Layout.Page.childUrlParam.categoryid},basicDetails={categoryId:params.categoryId};basicDetails.categoryName=parentId.find("#newCgyName").val(),basicDetails.categoryShortDescription=parentId.find("#newCgyShortDesc").val(),basicDetails.prefixCase=parentId.find("#newCgyPrefix").val();var classList=parentId.find("[id=cgyNameDiv]").find("i.zp_Si").attr("class").split(" ");classList.splice($.inArray("zp_Si",classList),1),basicDetails.categoryIcon=Icons.getIconName(classList[0]);var editorId="descEditor",editor=ZPFeeds.Editor.editorList[editorId];if(basicDetails.description="",void 0!=editor){var htmlContent=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1);basicDetails.description=ZPFeeds.getSmileysAndMentions(htmlContent,!1)}return params.categoryDetails=JSON.stringify(basicDetails),HRCategory.ConfigureCategory.validateCategoryName("sliderContent",categoryName),HRCategory.ConfigureCategory.validatePrefix("sliderContent"),HRCategory.ConfigureCategory.validateShortDescription("sliderContent"),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?(parentId.find("#sliderContent").scrollTop(parentId.find("span[class=etxt]:not([class=zp_dyn])").first().offset().top+parentId.find("#sliderContent").scrollTop()-parentId.find("#sliderContent").offset().top),void CommonTemplates.saveComplete("submitBtn")):void $.ajax({url:"/saveCategoryDetails.zp",type:"POST",data:params,async:!1,error:function(xhr){CommonTemplates.saveComplete("submitBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(data){if(CommonTemplates.saveComplete("submitBtn"),"success"==data.status){HRCategory.Edit.closeSlider(),HRCategory.adminDetails[Layout.Page.childUrlParam.categoryid]=data.categoryDetails,HRCategory.View.viewAdminPage(data.categoryDetails,Layout.Page.childUrlParam.categoryid),HRCategory.Edit.updateAllCategoryList(basicDetails);var adminCategoryListBox=$("[id=adminCategoryList]").find('[categoryid="'+Layout.Page.childUrlParam.categoryid+'"]');$(adminCategoryListBox).find("[name=categoryName]").text(basicDetails.categoryName),$(adminCategoryListBox).find("[name=desc]").text(basicDetails.categoryShortDescription),$(adminCategoryListBox).find("[name=icon]").attr("class","zp_Si "+Icons.getIconClass(basicDetails.categoryIcon).iconClass);var userCategoryListBox=$("[id=userCategoryList]").find('[categoryid="'+Layout.Page.childUrlParam.categoryid+'"]');$(userCategoryListBox).find("[name=categoryName]").text(basicDetails.categoryName),$(userCategoryListBox).find("[name=desc]").text(basicDetails.categoryShortDescription),$(userCategoryListBox).find("[name=icon]").attr("class","zp_Si "+Icons.getIconClass(basicDetails.categoryIcon).iconClass)}else data.hasOwnProperty("errormsg")&&"categoryName"==data.errormsg?(CommonTemplates.setErrorMessageinTextBox($("#sliderContent").find("#newCgyName"),data.desc),parentId.find("#sliderContent").scrollTop(parentId.find("span[class=etxt]:not([class=zp_dyn])").first().offset().top+parentId.find("#sliderContent").scrollTop()-parentId.find("#sliderContent").offset().top)):ZPeople.Message.showFailureMsg(data.desc)}})},updateAllCategoryList:function(data){var categoryLists=[CATEGORY_LIST,USERVIEW_CATEGORY_LIST,ADMINVIEW_CATEGORY_LIST,AGENTVIEW_CGY_LIST];$.each(categoryLists,function(i,list){$.isEmptyObject(list)||$.each(list,function(i,v){return v.categoryId==data.categoryId?(v.categoryName=ZPeople.escapeHtml(data.categoryName),v.categoryShortDescription=ZPeople.escapeHtml(data.categoryShortDescription),v.categoryIcon=ZPeople.escapeHtml(data.categoryIcon),void(v.description=data.description)):void 0})})},cloneAddConfigBox:function(needGeneralSettings,needLocSettings){var addConfigBox="",generalSettings="",locationSettings="";return(needGeneralSettings||needLocSettings)&&(needGeneralSettings&&"undefined"==typeof hCLocAccess&&(generalSettings='<label id="genSet" class="zp_link">'+ZPI18N.getString("zp.configuregeneralsettings")+"</label>"),needLocSettings&&(locationSettings='<label id="locSet" class="zp_link zp_ldot">'+ZPI18N.getString("zp.configurelocationsettings")+"</label>"),addConfigBox='<div id="addConfigBox" class="zp_sbx"><span>'+generalSettings+locationSettings+"</span></div>"),addConfigBox},editLocationConfigBox:function(data){var needLocation=data.hasOwnProperty("isAllLoc")?1!=data.isAllLoc:!0;HRCategory.Edit.openSlider(ZPI18N.getString("zp.catgeoryconfigurationdetails"));var parentId=$("#sliderPopup");parentId.find("#submitBtn").off("click"),parentId.find("#submitBtn").on("click",function(){HRCategory.Edit.updateLocationConfigBox()});var isAgentMandatory=!1;if(data.typeOthers==DEFAULT_GENERAL_CATEGORY&&data.hasOwnProperty("isAllLoc")&&data.isAllLoc&&(isAgentMandatory=!0),parentId.find("#sliderContent").html(HRCategory.ConfigureCategory.cloneLocationconfigBox(needLocation,!1,!1)),CommonTemplates.getSelectMenu(HRCategory.ConfigureCategory.chooseLocation(),parentId.find("#sliderContent [id=cgyLocationDiv]"),{id:"newCgyLoc",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.locations")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.locations")}),CommonTemplates.getSelectMenu(HRCaseDropdown.cgymemberdropdown(),parentId.find("#sliderContent [id=cgyAgentDiv]"),{id:"newCgyAgent",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.agent")},{isMandatory:isAgentMandatory,inputHeaderName:ZPI18N.getString("zp.agent")}),needLocation){var locations=[],locationarr=data.hasOwnProperty("locationId")?data.locationId.split(","):[];locationarr.length>0&&($.each(locationarr,function(key,val){var locObj={};locObj.id=val,locObj.text=ZPUtil.Location.ALL_LOCATION[val],locations.push(locObj)}),parentId.find("#newCgyLoc").zpselect({selectedVal:locations,checkbox:!0,callbackOnCancel:function(obj,obj1){var locationId=$(obj).find("i").attr("id");HRCategory.ConfigureCategory.addToLocationList(locationId)}}),parentId.find("#newCgyLoc").attr("locationGroupId",data.locationGroupId))}var agentObj={};if(agentObj=data.hasOwnProperty("categoryAgents")?data.categoryAgents:{},!$.isEmptyObject(agentObj)){agentImage=agentObj.agentTypeId==OWNER_EMPLOYEE.toString()?ZPeople.getUserDetailsById(agentObj.agentValueId).avatar:"";var selectedValObj={id:agentObj.agentValueId,text:agentObj.owner,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(agentObj.owner))),image:agentImage};parentId.find("#newCgyAgent").zpselect({selectedVal:[selectedValObj],isMandatory:isAgentMandatory}),parentId.find("#newCgyAgent").attr("cgyAgentId",agentObj.cgyAgentId),parentId.find("#newCgyAgent").attr("agenttype",agentObj.agentTypeId)}var referencesObjects=[];referencesObjects=data.hasOwnProperty("categoryReferences")?data.categoryReferences:[],referencesObjects.length>0&&$.each(referencesObjects,function(i,v){switch(v.formType){case LINK_URL:var linkHtml=HRCategory.ConfigureCategory.cloneAssociatedURLBox("edit");$(linkHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=parentId.find("div[contType]").last();$(contObj).find("#linkUrl").val(decodeURIComponent(v.link));break;case LINK_FILE:var linkName=v.link.split("/")[v.link.split("/").length-1],fileHtml=HRCategory.ConfigureCategory.cloneAssociatedDocumentsBox("edit");$(fileHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=parentId.find("div[contType]").last();$(contObj).find("#fName").html(linkName),$(contObj).attr("linkId",v.linkId)}var contObj=parentId.find("div[contType]").last();$(contObj).attr("linkId",v.linkId),$(contObj).find("input[type=text]").attr("disabled",!0),""==v.linkName&&$(contObj).find("#linkDispName").closest("div.zp_fm").remove(),$(contObj).find("#linkDispName").val(ZPeople.decodeTxt(v.linkName))}),parentId.find('[name="closeSlider"]').removeAttr("onclick"),parentId.find('[name="closeSlider"]').off("click").on("click",function(){var locId=parentId.find("#newCgyLoc").attr("selectedIds");if(""!=locId&&void 0!=locId){var locationsArr=locId.split(",");$.each(locationsArr,function(i,v){HRCategory.ConfigureCategory.addToLocationList(v)})}HRCategory.Edit.closeSlider()})},updateLocationConfigBox:function(){var parentId=$("#sliderPopup");CommonTemplates.waitTillSave("submitBtn");var filecount=0,formData=new FormData;formData.append("conreqcsr",csrfToken),formData.append("methodName","singleFieldCategoryEdit"),formData.append("mode","locationConfiguration"),formData.append("categoryId",Layout.Page.childUrlParam.categoryid);var configParams=HRCategory.ConfigureCategory.validateLocationConfigBox(parentId.find("#configBox"),filecount,formData,!0);if(configParams.hasOwnProperty("isConfErr")&&1==configParams.isConfErr)return CommonTemplates.saveComplete("submitBtn"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.incompleteconfiguration"));delete configParams.filecount;var param=JSON.stringify(configParams);formData.append("categoryConfiguration",param),$.ajax({url:"/saveLocationBasedConfigurations.zp",type:"POST",data:formData,processData:!1,contentType:!1,async:!1,error:function(xhr){CommonTemplates.saveComplete("submitBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(res){CommonTemplates.saveComplete("submitBtn"),"success"==res.status?(HRCategory.Edit.closeSlider(),HRCategory.adminDetails[Layout.Page.childUrlParam.categoryid]=res.categoryDetails,HRCategory.View.viewAdminPage(res.categoryDetails,Layout.Page.childUrlParam.categoryid)):ZPeople.Message.showFailureMsg(res.desc)}})},deleteLocationConfig:function(obj,locationGroupId,locationId,typeOthers){var pageId=Layout.Page.container,message=void 0!=locationGroupId?"zp.deletelocationconfig":"zp.deletegeneralconfig";ZPeople.BSModal.confirm(function(){var locGrpId=void 0!=locationGroupId?locationGroupId:"",params={locationGroupId:locGrpId,categoryId:Layout.Page.childUrlParam.categoryid,method:"deleteLocationConfig",conreqcsr:csrfToken};$.ajax({url:"/deleteLocationConfig.zp",type:"POST",data:params,async:!1,success:function(data){if("success"==data.status){if($(obj).closest("div[locGrp]").remove(),void 0!=locationGroupId){var locationsArr=locationId.split(",");$.each(locationsArr,function(i,v){HRCategory.ConfigureCategory.addToLocationList(v)})}var needGeneralSettings=void 0==locationGroupId;pageId.find("#addConfigBox").length>0&&(needGeneralSettings=pageId.find("#genSet").length>0?!0:needGeneralSettings,pageId.find("#addConfigBox").remove());var needLocSettings=$.isEmptyObject(ZPUtil.Location.ALL_LOCATION)||$.isEmptyObject(LOCATION_DROPDOWN)?!1:!0;if($("#addConfigBox").length<=0&&pageId.find("#adminviewCgy").append(HRCategory.Edit.cloneAddConfigBox(needGeneralSettings,needLocSettings)),needLocSettings||needGeneralSettings){var confBoxData={};confBoxData.typeOthers=typeOthers,pageId.find("#genSet").off("click"),pageId.find("#genSet").on("click",function(){confBoxData.isAllLoc=!0,HRCategory.Edit.editLocationConfigBox(confBoxData)}),pageId.find("#locSet").off("click"),pageId.find("#locSet").on("click",function(){confBoxData.isAllLoc=!1,HRCategory.Edit.editLocationConfigBox(confBoxData)})}var categoryDetails=HRCategory.adminDetails[Layout.Page.childUrlParam.categoryid];$.each(categoryDetails.categoryConfiguration,function(i,v){return v.locationGroupId==locGrpId?(categoryDetails.categoryConfiguration.splice(i,1),!1):void 0}),HRCategory.adminDetails[Layout.Page.childUrlParam.categoryid]=categoryDetails}else ZPeople.Message.showFailureMsg(data.desc)}})},"",ZPI18N.getString(message))},editAssociatedContent:function(data){HRCategory.Edit.openSlider(ZPI18N.getString("zp.associatedcontent"));var parentId=$("#sliderPopup");parentId.find("#submitBtn").off("click").on("click",function(){HRCategory.Edit.updateAssociatedContent()});var locationGroupIdArr=[];$.each(data,function(i,v){locationGroupIdArr.push(v.locationGroupId)});var locationGroupIds=locationGroupIdArr.join(","),params={method:"fetchAssociatedContentDetails",categoryId:Layout.Page.childUrlParam.categoryid,locationGroupIds:locationGroupIds,conreqcsr:csrfToken};$.ajax({url:"/fetchAssociatedContentDetails.zp",type:"POST",data:params,async:!1,success:function(data){parentId.find("#sliderContent").html(""),$.each(data,function(i,v){v.hasOwnProperty("isAllLoc")?1!=v.isAllLoc:!0;parentId.find("#sliderContent").append(HRCategory.ConfigureCategory.cloneLocationconfigBox(!0,!1,!1)),CommonTemplates.getSelectMenu(HRCategory.ConfigureCategory.chooseLocation(),parentId.find("[id=cgyLocationDiv]").last(),{id:"newCgyLoc",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.locations")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.locations")}),parentId.find("[id=configBox]").last().attr("isallloc",v.isAllLoc);var configBox=parentId.find("[id=configBox]").last(),locationName=v.isAllLoc?ZPI18N.getString("zp.alllocations"):HRCategory.View.getLocationNames(v.locationId),locationGroupId=v.isAllLoc?"":v.locationGroupId,locationId=v.isAllLoc?"":v.locationId,textboxInput={id:"newCgyLoc",onclick:"HRCategory.ConfigureCategory.chooseLocation(this)",value:locationName};""!=locationGroupId&&(textboxInput.locationGroupId=v.locationGroupId),""!=locationId&&(textboxInput.selectedIds=v.locationId),CommonTemplates.getInputTextBox(textboxInput,ZPI18N.getString("zp.applicablelocations"),!1,configBox.find("#cgyLocationDiv")),configBox.find("#cgyAgentDiv").remove();var referencesObjects=[];referencesObjects=v.hasOwnProperty("categoryReferences")?v.categoryReferences:[],referencesObjects.length>0&&$.each(referencesObjects,function(i,v){switch(v.formType){case LINK_URL:var linkHtml=HRCategory.ConfigureCategory.cloneAssociatedURLBox("edit");$(linkHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=configBox.find("div[contType]").last();$(contObj).find("#linkUrl").val(v.link);break;case LINK_FILE:var linkName=v.link.split("/")[v.link.split("/").length-1],fileHtml=HRCategory.ConfigureCategory.cloneAssociatedDocumentsBox("edit");$(fileHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=configBox.find("div[contType]").last();$(contObj).find("#fName").html(linkName),$(contObj).attr("linkId",v.linkId)}var contObj=configBox.find("div[contType]").last();$(contObj).attr("linkId",v.linkId),$(contObj).find("input[type=text]").attr("disabled",!0),""==v.linkName&&$(contObj).find("#linkDispName").closest("div.zp_fm").remove(),$(contObj).find("#linkDispName").val(ZPeople.decodeTxt(v.linkName))})}),parentId.find("input[type=text]").attr("disabled",!0)}})},updateAssociatedContent:function(){var parentId=$("#sliderPopup");CommonTemplates.waitTillSave("submitBtn");var categoryId=Layout.Page.childUrlParam.categoryid,formData=new FormData;formData.append("conreqcsr",csrfToken),formData.append("methodName","singleFieldCategoryEdit"),formData.append("mode","associatedContentEdit"),formData.append("categoryId",categoryId);var configParams=[],filecount=0;if(parentId.find("[id=configBox]").each(function(i){var configParamsObj=HRCategory.ConfigureCategory.validateLocationConfigBox($(this),filecount,formData);filecount=configParamsObj.filecount,delete configParamsObj.filecount,configParamsObj.hasOwnProperty("isConfErr")||configParamsObj.isConfErr||$.isEmptyObject(configParamsObj)||configParams.push(configParamsObj)}),configParams.length>0){var param=JSON.stringify(configParams);formData.append("categoryConfiguration",param),$.ajax({url:"/saveAssociatedContents.zp",type:"POST",data:formData,processData:!1,contentType:!1,async:!1,error:function(xhr){CommonTemplates.saveComplete("submitBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(res){CommonTemplates.saveComplete("submitBtn"),"success"==res.status?(HRCategory.Edit.closeSlider(),HRCategory.userDetails[categoryId]=res.categoryDetails,HRCategory.View.viewUserPage(res.categoryDetails,categoryId)):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.saveassociatedcontentfailed"))}})}else HRCategory.Edit.closeSlider()}};var HRCase={OPEN_SID:"1",INPROGRESS_SID:"2",AWAITING_SID:"3",ONHOLD_SID:"4",COMPLETED_SID:"5",CANCELLED_SID:"6",SPC_SEARCH:!1,PICK_CASE_ROW:"1",PICK_CASE_VIEW:"2",PICK_CASE_FEEDS:"3",MYREQ_CASE_PARAM:{},MYCASE_CASE_PARAM:{},UNASSIGN_CASE_PARAM:{},ALLCASE_CASE_PARAM:{},WATCHLIST_CASE_PARAM:{},ASSIGNEE_LIST:{},init:function(){var url=Layout.Page.hash,pageId=Layout.Page.container;$.isEmptyObject(STATUS)&&HRCases.getStatusList(),Layout.Page.container.find("#showNotes").hasClass("shw")?pageId.find("#showNotes").removeClass("shw"):"",HRCase.SearchFilter.constructFilterOptions(),("#hrcase/list/kanbanView"==url||"#allcases/list/kanbanView"==url)&&HRCase.KanbanView.showKanbanView(),("#hrcase/list"==url||-1!==url.indexOf("#hrcase/myrequest/list")||-1!==url.indexOf("#hrcase/allcases/list")||-1!==url.indexOf("#hrcase/unassigned/list")||-1!==url.indexOf("#hrcase/watchlist/list"))&&((isadmin||isManageHRCase)&&void 0!=Layout.Page.urlparam.categoryid&&void 0!=Layout.Page.urlparam.status&&-1!==url.indexOf("#hrcase/allcases/list")?(HRCase.SPC_SEARCH=!0,HRCase.List.getAllCasesList(1)):HRCase.SPC_SEARCH&&-1!==url.indexOf("#hrcase/allcases/list")&&(HRCase.SPC_SEARCH=!1,HRCase.List.getAllCasesList(1)),Layout.Page.container.removeClass("zp_Pshw")),(-1!==url.indexOf("#hrcase/list/view")||-1!==url.indexOf("#hrcase/myrequest/view")||-1!==url.indexOf("#hrcase/allcases/view")||-1!==url.indexOf("#hrcase/unassigned/view")||-1!==url.indexOf("#hrcase/watchlist/view"))&&(AdvancedFilter.hideFilter(),HRCase.DetailedView.viewCaseDetails(Layout.Page.childUrlParam.caseid))}};HRCase.AgentAddMode="AGENT",HRCase.Header={headerDiv:function(headerName,title,iconClass){var iconHtml=void 0!=iconClass&&""!=iconClass?'<i class="zp_Si '+iconClass+'"></i>':"",shrtDesc=void 0!=title&&""!=title?"<span>"+title+"</span>":"",headerNameHtml=void 0!=headerName&&""!=headerName?'<font id="cName" >'+headerName+"</font>":"",header="";return header=void 0!=title?'<h2 id="hdName">'+iconHtml+"<div>"+headerNameHtml+shrtDesc+"</div></h2>":'<h2 id="hdName">'+iconHtml+headerNameHtml+shrtDesc+"</h2>"},getCategoryHeader:function(mode,data){var pageId=Layout.Page.container,titleDiv="",headerButtons="",subHeaderDiv="",backButton="";if(mode==USER_CGY_LISTING)titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.askaquestionabout"));else if(mode==ADMIN_CGY_LISTING)titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.categorylist")),headerButtons='<button id="addCategory" class="zpthm" onclick="window.location.href=\'#hrcase/category/add\'">'+ZPI18N.getString("zp.addcategory")+"</button>";else if(mode==USER_VIEW)backButton='<i class="IC-ar-lft" onclick="HRCategory.closeSlide()"></i>',titleDiv+=HRCase.Header.headerDiv(data.name,data.shrtDesc,data.iconClass),headerButtons='<button id="askUs" class="zpthm" onclick="HRCase.AddCase.showAskus()">'+ZPI18N.getString("zp.askaquestion")+"</button>";else if(mode==ADMIN_VIEW&&(backButton='<i class="IC-ar-lft" onclick="HRCategory.closeSlide()"></i>',titleDiv+=HRCase.Header.headerDiv(data.name,data.shrtDesc,data.iconClass),!data.isViewOnly)){var deleteButton='<button id="deletecgy" class="del" onclick="HRCategory.View.confirmationPopup(\'zp.catalogdeletemsg\',HRCategory.ConfigureCategory.deleteCategory)">'+ZPI18N.getString("zp.delete")+"</button>",enableDisableButton="";enableDisableButton=data.isEnabled?'<button id="disableCgy" class="dis" onclick="HRCategory.View.confirmationPopup(\'zp.catalogdisablemsg\', HRCategory.ConfigureCategory.disableCategory)">'+ZPI18N.getString("zp.disable")+"</button>":'<button id="enableCgy" class="" onclick="HRCategory.ConfigureCategory.enableCategory()">'+ZPI18N.getString("zp.enable")+"</button>",headerButtons=enableDisableButton+deleteButton}pageId.find("[name=categoryHeader]").empty().append(backButton+titleDiv+'<div class="zp_frt zp_micn"><div class="zp_btn">'+headerButtons+"</div></div>"),""!=subHeaderDiv?pageId.find("#adminCategoryList").before(subHeaderDiv):pageId.find("[name=categoryList]").find(".zp_Lttl").remove()},getCaseHeader:function(mode,origin){var pageId=Layout.Page.container,titleDiv="",iconDiv="",subHeaderDiv="",selfserviceHeader='<div class="ZPcalvw-tphd-fr"> <div class="ZPcalvw-tphd-lt"><ul class="dash-tabs" role="tablist"><li id="myreq"><a onclick="SelfService.Cases.toggleView(this)">'+ZPI18N.getString("zp.myrequests")+'</a></li><li id="mycase"><a onclick="SelfService.Cases.toggleView(this)">'+ZPI18N.getString("zp.mycases")+"</a></li></ul></div></div>";mode==REQ_TYPE_MYREQUEST?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.myrequests")),"selfservice"==origin&&(titleDiv+=selfserviceHeader),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")}]})):mode==REQ_TYPE_MYCASES?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.mycases")),"selfservice"==origin&&(titleDiv+=selfserviceHeader),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")}]})):mode==REQ_TYPE_ALLCASES?("selfservice"==origin?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.mycases")),titleDiv+=selfserviceHeader):titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.allcases")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})):mode==REQ_TYPE_UNASSIGNCASES?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.unassignedCases")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})):mode==REQ_TYPE_FOLLOWS?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.watchlist")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})):mode==ADMIN_REPORT?titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.allcases")):mode==AGENT_REPORT?titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.mycases")):mode==USER_REPORT&&(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.myrequests"))),iconDiv+=mode!=REQ_TYPE_UNASSIGNCASES?'<div class="zp_frt zp_micn">'+CommonTemplates.getIconMenuBar([{attributes:{onclick:"AdvancedFilter.showHidefilter()"},iconsList:[{"class":"IC-filter-l"}]}])+"</div>":"",Layout.Page.container.find("[name=headerposition]").empty().append(titleDiv+iconDiv),(mode!=ADMIN_REPORT||mode!=AGENT_REPORT||mode!=USER_REPORT)&&(pageId.find("#caseScrollHead").remove(),pageId.find("[name=caseListView]").before(subHeaderDiv))},getSubHeader:function(properties){var html="",hdrId=properties.hasOwnProperty("id")?'id="'+properties.id+'"':"";return $.each(properties.headers,function(i,value){html+="<div class="+value.classNm+">",html+=void 0!=value.name?"<font><em>"+value.name+"</em> </font> ":"",html+=void 0!=value.filterClassNm?"<i class="+value.filterClassNm+' id="cgyFilter"></i>':"",html+="</div>"}),html="<div "+hdrId+' class="zp_Lttl"><div class="zp_Lst"><div>'+html+"</div></div></div>"},getFooter:function(mode,sCount,isFilterSearch){var pageId=Layout.Page.container;pageId.find("[name=footerposition]").hasClass("zp_dyn")?pageId.find("[name=footerposition]").removeClass("zp_dyn"):"";var footerHtml="",statusArr={};return mode==REQ_TYPE_ALLCASES||mode==REQ_TYPE_MYREQUEST||mode==REQ_TYPE_FOLLOWS||mode==REQ_TYPE_MYCASES?(statusArr[1]={attributes:{id:"openedCase",value:HRCase.OPEN_SID,"class":HRCase.List.getStatusColorClass(HRCase.OPEN_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.OPEN_SID+"',this)"},statusArr[2]={attributes:{id:"inProgressCase",value:HRCase.INPROGRESS_SID,"class":HRCase.List.getStatusColorClass(HRCase.INPROGRESS_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.INPROGRESS_SID+"',this)"},statusArr[3]={attributes:{id:"awaitingReqCase",value:HRCase.AWAITING_SID,"class":HRCase.List.getStatusColorClass(HRCase.AWAITING_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.AWAITING_SID+"',this)"},statusArr[4]={attributes:{id:"onHoldCase",value:HRCase.ONHOLD_SID,"class":HRCase.List.getStatusColorClass(HRCase.ONHOLD_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.ONHOLD_SID+"',this)"},statusArr[5]={attributes:{id:"closedCase",value:HRCase.COMPLETED_SID,"class":HRCase.List.getStatusColorClass(HRCase.COMPLETED_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.COMPLETED_SID+"',this)"},mode==REQ_TYPE_MYREQUEST&&(statusArr[6]={attributes:{id:"cancelledCase",value:HRCase.CANCELLED_SID,"class":HRCase.List.getStatusColorClass(HRCase.CANCELLED_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.CANCELLED_SID+"',this)"})):mode==REQ_TYPE_UNASSIGNCASES&&(statusArr[7]={attributes:{id:"unassigned",value:"1,2,3,4","class":"zp_gclr"}}),$.each(sCount,function(i,value){var sourceObj=statusArr[value.systemValue];void 0!=sourceObj&&(sourceObj.iconName=value.optionValue,void 0==isFilterSearch?void 0!=value.count?sourceObj.count=value.count:sourceObj.count=0:void 0!=value.count?sourceObj.count=value.count:delete statusArr[value.systemValue])}),footerHtml=CommonTemplates.getCountMenuBar(statusArr)}},HRCase.AddManualCase={resetPage:function(){CommonTemplates.getInputTextBox({id:"resolution"},ZPI18N.getString("zp.resolution"),!1,$("#caseresolutionDiv"));var openstatus="",statusParams=[];$.each(STATUS,function(key){if(STATUS[key]==HRCase.OPEN_SID&&(openstatus=key),STATUS[key]!=HRCase.CANCELLED_SID){var param1={id:STATUS[key],value:key};statusParams.push(param1)}}),CommonTemplates.getSelectMenu({id:"statusList",data:statusParams},$("#casestatusDiv"),{id:"statusId"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.status")}),$("#statusId").zpselect({selectedVal:[{id:HRCase.OPEN_SID,text:openstatus}]});var employeeMenuObj={id:"empList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","HRCASES")}};CommonTemplates.getSelectMenu(employeeMenuObj,$("#csempDiv"),{id:"empInput"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.employee")})}},HRCase.AddCase={validateSubject:function(headerDiv,currentId){var shortDesc=$("#"+headerDiv).find("#"+currentId).val(),data=$.trim(shortDesc);if(""==data||shortDesc.length>250){var errorMsg=ZPI18N.getString("zp.subjectemptymsg");shortDesc.length>250&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.subject"),"250"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId))},resetPage:function(mode,categoryid){var cgyMode=SUBMIT_CASE;mode==HRCase.AgentAddMode&&(HRCase.AddManualCase.resetPage(),cgyMode=AGENT_CGY_LISTING),CommonTemplates.removeErrorMessagesinContainerDiv("addcaseContent"),$("#caseCgyDiv").empty(),$("#addcaseHeader").html("<h3>"+ZPI18N.getString("zp.askaquestion")+"</h3>"),(void 0==categoryid||""==categoryid)&&CommonTemplates.getSelectMenu(HRCategory.cgydropdown(cgyMode),$("#caseCgyDiv"),{id:"cgyId"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.category")}),CommonTemplates.getInputTextBox({id:"caseSubject"},ZPI18N.getString("zp.subject"),!0,$("#caseSubDiv")),EditorTemplate.editorConstruct("caseeditor",!0,"addcaseContent",!0),EditorTemplate.replaceWithEditor("caseDescEditorContainer","descEditor",!0);var isCategoryValid=!1;void 0!=categoryid&&""!=categoryid?(isCategoryValid=!0,$("#submitCaseBtn").attr("onclick","HRCase.AddCase.submitCase('"+mode+"','"+categoryid+"')")):$("#submitCaseBtn").attr("onclick","HRCase.AddCase.submitCase('"+mode+"')"),$("#caseSubject").on("click keyup",function(e){""==$(this).val()||!isCategoryValid&&""==$("#cgyId").attr("selectedids")?$("#submitCaseBtn").removeClass("sel"):$("#submitCaseBtn").addClass("sel")}),$("#addcaseContent").find("div.attachedFile").remove(),$.isEmptyObject(USERVIEW_CATEGORY_LIST)&&HRCategory.getCgyList(USER_CGY_LISTING),$.each(USERVIEW_CATEGORY_LIST,function(i,val){if(void 0==categoryid||""==categoryid){if(val.typeOthers==DEFAULT_GENERAL_CATEGORY)return void $("#cgyId").zpselect({selectedVal:[{id:val.categoryId,text:val.categoryName,iconClass:"zp_Si "+Icons.getIconClass(val.categoryIcon).iconClass}],isMandatory:!0})}else if(val.categoryId==categoryid)return void $("#addcaseHeader").html("<h3>"+ZPI18N.getString("zp.queryoncategory",[val.categoryName])+"</h3>")}),mode==HRCaseBand.TOPBAND&&void 0!=$("#cgyId").attr("selectedIds")&&""!=$("#cgyId").attr("selectedIds")&&HRCaseBand.getCategoryView($("#cgyId").attr("selectedIds")),$("#hcDFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"0"},$(this),"addcaseContent")}),$("#hcCFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"1"},$(this),"addcaseContent")})},checkEmptyError:function(id){var isEmpty=!1,value=$("#"+id).val();return("cgyId"==id||"empInput"==id)&&(value=$("#"+id).attr("selectedids")),(""==value||null==value||void 0==value)&&(CommonTemplates.setErrorMessageinTextBox($("#"+id)),isEmpty=!0),isEmpty},showAskus:function(mode){var url=Layout.Page.hash;mode=void 0==mode?"":mode,-1!==url.indexOf("#hrcase/category/view")?HRCase.AddCase.addCasePage(mode,Layout.Page.childUrlParam.categoryid):HRCase.AddCase.addCasePage(mode)},addCasePage:function(mode,categoryid){var pageId=Layout.Page.container;pageId.find("#addHRCase").attr("formid");$("#addHRCase").length<=0&&$("body").append(HRCaseCommon.askUsHtml()),HRCase.AddCase.resetPage(mode,categoryid),$("#cgyId").removeAttr("disabled"),$("#addHRCase").addClass("zp_shw"),mode==HRCase.AgentAddMode?setTimeout(function(){$("#empInput").trigger("focus")},300):setTimeout(function(){void 0!=categoryid?$("#caseSubject").trigger("focus"):$("#cgyId").trigger("focus")},300)},submitCase:function(mode,categoryId){CommonTemplates.removeErrorMessagesinContainerDiv("addcaseContent");var categoryid="",isCategoryEmpty=!0;$("#cgyId").length>0?(categoryid=$("#cgyId").attr("selectedids"),isCategoryEmpty=HRCase.AddCase.checkEmptyError("cgyId")):(categoryid=categoryId,isCategoryEmpty=!1);var caseSub=$.trim($("#caseSubject").val()).replace(/ +/g," "),caseDesc="",editorId="descEditor",editor=ZPFeeds.Editor.editorList[editorId];void 0!=editor&&(caseDesc=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1)),HRCase.AddCase.validateSubject("addcaseContent","caseSubject");var isSubEmpty=HRCase.AddCase.checkEmptyError("caseSubject"),isEmpEmpty=mode!=HRCase.AgentAddMode?!1:HRCase.AddCase.checkEmptyError("empInput");if($("#addcaseContent").find("span[class=etxt]:not([class=zp_dyn])").length<=0&&!(isSubEmpty||isCategoryEmpty||isEmpEmpty)){CommonTemplates.waitTillSave("submitCaseBtn");var caseParams={categoryId:categoryid,subject:caseSub,conreqcsr:csrfToken,methodName:"addHRCase"};if(mode==HRCase.AgentAddMode){var resolCmt=$.trim($("#resolution").val()).replace(/ +/g," ");caseParams.employeeId=$("#empInput").attr("selectedids"),caseParams.status=$("#statusId").attr("selectedids"),caseParams.messageText=resolCmt,caseParams.comment=resolCmt}if(caseParams.description=caseDesc,$("#addcaseContent  div.attachedFile").length>0){var formData=new FormData;formData.append("loginUserZUID",_ZUIDENRYPT),formData.append("formId",0),formData.append("tableName","P_HR_Case"),formData.append("conreqcsr",csrfToken);var uploadFromCloud=[];$("#addcaseContent  div.attachedFile").each(function(i){var uploadMode=$(this).data("uploadMode"),cloudUploadDoc=$(this).data("cloudUploadDoc"),caseFileUpload=$(this).data("caseFileUpload");"cloudUpload"==uploadMode?uploadFromCloud.push(cloudUploadDoc):"localUpload"==uploadMode&&void 0!==caseFileUpload&&formData.append("case_attachment",caseFileUpload)}),formData.append("uploadFromCloud",JSON.stringify(uploadFromCloud)),$.ajax({url:"/fileUploadAction.zp",type:"POST",data:formData,contentType:!1,processData:!1,cache:!1,error:function(xhr){CommonTemplates.saveComplete("submitCaseBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(data){var result=data.substring(data.indexOf("(")+1,data.lastIndexOf(")")),resultJson=JSON.parse(result);if("7000"==resultJson.code){var allFiles=[];$.each(resultJson.message,function(i,v){allFiles.push(v.filePath)}),caseParams.case_attachment=JSON.stringify(allFiles),HRCase.AddCase.addCaseRequest(caseParams,mode)}else CommonTemplates.saveComplete("submitCaseBtn"),ZPeople.Message.showFailureMsg(resultJson.message)}})}else HRCase.AddCase.addCaseRequest(caseParams,mode)}},addCaseRequest:function(obj,mode){var params=obj;ZPeople.Request.send("/addHrcase.zp",params,function(data){if(CommonTemplates.saveComplete("submitCaseBtn"),"success"==data.status){var redirectToCase='<a href="#hrcase/myrequest/view-caseid:'+data.zp_recordId+'">'+ZPI18N.getString("zp.here")+"</a>";ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.viewqueryraise",[redirectToCase])),HRCase.AddCase.closePage()}else ZPeople.Message.showFailureMsg(data.desc)},{},function(resultData){CommonTemplates.saveComplete("submitCaseBtn");var error_response=JSON.parse(resultData);ZPeople.Message.showFailureMsg(error_response.error)})},closePage:function(){CommonTemplates.removeErrorMessagesinContainerDiv("addHRCase"),$("#addHRCase").removeClass("zp_shw")}},HRCase.addCaseInWMS={getInstantCaseRow:function(data){var isRequestor=(Layout.Page.hash,!1),isAgent=!1,isMemberAgent=!1,isFollower=!1;if(data.isRequestor==erecno&&(isRequestor=!0),data.isAgent==erecno?isAgent=!0:"2"==data.isAgentType&&data.isMemberAgent==_LOGGEDIN_DEPID?isMemberAgent=!0:"3"==data.isAgentType&&$.each(_LOGGEDIN_GROUPID,function(k,grpId){data.isMemberAgent==grpId&&(isMemberAgent=!0)}),void 0!=data.isFollower&&$.each(data.isFollower,function(k,arr){1==arr.isFollowerId?$.each(arr.isFollower,function(k,followerId){followerId==erecno&&(isFollower=!0)}):2==arr.isFollowerId?$.each(arr.isFollower,function(k,deptId){deptId==_LOGGEDIN_DEPID&&(isFollower=!0)}):3==arr.isFollowerId&&$.each(arr.isFollower,function(k,followerGrpId){$.each(_LOGGEDIN_GROUPID,function(k,grpId){grpId==followerGrpId&&(isFollower=!0)})})}),null!=ZPTabs.TAB_JSON){var hrcaseTabJSON={},watchListTabJSon={},casesSubTabJSON={},caseTabIndex=0;$.each(ZPTabs.TAB_JSON,function(index,value){"HRCase"==value.name&&(hrcaseTabJSON=ZPTabs.TAB_JSON[index],$.each(hrcaseTabJSON.subtabs,function(index,subTab){"Watchlist"==subTab.displayName&&(watchListTabJSon=subTab),"Cases"==subTab.displayName&&(casesSubTabJSON=subTab)}),isFollower&&(void 0==watchListTabJSon||$.isEmptyObject(watchListTabJSon)?(hrcaseTabJSON.subtabs.splice(2,0,{displayName:ZPI18N.getString("zp.watchlist"),tabURL:"hrcase/watchlist/list"}),HRCase.addCaseInWMS.addCaseRwInWatchListTab(data,!0)):HRCase.addCaseInWMS.addCaseRwInWatchListTab(data,!1)),caseTabIndex=void 0!=watchListTabJSon&&isFollower?3:2)});var formArrTabJson={};void 0==casesSubTabJSON||$.isEmptyObject(casesSubTabJSON)?(isadmin&&1!=isAgent&&1!=isMemberAgent||(hrcaseTabJSON.subtabs.splice(caseTabIndex,0,{displayName:ZPI18N.getString("zp.cases"),formArr:[],isStaticTab:!0,tabName:"Cases"}),0==hrcaseTabJSON.subtabs[caseTabIndex].formArr&&hrcaseTabJSON.subtabs[caseTabIndex].formArr.splice(0,0,{displayName:ZPI18N.getString("zp.allcases"),tabURL:"hrcase/allcases/list"})),formArrTabJson=hrcaseTabJSON.subtabs[caseTabIndex].formArr):formArrTabJson=casesSubTabJSON.formArr,data.isNewRwAdded?(isRequestor&&HRCase.addCaseInWMS.addCaseRwInRequestTab(data),isAgent&&HRCase.addCaseInWMS.addCaseRwInMycaseTab(data,isAgent,hrcaseTabJSON,formArrTabJson,caseTabIndex),isMemberAgent&&HRCase.addCaseInWMS.addCaseRwInUnassignedTab(data,isMemberAgent,hrcaseTabJSON,formArrTabJson,caseTabIndex),(isAgent||isMemberAgent)&&HRCase.addCaseInWMS.addCaseRwInAllCaseTab(data,isAgent,isMemberAgent,hrcaseTabJSON,formArrTabJson)):(isRequestor&&HRCase.addCaseInWMS.deleteRwInWMSNotify(data,isRequestor,!1,!1,!1),isAgent&&HRCase.addCaseInWMS.deleteRwInWMSNotify(data,!1,isAgent,!1,!1),isMemberAgent&&HRCase.addCaseInWMS.deleteRwInWMSNotify(data,!1,!1,isMemberAgent,!1),(isAgent||isMemberAgent)&&HRCase.addCaseInWMS.deleteRwInWMSNotify(data,!1,!1,!1,!0))}},addCaseRwInWatchListTab:function(data,isTabRefresh){if(isTabRefresh)ZPTabs.constructSubtabsBasedOnHash();else{var zpContwrapId="hrcase-watchlist-list";HRCase.addCaseInWMS.constructCaseRwInWMS(data,zpContwrapId,REQ_TYPE_FOLLOWS,"openedCase")}},addCaseRwInRequestTab:function(data){var zpContwrapId="zp-contwrap-hrcase-myrequest";HRCase.addCaseInWMS.constructCaseRwInWMS(data,zpContwrapId,REQ_TYPE_MYREQUEST,"openedCase")},addCaseRwInAllCaseTab:function(data,isAgent,isMemberAgent,hrcaseTabJSON,formArrTabJson){var zpContwrapId="";(isAgent||isMemberAgent)&&(zpContwrapId="zp-contwrap-hrcase-allcases"),HRCase.addCaseInWMS.constructCaseRwInWMS(data,zpContwrapId,REQ_TYPE_ALLCASES,"openedCase")},addCaseRwInMycaseTab:function(data,isAgent,hrcaseTabJSON,formArrTabJson,caseTabIndex){var isTabRefresh=!1,zpContwrapId="";if(data.isNewRwAdded&&isAgent){var myCaseJsonArr=ZPServices.getObjectFormArray(hrcaseTabJSON.subtabs[caseTabIndex].formArr,"tabURL","hrcase/list",!0,!0);void 0==myCaseJsonArr?(isTabRefresh=!0,formArrTabJson.splice(0,0,{displayName:ZPI18N.getString("zp.mycases"),tabURL:"hrcase/list"})):zpContwrapId="zp-contwrap-hrcase-list"}isTabRefresh?ZPTabs.constructSubtabsBasedOnHash():HRCase.addCaseInWMS.constructCaseRwInWMS(data,zpContwrapId,REQ_TYPE_MYCASES,"openedCase")},addCaseRwInUnassignedTab:function(data,isMemberAgent,hrcaseTabJSON,formArrTabJson,caseTabIndex){var isTabRefresh=!1,zpContwrapId="";if(data.isNewRwAdded&&isMemberAgent){var unassignedJsonArr=ZPServices.getObjectFormArray(hrcaseTabJSON.subtabs[caseTabIndex].formArr,"tabURL","hrcase/unassigned/list",!0,!0);void 0==unassignedJsonArr?(isTabRefresh=!0,formArrTabJson.splice(2,0,{displayName:ZPI18N.getString("zp.unassigned"),tabURL:"hrcase/unassigned/list"})):zpContwrapId="zp-contwrap-hrcase-unassigned"}isTabRefresh?ZPTabs.constructSubtabsBasedOnHash():HRCase.addCaseInWMS.constructCaseRwInWMS(data,zpContwrapId,REQ_TYPE_UNASSIGNCASES,"unassigned")},constructCaseRwInWMS:function(data,zpContwrapId,mode,isCountId){if(0!=$("#"+zpContwrapId).find("#caseList").find("#noData").length){$("#"+zpContwrapId).find("#caseList").find("#noData").remove(),$("#"+zpContwrapId).find("#caseScrollHead").removeClass("zp_dyn"),$("#"+zpContwrapId).find(".zp_cinfo").removeClass("zp_dyn");var caseListHtml=HRCase.List.caseListRow(data.caseJobj,mode);$("#"+zpContwrapId).find("#caseList").append(caseListHtml)}else{var caseListHtml=HRCase.List.caseListRow(data.caseJobj,mode);$("#"+zpContwrapId).find("#caseList div:eq(0)").before(caseListHtml)}if(data.isOpenedCase){var count=$("#"+zpContwrapId).find("#"+isCountId).text(),iNum=parseInt(count);$("#"+zpContwrapId).find("#"+isCountId).html(iNum+1)}else{var count=$("#"+zpContwrapId).find("#"+data.isStatusId).text(),iNum=parseInt(count);$("#"+zpContwrapId).find("#"+data.isStatusId).html(iNum+1)}},deleteRwInWMSNotify:function(data,isRequestor,isAgent,isMemberAgent,isAllCase){var zpContwrapId="",isCountId="",nodataKey="";isRequestor&&(zpContwrapId="zp-contwrap-hrcase-myrequest",isCountId=data.isStatusId,nodataKey=ZPI18N.getString("zp.nodatarequestor")),isAgent&&(zpContwrapId="zp-contwrap-hrcase-list",isCountId=data.isStatusId,nodataKey=ZPI18N.getString("zp.noongoingcases")),isMemberAgent&&(zpContwrapId="zp-contwrap-hrcase-unassigned",isCountId="unassigned",nodataKey=ZPI18N.getString("zp.nodataunassign")),isAllCase&&(zpContwrapId="zp-contwrap-hrcase-allcases",isCountId=data.isStatusId,nodataKey=ZPI18N.getString("zp.nofollowedcases")),$("#"+zpContwrapId).find("#caseList").find("[caseid="+data.hrcase+"]").remove();var count=$("#"+zpContwrapId).find("#"+isCountId).text(),iNum=parseInt(count);iNum>0&&$("#"+zpContwrapId).find("#"+isCountId).html(iNum-1),0==$("#"+zpContwrapId).find("#caseList").find("div[caseId]").length&&(HRCase.DetailedView.closeSlide(),$("#"+zpContwrapId).find("#caseList").append(CommonTemplates.noDataSVG("",!0,nodataKey)))}},HRCase.List={statusSysValue:"1,2,3,4",reloadMyReqCaseList:function(){var index=1;Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_MYREQUEST),HRCase.List.getMyReqCasesList(index)},reloadMyHrCaseList:function(){var index=1;Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_MYCASES),HRCase.List.getMyHrCasesList(index)},reloadAllCasesList:function(){var index=1;Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_ALLCASES),HRCase.List.getAllCasesList(index)},reloadUnassignedList:function(){var index=1;Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_UNASSIGNCASES),HRCase.List.getUnassignedList(index)},reloadfollowedList:function(){var index=1;Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_FOLLOWS),HRCase.List.getFollowedCasesList(index)},getFollowedCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var index,params={},errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:HRCase.List.statusSysValue,index:index,requestorErecno:"",query:""},errorMsg=ZPI18N.getString("zp.nofollowedcases"),HRCase.WATCHLIST_CASE_PARAM=newJSONObject),params={method:"followedHRCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/followedHRCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_FOLLOWS,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_FOLLOWS,errorMsg,!needNewFooter,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getUnassignedList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var index,params={},errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:HRCase.List.statusSysValue,index:index,requestorErecno:"",query:"",type:"unassigned"},errorMsg=ZPI18N.getString("zp.nodataunassign"),HRCase.UNASSIGN_CASE_PARAM=newJSONObject),params={method:"unassignedHRCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/unassignedHRCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_UNASSIGNCASES,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_UNASSIGNCASES,errorMsg,!needNewFooter,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getMyReqCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter,self){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params={},errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:"",index:index},HRCase.MYREQ_CASE_PARAM=newJSONObject,errorMsg=ZPI18N.getString("zp.nodatarequestor")),params={method:"myHrCasesRequest",myCaseRequestJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/myHrCasesRequest.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_MYREQUEST,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_MYREQUEST,errorMsg,!needNewFooter,!needNewFooter,self),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getMyHrCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter,mode,particular,id){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params={},errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={requestorErecno:"",query:"",status:HRCase.List.statusSysValue,index:index},HRCase.MYCASE_CASE_PARAM=newJSONObject,errorMsg=ZPI18N.getString("zp.noongoingcases")),mode&&(newJSONObject.mode="self",particular&&(newJSONObject.requestorErecno=id)),params={method:"myHrCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/myHrCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_MYCASES,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),mode?HRCase.List.getCasesList(data,REQ_TYPE_ALLCASES,errorMsg,!0,!needNewFooter,mode):HRCase.List.getCasesList(data,REQ_TYPE_MYCASES,errorMsg,!0,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getAllCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params={},errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject=(isadmin||isManageHRCase)&&void 0!=Layout.Page.urlparam.categoryid&&void 0!=Layout.Page.urlparam.status&&HRCase.SPC_SEARCH?{categoryId:Layout.Page.urlparam.categoryid,query:"",status:Layout.Page.urlparam.status,index:index}:{categoryId:"",query:"",status:"",index:index},HRCase.ALLCASE_CASE_PARAM=newJSONObject,errorMsg=ZPI18N.getString("zp.noallcases")),params={method:"allHrCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/allHrCases.zp",type:POST,data:params,async:!1,success:function(data){if(1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_ALLCASES,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_ALLCASES,errorMsg,!needNewFooter,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status),(isadmin||isManageHRCase)&&void 0!=Layout.Page.urlparam.categoryid&&void 0!=Layout.Page.urlparam.status&&HRCase.SPC_SEARCH){var filterDiv=HRCase.SearchFilter.getFilterArray();AdvancedFilter.filterTagClearOption(filterDiv),pageId.find("#statusDiv_input").attr("selectedIds",Layout.Page.urlparam.status),pageId.find("#cgyDiv_input").attr("selectedIds",Layout.Page.urlparam.categoryid)}}})},getCasesList:function(data,mode,nodataKey,showFooterOnempty,showHeaderOnEmpty,isCheckforCaserowClick){var pageId=Layout.Page.container,bodyDiv="div#caseList";0==pageId.find("div[caseId]").length&&pageId.find(bodyDiv).html(""),0!=data.hrcaseList.length&&(pageId.find("#hrcaseHead [caseid]").removeClass("sel"),pageId.find("#caseScrollHead").removeClass("zp_dyn"),$.each(data.hrcaseList,function(index,value){pageId.find(bodyDiv).append(HRCase.List.caseListRow(value,mode,isCheckforCaserowClick))})),0==pageId.find("div[caseId]").length&&(pageId.find(bodyDiv).empty(),void 0!=showFooterOnempty&&showFooterOnempty||pageId.find("[name=footerposition]").addClass("zp_dyn"),void 0!=showHeaderOnEmpty&&showHeaderOnEmpty||pageId.find("#caseScrollHead").addClass("zp_dyn"),pageId.find(bodyDiv).append(CommonTemplates.noDataSVG("",!0,nodataKey)),pageId.find("[name=nodataReq]").click(function(e){window.location.href="#hrcase/category/list"})),pageId.find("#cgyFilter").off("click"),pageId.find("#cgyFilter").on("click",function(e){var filterType="category_agent";mode!=REQ_TYPE_MYCASES&&mode!=REQ_TYPE_UNASSIGNCASES&&(filterType="category");var prop=HRCase.SearchFilter.filterDropDown(filterType);prop.checkbox=!1,prop.callback=function(ele){var categoryId=$(ele).attr("id"),categoryName=$(ele).attr("name");""==categoryId&&(categoryName=ZPI18N.getString("zp.category")),HRCase.SearchFilter.getQuickFilterList("category",categoryId),pageId.find("#cgyFilter").prev("font").html("<em>"+ZPeople.escapeHtml(categoryName)+"</em>")},pageId.find("#cgyFilter").zparrowmenu(prop)}),data.isNextAvailable&&ZPeople.FireScroll.reset()},caseListRow:function(data,mode,isCheckforCaserowClick){var caseRow=(Layout.Page.container,$("#caseRow").clone());$(caseRow).removeAttr("id"),$(caseRow).removeClass("zp_dyn"),$(caseRow).attr("caseId",data.recordId);var userData={};mode==REQ_TYPE_MYREQUEST?($(caseRow).find("[name=caseDetails]").before(HRCase.List.getAvatarImageDiv(data,mode)),userData=data.agent,data.agent.hasOwnProperty("name")||(userData.name=data.agent.details)):($(caseRow).find("[name=caseDetails]").before(CommonTemplates.returnImgDiv(data.requestor.employeePhoto,"","","",data.requestor.zuid)),userData=data.requestor);var attachmentDiv="";data.hasOwnProperty("hasAttachment")&&(attachmentDiv+='<span id="attachment"><i class="IC-attach1" data-original-title="Attachment" data-toggle="tooltip" data-placement="top"></i></span>');var userPopup="";userData.hasOwnProperty("zuid")&&(userPopup='empid="'+userData.zuid+'" popup= "user"');var followtype="";mode==REQ_TYPE_FOLLOWS&&data.hasOwnProperty("followerMode")&&(followtype='<em class="zp_ldot">'+data.followerMode+"</em>");var casedetails="<h3><span>"+data.caseId+"</span>"+data.subject+"</h3>"+attachmentDiv+"<a "+userPopup+' class="zp_ldot">'+userData.name+'</a><em class="zp_ldot">'+data.requestedTime+"</em>"+followtype+"</div>";$(caseRow).find("[name=caseDetails]").empty().append(casedetails),$(caseRow).find("[name=CLcategory]").html(data.categoryName),$(caseRow).find("[name=CLstatus]").empty().html("<span >"+data.status+"</span>"),$(caseRow).find("[name=CLstatus]").find("span").addClass(HRCase.List.getStatusColorClass(data.statusId));var deleteButton="";return(isadmin||isManageHRCase&&"undefined"==typeof hCLocAccess)&&mode==REQ_TYPE_ALLCASES&&(deleteButton='<i id="delCase" class="IC-delete-1px zp_rB"></i>'),mode!=REQ_TYPE_MYREQUEST&&mode!=REQ_TYPE_MYCASES&&(data.agent.hasOwnProperty("name")?$(caseRow).find("[name=CLstatus]").after('<div class="zp_Lass" name="CLAgent">'+HRCase.List.getAvatarImageDiv(data,mode)+'</div><div class="zp_Lrgt">'+deleteButton+"</div>"):$(caseRow).find("[name=CLstatus]").after('<div class="zp_Lass" name="CLAgent"><i class="IC-user-plu zp_rBf" id="pickUptoMe" onclick="HRCase.DetailedView.getAssignedToList(event,this,\''+data.recordId+"','caseList')\"></i></div><div class=\"zp_Lrgt\">"+deleteButton+"</div>")),-1!==deleteButton.indexOf("delCase")&&$(caseRow).find("#delCase").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),HRCase.DetailedView.deleteCase(data.recordId)}),$(caseRow).off("click").on("click",function(){isCheckforCaserowClick?HRCase.DetailedView.viewCaseDetails(data.recordId,isCheckforCaserowClick):window.location.href=HRCases.getParentURL()+"/view-caseid:"+data.recordId}),$(caseRow).find("#attachment").on("click",function(e){e.stopPropagation();var obj=$(this);ZPeople.Request.send("/getfilesList.zp",{method:"getFilesList",conreqcsr:csrfToken,caseId:data.recordId},function(d){var params=[];$.each(d,function(index,v){var param1={value:v.fileName,id:v.fileUploadId};params.push(param1)}),obj.zparrowmenu({id:"flList",data:params,callback:function(Obj1){HRCaseCommon.getFileContent($(Obj1).attr("id"),data.recordId,HR_CASE_ATTACHEMENTS,escape($(Obj1).attr("name")))}})})}),data.statusId==HRCase.COMPLETED_SID&&$(caseRow).addClass("zp_cmpl"),caseRow},getStatusColorClass:function(statusId){var colorClass="zp_bclr";switch(statusId){case HRCase.OPEN_SID:colorClass="zp_bclr";break;case HRCase.INPROGRESS_SID:colorClass="zp_gclr";break;case HRCase.AWAITING_SID:colorClass="zp_ybg";break;case HRCase.ONHOLD_SID:colorClass="zp_lyclr";break;case HRCase.COMPLETED_SID:colorClass="zp_grbg";break;case HRCase.CANCELLED_SID:colorClass="zp_rclr";break;default:newClassName="zp_bclr"}return colorClass},getAvatarImageDiv:function(data,mode){var html="",name=data.agent.hasOwnProperty("name")?data.agent.name:data.agent.details;return html+=data.agent.hasOwnProperty("name")?CommonTemplates.returnImgDiv(data.agent.employeePhoto,ZPeople.escapeHtml(CommonTemplates.getAltText(name)),"","",data.agent.zuid):data.agent.typeId==ZPI18N.getString("zp.employee")?CommonTemplates.returnImgDiv(data.agent.employeePhoto,ZPeople.escapeHtml(CommonTemplates.getAltText(name)),"","",data.agent.zuid):CommonTemplates.returnImgDiv("",ZPeople.escapeHtml(CommonTemplates.getAltText(name)),"",name)},newstatusChange:function(statusId,caseId){var pageId=Layout.Page.container,newClassName=HRCase.List.getStatusColorClass(statusId);if(pageId.find("#cStatus").attr("class",newClassName),void 0!=caseId){var statusName="";$.each(STATUS,function(key){return STATUS[key]==statusId?void(statusName=key):void 0}),pageId.find("#caseList").find("[caseid="+caseId+"]").find("[name=CLstatus] span").attr("class",newClassName),pageId.find("#caseList").find("[caseid="+caseId+"]").find("[name=CLstatus] span").html(statusName)}},footerStatusUpdate:function(oldStatusId,newStatusId){var pageId=Layout.Page.container;if(void 0!=oldStatusId){var oldStatus=pageId.find("[name='footerposition']").find("span[value="+oldStatusId+"]");oldStatus.length>0&&oldStatus.text(parseInt(oldStatus.text())-1)}if(void 0!=newStatusId){var newStatus=pageId.find("[name='footerposition']").find("span[value="+newStatusId+"]");newStatus.length>0&&newStatus.text(parseInt(newStatus.text())+1)}}},HRCase.DetailedView={viewCaseDetails:function(caseid,self){var pageId=Layout.Page.container,url=Layout.Page.hash;AdvancedFilter.hideFilter(),pageId.find("#caseDtls").find("#zp_page_loading").remove(),pageId.find("div[caseid]").removeClass("sel"),pageId.find('div[caseid = "'+caseid+'"]').addClass("sel");var params={conreqcsr:csrfToken,method:"getInfoInCase",caseId:caseid};ZPeople.Request.send("/getHRCaseInfoPanel.zp",params,function(response){var status=response.status;if("success"==status){var onlyCaseDetails=response.InfoPanel.viewCaseDataOnly,caseDtl=response.InfoPanel.caseDtls;if(pageId.find("#caseDtls").length<=0){var viewPg=HRCaseCommon.cViewPageHtml();if(viewPg=viewPg.replace(/\$CVHDR\$/g,HRCaseCommon.cViewHeader()),viewPg=viewPg.replace(/\$CVINFO\$/g,HRCaseCommon.cViewInfo()),caseDtl.statusId==HRCase.COMPLETED_SID){var closedTime=ZPDateTime.getDateDisplayFormat(caseDtl.completedTime),headertext=ZPI18N.getString("zp.closed");-1===closedTime.indexOf(ZPI18N.getString("zp.today"))&&-1===closedTime.indexOf(ZPI18N.getString("zp.yesterday"))&&(headertext+=" "+ZPI18N.getString("zp.on")),viewPg=viewPg.replace(/_AGENT_/g,headertext+" <span>"+closedTime+"</span> "+ZPI18N.getString("zp.by"))}else viewPg=viewPg.replace(/_AGENT_/g,ZPI18N.getString("zp.agent"));viewPg=viewPg.replace(/\$CVCNT\$/g,HRCaseCommon.cViewCnt(onlyCaseDetails)),viewPg=viewPg.replace(/\$CASEID\$/g,"'"+caseid+"'"),Layout.Page.container.append(viewPg),-1!==url.indexOf("selfservice/cases/list")||-1!==url.indexOf("selfservice/mycases/list")?pageId.find("#caseDtls").addClass("zp_sFlv"):pageId.find("#caseDtls").removeClass("zp_sFlv")}MORE_OPTION=[],pageId.find("#moredropdown").remove(),ZPForm.CURRFORM_PARAM.recordId=caseid,ZPForm.CURRFORM_PARAM.formId=response.hrcaseformId;var caseDtl=response.InfoPanel.caseDtls;pageId.find("#caseDtlsContent").scrollTop(0),pageId.find("#viewHeader").empty(),pageId.find("#viewHeader").append("<label >"+caseDtl.caseId+'</label> <span title="'+caseDtl.subject+'">'+caseDtl.subject+"</span>"),pageId.find("#viewHeader").append("<div>"+ZPDateTime.getDateDisplayFormat(caseDtl.createdTime)+" <em> "+ZPI18N.getString("zp.by")+" </em>"+caseDtl.requestorName+" </div>"),pageId.find("#addNotes").find(".CR-note").removeAttr("noteId"),caseDtl.hasOwnProperty("noteId")?(pageId.find("#addNotes").find(".CR-note").addClass("sel"),pageId.find("#addNotes").find(".CR-note").attr("noteid",caseDtl.noteId)):pageId.find("#addNotes").find(".CR-note").removeClass("sel"),HRCaseNotes.escapeKeyEvent(),HRCaseMoreOption.moreOption(caseid,caseDtl.agentId,caseDtl.agentTypeId,caseDtl.requestorId,caseDtl.statusId);var categorydropdownarrow="";pageId.find("#cgyName").off("click"),response.InfoPanel.hasOwnProperty("changeCategoryList")?(pageId.find("#cgyName").closest("div").removeClass("zp_NH"),pageId.find("#cgyName").data("changeCategoryList",response.InfoPanel.changeCategoryList),categorydropdownarrow='<i class="IC-ar-dwn"></i>',pageId.find("#cgyName").on("click",function(){HRCase.DetailedView.changeCategoryDropdown(this,caseid,HRCase.DetailedView.CASE_VIEW_PAGE,caseDtl.requestorId!=erecno)})):pageId.find("#cgyName").closest("div").addClass("zp_NH"),pageId.find("#cgyName").html('<i class="'+Icons.getIconClass(caseDtl.categoryIcon).iconClass+' zp_Si"></i><font>'+caseDtl.categoryName+"</font>"+categorydropdownarrow),pageId.find("#cgyName").attr("selectedIds",caseDtl.categoryId),HRCase.List.newstatusChange(caseDtl.statusId);var statusdropdownarrow=caseDtl.statusId!=HRCase.CANCELLED_SID&&caseDtl.permittedCaseStatus.length>0?'<i class="IC-ar-dwn"></i>':"";if(pageId.find("#caseStatus").html("<font>"+caseDtl.statusName+"</font>"+statusdropdownarrow),pageId.find("#caseStatus").attr("selectedIds",caseDtl.statusId),pageId.find("#caseStatus").off("click"),caseDtl.permittedCaseStatus.length>0?(pageId.find("#caseStatus").closest("div").removeClass("zp_NH"),pageId.find("#caseStatus").on("click",function(){HRCase.SearchFilter.selectCaseStatus(caseid,this,caseDtl.statusId,caseDtl.isAgent,caseDtl.permittedCaseStatus)})):pageId.find("#caseStatus").closest("div").addClass("zp_NH"),pageId.find("#caseOwner").off("click"),caseDtl.statusId==HRCase.COMPLETED_SID&&caseDtl.hasOwnProperty("completedBy")){var closedTime=ZPDateTime.getDateDisplayFormat(caseDtl.completedTime),headertext=ZPI18N.getString("zp.closed");-1===closedTime.indexOf(ZPI18N.getString("zp.today"))&&-1===closedTime.indexOf(ZPI18N.getString("zp.yesterday"))&&(headertext+=" "+ZPI18N.getString("zp.on")),pageId.find("#pickupOption").siblings("dt").html(headertext+" <span>"+closedTime+"</span> "+ZPI18N.getString("zp.by")),pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv(caseDtl.completedBy.employeePhoto,ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(caseDtl.completedBy.name))),"","",caseDtl.completedBy.zuid)+"<font>"+caseDtl.completedBy.name+"</font>")}else{pageId.find("#pickupOption").siblings("dt").html(ZPI18N.getString("zp.agent"));var altText=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(caseDtl.agentDetails))),sourceUrl="",agentZuid="";caseDtl.hasOwnProperty("agentId")&&"null"!=caseDtl.agentId&&(sourceUrl=caseDtl.agent.employeePhoto,agentZuid=caseDtl.agent.zuid),pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv(sourceUrl,altText,"","",agentZuid)+"<font>"+caseDtl.agentDetails+"</font>")}response.InfoPanel.hasOwnProperty("assignedToList")&&response.InfoPanel.assignedToList?(pageId.find("#caseOwner").append('<i class="IC-ar-dwn"></i>'),pageId.find("#caseOwner").closest("div").removeClass("zp_NH"),pageId.find("#caseOwner").off("click").on("click",function(e){HRCase.DetailedView.getAssignedToList(e,this,caseid,"caseView")})):pageId.find("#caseOwner").closest("div").addClass("zp_NH"),"null"!=caseDtl.description&&""!=caseDtl.description?(pageId.find("#caseDesc").remove(),pageId.find("#showFromInfo").before('<div  id="caseDesc" class="zp_Pdesc">'+caseDtl.description+"</div>")):pageId.find("#caseDesc").remove();var formDiv=HRCaseCommon.cViewForm();if(formDiv=formDiv.replace(/\$CASEID\$/g,"'"+caseid+"'"),pageId.find("#showFromInfo").replaceWith(formDiv),HRCase.DetailedView.getAttachmentList(caseid,response.InfoPanel),onlyCaseDetails)pageId.find("#showFromInfo").find(".zp_Plnk").trigger("click");else{for(var comments=response.HRCaseFeedComment.comments,cnt=0;cnt<comments.length;cnt++)comments[cnt].content=ZPFeeds.Activity.validateContent(comments[cnt].content,!1,response.HRCaseFeedComment.departmentDts,response.HRCaseFeedComment.groupDts);pageId.find("#zp_hrcase_comments").empty(),pageId.find("#zp_hrcase_comments").attr("streamid",caseid);var cmtData=response.HRCaseFeedComment;pageId.find("#caseDtls").attr("fdk",cmtData.fdk),cmtData.actRecId=caseid,cmtData.customeButton=caseDtl.permittedCaseStatus.length>0?!0:!1,cmtData.status=response.InfoPanel.caseDtls.statusId,cmtData.reqID=caseDtl.requestorId;var newJSON={};newJSON.calback=function(){HRCase.Comments.showMoreComments(caseid)},newJSON.subBtnName="zp.reply",ZPACommon.constructCmtRw(cmtData,Layout.Page.container.find("#zp_hrcase_comments"),newJSON),pageId.find("#cmtReplyBtn").click(function(e){e.stopPropagation(),e.preventDefault(),pageId.find("#editor_container,#postCommentBtn").remove(),ZPFeeds.Comment.getNewEditor(cmtData)}),pageId.find("#addTaskBtn").click(function(e){setTimeout(function(){pageId.find("#caseDtlsContent").scrollTop(pageId.find("#rt_table").offset().top),pageId.find("#quicktaskname").trigger("focus")},300)}),pageId.find("#zp_views_list_container_rel-1").empty(),void 0!=response.InfoPanel.caseDtls.agentId?Task.constructRelatedTask(response.taskList,!0):pageId.find(".IC-hc-task").parent().addClass("zp_dyn");}Layout.Page.container.addClass("zp_Pshw"),pageId.find("#caseDtls").attr("caseId",caseid),CommonTemplates.setViewKey()}else ZPeople.Message.showFailureMsg(response.desc),HRCase.DetailedView.closeSlide()})},CASE_VIEW_PAGE:"caseViewPage",changeCategoryDropdown:function(obj,recordId,mode,allowFollow){var params=[],callback="";$.isEmptyObject($(obj).data("changeCategoryList"))||$.each($(obj).data("changeCategoryList"),function(i,v){var param1={};param1.id=v.categoryId,param1.value=v.categoryName,param1.iconClass="zp_Si "+Icons.getIconClass(v.categoryIcon).iconClass,params.push(param1)}),"caseViewPage"==mode&&(callback=function(liObj,sourceObj){HRCase.DetailedView.categoryChangeCallback(recordId,liObj,sourceObj)}),$(obj).zparrowmenu({id:"ccategoryList",data:params,callback:function(dataObj,sourceObj){var popupHtml=ZPI18N.getString("zp.categoryconfirm",new Array(ZPeople.escapeHtml($(dataObj).attr("name"))));allowFollow&&(popupHtml+='<p class="inlCbox MT10"><label class="checkbox"><input id="folChk" name="folChk" type="checkbox"><span>'+ZPI18N.getString("zp.followcase")+"</span><div></div></label></p>"),ZPeople.BSModal.confirm(function(e){var isFollow=!1;allowFollow&&(isFollow=$("#zp_confirm_body").find("#folChk").is(":checked")),HRCase.DetailedView.ChangeCategory(dataObj,sourceObj,recordId,isFollow,callback)},ZPI18N.getString("zp.changecategory"),popupHtml)}})},getFormView:function(caseid){var pageId=Layout.Page.container,parentDiv=pageId.find("#showFromInfo").find("div.zp_Plnk");parentDiv.hasClass("zp_sel")?(parentDiv.next().remove(),parentDiv.removeClass("zp_sel"),parentDiv.empty().append(ZPI18N.getString("zp.showdetails")+'<i class="IC-ar-dwn"></i>'),parentDiv.after('<div id="formInfo"></div>')):(parentDiv.addClass("zp_sel"),parentDiv.empty().append(ZPI18N.getString("zp.hidedetails")+'<i class="IC-ar-dwn"></i>'),HRCases.CURR_COMPONENT={formId:ZPForm.CURRFORM_PARAM.formId,recordId:caseid,isPageMode:!0,formMode:"VIEW",containerId:"formInfo",loadingContainer:"showFromInfo",disableSingleEdit:!0},ZPForm.load(HRCases.CURR_COMPONENT))},getAssignedToList:function(event,obj,caseId,mode,callback){event.stopPropagation(),event.preventDefault(),HRCase.ASSIGNEE_LIST.hasOwnProperty(caseId)||ZPeople.Request.sendAsyncPost("/getAssignedToList.zp",{caseId:caseId,method:"getAssignedToList",conreqcsr:csrfToken},function(data){"success"==data.status?data.assignedToList.isAssigneeAvailable?HRCase.ASSIGNEE_LIST[caseId]=data.assignedToList.assigneeList:HRCase.ASSIGNEE_LIST[caseId]=[]:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))},function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))});var empdata=[];$.each(HRCase.ASSIGNEE_LIST[caseId],function(i,value){var param1={value:value.empDispName,image:value.empPhoto,id:value.empErecno,ownerType:OWNER_EMPLOYEE,dataval:"callbackcal"};empdata.push(param1)}),empdata.length>0&&$(obj).zparrowmenu({id:"assignedToList",data:empdata,callback:function(liObj,srcObj){HRCase.DetailedView.assignHrcase(srcObj,liObj,caseId,mode)}}),void 0!=callback&&"function"==typeof callback&&callback(empdata)},getAttachments:function(caseId,fileArr){var html="";return $.each(fileArr,function(i,v){html+=v.hasOwnProperty("imageUri")?'<div class="attachedFile filePosts"  attachcnt="'+i+'1"  onclick="HRCaseCommon.getFileContent(\''+v.fileUploadId+"','"+caseId+"','"+HR_CASE_ATTACHEMENTS+"','"+escape(v.fileName)+'\')"> <i class="IC-jpg fileType"></i><div class="fileNameAndSize"><label class="fileName" purpose="fileName">"'+v.imageUri+'"</label> <span purpose="fileSize"></span> </div> </div>':'<div class="attachedFile filePosts"  attachcnt="'+i+'1"  onclick="HRCaseCommon.getFileContent(\''+v.fileUploadId+"','"+caseId+"','"+HR_CASE_ATTACHEMENTS+"','"+escape(v.fileName)+'\')"> <i class="IC-ppt fileType"></i><div class="fileNameAndSize"><label class="fileName" purpose="fileName">"'+decodeURIComponent(v.fileName)+'"</label> <span purpose="fileSize"></span> </div> </div>'}),html},getAttachmentList:function(caseId,response){var pageId=Layout.Page.container;if(response.hasOwnProperty("filesList")){pageId.find("#caseAttch").removeClass("zp_dyn"),pageId.find("#filesAttch").empty();var html="";$.each(response.filesList,function(i,v){html+=v.hasOwnProperty("imageUri")?'<div class="attachedFile" attachcnt="'+i+'1"  onclick="HRCaseCommon.getFileContent(\''+v.fileUploadId+"','"+caseId+"','"+HR_CASE_ATTACHEMENTS+"','"+escape(v.fileName)+'\')" ><a class="attImage"><img src="'+v.imageUri+'"></a></div>':'<div class="attachedFile" attachcnt="'+i+'1"  onclick="HRCaseCommon.getFileContent(\''+v.fileUploadId+"','"+caseId+"','"+HR_CASE_ATTACHEMENTS+"','"+escape(v.fileName)+'\')" ><div class="uploadBar"><p id="zp_fileName">'+decodeURIComponent(v.fileName)+'</p></div><i class="IC-formcustom fileType"></i></div>'}),pageId.find("#filesAttch").append(html)}else pageId.find("#caseAttch").addClass("zp_dyn"),pageId.find("#filesAttch").empty()},closeSlide:function(){var pageId=Layout.Page.container;pageId.find("div[caseid]").removeClass("sel"),Layout.Page.container.hasClass("zp_Pshw")?Layout.Page.container.removeClass("zp_Pshw"):"",-1!==Layout.Page.hash.indexOf("#hrcase/myrequest")?window.location.href="#hrcase/myrequest/list":-1!==Layout.Page.hash.indexOf("#hrcase/list/")?window.location.href="#hrcase/list":-1!==Layout.Page.hash.indexOf("#hrcase/allcases/")?window.location.href="#hrcase/allcases/list":-1!==Layout.Page.hash.indexOf("#hrcase/watchlist/")?window.location.href="#hrcase/watchlist/list":-1!==Layout.Page.hash.indexOf("#hrcase/unassigned/")&&(window.location.href="#hrcase/unassigned/list"),pageId.find("#hrcaseHead").find("div.zp_lwrap").hasClass("zp_kansh")?pageId.find("#hrcaseHead").find(".zp_lwrap").removeClass("zp_kansh"):"",pageId.find("#showNotes").hasClass("shw")&&pageId.find("#showNotes").removeClass("shw")},CloseHrcase:function(caseId,ele,oldCaseStatus){var pageId=Layout.Page.container,params={conreqcsr:csrfToken,status:$(ele).attr("id"),zp_recordId:caseId,method:"CloseHrcase"};pageId.find("#caseStatus").html(ZPeople.LOADING_HTML),ZPeople.Request.send("/CloseHrcase.zp",params,function(data){"success"==data.status?HRCase.DetailedView.changeStatusCallBack(data,oldCaseStatus,params.status,$(ele).attr("name"),caseId):ZPeople.Message.showFailureMsg(data.desc)})},changeStatusCallBack:function(data,oldStatusId,newstatusId,newstatusName,caseId,noComment){var pageId=Layout.Page.container;if(HRCase.List.footerStatusUpdate(oldStatusId,newstatusId),MORE_OPTION=jQuery.grep(MORE_OPTION,function(value){return"cancelCase"!=value.id}),0==MORE_OPTION.length&&pageId.find("#moredropdown").remove(),void 0!=noComment&&noComment||HRCase.Comments.constructSinglefieldComments(data,caseId),newstatusId==HRCase.CANCELLED_SID?pageId.find("#cStatus").html('<span id="caseStatus"><font>'+ZPeople.escapeHtml(ZPI18N.getString("zp.cancelled"))+"</font></span>"):pageId.find("#cStatus").html('<span id="caseStatus"><font>'+ZPeople.escapeHtml(newstatusName)+'</font><i class="IC-ar-dwn"></i></span>'),pageId.find("#caseStatus").attr("selectedids",newstatusId),HRCase.List.newstatusChange(newstatusId,caseId),0!=pageId.find("#caseDtlsContent").find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId).length){var fcid=pageId.find("[folabel=status]").attr("id").split("_").pop(),status_optionvalue=HRCaseForm.getOptionValue(fcid,ZPForm.CURRFORM_PARAM.formId,newstatusId);pageId.find("[folabel=status]").find("span").text(status_optionvalue),newstatusId==HRCase.COMPLETED_SID&&(pageId.find("[folabel=completed_time]").find("span").text(ZPI18N.getString("zp.now")),pageId.find("[folabel=complete_by]").find("span").text(ZPeople.CURR_USER.name)),HRCaseForm.fillDetailViewPage({case_number:$(pageId.find("[folabel=caseid]").find("span")[0]).text()})}if(newstatusId==HRCase.COMPLETED_SID){var closedTime=ZPDateTime.getDateDisplayFormat($.now()),headertext=ZPI18N.getString("zp.closed");-1===closedTime.indexOf(ZPI18N.getString("zp.today"))&&-1===closedTime.indexOf(ZPI18N.getString("zp.yesterday"))&&(headertext+=" "+ZPI18N.getString("zp.on")),pageId.find("#pickupOption").siblings("dt").html(headertext+" <span>"+closedTime+"</span> "+ZPI18N.getString("zp.by")),pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv(ZPeople.CURR_USER.avatar,ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(ZPeople.CURR_USER.name))),"","",_LOGGEDIN_ZUID)+"<font>"+ZPeople.CURR_USER.name+"</font>"),pageId.find("#caseList").find("div[caseid="+caseId+"]").addClass("zp_cmpl")}else pageId.find("#pickupOption").siblings("dt").html(ZPI18N.getString("zp.agent")),pageId.find("#caseList").find("div[caseid="+caseId+"]").removeClass("zp_cmpl"),data.hasOwnProperty("agent")?pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv(data.agent.employeePhoto,ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent.name))),"","",data.agent.zuid)+"<font>"+data.agent.name+"</font>"):pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv("",ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))),"","")+"<font>"+data.agent_details+"</font>");(newstatusId==HRCase.CANCELLED_SID||newstatusId==HRCase.COMPLETED_SID)&&(pageId.find("#cgyName").closest("div").addClass("zp_NH"),pageId.find("#cgyName").off("click"),pageId.find("#cgyName").find("i.IC-ar-dwn").remove(),pageId.find("#caseOwner").closest("div").addClass("zp_NH"),pageId.find("#caseOwner").off("click"),pageId.find("#caseOwner").find("i").remove(),HRCase.ASSIGNEE_LIST[caseId]=[],pageId.find("#postclosecmts").remove()),data.hasOwnProperty("agent")&&(pageId.find("#caseList").find("[caseid="+caseId+"]").find("[name=CLAgent]").html(pageId.find("#caseOwner").find("div.ZP_photo")[0].outerHTML),HRCase.DetailedView.updateUnassignedCount(!0,1)),pageId.find("#caseStatus").off("click"),data.hasOwnProperty("permittedCaseStatus")&&data.permittedCaseStatus.length>0?(pageId.find("#cStatus").closest("div").removeClass("zp_NH"),pageId.find("#caseStatus").on("click",function(){HRCase.SearchFilter.selectCaseStatus(caseId,this,newstatusId,data.isAgent,data.permittedCaseStatus)})):(pageId.find("#cStatus").closest("div").addClass("zp_NH"),pageId.find("#cStatus").find("i.IC-ar-dwn").remove())},updateUnassignedCount:function(isDecreased,offset){var unassignedCountDiv=Layout.Page.container.find("[name=footerposition]").find("#unassigned");if(unassignedCountDiv.length>0){var count=parseInt(unassignedCountDiv.text());isDecreased?count-=offset:count+=offset,unassignedCountDiv.html(count)}},assignHrcase:function(srcObj,ele,caseid,mode){var pageId=Layout.Page.container,params=(Layout.Page.hash,{conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:caseid,assignedId:$(ele).attr("id")});pageId.find("#caseOwner").html(ZPeople.LOADING_HTML),ZPeople.Request.send("/assignedHrcase.zp",params,function(data){if("success"==data.status){if("caseList"==mode){var obj=$(srcObj).parent().parent();obj.find("[name=CLAgent]").remove(),$(obj).find("[name=CLstatus]").after('<div class="zp_Lass" name="CLAgent">'+HRCase.List.getAvatarImageDiv(data,mode)+"</div>")}else if(("caseView"==mode||"categorychnge"==mode)&&(HRCase.Comments.constructSinglefieldComments(data,caseid),0!=pageId.find("#caseDtlsContent").find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId).length)){var fcid=ZPForm.LAYOUT.find("div[folabel=agent]").attr("id").split("_").pop(),formcp=ZPForm.Field.getFieldComponent(fcid),value=ZPForm.Field.setValue(formcp,$(ele).attr("name"),fcid);ZPForm.LAYOUT.find("[folabel=agent]").html(value)}HRCase.DetailedView.newAgentDetails(caseid,{id:data.agent.zuid,name:ZPeople.escapeHtml($(ele).attr("name")),data:data,mode:mode},$(ele).find("div.ZP_photo")[0].outerHTML)}else ZPeople.Message.showFailureMsg(data.desc)})},newAgentDetails:function(caseId,agentData,imageDiv){var pageId=Layout.Page.container,url=Layout.Page.hash,data=agentData.data;pageId.find("#caseOwner").html(imageDiv+"<font>"+agentData.name+"</font>"),void 0!=agentData.id&&(pageId.find("#caseOwner").find("div.ZP_photo").attr("popup","user"),pageId.find("#caseOwner").find("div.ZP_photo").attr("empid",agentData.id)),data.hasOwnProperty("taskList")||data.hasOwnProperty("agent")?(pageId.find("#zp_views_list_container_rel-1").empty(),Task.constructRelatedTask(data.taskList,!0)):pageId.find("#zp_views_list_container_rel-1").empty();var agentRow=pageId.find('[caseid = "'+caseId+'"]');agentRow.find("[name=CLAgent]").empty(),-1!==url.indexOf("hrcase/allcases/list")||-1!==url.indexOf("hrcase/unassigned/list")||-1!==url.indexOf("hrcase/myfollows/list")||-1!==url.indexOf("#hrcase/allcases/view")||-1!==url.indexOf("#hrcase/unassigned/view")||-1!==url.indexOf("#hrcase/watchlist/view")||-1!==url.indexOf("selfservice/cases/list")||-1!==url.indexOf("selfservice/mycases/list")?"categorychnge"==agentData.mode||"unassign"==agentData.mode?(data.hasOwnProperty("agent")?($(agentRow).find("[name=CLAgent]").html(HRCase.List.getAvatarImageDiv(data,agentData.mode)),$(agentRow).find("[name=CLAgent]").removeAttr("onclick"),$(agentRow).find("[name=CLAgent]").off("click")):data.hasOwnProperty("assignedToList")&&data.assignedToList.isAssigneeAvailable||void 0!=HRCase.ASSIGNEE_LIST[caseId]&&HRCase.ASSIGNEE_LIST[caseId].length>0?($(agentRow).find("[name=CLAgent]").html('<i class="IC-user-plu zp_rBf" id="pickUptoMe"></i>'),$(agentRow).find("[name=CLAgent]").attr("onclick","HRCase.DetailedView.getAssignedToList(event, this, '"+caseId+"', '"+agentData.mode+"')")):($(agentRow).find("[name=CLAgent]").html(CommonTemplates.returnImgDiv("",ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))),"",data.agent_details,"")),$(agentRow).find("[name=CLAgent]").removeAttr("onclick"),$(agentRow).find("[name=CLAgent]").off("click")),$(agentRow).find("[name=CLcategory]").html(ZPeople.escapeHtml($("#cgyName").text()))):$(agentRow).find("[name=CLAgent]").html(HRCase.List.getAvatarImageDiv(agentData.data)):$(agentRow).find("[name=CLcategory]").html(ZPeople.escapeHtml($("#cgyName").text()))},ChangeCategory:function(obj,sourceObj,recordId,isFollow,callback){var params=(Layout.Page.container,{conreqcsr:csrfToken,method:"changeCatalog",categoryId:$(obj).attr("id"),zp_recordId:recordId});isFollow&&(params.followCase=!0);var originalHtml=$(sourceObj).html();$(sourceObj).html(ZPeople.LOADING_HTML),ZPeople.Request.send("/changeCatalog.zp",params,function(data){"success"!=data.status&&$(sourceObj).html(originalHtml),callback(data,obj)})},categoryChangeCallback:function(caseId,data,obj){var pageId=Layout.Page.container;if("success"==data.status){if(HRCase.Comments.constructSinglefieldComments(data,caseId),0!=pageId.find("#caseDtlsContent").find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId).length){var fcid=pageId.find("[folabel=category]").attr("id").split("_").pop(),formcp=ZPForm.Field.getFieldComponent(fcid),value=ZPForm.Field.setValue(formcp,$(obj).attr("name"),fcid);ZPForm.LAYOUT.find("[folabel=category]").html(value)}var altText=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))),sourceUrl="",popupZuid="",agentData={};data.hasOwnProperty("agentId")&&"null"!=data.agentId?(sourceUrl=data.agent.employeePhoto,popupZuid=data.agent.zuid,agentData={id:popupZuid,name:data.agent_details}):agentData={name:data.agent_details},pageId.find("#cgyName").html($(obj).find("i")[0].outerHTML+"<font>"+ZPeople.escapeHtml($(obj).attr("name"))+"</font>"),agentData.mode="categorychnge",agentData.data=data,HRCase.DetailedView.newAgentDetails(caseId,agentData,CommonTemplates.returnImgDiv(sourceUrl,altText,"","",popupZuid));var categorydropdown="";pageId.find("#caseOwner").off("click"),data.hasOwnProperty("assignedToList")&&data.assignedToList.isAssigneeAvailable?(pageId.find("#caseOwner").closest("div").removeClass("zp_NH"),pageId.find("#caseOwner").append('<i class="IC-ar-dwn"></i>'),HRCase.ASSIGNEE_LIST[caseId]=data.assignedToList.assigneeList,pageId.find("#caseOwner").on("click",function(e){HRCase.DetailedView.getAssignedToList(e,this,caseId,"categorychnge")}),categorydropdown='<i class="IC-ar-dwn"></i>'):(HRCase.ASSIGNEE_LIST[caseId]=[],pageId.find("#caseOwner").closest("div").addClass("zp_NH")),pageId.find("#cgyName").append(categorydropdown)}else ZPeople.Message.showFailureMsg(data.desc)},unAssignedHrcase:function(caseId){var pageId=Layout.Page.container,params=(Layout.Page.hash,{conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:caseId,assignedId:0});ZPeople.Request.send("/unAssignedHrcase.zp",params,function(data){if("success"==data.status){if(MORE_OPTION=jQuery.grep(MORE_OPTION,function(value){return"unassignCase"!=value.id}),0==MORE_OPTION.length&&pageId.find("#moredropdown").remove(),HRCase.DetailedView.newAgentDetails(caseId,{name:data.agent_details,mode:"unassign",data:data},CommonTemplates.returnImgDiv("",CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details)),"","")),HRCase.Comments.constructSinglefieldComments(data,caseId),0!=pageId.find("#caseDtlsContent").find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId).length){var fcid=ZPForm.LAYOUT.find("div[folabel=agent]").attr("id").split("_").pop(),formcp=ZPForm.Field.getFieldComponent(fcid);ZPForm.Field.setValue(formcp,"-Select-",fcid);ZPForm.LAYOUT.find("[folabel=agent]").html("-")}}else ZPeople.Message.showFailureMsg(data.desc)})},deleteCase:function(caseid){ZPeople.BSModal.confirm(function(e){var params={method:"deleteCase",caseId:caseid,conreqcsr:csrfToken};ZPeople.Request.send("/deleteCase.zp",params,function(data){"success"==data.status?(HRCase.DetailedView.closeSlide(),$("div[caseid = "+caseid+"]").remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success"))):ZPeople.Message.showFailureMsg(data.desc)})},ZPI18N.getString("zp.deletecase"),ZPI18N.getString("zp.confirmdeletecase"))}},HRCase.Comments={List:{FEEDS_ACTIVITY_TYPE:"HrCase"},customeButton:function(data,params,actRecId){var pageId=Layout.Page.container;if("home/feeds/myfeed"===Layout.Page.currentmode){var boxId=pageId.find("#zp_feeds_views").find("[streamid="+actRecId+"]");boxId.find("#status").text(ZPI18N.getString("zp.closed")),boxId.find("#customeBtn").remove()}else HRCase.DetailedView.changeStatusCallBack(data,pageId.find("#caseStatus").attr("selectedids"),HRCase.COMPLETED_SID,ZPI18N.getString("zp.closed"),actRecId,!0)},constructSinglefieldComments:function(data,recId){var pageId=Layout.Page.container,content=ZPFeeds.Activity.validateContent(data.content.comments,void 0,void 0,!1),div="<div  id="+data.cfdk+'  class="zp-cmtdiv" commentid='+data.commentId+"><div empid="+ZPeople.CURR_USER.id+' popup="user" class="zp-cmt-uimg"> <img src='+ZPeople.CURR_USER.thumb+' class="zp-usimg zphvr-cpro"> </div> <div class="zp-cmt-content"><a empid='+data.zuid+' popup="user" class="zp-cmt-uname zphvr-cpro">'+ZPeople.CURR_USER.name+'</a><div class="zp-cmt-udt"><div>'+content+'<br></div></div> <div class="zp-cmt-uaction"> <span class="zpcmt-date FL">'+ZPDateTime.getDateDisplayFormat(data.content.time)+'</span> <div class="FL ZPdot"></div> <a id="zpcmt_like_link" class="zpcmt-like FL">'+ZPI18N.getString("zp.like")+"</a></div> </div> </div>";pageId.find("[streamid="+recId+"]").find("#cmtlistcont").removeClass("DN").append(div)},showMoreComments:function(caseid){var pageId=Layout.Page.container,params={method:"showMoreComments",conreqcsr:csrfToken,record_Id:caseid,reqType:"HrCase"};ZPeople.Request.send("/showMoreComments.zp",params,function(data){pageId.find("#zp_hrcase_comments").empty(),pageId.find("#zp_hrcase_comments").attr("streamid",caseid);for(var comments=data.comments,cnt=0;cnt<comments.length;cnt++)comments[cnt].content=ZPFeeds.Activity.validateContent(comments[cnt].content,!1,data.departmentDts,data.groupDts);data.comments=comments,data.actRecId=caseid,data.status=pageId.find("#caseStatus").attr("selectedIds"),data.customeButton=data.permittedCaseStatus.length>0?!0:!1,data.reqID=data.reqID;var newJSON={};newJSON.subBtnName="zp.reply",ZPACommon.constructCmtRw(data,Layout.Page.container.find("#zp_hrcase_comments"),newJSON),pageId.find("[totalcmts="+data.totalComments+"]").empty().append(ZPI18N.getString("zp.viewingallcomments",[data.totalComments])),pageId.find("[totalcmts="+data.totalComments+"]").parent().removeAttr("id")})},deleteHRCaseComment:function(cmtId,obj){var params={method:"postCaseComment",mode:"deleteHRCaseComment",conreqcsr:csrfToken,commentId:cmtId};ZPeople.Request.send("/deleteCaseComment.zp",params,function(data){"success"==data.status&&$(obj).remove()})}},HRCase.KanbanView={URL:"/myHRCaseKanbanView.zp",showKanbanView:function(){var criteriaObj={status:"",categoryId:"",query:""};HRCase.KanbanView.kanbanView(criteriaObj)},filterKanbanView:function(){var pageId=Layout.Page.container,criteriaObj={status:"",categoryId:"",query:""};pageId.find("#hrcasePreview").hasClass("zp_kanb")&&(""!=pageId.find("#searchInput").val()?criteriaObj.subject=pageId.find("#searchInput").val():"",void 0!=pageId.find("#statusInput").attr("selectedids")?criteriaObj.status=pageId.find("#statusInput").attr("selectedids"):"",void 0!=pageId.find("#cgyInput").attr("selectedids")?criteriaObj.categoryId=pageId.find("#cgyInput").attr("selectedids"):"",void 0!=pageId.find("#casereqInput").attr("selectedids")?criteriaObj.caseRequestor=pageId.find("#casereqInput").attr("selectedids"):"",void 0!=pageId.find("#tymPeriodInput").attr("selectedids")?criteriaObj.dateRange=pageId.find("#tymPeriodInput").attr("selectedids"):""),HRCase.KanbanView.kanbanView(criteriaObj)},kanbanView:function(CriteriaObj){var mode="status",pageId=Layout.Page.container,url=Layout.Page.hash,reqType="",ddobj={};-1!==url.indexOf("#hrcase/list")?reqType=REQ_TYPE_MYCASES:-1!==url.indexOf("#hrcase/allcases/list")&&(reqType=REQ_TYPE_ALLCASES),pageId.find("#hrcaseHead").children().remove(),$.ajax({url:HRCase.KanbanView.URL,type:POST,async:!1,data:{conreqcsr:csrfToken,method:"myKanbanView",mode:mode,reqType:reqType,criteria:JSON.stringify(CriteriaObj)},success:function(data){("#hrcase/list"==url||"#hrcase/allcases/list"==url)&&(window.location.href=Layout.Page.hash+"/kanbanView"),pageId.find("#hrcasePreview").addClass("zp_kanb"),pageId.find("#hrcaseHead").attr("mode",mode),ddobj.fcid=Object.keys(data)[0],ddobj.mode=mode,ddobj.formid=ZPForm.CURRFORM_PARAM.formId,ddobj.tablename=HRCaseTableName,ddobj.callback=ZPTasks.doAfterKanbUpdate;var columnNo=1;$.each(data[ddobj.fcid],function(val,rows){var columnId=pageId.find("#hrcaseHead").createNewColumn(!0,val,ddobj.mode+columnNo++);HRCase.KanbanView.cloneHRCaseRow(rows,columnId+" .zp_liscr")})}}),pageId.find("#hrcaseHead").createDragAndDrop(ddobj)},cloneHRCaseRow:function(caseArr,bodyToAppend){var url=Layout.Page.hash,currentRow="",pageId=Layout.Page.container;0==caseArr.length?0==pageId.find("#"+bodyToAppend).children().length&&pageId.find("#"+bodyToAppend).html("").append('<div id="noCasefound"><p class="no-para">'+ZPI18N.getString("zp.norecfound")+"</p></div>"):($.each(caseArr,function(index,row){currentRow=$("#caseRow").cloneRow("#"+bodyToAppend),currentRow.removeClass("zp_dyn"),currentRow.attr("rowid",row.caseId);var queryHtml='<span id="CLCaseNo" >'+this.caseId+"</span>";if(currentRow.find("#CLCaseQuery").html(queryHtml+row.subject),currentRow.find("#CLReqDate").text(row.requestedTime),-1!==url.indexOf("#hrcase/list")){0==row.agent.erecno.length&&row.isAgent&&(currentRow.find("div.zp_cfrm").prepend(HRCaseCommon.getPickUpHtml()),currentRow.find("#CLCaseReqName").addClass("zp_ldot"));var name=""!=row.agent.hasOwnProperty("name")?row.agent.name:row.agent.details;currentRow.find("#reqImgDiv").html(CommonTemplates.returnImgDiv(row.requestor.employeePhoto,"","CLReqPhoto",ZPeople.decodeTxt(name),row.requestor.zuid)),currentRow.find("#CLCaseReqName").html(name),currentRow.on("click",function(){window.location.href="#hrcase/list/view-caseid:"+row.recordId,currentRow.closest(".zp_lwrap").addClass("zp_kansh")})}else-1!==url.indexOf("#hrcase/allcases/list")&&(0==row.agent.erecno.length&&row.isAgent&&(currentRow.find("div.zp_cfrm").prepend(HRCaseCommon.getPickUpHtml()),currentRow.find("#CLCaseReqName").addClass("zp_ldot")),currentRow.find("#reqImgDiv").html(CommonTemplates.returnImgDiv(this.requestor.employeePhoto,"","CLReqPhoto",ZPeople.decodeTxt(this.requestor.name),this.requestor.zuid)),currentRow.find("#CLCaseReqName").html(this.requestor.name),currentRow.on("click",function(){window.location.href="#hrcase/allcases/view-caseid:"+row.recordId,currentRow.closest(".zp_lwrap").addClass("zp_kansh")}))}),caseArr.length==RECORDS_PER_PAGE&&ZPeople.FireScroll.reset())}},HRCase.SearchFilter={constructFilterOptions:function(){AdvancedFilter.constructFilter(HRCase.SearchFilter.getFilterArray(),HRCase.SearchFilter.searchHrcase)},getFilterArray:function(){var url=Layout.Page.hash,filterArr=[];return-1===url.indexOf("#hrcase/reports/adminreport")&&-1===url.indexOf("#hrcase/reports/agentreport")&&-1===url.indexOf("#hrcase/reports/userreport")&&filterArr.push({parentDiv:"searchDiv",type:"search",title:ZPI18N.getString("zp.search")}),filterArr.push({parentDiv:"statusDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("status"),title:ZPI18N.getString("zp.status")}),-1!==url.indexOf("#hrcase/list")||-1!==url.indexOf("#selfservice/mycases/list")?(filterArr.push({parentDiv:"caseReqDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("caseRequestor"),title:ZPI18N.getString("zp.casereq")}),filterArr.push({parentDiv:"tymPeriodDiv",type:"select",menuProperties:HRCase.SearchFilter.timeBasedDropDown(),title:ZPI18N.getString("zp.periodoftime")})):-1!==url.indexOf("#hrcase/allcases")||-1!==url.indexOf("#hrcase/watchlist")?(filterArr.push({parentDiv:"caseReqDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("caseRequestor"),title:ZPI18N.getString("zp.casereq")}),filterArr.push({parentDiv:"tymPeriodDiv",type:"select",menuProperties:HRCase.SearchFilter.timeBasedDropDown(),title:ZPI18N.getString("zp.periodoftime")}),filterArr.push({parentDiv:"cgyDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("category_filter"),title:ZPI18N.getString("zp.category")})):(-1!==url.indexOf("#hrcase/reports/adminreport")||-1!==url.indexOf("hrcase/reports/agentreport")||-1!==url.indexOf("hrcase/reports/userreport"))&&filterArr.push({parentDiv:"cgyDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("category_filter"),title:ZPI18N.getString("zp.category")}),filterArr},filterDropDown:function(mode){var params=[];if("category"==mode||"category_filter"==mode)"category"==mode&&params.push({id:"",value:"All Categories"}),isadmin?(ADMINVIEW_CATEGORY_LIST.length<=0&&HRCategory.getCgyList(ADMIN_CGY_LISTING),$.each(ADMINVIEW_CATEGORY_LIST,function(index,value){var param1={};param1.id=value.categoryId,param1.value=value.categoryName,param1.iconClass="zp_Si "+Icons.getIconClass(value.categoryIcon).iconClass,params.push(param1)})):(USERVIEW_CATEGORY_LIST.length<=0&&HRCategory.getCgyList(USER_CGY_LISTING),$.each(USERVIEW_CATEGORY_LIST,function(index,value){var param1={};param1.id=value.categoryId,param1.value=value.categoryName,param1.iconClass="zp_Si "+Icons.getIconClass(value.categoryIcon).iconClass,params.push(param1)}));else if("category_agent"==mode)params.push({id:"",value:"All Categories"}),AGENTVIEW_CGY_LIST.length<=0&&HRCategory.getCgyList(AGENT_CGY_LISTING),$.each(AGENTVIEW_CGY_LIST,function(index,value){var param1={};param1.id=value.categoryId,param1.value=value.categoryName,param1.iconClass="zp_Si "+Icons.getIconClass(value.categoryIcon).iconClass,params.push(param1)});else if("status"==mode)$.each(STATUS,function(key,value){if(HRCase.CANCELLED_SID!=value){var param1={id:STATUS[key],value:key};params.push(param1)}});else if("caseRequestor"==mode){var caseReqObj={id:"caserequestorList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","HRCASES")},checkbox:!0};return caseReqObj}var returnObj={id:"mainmenu",data:params,checkbox:!0};return returnObj},timeBasedDropDown:function(){var params=[];PERIOD_OF_TIME=[ZPI18N.getString("zp.today"),ZPI18N.getString("zp.yesterday"),ZPI18N.getString("zp.lastweek"),ZPI18N.getString("zp.lastmonth")],$.each(PERIOD_OF_TIME,function(index,value){var param1={};"CUSTOM RANGE"==value?param1.id="none":param1.id=index,param1.value=value,params.push(param1)});var returnobj={id:"mainmenu",data:params,search:!0};return returnobj},searchHrcase:function(isFromAdvancedFilter,onlyParams){var pageId=Layout.Page.container,index=0===pageId.find("#caseList").find("div[caseId]").length?1:pageId.find("#caseList").find("div[caseId]").length+1;index=isFromAdvancedFilter?1:index;var caseListParam={status:"",index:index};return isFromAdvancedFilter?(ZPeople.FireScroll.reset(),CommonTemplates.toCheckEmpty("statusDiv_input",caseListParam,"status"),CommonTemplates.toCheckEmpty("cgyDiv_input",caseListParam,"categoryId"),CommonTemplates.toCheckEmpty("tymPeriodDiv_input",caseListParam,"periodOfTime"),CommonTemplates.toCheckEmpty("caseReqDiv_input",caseListParam,"requestorErecno"),pageId.find("#searchDiv_input").length>0&&(caseListParam.query=$.trim(pageId.find("#searchDiv_input").val())),caseListParam.searchtype="filter",HRCase.SearchFilter.setURLBasedParam(caseListParam)):(caseListParam=HRCase.SearchFilter.getURLBasedParam(),caseListParam.index=index,delete caseListParam.searchtype),pageId.find("[name=headerposition]").hasClass("zp_sfltr")?(pageId.find("#cgyFilter").addClass("zp_dyn"),pageId.find("#cgyFilter").prev("font").html("<em>"+ZPI18N.getString("zp.category")+"</em>")):(pageId.find("#cgyFilter").removeClass("zp_dyn"),isFromAdvancedFilter&&pageId.find("#cgyFilter").prev("font").html("<em>"+ZPI18N.getString("zp.category")+"</em>")),void 0!=onlyParams&&onlyParams||HRCase.SearchFilter.getListing(index,caseListParam,isFromAdvancedFilter),caseListParam},getListing:function(index,caseListParam,isFromAdvancedFilter){var url=Layout.Page.hash;-1!==url.indexOf("#hrcase/reports/adminreport")?HRCReport.adminReport(caseListParam):-1!==url.indexOf("hrcase/reports/agentreport")?HRCReport.agentReport(caseListParam):-1!==url.indexOf("hrcase/reports/userreport")?HRCReport.userReport(caseListParam):-1!==url.indexOf("#hrcase/myrequest/")?HRCase.List.getMyReqCasesList(index,caseListParam,isFromAdvancedFilter,""):-1!==url.indexOf("#selfservice/cases/list")?HRCase.List.getMyReqCasesList(index,caseListParam,isFromAdvancedFilter,"self"):-1!==url.indexOf("#hrcase/allcases/")?"#hrcase/allcases/list/kanbanView"==url?HRCase.KanbanView.filterKanbanView():HRCase.List.getAllCasesList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#hrcase/watchlist/")?HRCase.List.getFollowedCasesList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#hrcase/unassigned/")?HRCase.List.getUnassignedList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#selfservice/mycases/list")?HRCase.List.getMyHrCasesList(index,caseListParam,isFromAdvancedFilter,"self"):-1!==url.indexOf("#hrcase/")&&("#hrcase/list/kanbanView"==url?HRCase.KanbanView.filterKanbanView():HRCase.List.getMyHrCasesList(index,caseListParam,isFromAdvancedFilter,""))},getURLBasedParam:function(){var url=Layout.Page.hash;return-1!==url.indexOf("#hrcase/myrequest/")||-1!==url.indexOf("#selfservice/cases/list")?HRCase.MYREQ_CASE_PARAM:-1!==url.indexOf("#hrcase/allcases/")?HRCase.ALLCASE_CASE_PARAM:-1!==url.indexOf("#hrcase/watchlist/")?HRCase.WATCHLIST_CASE_PARAM:-1!==url.indexOf("#hrcase/unassigned/")?HRCase.UNASSIGN_CASE_PARAM:-1!==url.indexOf("#hrcase/")||-1!==url.indexOf("#selfservice/mycases/list")?HRCase.MYCASE_CASE_PARAM:{}},setURLBasedParam:function(caseParam){var url=Layout.Page.hash;-1!==url.indexOf("#hrcase/myrequest/")||-1!==url.indexOf("#selfservice/cases/list")?HRCase.MYREQ_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/allcases/")?HRCase.ALLCASE_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/watchlist/")?HRCase.WATCHLIST_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/unassigned/")?HRCase.UNASSIGN_CASE_PARAM=caseParam:(-1!==url.indexOf("#hrcase/")||-1!==url.indexOf("#selfservice/mycases/list"))&&(HRCase.MYCASE_CASE_PARAM=caseParam);},getQuickFilterList:function(mode,value,ele){var pageId=(Layout.Page.hash,Layout.Page.container),caseParam=HRCase.SearchFilter.searchHrcase(!1,!0);caseParam.index=1,caseParam.mode=mode,"status"==mode?(caseParam.status=value,void 0!=ele&&($(ele).hasClass("sel")||pageId.find("[name=footerposition]").find("[class=sel]").removeClass("sel"),$(ele).toggleClass("sel"),$(ele).hasClass("sel")?caseParam.status=value:void 0!=Layout.Page.urlparam.status?caseParam.status=Layout.Page.urlparam.status:(caseParam.status="",CommonTemplates.toCheckEmpty("statusDiv_input",caseParam,"status")))):"category"==mode&&(caseParam.categoryId=value),ZPeople.FireScroll.reset(),HRCase.SearchFilter.getListing(1,caseParam,!1)},getStatusFilterValue:function(statusStr){var sVal=(Layout.Page.container,[]),arr=statusStr.split(",");$.isEmptyObject(STATUS)&&HRCases.getStatusList(),$.each(STATUS,function(key,value){if(-1!==$.inArray(STATUS[key],arr)){var param1={};param1.id=STATUS[key],param1.text=key,sVal.push(param1)}})},selectCaseStatus:function(caseId,obj,currentCaseStatus,isAgent,permittedCaseStatus){var dropdownList=[];permittedCaseStatus.length>0&&currentCaseStatus!=HRCase.CANCELLED_SID&&($.each(permittedCaseStatus,function(key,value){var param1={id:value.systemValue,value:value.optionValue};dropdownList.push(param1)}),$(obj).zparrowmenu({id:"statusList",data:dropdownList,callback:function(obj,initObj){HRCase.DetailedView.CloseHrcase(caseId,obj,currentCaseStatus)}}))}};var HRCases={showNoData:function(bodyDiv,rowDiv){var pageId=Layout.Page.container,row=pageId.find("#"+rowDiv).clone(!0);$(row).children().remove(),$(row).removeClass("zp_dyn").addClass("zp_nodata"),$(row).append("<span> "+ZPI18N.getString("zp.lookup.norecfound")+" </span>"),$(bodyDiv).append(row)},getParentURL:function(){return-1!==Layout.Page.hash.indexOf("#hrcase/myrequest")?"#hrcase/myrequest":-1!==Layout.Page.hash.indexOf("#hrcase/list")?"#hrcase/list":-1!==Layout.Page.hash.indexOf("#hrcase/allcases")?"#hrcase/allcases":-1!==Layout.Page.hash.indexOf("#hrcase/unassigned")?"#hrcase/unassigned":-1!==Layout.Page.hash.indexOf("#hrcase/watchlist")?"#hrcase/watchlist":void 0},changeIconAddCase:function(obj){var pageId=Layout.Page.container,iconValue=$(obj).attr("icon");void 0!=iconValue&&""!=iconValue?Icons.getIconClass(iconValue).iconClass:ADD_ICON;pageId.find("#cgyId").attr("categoryId",$(obj).attr("id")),""!=pageId.find("#caseSubject").val()&&""!=pageId.find("#cgyId").attr("selectedids")?pageId.find("#submitCaseBtn").addClass("sel"):pageId.find("#submitCaseBtn").removeClass("sel"),HRCaseBand.getCategoryView($(obj).attr("id"))},getStatusList:function(){var params={method:"getStatusList",conreqcsr:csrfToken};$.ajax({url:"/fetchAllStatus.zp",type:"POST",data:params,async:!1,success:function(data){$.each(data,function(i,v){STATUS[v.optionValue]=v.systemValue})}})}},HRCaseForm={fillDetailViewPage:function(extraparams){var pageId=$("#"+Layout.Page.pageId).find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId),fcid=pageId.find("[folabel=caseid]").attr("id").split("_").pop(),formcp=ZPForm.Field.getFieldComponent(fcid);ZPForm.Field.setValue(formcp,extraparams.case_number,fcid);ZPForm.LAYOUT.find("[folabel=caseid]").html("<span>"+extraparams.case_number+"</span>");var agent=$(pageId.find("[folabel=agent]").find("span")[0]).text();""!=agent?pageId.find("[folabel=agent_details]").closest("div.zp-label").addClass("zp_dyn"):""==agent&&pageId.find("[folabel=agent]").closest("div.zp-label").addClass("zp_dyn");var status=$(pageId.find("[folabel=status]").find("span")[0]).text(),status_sysvalue=HRCaseForm.getSysValue(pageId.find("[folabel=status]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,status);status_sysvalue==HRCase.COMPLETED_SID?(pageId.find("[folabel=completed_time]").closest("div.zp-label").removeClass("zp_dyn"),pageId.find("[folabel=complete_by]").closest("div.zp-label").removeClass("zp_dyn")):(pageId.find("[folabel=completed_time]").closest("div.zp-label").addClass("zp_dyn"),pageId.find("[folabel=complete_by]").closest("div.zp-label").addClass("zp_dyn"))},getSysValue:function(fcId,formId,optionValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,sysvalue=0;return $.each(options,function(index,row){return row.Value==optionValue?void(sysvalue=row.SysValue):void 0}),sysvalue},getOptionValue:function(fcId,formId,optionValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,optValue="";return $.each(options,function(index,row){return row.SysValue==optionValue?void(optValue=row.Value):void 0}),optValue}},HRCaseFeeds={pickupHRCase:function(ele,mode){var caseId=(Layout.Page.container,$(ele).closest("[caseid]").attr("caseId")),params={conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:caseId,assignedId:erecno};ZPeople.Request.send("/assignedHrcase.zp",params,function(data){if("success"==data.status)if(mode==HRCase.PICK_CASE_ROW){var agnetDiv=$(ele).parent();agnetDiv.empty(),agnetDiv.html(CommonTemplates.returnImgDiv(ZPeople.CURR_USER.avatar,"","","",data.zuid)+"<a>"+ZPeople.CURR_USER.name+'</a></div><div class="zp_Lrgt"></div>')}else if(mode==HRCase.PICK_CASE_VIEW)HRCase.DetailedView.newAgentDetails(caseId,{id:data.zuid,name:data.agent_details},CommonTemplates.returnImgDiv(ZPeople.CURR_USER.avatar,"","","",data.zuid)),$(ele).remove();else{var agentDiv=$(ele).parent().parent();agentDiv.empty(),agentDiv.append('<div class="dpcnt"><img popup="user" empid='+ZPeople.CURR_USER.id+' src="'+ZPeople.CURR_USER.avatar+'" class="zp-usimg"></div><div class="zp-fd-uname">'+ZPeople.CURR_USER.name+"</div>"),HRCase.Comments.constructSinglefieldComments(data,caseId)}})},CloseHrcaseInFeeds:function(ele){var params=(Layout.Page.container,{conreqcsr:csrfToken,status:$(ele).attr("id"),zp_recordId:$(ele).attr("caseid"),method:"CloseHrcase"});ZPeople.Request.send("/CloseHrcase.zp",params,function(data){$(ele).remove()})}},HRCaseNotes={notesTemplate:function(){var html='<div class="zp_notes " id="showNotes"><div class="zp_pshead">'+ZPI18N.getString("zp.notes")+'<i class="IC-cls" title='+ZPI18N.getString("zp.close")+' onclick="HRCaseNotes.addNoteSlide()"></i> </div>';return html+='<div class="zp_cnotes"  id="notesContent" contenteditable="true" data-text="Enter text here"></div>',html+='<div class="zp_btn"><button class="zpthm" name="noteBtn"></button><button onclick="HRCaseNotes.addNoteSlide();">'+ZPI18N.getString("zp.cancel")+"</button></div>",html+='<i class="ticon IC-delete" id="deleteNotes" title='+ZPI18N.getString("zp.delete")+' onclick="HRCaseNotes.deleteNote()"></i></div>'},escapeKeyEvent:function(){var pageId=Layout.Page.container;$("body").on("keyup",function(e){27===e.which&&0!=pageId.find("#caseDtls").siblings("#showNotes").length&&pageId.find("#caseDtls").siblings("#showNotes").remove()})},addNoteSlide:function(){var pageId=Layout.Page.container,recordId=pageId.find("#caseDtls").attr("caseid");if(0!=pageId.find("#caseDtls").siblings("#showNotes").length)pageId.find("#caseDtls").siblings("#showNotes").remove();else{pageId.find("#caseDtls").after(HRCaseNotes.notesTemplate()),EditorTemplate.editorConstruct("notesContent",!1,"showNotes",!1),EditorTemplate.replaceWithNoteEditor("notesContent","descEditor",!0);var noteId=pageId.find("#addNotes").find("i").attr("noteid"),noteBtn=pageId.find("#showNotes").find("[name=noteBtn]"),deleteBtn=pageId.find("#deleteNotes");void 0!=noteId?(pageId.find("#showNotes").attr("noteId",noteId),noteBtn.attr("onclick","HRCaseNotes.editNote()"),noteBtn.text(ZPI18N.getString("zp.update")),HRCaseNotes.fetchNotes(noteId),deleteBtn.removeClass("zp_dyn")):(noteBtn.attr("onclick","HRCaseNotes.addNotes('"+recordId+"')"),noteBtn.text(ZPI18N.getString("zp.save")),pageId.find("#showNotes").addClass("shw"),pageId.find("#notesContent").trigger("focus"),deleteBtn.addClass("zp_dyn"))}},editNote:function(){var pageId=Layout.Page.container,editorId="descEditor",editor=ZPFeeds.Editor.editorList[editorId],description="";void 0!=editor&&(description=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1));var noteJson={text:description,recordId:Layout.Page.childUrlParam.caseid,formID:ZPForm.CURRFORM_PARAM.formId,module_type:10},params={method:"addNote",conreqcsr:csrfToken,addNoteJson:JSON.stringify(noteJson)};ZPeople.Request.send("/addNote.zp",params,function(data){"success"==data.status&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.noteseditmsg")),pageId.find("#caseDtls").siblings("#showNotes").remove())})},fetchNotes:function(noteId){var pageId=Layout.Page.container,params={method:"fetchNotes",conreqcsr:csrfToken,noteId:noteId,recordId:Layout.Page.childUrlParam.caseid,module_type:10};ZPeople.Request.send("/fetchNotes.zp",params,function(data){$.each(data,function(index,value){""!=value.text?setTimeout(function(){$("#descEditor iframe").contents().find("body").html(value.text)},300):pageId.find("#descEditor").html(""),pageId.find("#showNotes").addClass("shw"),pageId.find("#notesContent").trigger("focus")})})},addNotes:function(recordId){var pageId=Layout.Page.container,editorId="descEditor",editor=ZPFeeds.Editor.editorList[editorId],description="";void 0!=editor&&(description=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1));var noteJson={text:description,recordId:recordId,formID:ZPForm.CURRFORM_PARAM.formId,module_type:10},params={method:"addNote",conreqcsr:csrfToken,addNoteJson:JSON.stringify(noteJson)};ZPeople.Request.send("/addNote.zp",params,function(data){if("success"==data.status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.notessuccessmsg")),pageId.find("#caseDtls").siblings("#showNotes").remove();var noteIcon=pageId.find("#addNotes").find(".CR-note");noteIcon.addClass("sel"),noteIcon.attr("noteId",data.noteId)}})},deleteNote:function(){var pageId=Layout.Page.container,params=(pageId.find("#notesContent").text(),{method:"deleteNote",conreqcsr:csrfToken,noteId:pageId.find("#showNotes").attr("noteId")});ZPeople.Request.send("/deleteNote.zp",params,function(data){pageId.find("#notesContent").html(""),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.notesdeletemsg"));var noteIcon=pageId.find("#addNotes").find(".CR-note");noteIcon.removeClass("sel"),noteIcon.removeAttr("noteId"),pageId.find("#caseDtls").siblings("#showNotes").remove()})}},HRCaseFileTag={fileUploadfn:function(obj,currentDiv,parentId){if("0"==obj.id)$("#hcBrowseFile").trigger("click"),$("#hcBrowseFile").off("change").on("change",function(){var parentDiv=$(currentDiv).closest("#"+parentId);if($(parentDiv).find("div.attachedFile").length+$("#hcBrowseFile")[0].files.length>5)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxfileupload"));else{var files=$(this)[0].files;$.each(files,function(i){CommonTemplates.getFileBoxOnSelect(this,function(html,file,url){if($(parentDiv).append(html),$(parentDiv).find("div.attachedFile").length>0){var fileBox=$(parentDiv).find("div.attachedFile").last();$(parentDiv).find("div.attachedFile").last().data("uploadMode","localUpload"),$(parentDiv).find("div.attachedFile").last().data("caseFileUpload",file),$(parentDiv).find("div.attachedFile").last().offset().top>$(parentDiv).scrollTop()&&$(parentDiv).scrollTop($(parentDiv).find("div.attachedFile").last().offset().top),void 0!=url&&fileBox.off("click").on("click",function(){Layout.Page.container;Layout.Page.container.find("#viewfileHeader").html(decodeURIComponent(file.name));var fileSize="";fileSize=Layout.Page.container.find("#viewFileDiv"),fileSize.height($(window).height()-131+"px");var height=Layout.Page.container.find("#viewFileDiv").height();if(Layout.Page.container.find("#iframeContentDiv").html('<iframe  src="" id="cgyFileFrame" name="cgyFileFrame" scrolling="auto" style="border: none; margin: 0pt;" frameborder="0" height="'+height+'" width="100%" ></iframe>'),Layout.Page.container.find("#viewFileDiv").removeClass("DN"),Layout.Page.container.find("#freeze").show(),0===Layout.Page.container.find("#iframeContentDiv").find("#zp_page_loading").length&&Layout.Page.container.find("#iframeContentDiv").append(ZPeople.LOADING_HTML),Layout.Page.container.find("#viewFileDiv").is(":visible")){var fileiframe="";$(window).resize(function(){fileSize=Layout.Page.container.find("#viewFileDiv"),fileSize.height($(window).height()-131+"px"),fileiframe=Layout.Page.container.find("#cgyFileFrame"),fileiframe.height(Layout.Page.container.find("#viewFileDiv").height()-43+"px")})}Layout.Page.container.find("#cgyFileFrame").attr("src",url)})}})})}});else if("1"==obj.id){var mode="";"addFaqContent"==parentId?mode="AddFAQFiles":"addcaseContent"==parentId&&(mode="AddHRCase"),Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl,mode)}},addFileTag:function(filename,fileJsonObj,mode){var parentId=(Layout.Page.container,"addcaseContent"),fileObj={name:filename,type:"cloudUpload"};"AddFAQFiles"==mode&&(parentId="addFaqContent"),$("[id="+parentId+"]").find("div.attachedFile").length<5?CommonTemplates.getFileBoxOnSelect(fileObj,function(html,file){$("[id="+parentId+"]").append(html),$("[id="+parentId+"]").find("div.attachedFile").last().offset().top>$("[id="+parentId+"]").scrollTop()&&$("[id="+parentId+"]").scrollTop($("[id="+parentId+"]").find("div.attachedFile").last().offset().top)}):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxfileupload")),$("[id="+parentId+"]").find("div.attachedFile").last().data("uploadMode",Files.uploadMode),$("[id="+parentId+"]").find("div.attachedFile").last().data("cloudUploadDoc",fileJsonObj)}},HRCaseMoreOption={moreOption:function(caseId,agent,agentTypeId,requestor,status){var pageId=Layout.Page.container;status!=HRCase.CANCELLED_SID&&status!=HRCase.COMPLETED_SID&&(null!=agent&&agent==erecno&&"1"!=agentTypeId&&MORE_OPTION.push({id:"unassignCase",value:ZPI18N.getString("zp.unassign")}),requestor==erecno&&MORE_OPTION.push({id:"cancelCase",value:ZPI18N.getString("zp.cancelReq")})),(isadmin||isManageHRCase&&"undefined"==typeof hCLocAccess)&&MORE_OPTION.push({id:"delCase",value:ZPI18N.getString("zp.deletecase")}),0!=MORE_OPTION.length&&pageId.find("#addNotes").after(CommonTemplates.getSingleIconMenu({attributes:{id:"moredropdown",onclick:"HRCaseMoreOption.dropdown(this,'"+caseId+"')"},iconsList:[{"class":"IC-more","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.more")}]}))},dropdown:function(obj,caseId){$(obj).zparrowmenu({id:"mainmenu",data:MORE_OPTION,search:!1,width:200,position:ZPArrow.BOTTOM_RIGHT,callback:function(obj,initObj){$(initObj).removeAttr("selectedIds"),HRCaseMoreOption.optionCallBack(obj,caseId)}})},optionCallBack:function(obj,caseId){var pageId=Layout.Page.container;"unassignCase"==$(obj).attr("id")?HRCase.DetailedView.unAssignedHrcase(caseId):"cancelCase"==$(obj).attr("id")?($(obj).removeAttr("id"),$(obj).attr("id",HRCase.CANCELLED_SID),ZPeople.BSModal.confirm(function(){HRCase.DetailedView.CloseHrcase(caseId,obj,pageId.find("#caseStatus").attr("selectedIds")),pageId.find("#cStatus").html('<span id="caseStatus">'+ZPI18N.getString("zp.cancelled")+"<div></div></span>")},"",ZPI18N.getString("zp.canceledmsg"))):"delCase"==$(obj).attr("id")&&HRCase.DetailedView.deleteCase(caseId)}},HRCaseCommon={cloneTag:function(data,showTag){var tagsHtml="",noTag=showTag?"":"notg";$.each(data,function(i,v){var imageHtml=CommonTemplates.returnImgDiv(v.imageSrc,v.imageAlt,"","",v.imgZuid);tagsHtml+='<div class="zp_Tg '+noTag+'">'+imageHtml+v.text+"</div>"});var tag="<div>"+tagsHtml+"</div>";return tag},getFileViewHtml:function(){var html="Layout.Page.container.find('#freeze').hide();Layout.Page.container.find('#viewFileDiv').addClass('DN');Layout.Page.container.find('#iframeContentDiv').html('')",fileViewer='<div class="content-header"> <h6 class="addPopTitle" id="viewfileHeader"></h6> <div class="pull-right MT8 zp_dyn" style="" id="filePrint"><a class="MR30"><span class="IC-print DIB gry MR10 ZPtooltip" data-toggle="tooltip" data-placement="bottom" title="" onclick="HRCatalogList.printFile()" data-original-title="Print file"></span></a></div> <button aria-label="Close" data-dismiss="modal" class="close" type="button"  onclick="'+html+'"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div><div class="content-body" id="iframeContentDiv"></div></div>',freeze='<div class="custom-backdrop in" id="freeze" style="display:none"></div>',form='<form method="post" id="viewcgyFile" enctype="multipart/form-data" action="/getCgyFile.zp" target="cgyFileFrame" novalidate> </form>';return'<div class="content-box DN" id="viewFileDiv" style="height:587px; overflow:hidden;">'+fileViewer+"</div>"+freeze+form},getFileContent:function(fileId,recordId,fileType,displayName,extn){Layout.Page.container;Layout.Page.container.find("#viewfileHeader").html(decodeURIComponent(displayName));var fileSize="";fileSize=Layout.Page.container.find("#viewFileDiv"),fileSize.height($(window).height()-131+"px");var height=Layout.Page.container.find("#viewFileDiv").height();Layout.Page.container.find("#iframeContentDiv").html('<iframe  src="" id="cgyFileFrame" name="cgyFileFrame" scrolling="auto" style="border: none; margin: 0pt;" frameborder="0" height="'+height+'" width="100%" ></iframe>');var fileExtn="";void 0!=extn||fileType!=HR_CASE_ATTACHEMENTS&&fileType!=HRCASE_FAQ_ATTACHEMENTS?fileType==HR_CATEGORY_ATTACHEMENTS&&(fileExtn=void 0!=extn?extn:fileExtn):-1!=displayName.lastIndexOf(".")&&(fileExtn=displayName.substr(displayName.lastIndexOf(".")+1,displayName.length));var iframeLoadedFileExtn=["pdf","jpg","jpeg","png","gif","html","htm","txt"],zohoDocsFileExtn=["xls","xlsx","sxc","ods","csv","tsv","doc","docx","sxw","odt","rtf","ppt","pptx","pps","odp","sxi"];if((-1!=$.inArray(fileExtn,iframeLoadedFileExtn)||-1!=$.inArray(fileExtn,zohoDocsFileExtn))&&(Layout.Page.container.find("#viewFileDiv").removeClass("DN"),Layout.Page.container.find("#freeze").show(),0===Layout.Page.container.find("#iframeContentDiv").find("#zp_page_loading").length&&Layout.Page.container.find("#iframeContentDiv").append(ZPeople.LOADING_HTML),Layout.Page.container.find("#viewFileDiv").is(":visible"))){var fileiframe="";$(window).resize(function(){fileSize=Layout.Page.container.find("#viewFileDiv"),fileSize.height($(window).height()-131+"px"),fileiframe=Layout.Page.container.find("#cgyFileFrame"),fileiframe.height(Layout.Page.container.find("#viewFileDiv").height()-43+"px")})}var fileParams={fileId:fileId,recordId:recordId,fileType:fileType,conreqcsr:csrfToken,methodName:"viewCgyFile"};if(Layout.Page.container.find("#filePrint").addClass("zp_dyn"),"xls"===fileExtn||"xlsx"===fileExtn||"sxc"===fileExtn||"ods"===fileExtn||"csv"===fileExtn||"tsv"===fileExtn||"doc"===fileExtn||"docx"===fileExtn||"sxw"===fileExtn||"odt"===fileExtn||"rtf"===fileExtn||"ppt"===fileExtn||"pps"===fileExtn||"odp"===fileExtn||"sxi"===fileExtn||"pptx"===fileExtn)$.ajax({url:"/getCgyFile.zp",type:"POST",data:fileParams,async:!1,success:function(data,textStatus,request){var res=JSON.parse(data),url="";"writer"===res.fileforformat?(url=res.url.replace("<script language='javascript'>window.location.href='",""),url=url.replace("';</script>","")):url=res.url.split("URL=")[1],Layout.Page.container.find("#cgyFileFrame").attr("src",url)}});else{var caseForm=Layout.Page.container.find("#viewcgyFile");caseForm.append('<input type="hidden" name="fileId" value="'+fileId+'">'),caseForm.append('<input type="hidden" name="recordId" value="'+recordId+'">'),caseForm.append('<input type="hidden" name="fileType" value="'+fileType+'">'),caseForm.append('<input type="hidden" name="conreqcsr" value="'+csrfToken+'">'),caseForm.append('<input type="hidden" name="methodName" value="viewCgyFile">'),caseForm.submit(),$(caseForm).find("input[type=hidden]").remove()}},getPickUpHtml:function(){var html='<span class="zp_ldot zp_caps dte" id="pickUptoMe"><span class="zp_ldot zp_caps dte zp_link"  id="CLCaseAgent" onclick="HRCaseFeeds.pickupHRCase(this,'+HRCase.PICK_CASE_ROW+')" >'+ZPI18N.getString("zp.pickupcase")+"</span></span>";return html},removeFileDiv:function(obj){Layout.Page.container;""!=$(obj).closest("div.attachedFile").attr("fileid")&&void 0!=$(obj).closest("div.attachedFile").attr("fileid")?$(obj).closest("div.attachedFile").addClass("zp_dyn"):$(obj).closest("div.attachedFile").remove()},askUsHtml:function(needCategory,isAgent){var empHtml="",cgyHtml="",statusHtml="",resolHtml="";needCategory&&(cgyHtml='<div id="caseCgyDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrcategory")+"</span>"),isAgent&&(empHtml='<div id="csempDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrEmployee")+"</span>",cgyHtml='<div id="caseCgyDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrcategory")+"</span>",statusHtml='<div id="casestatusDiv" class="zp_fm"></div>',resolHtml='<div id="caseresolutionDiv" class="zp_fm"></div>');var html='<div class="zp_whtbg" id="addHRCase"><div class="zp_pop" id="caseDescEditorContainer"><div class="zp_Ptl" id="addcaseHeader"><h3>'+ZPI18N.getString("zp.askaquestion")+"</h3></div>";return html+='<div class="zp_pcnt" id="addcaseContent" onscroll="CommonTemplates.scrollfunction(\'addcaseHeader\',\'addcaseContent\')">'+empHtml+cgyHtml+'<div id="caseSubDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.mentionthesubject")+'</span><div class=""  id="caseeditor"></div>'+statusHtml+resolHtml+CommonTemplates.chooseFileHtml()+"</div>",html+='<div class="zp_btn"><button  id="submitCaseBtn" class="zpthm zpn_btn" onclick="HRCase.AddCase.submitCase()"><b>'+ZPI18N.getString("zp.submit")+'</b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.submitting")+"</label></button><button onclick='HRCase.AddCase.closePage()'>"+ZPI18N.getString("zp.cancel")+'</button></div></div><i class="IC-cls"  title='+ZPI18N.getString("zp.close")+" onclick='HRCase.AddCase.closePage()'></i></div>"},cViewPageHtml:function(){var html='<div  id="caseDtls" class="zp_pv"><div class="zp_pwrap"><div id="caseDtlsHeader" class="zp_pvhd">$CVHDR$</div><div id="caseScrlHead" class="zp_info">$CVINFO$</div><div id="caseDtlsContent" class="zp_pvcnt" onscroll="CommonTemplates.scrollfunction(\'caseScrlHead\',\'caseDtlsContent\')">$CVCNT$</div></div></div>';return html},cViewHeader:function(){var iconsHtml=CommonTemplates.getIconMenuBar([{attributes:{id:"addNotes",onclick:"HRCaseNotes.addNoteSlide()"},iconsList:[{"class":"CR-note","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.note")}]},{attributes:{onclick:"HRCase.DetailedView.closeSlide()"},iconsList:[{"class":"IC-cls","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.close")}]}]);return'<div class="zp_mark" id="viewHeader"></div><div class="zp_micn" id="vLBtn">'+iconsHtml+"</div>"},cViewInfo:function(){var html='<div><dl class="pht"> <dt>'+ZPI18N.getString("zp.category")+'</dt><dd id="categoryOption" name="Category"><span id="cgyName"></span></dd></dl></div>';return html+='<div><dl class="pht"> <dt>_AGENT_</dt><dd id="pickupOption"><span id="caseOwner"></span></dd></dl></div>',html+='<div><dl class="nop"> <dt>'+ZPI18N.getString("zp.status")+'</dt><dd id="cStatus" name="Status"><span id="caseStatus"></span></dd></dl></div>',"<div>"+html+"</div>"},cViewForm:function(){var html='<div id="showFromInfo"><div class="zp_Plnk" onclick="HRCase.DetailedView.getFormView($CASEID$)">'+ZPI18N.getString("zp.showdetails")+'<i class="IC-ar-dwn"></i></div><div id="formInfo"></div></div>';return html},cViewCnt:function(onlyCaseDetails){var html=HRCaseCommon.cViewForm();return html+='<div id="caseAttch" class="zp_attach zp_dyn"><div  class="zp_pshead">'+ZPI18N.getString("zp.attachment")+'</div><div id="filesAttch" class="zp_Alst"></div></div>',onlyCaseDetails||(html+='<div class="zp_Pbtn"><span id="cmtReplyBtn"><i class="IC-hc-replay" ></i>'+ZPI18N.getString("zp.reply")+'</span><span id="addTaskBtn"><i class="IC-hc-task"></i>'+ZPI18N.getString("zp.addtask")+"</span></div>",html+='<div class="media-comments" id="zp_hrcase_comments"></div>',html+='<div id="zp_views_list_container_rel-1"></div>'),html}};HRCases.FAQ_FILEUPLOAD_LABELNAME="attachment",HRCases.HRCASE_FILEUPLOAD_LABELNAME="case_attachment";var Delegation={DELEGATION_URL:"/delegationAction.zp",DELEGATION_JSON:[],DELEGATION_TYPE:{temporary:1,permanent:2},addDelegationForm:function(){ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"addDelegationForm",conreqcsr:csrfToken})},initPage:function(){var url=Layout.Page.hash;url==Delegation.getDelegationUrl("list")?Delegation.View.fecthDelegationList():url==Delegation.getDelegationUrl("edit",Layout.Page.childUrlParam.delegationid)?Delegation.Edit.getSingleRecord("edit"):url==Delegation.getDelegationUrl("add")?Delegation.Modal.openDelegSlide():url==Delegation.getDelegationUrl("view",Layout.Page.childUrlParam.delegationid)?Delegation.Edit.getSingleRecord("view"):($("#"+Layout.Page.pageId).find("#delegationPage .btn").removeAttr("onclick"),$("#"+Layout.Page.pageId).children().addClass("DN"),$("#"+Layout.Page.pageId).append('<div class="profileLft zc-componentBg mt7"><div class="pad20" id="errorDiv"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div><p class="PT20 S15">'+ZPI18N.getString("zp.securityaccesserr")+"</p></div></div></div></div></div>"))},showPageLoading:function(divToHide,parentDiv){divToHide.addClass("DN"),parentDiv.append(ZPeople.LOADING_HTML)},hidePageLoading:function(divToShow,parentDiv){divToShow.removeClass("DN"),parentDiv.find("#zp_page_loading").remove()},getSelfServiceErecno:function(){return-1!==Layout.Page.currentmode.indexOf("selfservice/delegation")?SelfService.getUserId():void 0},getDelegationUrl:function(mode,delegationId){var selfServiceErecno=Delegation.getSelfServiceErecno();if(selfServiceErecno){var urlParam=selfServiceErecno!=erecno?"-id:"+selfServiceErecno:"";return"#selfservice/delegation/"+mode+urlParam+(delegationId?(""!=urlParam?"/":"-")+"delegationid:"+delegationId:"")}return isadmin?"#admin/organization/delegation/"+mode+(delegationId?"-delegationid:"+delegationId:""):void 0}};Delegation.View={createDeleg:function(){Delegation.Modal.openDelegSlide()},fecthDelegationList:function(){var tableBody=$("#"+Layout.Page.pageId).find("#delegTable tbody");if(!(tableBody.find("tr").length>0)){var pageDiv=$("#"+Layout.Page.pageId).find("#delegationPage");Delegation.showPageLoading(pageDiv.find(".ZPTscrlcont"),pageDiv),isadmin||SelfService.Info.allow_add_delegation||pageDiv.find(".mainhead .btn.btn-primary").addClass("DN"),ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"list",erecno:Delegation.getSelfServiceErecno(),conreqcsr:csrfToken},Delegation.View.constructDelgPage)}},constructDelgPage:function(delegList){if(void 0!=delegList){if($("#"+Layout.Page.pageId).find("#zp_page_loading").remove(),Delegation.DELEGATION_JSON=delegList,Delegation.DELEGATION_JSON.length<1)return $("#"+Layout.Page.pageId).find("#delegationPage").append(CommonTemplates.noDataSVG("delegationPage",!0,ZPI18N.getString("zp.nodelegationmsg"),!1)),void $("#"+Layout.Page.pageId).find("#delegationPage .mainhead").addClass("ndat");var tableBody=$("#"+Layout.Page.pageId).find("#delegTable tbody");$.each(delegList,function(i,singleDeleg){var tableRow=Delegation.View.constructDelgRow(singleDeleg);tableBody.append(tableRow)}),Delegation.View.addClickEvent(tableBody);var pageDiv=$("#"+Layout.Page.pageId).find("#delegationPage");Delegation.hidePageLoading(pageDiv.find(".ZPTscrlcont"),pageDiv)}},constructDelgRow:function(singleDeleg){return'<tr class="ZPLRow" delegationid="'+singleDeleg.delegationId+'">'+Delegation.View.constructDelgData(singleDeleg)+"</tr>"},addClickEvent:function(tableBody){tableBody.find("tr td div .IC-pen").on("click",function(e){e.stopPropagation(),e.preventDefault(),Delegation.Edit.getSingleRecord("edit",$(this).closest("tr").attr("delegationid"))}),tableBody.find("tr td div .IC-delete").on("click",function(e){e.stopPropagation(),e.preventDefault(),Delegation.Delete.deleteRecord($(this).closest("tr").attr("delegationid"))}),tableBody.find("tr").on("click",function(){Delegation.Edit.getSingleRecord("view",$(this).closest("tr").attr("delegationid"))})},constructDelgData:function(singleDeleg){var singleDelgtr=(singleDeleg.delegationId,'<td class="PL0I text-center over-display"></td>');return singleDelgtr+=this.constructEmpData(singleDeleg.employeeDtls),singleDelgtr+=this.constructEmpData(singleDeleg.delegateeDtls),singleDeleg.TypeOfDelegation==Delegation.DELEGATION_TYPE.temporary?(singleDelgtr+="<td>"+ZPI18N.getString("zp.local.Temporary")+"</td>",singleDelgtr+='<td><div class="FL">'+singleDeleg.From+'<span class="dgry ML2 MR2">-</span>'+singleDeleg.To+"</div></td>"):(singleDelgtr+="<td>"+ZPI18N.getString("zp.local.Permanent")+"</td>",singleDelgtr+="<td></td>"),singleDelgtr+="<td><span>"+singleDeleg.Status+"</span></td>",singleDelgtr+='<td class="text-left over-display P0"><div class="dvlist-action">',singleDeleg.hasEditDelPerm&&(singleDeleg.Status!==ZPI18N.getString("zp.leave.compensatory.expired")&&(singleDelgtr+='<a class="IC-pen ZPtitle FL" title="'+ZPI18N.getString("zp.edit")+'" data-original-title="Edit"></a>'),singleDelgtr+='<a class="IC-delete ML15 ZPtitle" title="'+ZPI18N.getString("zp.delete")+'" data-original-title="Delete"></a>'),singleDelgtr+="</div></td>"},constructEmpData:function(empData){var empHTML="<td>";return void 0!=empData&&Object.keys(empData).length>0&&(empHTML+='<img src="'+empData.employeePhoto+'" class="FL ZP_photo" data-toggle="tooltip" data-placement="top" data-original-title="" popup="user" empid="'+empData.zuid+'"><div class="ZPusrName" popup="user" empid="'+empData.zuid+'"><span>',empHTML+=empData.erecno==erecno?ZPI18N.getString("zp.you"):"<b>"+empData.employeeID+"</b>"+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</span></div>"),empHTML+"</td>"},getPermissionDeniedData:function(mode){var key="";return key="view"===mode?"zp.deniedtoviewdelegperm":"edit"===mode?"zp.deniedtoeditdelegperm":"delete"===mode?"zp.deniedtodeltdelegperm":"zp.deniedtoadddelegperm",ZPI18N.getString(key)}},Delegation.Menu={getEmpMenuProperty:function(){var param={id:"empList",data:function(searchObj){var searchVal=void 0==$(searchObj).val()?"":$(searchObj).val(),delegateeId=$("#delegModal #addEdit").find('[label="Delegatee"] #delegId').attr("selectedIds");return EmployeeDropdown.getEmpList(searchVal,"emp","DELEGATION_EMP",void 0==delegateeId||""==delegateeId?void 0:[delegateeId])}};return param},getDelegMenuProperty:function(){var param={id:"delegList",data:function(searchObj){var searchVal=void 0==$(searchObj).val()?"":$(searchObj).val(),delegatorId=$("#delegModal #addEdit").find('[label="Delegator"] #empId').attr("selectedIds");return EmployeeDropdown.getEmpList(searchVal,"emp","DELEGATION_DELEGATOR",void 0==delegatorId||""==delegatorId?void 0:[delegatorId])}};return param},getDefaultData:function(erecno,name,image){return{id:erecno,text:ZPeople.decodeTxt(ZPeople.escapeHtml(name)),image:image,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(name))}},getSelectDefault:function(erecno,name,image){return{selectedVal:[Delegation.Menu.getDefaultData(erecno,name,image)],isMandatory:!0}}},Delegation.Modal={openDelegSlide:function(mode,response){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal");delegModalDiv.find("#viewErrorModal").remove(),Delegation.showPageLoading(delegModalDiv.find(".modal-dialog .modal-content"),delegModalDiv.find(".modal-dialog")),delegModalDiv.modal("show"),this.resetErrorMsg();if("view"===mode)delegModalDiv.find("#addEdit").addClass("DN"),delegModalDiv.find("#view").removeClass("DN"),delegModalDiv.find(".modal-footer .btn-default").removeClass("DN"),delegModalDiv.find(".modal-footer .btn-primary").addClass("DN"),delegModalDiv.find(".modal-footer .btn-primary").off("click"),Delegation.Modal.constructViewModalBody(response);else if(isadmin||SelfService.Info.allow_add_delegation){delegModalDiv.find(".modal-header .IC-pen").addClass("DN"),delegModalDiv.find("#view").addClass("DN"),delegModalDiv.find("#addEdit").removeClass("DN"),delegModalDiv.find(".modal-footer a").removeClass("DN"),editDelegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal").find("#addEdit"),delegModalDiv.find("#empId").length<1&&CommonTemplates.getSelectMenu(Delegation.Menu.getEmpMenuProperty(),editDelegModalDiv.find("[label=Delegator]"),{id:"empId"},{needTag:!1,isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.delegator")}),delegModalDiv.find("#delegId").length<1&&CommonTemplates.getSelectMenu(Delegation.Menu.getDelegMenuProperty(),editDelegModalDiv.find("[label=Delegatee]"),{id:"delegId",placeholder:ZPI18N.getString("zp.delegateeplaceholder")},{needTag:!1,isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.delegatee")}),editDelegModalDiv.find('[label="TypeOfDelegation"] label').on("click",function(){var value=$(this).find("input").attr("value");value==Delegation.DELEGATION_TYPE.temporary?($(this).closest(".form-group").removeClass("zp_fmBN"),$(this).siblings('[label="Date"]').collapse("show"),$(this).closest('[label="TypeOfDelegation"]').find("[label='FromTo']").val("")):value==Delegation.DELEGATION_TYPE.permanent&&($(this).siblings('[label="Date"]').collapse("hide"),$(this).closest(".form-group").addClass("zp_fmBN"),$(this).siblings('[label="Date"]').hasClass("collapsing")||$(this).siblings('[label="Date"]').addClass("collapse"))});var saveButton=delegModalDiv.find(".modal-footer .btn-primary");"edit"===mode?(editDelegModalDiv.find('[label="Delegator"] div').addClass("sel"),editDelegModalDiv.find('[label="Delegator"] div').find("font").addClass("zp_dyn"),saveButton.off("click").on("click",function(){Delegation.Add.save(response.delegationId)}),Delegation.Modal.constructEditModalBody(response)):(editDelegModalDiv.find('[label="Delegator"] div').removeClass("sel"),editDelegModalDiv.find('[label="Delegator"] div').find("font").removeClass("zp_dyn"),saveButton.off("click").on("click",function(){Delegation.Add.save()}),Delegation.Modal.resetModalBody())}else Delegation.Edit.constructDelegError(mode,Delegation.View.getPermissionDeniedData(mode));delegModalDiv.find(".modal-header h6").html(Delegation.Edit.getModalHeaderStr(mode)),Delegation.hidePageLoading(delegModalDiv.find(".modal-dialog .modal-content"),delegModalDiv.find(".modal-dialog"))},resetModalBody:function(){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal #addEdit");ZPSelect.clearAllValues(delegModalDiv.find("#delegId")),ZPSelect.clearAllValues(delegModalDiv.find("#empId"));var selfServiceErecno=Delegation.getSelfServiceErecno();if(void 0==selfServiceErecno||selfServiceErecno==erecno)delegModalDiv.find("#empId").zpselect(Delegation.Menu.getSelectDefault(ZPeople.CURR_USER.usererec,ZPeople.CURR_USER.name,ZPeople.CURR_USER.avatar));else{var userDtl=ZPeople.getUserDetailsById(selfServiceErecno);delegModalDiv.find("#empId").zpselect(Delegation.Menu.getSelectDefault(userDtl.usererec,userDtl.name,userDtl.avatar))}delegModalDiv.find("[label='TypeOfDelegation'] label").find("[value='"+Delegation.DELEGATION_TYPE.temporary+"']").trigger("click"),delegModalDiv.find("[label='FromTo']").val(""),delegModalDiv.find("[label='Description'] textarea").val(""),delegModalDiv.find("[label='is_Notify']").find("[value='1']").click()},constructEditModalBody:function(data){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal #addEdit");$("#"+Layout.Page.pageId).find("#delegModal").attr("delegationid",data.delegationId),ZPSelect.clearAllValues(delegModalDiv.find("#delegId")),ZPSelect.clearAllValues(delegModalDiv.find("#empId")),Object.keys(data.employeeDtls).length>0&&delegModalDiv.find("#empId").zpselect(Delegation.Menu.getSelectDefault(data.employeeDtls.erecno,data.employeeDtls.name,data.employeeDtls.employeePhoto)),Object.keys(data.delegateeDtls).length>0&&delegModalDiv.find("#delegId").zpselect(Delegation.Menu.getSelectDefault(data.delegateeDtls.erecno,data.delegateeDtls.name,data.delegateeDtls.employeePhoto)),delegModalDiv.find("[label='TypeOfDelegation'] label").find("[value='"+data.TypeOfDelegation+"']").trigger("click"),data.TypeOfDelegation==Delegation.DELEGATION_TYPE.temporary&&delegModalDiv.find("[label='FromTo']").val(data.From+"-"+data.To),delegModalDiv.find("[label='Description'] textarea").val(void 0!=data.Description?ZPeople.decodeTxt(data.Description):""),delegModalDiv.find("[label='is_Notify']").find("[value='"+(data.delegateeDtls.is_Notify?"1":"0")+"']").click()},constructViewModalBody:function(viewData){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal #view");$("#"+Layout.Page.pageId).find("#delegModal").attr("delegationid",viewData.delegationId);var headerEdit=$("#"+Layout.Page.pageId).find("#delegModal").find(".modal-header .IC-pen");viewData.hasEditDelPerm&&viewData.Status!=ZPI18N.getString("zp.leave.compensatory.expired")?(headerEdit.removeClass("DN"),headerEdit.on("click",function(e){e.stopPropagation(),e.preventDefault(),Delegation.Edit.getSingleRecord("edit",$("#"+Layout.Page.pageId).find("#delegModal").attr("delegationid"))})):(headerEdit.addClass("DN"),headerEdit.off("click")),this.setEmpData(viewData.employeeDtls,delegModalDiv.find("[label=Delegator]")),this.setEmpData(viewData.delegateeDtls,delegModalDiv.find("[label=Delegatee]"));var delegationType=ZPI18N.getString("zp.local.Permanent"),dateRange="";viewData.TypeOfDelegation==Delegation.DELEGATION_TYPE.temporary&&(delegationType=ZPI18N.getString("zp.local.Temporary"),dateRange=viewData.From+"-"+viewData.To),delegModalDiv.find("[label=Date]").text(dateRange),delegModalDiv.find("[label=TypeOfDelegation]").text(delegationType),delegModalDiv.find("[label=is_Notify] span").text(viewData.delegateeDtls.is_Notify?ZPI18N.getString("zp.delegateeanddelegator"):ZPI18N.getString("zp.delegatee")),delegModalDiv.find("[label=Description] span").text(viewData.Description?ZPeople.decodeTxt(viewData.Description):"-")},setEmpData:function(empData,parentDiv){if(void 0!=empData){var imageDiv=CommonTemplates.returnImgDiv(empData.employeePhoto,CommonTemplates.getAltText(ZPeople.escapeHtml(empData.name)),"","","");parentDiv.find("div").html('<div class="zp_Tg notg" popup="user" empid="'+empData.zuid+'">'+imageDiv+"<span><b>"+empData.employeeID+"</b> - "+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</span></div>")}},resetErrorMsg:function(){$("#"+Layout.Page.pageId).find("#delegModal .etxt").remove()},closeDelegSlide:function(){$("#"+Layout.Page.pageId).find("#delegModal").modal("hide"),window.location.href=Delegation.getDelegationUrl("list")}},Delegation.Validation={validateEmptyValue:function(value,valueParentEle,errorMsg){$.isEmptyObject(value)&&Delegation.Validation.showErrorMsg(valueParentEle,errorMsg)},showErrorMsg:function(valueParentEle,errorMsg){if(valueParentEle.length>0){var errorDiv=$('<span class="etxt">'+errorMsg+"</span>");"TypeOfDelegation"==valueParentEle.attr("label")?valueParentEle.append(errorDiv):(valueParentEle.find("input").length>0&&(valueParentEle=valueParentEle.find("input")),errorDiv.insertAfter(valueParentEle))}else ZPeople.Message.showFailureMsg(errorMsg)}},Delegation.Add={save:function(delegationId){var delegModal=$("#"+Layout.Page.pageId).find("#delegModal");delegModal.find(".etxt").remove();var empId;void 0==delegationId&&(empId=delegModal.find('[label="Delegator"] #empId').attr("selectedIds"),Delegation.Validation.validateEmptyValue(empId,delegModal.find('[label="Delegator"]'),ZPI18N.getString("zp.delegatoremptyerr")));var delegId=delegModal.find('[label="Delegatee"] #delegId').attr("selectedIds");Delegation.Validation.validateEmptyValue(delegId,delegModal.find('[label="Delegatee"]'),ZPI18N.getString("zp.delegateeemptyerr"));var isNotify=delegModal.find('[name="delgNotify"]:checked').attr("value"),desc=delegModal.find('[label="Description"] textarea').val(),delegationType=delegModal.find('[name="delgType"]:checked').attr("value");if(1==delegationType){var date=delegModal.find('[label="FromTo"]').val();if(void 0==date||""==date)Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.emptydateerr"));else{var from,to,splitDate=date.split("-");splitDate.length<2||3==splitDate.length?Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.temporaryplaceholder")):2===splitDate.length?(from=splitDate[0],to=splitDate[1]):6===splitDate.length?(from=splitDate[0]+"-"+splitDate[1]+"-"+splitDate[2],to=splitDate[3]+"-"+splitDate[4]+"-"+splitDate[5]):Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr")),!from||!to||Calendar.isvalidDate(from.trim())&&Calendar.isvalidDate(to.trim())||Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr"))}}if(delegModal.find(".etxt").length<1){delegModal.find(".modal-footer .btn-primary").attr("disabled",!0);var configuration={Delegator:empId,Delegatee:delegId,From:from,To:to,Description:desc,TypeOfDelegation:delegationType,is_Notify:isNotify},params={method:"addUpdateDelegation",conreqcsr:csrfToken,configuration:JSON.stringify(configuration)};void 0!=delegationId&&(params.delegationId=delegationId),ZPeople.Request.send(Delegation.DELEGATION_URL,params,Delegation.Add.showSuccessMsg)}},showSuccessMsg:function(data,params){if(data.success){params.delegationId?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.successdelegedit")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.successdelegadd"));var selfServiceErecno=Delegation.getSelfServiceErecno();if($("#"+Layout.Page.pageId).find("#delegTable tbody tr").length>=0&&data.success.delegationId){if(void 0==selfServiceErecno||data.success.employeeDtls.erecno==selfServiceErecno||data.success.delegateeDtls.erecno==selfServiceErecno)Delegation.Add.addDelegationRow(data.success);else if(selfServiceErecno){var delegation=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",data.success.delegationId,!0,!0);delegation&&Delegation.DELEGATION_JSON.splice(delegation.index,1),$("#"+Layout.Page.pageId).find("#delegTable tbody [delegationid='"+data.success.delegationId+"']").remove(),Delegation.Modal.closeDelegSlide()}}else Delegation.Modal.closeDelegSlide()}else if(data.errors){if("string"==typeof data.errors)return void ZPeople.Message.showFailureMsg(data.errors);$.each(data.errors,function(key,errorMsg){Delegation.Add.constructErrorMsg(key,errorMsg)})}$("#"+Layout.Page.pageId).find("#delegModal").find(".modal-footer .btn-primary").removeAttr("disabled")},addDelegationRow:function(singleDeleg){var pageDiv=$("#"+Layout.Page.pageId).find("#delegationPage .ZPTscrlcont");if(void 0!=singleDeleg)if(pageDiv.removeClass("DN"),pageDiv.find("tbody [delegationid='"+singleDeleg.delegationId+"']").length>0){var oldSingleDeleg=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",singleDeleg.delegationId,!1,!0);Delegation.DELEGATION_JSON.splice(oldSingleDeleg.index,1,singleDeleg);var tableData=Delegation.View.constructDelgData(singleDeleg),tableRow=pageDiv.find("tbody [delegationid='"+singleDeleg.delegationId+"']");tableRow.empty(),tableRow.append(tableData)}else{Delegation.DELEGATION_JSON.splice(0,0,singleDeleg);var tableRow=Delegation.View.constructDelgRow(singleDeleg);$("#"+Layout.Page.pageId).find("#delegationPage #noData").remove(),pageDiv.find("tbody").prepend(tableRow)}Delegation.View.addClickEvent(pageDiv.find("table")),Delegation.Modal.closeDelegSlide()},constructErrorMsg:function(key,errorMsg){var delegModal=$("#"+Layout.Page.pageId).find("#delegModal #addEdit");("From"===key||"To"===key)&&(key="FromTo"),Delegation.Validation.showErrorMsg(delegModal.find("[label='"+key+"']"),errorMsg)}},Delegation.Edit={getSingleRecord:function(mode,delegationId){if(delegationId=delegationId?delegationId:Layout.Page.childUrlParam.delegationid,void 0!==delegationId){var singleDelegData=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",delegationId);void 0==singleDelegData||"edit"===mode&&!singleDelegData.hasEditDelPerm?ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"delegationOperation",mode:mode,conreqcsr:csrfToken,delegationId:delegationId},Delegation.Edit.constructEditData,mode):Delegation.Modal.openDelegSlide(mode,singleDelegData)}},constructEditData:function(data,param,mode){data.errors?Delegation.Edit.constructDelegError(mode,data.errors):Delegation.Modal.openDelegSlide(mode,data)},constructDelegError:function(mode,errorMsg){var messageHTML=$('<div class="col-lg-12 text-center" id="viewErrorModal"><div class="PArds"></div><h2 class="ZPNdt">'+errorMsg+"</h2></div>"),delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal");delegModalDiv.find("#viewErrorModal").remove(),delegModalDiv.modal("show"),delegModalDiv.find(".modal-header h6").html(Delegation.Edit.getModalHeaderStr(mode)),delegModalDiv.find(".modal-body form").addClass("DN"),delegModalDiv.find(".modal-body").append(messageHTML),delegModalDiv.find(".modal-footer .btn-default").removeClass("DN")},getModalHeaderStr:function(mode){var modalHeaderText="";return modalHeaderText="view"===mode?ZPI18N.getString("zp.viewdelegheader"):"edit"===mode?ZPI18N.getString("zp.editdelegheader"):ZPI18N.getString("zp.createdelegbtn")}},Delegation.Delete={deleteRecord:function(delegationId){void 0!==delegationId&&(isadmin||SelfService.Info.allow_add_delegation?ZPeople.BSModal.confirm(function(){Delegation.Delete.sendDeleteRequest(delegationId)},ZPI18N.getString("zp.confirm"),ZPI18N.getString("zp.deletedelegconfirm")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.deniedtodeltdelegperm")))},sendDeleteRequest:function(delegationId){ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"delegationOperation",conreqcsr:csrfToken,mode:"delete",delegationId:delegationId},Delegation.Delete.showMessage)},showMessage:function(data,params){if(data.errors)ZPeople.Message.showFailureMsg(data.errors);else if(data.success&&params.delegationId){ZPeople.Message.showSuccessMsg(data.success);var oldSingleDeleg=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",params.delegationId,!1,!0),selectedRow=$("#"+Layout.Page.pageId).find("#delegationPage tbody [delegationid="+params.delegationId+"]");"delete"===params.mode&&(Delegation.DELEGATION_JSON.splice(oldSingleDeleg.index,1),selectedRow.remove(),$("#"+Layout.Page.pageId).find("#delegationPage tbody tr").length<1&&($("#"+Layout.Page.pageId).find("#delegationPage .ZPTscrlcont").addClass("DN"),$("#"+Layout.Page.pageId).find("#delegationPage").append(CommonTemplates.noDataSVG("delegationPage",!0,ZPI18N.getString("zp.nodelegationmsg"),!1)),$("#"+Layout.Page.pageId).find("#delegationPage .mainhead").addClass("ndat")))}}};